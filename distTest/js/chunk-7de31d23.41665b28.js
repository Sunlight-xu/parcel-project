(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7de31d23"],{3189:function(e,t,i){},"772e":function(e,t,i){"use strict";i("92d9")},"92d9":function(e,t,i){},bcc0:function(e,t,i){"use strict";i("3189")},cdff:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"main_container"},[i("searchModule",{attrs:{"search-module":!0,type:"controlMission","filters-item":[["controlName","controlType","alarmLevel","controlType","planTime","status"]]}}),i("div",{staticClass:"search_content"},[i("div",{staticClass:"table_button"},[i("div",{staticClass:"button_left"}),i("div",{staticClass:"button_right"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.delMission()}}},[e._v(" 批量删除 ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.addMission}},[e._v(" 新增 ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.exportData}},[e._v(" 导出 ")]),i("el-dialog",{attrs:{width:"300px",visible:e.delMissionVisible},on:{"update:visible":function(t){e.delMissionVisible=t}}},[i("span",{staticClass:"button_left_dialog"},[e._v("确定要删除吗？")]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.delMissionVisible=!1}}},[e._v(" 取 消 ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.delMissionConfirm}},[e._v(" 确 定 ")])],1)])],1)]),i("div",{staticClass:"table_container"},[i("el-table",{ref:"dataTable",attrs:{data:e.dataList,"row-key":e.getKey,"header-cell-style":e.headerCellStyle,"cell-style":e.cellStyle},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"50"}}),i("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号"}}),i("el-table-column",{attrs:{label:"名称",prop:"name"}}),i("el-table-column",{attrs:{label:"布控库",prop:"group_id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.valueFilter(t.row.group_id,e.missionLibraryOptions))+" ")]}}])}),i("el-table-column",{attrs:{label:"等级",prop:"alarm_level"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.valueFilter(t.row.alarm_level,e.missionLevelOptions))+" ")]}}])}),i("el-table-column",{attrs:{label:"启用状态",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.valueFilter(t.row.status,e.missionStatusType))+" ")]}}])}),i("el-table-column",{attrs:{label:"布控人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.applicant.name)+" ")]}}])}),i("el-table-column",{attrs:{label:"发布时间",prop:"publish_time",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.timeFilter(t.row.publish_time))+" ")]}}])}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{directives:[{name:"show",rawName:"v-show",value:t.row.editable,expression:"scope.row.editable"}]},[i("i",{staticClass:"el-icon-edit-outline icon",on:{click:function(i){return e.modMission(t.row)}}})]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.row.editable,expression:"scope.row.editable"}],staticStyle:{padding:"0 10px"}},[i("i",{staticClass:"el-icon-delete icon",on:{click:function(i){return e.delMission(t.row)}}})]),i("span",[i("i",{staticClass:"el-icon-document icon",on:{click:function(i){return e.showDetail(t.row)}}})])]}}])})],1),i("div",{staticClass:"pagintion_content"},[i("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[1,10,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.hanleCurrentPChange,"size-change":e.handleSizeChange}})],1)],1)]),i("el-dialog",{attrs:{visible:e.missionVisible,"destroy-on-close":!0,"custom-class":e.inputDisable?"mission_dialog":"",title:e.dialogTitle},on:{"update:visible":function(t){e.missionVisible=t}}},[i("div",{staticClass:"mission_form"},[i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 任务名称: ")]),i("div",{staticClass:"mission_item_content"},[i("el-input",{attrs:{disabled:e.inputDisable},model:{value:e.missionName,callback:function(t){e.missionName=t},expression:"missionName"}})],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 布控地点: ")]),i("div",{staticClass:"mission_item_content"},[i("el-tree",{ref:"tree",attrs:{"node-key":"id","show-checkbox":!e.inputDisable,"default-checked-keys":e.checkedNodes,"default-expand-all":!1,data:e.inputDisable?e.filterTree:e.missionAreaOptions},on:{check:e.handlePollNode}})],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 布控原因: ")]),i("div",{staticClass:"mission_item_content"},[i("el-input",{attrs:{disabled:e.inputDisable},model:{value:e.missionReason,callback:function(t){e.missionReason=t},expression:"missionReason"}})],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 日期: ")]),i("div",{staticClass:"mission_item_content"},[i("el-date-picker",{attrs:{type:"date",disabled:e.inputDisable,placeholder:"选择日期"},model:{value:e.planStartDate,callback:function(t){e.planStartDate=t},expression:"planStartDate"}}),i("span",{staticClass:"mission_item_tag"},[e._v("-")]),i("el-date-picker",{attrs:{type:"date",disabled:e.inputDisable,placeholder:"选择日期"},model:{value:e.planEndDate,callback:function(t){e.planEndDate=t},expression:"planEndDate"}})],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 时间段: ")]),i("div",{staticClass:"mission_item_timeContent"},e._l(e.planTime,(function(t,s){return i("div",{key:s,staticClass:"mission_item_picker"},[i("el-time-picker",{attrs:{"is-range":"",disabled:e.inputDisable,"range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:e.planTime[s],callback:function(t){e.$set(e.planTime,s,t)},expression:"planTime[index]"}}),i("span",{staticClass:"mission_item_picker_button"},[s<=e.planTime.length-1&&0!==s&&!e.inputDisable?i("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.rmTimePicker(s)}}}):e._e(),s!==e.planTime.length-1||e.inputDisable?e._e():i("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.addTimePicker}})])],1)})),0)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 人脸库: ")]),i("div",{staticClass:"mission_item_content"},[i("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionLibrary,callback:function(t){e.missionLibrary=t},expression:"missionLibrary"}},e._l(e.missionLibraryOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 报警等级: ")]),i("div",{staticClass:"mission_item_content"},[i("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionLevel,callback:function(t){e.missionLevel=t},expression:"missionLevel"}},e._l(e.missionLevelOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),i("div",{staticClass:"mission_form_item"},[i("div",{staticClass:"mission_item_header"},[e._v(" 启用状态: ")]),i("div",{staticClass:"mission_item_content"},[i("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionStatus,callback:function(t){e.missionStatus=t},expression:"missionStatus"}},e._l(e.inputDisable?e.missionStatusType:e.missionStatusOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.addConcel}},[e._v(" 取 消 ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.addTrue}},[e._v(" 确定 ")])],1)])],1)},a=[],n=i("5530"),o=(i("4160"),i("d3b7"),i("159b"),i("b0c0"),i("99af"),i("0d03"),i("a434"),i("c975"),i("2f62")),l=i("5c96"),r=i("be46"),c=i("510e"),u=i("8dce"),m=i("d1cc"),d=i("365c"),h=i("f306"),p={data:function(){return{dataList:[],cellStyle:{textAlign:"center"},headerCellStyle:{textAlign:"center"},rowStyle:{background:"#22253B"},selection:[],currentPage:1,total:0,pageSize:10,missionVisible:!1,delMissionVisible:!1,missionId:"",missionName:"",missionArea:"",checkedNodes:[],filterTree:[],missionAreaOptions:[],missionLibrary:"",missionLibraryOptions:[],missionLevel:"",missionLevelOptions:[{label:"一级",value:1},{label:"二级",value:2},{label:"三级",value:3}],missionStatus:"",missionStatusType:[{label:"启用",value:1},{label:"停用",value:2},{label:"未开始",value:3},{label:"已过期",value:4}],missionStatusOptions:[{label:"启用",value:1},{label:"停用",value:2}],missionReason:"",planStartDate:"",planEndDate:"",planTime:[""],inputDisable:!1,dialogTitle:"新增任务",currentRow:null}},mixins:[h["a"]],computed:Object(n["a"])({},Object(o["b"])(["controlData","controlDataQuery","library","areaData","camerasData"])),watch:{controlData:function(){this.controlData&&this.controlData.controls?(this.dataList=this.controlData.controls,this.total=this.controlData.count):(this.dataList=[],this.total=0)},controlDataQuery:function(e){e.reset&&this.$refs.dataTable.clearSelection(),this.currentPage=e.page,this.pageSize=e.page_size},missionVisible:function(e){e||(this.missionName="",this.checkedNodes=[],this.missionLibrary="",this.missionStatus="",this.missionLevel="",this.missionReason="",this.planStartDate="",this.planEndDate="",this.planTime=[""])},areaData:function(){this.missionAreaOptions=this.areaData},library:function(){var e=[];this.library.forEach((function(t){2===t.type&&e.push({label:t.name,value:t.id})})),this.missionLibraryOptions=e}},components:{searchModule:r["a"]},mounted:function(){this.missionAreaOptions=this.areaData;var e=[];this.library.forEach((function(t){e.push({label:t.name,value:t.id})})),this.missionLibraryOptions=e},methods:{getKey:function(e){return e.id},valueFilter:function(e,t){var i="";return t.forEach((function(t){e===t.value&&(i=t.label)})),i},timeFilter:function(e){var t=c["a"].getTime(e);return"".concat(t.nowYear,"/").concat(t.nowMonth,"/").concat(t.nowDate," ").concat(t.nowHour,":").concat(t.nowMin,":").concat(t.nowSec)},refreshData:function(e){this.controlDataQuery.type&&!this.controlDataQuery.check_status&&0!==this.controlDataQuery.check_status&&this.$store.dispatch("SEARCHCONTROL",Object(n["a"])(Object(n["a"])({},this.controlDataQuery),e))},addMission:function(){this.inputDisable=!1,this.dialogTitle="新增任务",this.missionVisible=!0},modMission:function(e){this.inputDisable=!1,this.missionId=e.id,this.missionName=e.name,this.missionReason=e.reason,this.missionLevel=e.alarm_level,this.checkedNodes=e.cameras,this.missionLibrary=e.group_id,this.missionStatus=e.status>2?1:e.status;var t=[];e.periods.forEach((function(e){t.push([new Date(1e3*e[0]+new Date((new Date).setHours(0,0,0,0)).getTime()),new Date(1e3*e[1]+new Date((new Date).setHours(0,0,0,0)).getTime())])})),this.planTime=t,this.planStartDate=new Date(1e3*e.start_time),this.planEndDate=new Date(1e3*e.end_time),this.dialogTitle="修改任务",this.missionVisible=!0},showDetail:function(e){this.missionName=e.name,this.missionReason=e.reason,this.missionLevel=e.alarm_level,this.checkedNodes=e.cameras,this.missionLibrary=e.group_id,this.missionStatus=e.status;var t=[];e.periods.forEach((function(e){t.push([new Date(1e3*e[0]+new Date((new Date).setHours(0,0,0,0)).getTime()),new Date(1e3*e[1]+new Date((new Date).setHours(0,0,0,0)).getTime())])})),this.planTime=t,this.planStartDate=new Date(1e3*e.start_time),this.planEndDate=new Date(1e3*e.end_time),this.dialogTitle="任务详情",this.inputDisable=!0,this.missionVisible=!0,this.filterTreeNode()},delMission:function(e){!e&&this.selection.length<1?l["Message"].error({message:"请选择任务再进行操作"}):(this.currentRow=e||null,this.delMissionVisible=!0)},delMissionConfirm:function(){var e=this,t=[];this.currentRow?t.push(this.currentRow.id):this.selection.forEach((function(e){t.push(e.id)})),Object(m["c"])(t).then((function(i){var s=1;1===t.length&&(s=c["a"].formatPage({current:e.currentPage,size:e.pageSize,total:e.total},"del")),0===i.error_no?(l["Message"].success({message:"删除成功"}),e.refreshData({page:s})):504===i.error_no&&e.refreshData({page:s})})),this.delMissionVisible=!1},addTimePicker:function(){this.planTime.push("")},rmTimePicker:function(e){this.planTime.splice(e,1)},addConcel:function(){this.missionVisible=!1},addTrue:function(){var e=this;if("任务详情"!==this.dialogTitle)if(this.missionName&&this.planStartDate&&this.planEndDate&&0!==this.checkedNodes.length&&this.planTime[0]&&this.missionLibrary&&this.missionLevel&&this.missionStatus&&this.missionReason){var t=[];if(this.planTime[0]){var i=!1;if(this.planTime.forEach((function(e){var s=(e[0].getTime()-new Date((new Date).setHours(0,0,0,0)).getTime())/1e3,a=(e[1].getTime()-new Date((new Date).setHours(0,0,0,0)).getTime())/1e3;a-s<=0&&(i=!0);var n=[s,a];t.push(n)})),i)return void l["Message"].error({message:"结束时间应大于开始时间"})}if(this.planEndDate.getTime()-this.planStartDate.getTime()<0)l["Message"].error({message:"结束日期不能小于开始日期"});else{var s={name:this.missionName,reason:this.missionReason,start_time:new Date(this.planStartDate).getTime()/1e3,end_time:new Date(this.planEndDate).getTime()/1e3,camera_ids:this.checkedNodes,periods:t,group_id:this.missionLibrary,alarm_level:this.missionLevel,status:this.missionStatus,type:1};"新增任务"===this.dialogTitle?Object(m["a"])(s).then((function(t){0===t.error_no?(l["Message"].success({message:"添加成功"}),e.missionVisible=!1,e.refreshData({page:1})):l["Message"].error({message:"请正确填写信息"})})):"修改任务"===this.dialogTitle&&Object(m["e"])(this.missionId,s).then((function(t){0===t.error_no?(l["Message"].success({message:"修改成功"}),e.missionVisible=!1,e.refreshData()):l["Message"].error({message:"请正确填写信息"})}))}}else l["Message"].error({message:"请填写完整"});else this.missionVisible=!1},handleSelectionChange:function(e){var t=this;this.selection=[],e&&e.forEach((function(e){e&&t.selection.push(e)}))},handlePollNode:function(e,t){var i=this;this.checkedNodes=[],t.checkedNodes.forEach((function(e){e.id&&i.checkedNodes.push(e.id)}))},hanleCurrentPChange:function(e){this.refreshData({page:e,reset:0})},handleSizeChange:function(e){this.refreshData({page_size:e,page:1,reset:0})},exportData:function(){var e=this;if(this.selection.length<1)l["Message"].error({message:"请选择导出数据"});else{var t=[[]];this.selection.forEach((function(i){t[0].push({"名称":i.name,"布控库":e.valueFilter(i.group_id,e.missionLibraryOptions),"报警等级":e.valueFilter(i.alarm_level,e.missionLevelOptions),"启用状态":e.valueFilter(i.status,e.missionStatusType),"布控人":i.applicant.name,"发布时间":e.timeFilter(i.publish_time)})})),Object(u["a"])(t,["任务配置"],"任务配置");var i={action:"导出",extra:"任务配置"};Object(d["b"])(i).then((function(){}))}},filterTreeNode:function(){var e=this,t=[];this.camerasData.forEach((function(i){-1!==e.checkedNodes.indexOf(i.id)&&t.push(i)})),this.filterTree=c["a"].handleData(t)}}},b=p,f=(i("772e"),i("bcc0"),i("2877")),v=Object(f["a"])(b,s,a,!1,null,"5f14bbc0",null);t["default"]=v.exports}}]);