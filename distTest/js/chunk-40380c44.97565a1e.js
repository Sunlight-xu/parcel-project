(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40380c44"],{"0f2a":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAntJREFUSA21Vr9rVEEQ/uZ5GoIKWgTOK8KJkAO1MprKIiZqq2JpKVgYEKv7B7SKTRByhbYKNoIpgsKpsRCL01iK2ogR7tQgighBPW+d773su/dj76fPad6+md3v29mZnVlBD5ky6xMtNE+3YE4IMG4gBS4RmLoB1jxI1UPuXk3G3naD0rVuOWTqkwKZNzAz7hlxrc59rHPLL6WwGrcEfymiaWNyP/BxoQVcBEzK7gJp68R4QGUH8pefiDTbep5ARI6ab7s3sHFXd3Ysoh54qN6tjGL07FPZ9dUu1g0EQk+yICEaN0osYm7CIyTicf2rJxbUkhHT6vyjY+D1FJ8PHhML0+krmpjmCBPE94jZlT2J75cE2OrGYbNeauH360576kvf0hy9XwMOFIFiPrUkh60l9ah5KmUZREGSK7eAq7eBm8vOlbzwHm+809qP0pI80PBuHwHOzTpXkcPTbBh3Wu+sAOevaZH55DQjSbIwB+wvOueSw7O1KzXjw2fg1ZrWh+vA+wSZi+Tg3hSEVZAjvEdWGX4vnQGmSsCX78BchGxAEuKpR0aPztRD8OhgZBswfyFO9q4RBN7GhMfVxZM2nGmIXtaqKo63lYnRz19A+QZQewPktmiS/gkC3zeJj/fQYz9JQMd/o54NR6J1Tqr9X1h6tvQMmJwA9hXim+nxxwurcdK1pvFIC+pMj/lDmdkQV2XPrJ91SlLW3NACmLWICbARtInN6lrJmka9qNjWHt4jtl92xqzIiEVMixcSscez/WZBRgxiRd8NIRGZ2eN3In9S03FxuJjxcSKLxIi+F4jtZx0HSfnvz60kIRsje1a3B6SWjKUXMqalo7P8Bamx9k5jBSVTAAAAAElFTkSuQmCC"},"134c":function(t,e,i){"use strict";i("5e36")},1807:function(t,e,i){},"5e36":function(t,e,i){},6062:function(t,e,i){"use strict";var a=i("6d61"),s=i("6566");a("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},d548:function(t,e,i){"use strict";i("eb7d")},e7d5:function(t,e,i){},eb7d:function(t,e,i){},ec86:function(t,e,i){"use strict";i("1807")},f0d99:function(t,e,i){"use strict";i("e7d5")},f322:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.showMissionDetail?i("recall-detail",{attrs:{missionData:t.missionData,currentTask:t.currentTaskId},on:{backRecallList:t.backMissionDetail}}):i("section",{staticClass:"patch_track_container"},[i("div",{staticClass:"patch_track_header"},[i("div",{staticClass:"table_control"},[i("ul",[i("li",{class:"轨迹完善"==t.contentRadio?"active":"",on:{click:function(e){return t.changeTab("轨迹完善")}}},[t._v(" 轨迹完善 ")]),i("li",{class:["轨迹回溯任务"==t.contentRadio?"active":"","number_position"],on:{click:function(e){return t.changeTab("轨迹回溯任务")}}},[t._v("轨迹回溯任务 "),i("span",[t._v(t._s(t.downValue))])])]),i("div",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.patchPoint("all")}}},[t._v("全场补全")]),i("el-button",{staticClass:"task_button",attrs:{type:"primary",disabled:t.isDisabled},on:{click:t.createPatckTask}},[t._v("创建轨迹回溯任务")])],1)])]),"轨迹完善"===t.contentRadio?i("section",{staticClass:"patch_track_main_container"},[i("searchModule",{attrs:{searchModule:!0,type:"trackHistory",catchImg:t.catchImg,defaultQuery:t.defaultQuery,filtersItem:[["time","gate","flightNumber","boardNumber","ids","singleImgs","similar","target","filter"]]}}),i("div",{staticClass:"content"},[i("div",{staticClass:"map_content border_radius"},[i("Map",{key:"track",attrs:{oldmap:!1,floors:t.floorInfo,allTracks:t.allFloorTracksData,lastFloorId:t.lastFloorId,camerasData:t.camerasData,personalAllTracks:t.personalAllTracks},on:{setCurrentFloor:t.setCurrentFloor,showLastVideo:t.showVideo,showBodyDialog:t.showBodyDialog}}),i("div",{staticClass:"map_content_hint"},[i("span",[t._v("有 "+t._s(t.missOutsNumber)+" 段需补全的轨迹，请在地图上点击图标进行修补。")]),i("span",{staticStyle:{margin:"8px 0"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showSetTimeVisible("start")}}},[t._v("补起点")])],1),i("span",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showSetTimeVisible("end")}}},[t._v("补终点")])],1)])],1),i("div",{staticClass:"result_card border_radius"},[t.securityData.image_url?i("div",{staticClass:"card_container_security"},[i("span",{staticClass:"card_container_security_title"},[t._v("照片")]),i("div",{staticClass:"card_container_security_card border_radius"},[i("img",{staticClass:"border_radius",attrs:{src:t.securityData.image_url,alt:""}}),i("div",{staticClass:"card_container_security_info"},[i("span",{staticClass:"card_container_security_info_name"},[t._v(" "+t._s(t.securityData.name))]),i("span",[t._v(t._s(t.securityData.number))])])])]):t._e(),i("div",{staticClass:"user_card",style:t.securityData.image_url?{width:"calc(100% - 288px)"}:{width:"100%"}},[t._m(0),i("ul",{staticClass:"card_container"},t._l(t.searchData,(function(e){return i("li",{key:e.pid,staticClass:"img_content border_radius",attrs:{id:e.pid}},[i("div",{staticClass:"img_content_info",on:{mouseenter:function(i){return t.handleMouseEnter(e)},mouseleave:function(e){return t.handleMouseLeave()}}},[i("img",{staticClass:"border_radius",attrs:{src:e.image_url,alt:""}}),t.currentPid===e.pid?i("div",{staticClass:"has_choose"}):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:t.currentHoverPid===e.pid,expression:"currentHoverPid === item.pid"}],staticClass:"hover_content"},[i("div",{staticClass:"detail_button",staticStyle:{"margin-bottom":"8px"},on:{click:function(i){return t.showDeatil(e.pid)}}},[t._v(" 详情 ")]),i("div",{staticClass:"detail_button",on:{click:function(i){return t.trackChange(e)}}},[t._v(" 查看轨迹 ")])])]),i("div",{staticClass:"score_span"},[i("span",[t._v("相似度 "),i("i",{staticClass:"score_i"},[t._v(t._s(e.score)),i("i",{staticClass:"symbol"},[t._v("%")])])])])])})),0)])])]),i("my-dialog",{attrs:{isVisible:t.detailVisible,title:"轨迹详情",width:"940px"},on:{close:t.handleClose},scopedSlots:t._u([{key:"content",fn:function(){return["列表"===t.radio?i("div",{staticClass:"table_content"},[i("common-table",{attrs:{isShowIndex:!0,tableColArray:t.detailTableColumn,currentPage:t.currentPage,pageSize:t.pageSize,tableData:t.tableData},scopedSlots:t._u([{key:"image",fn:function(e){return[i("img",{attrs:{src:e.row.image_url,width:"80",height:"100"},on:{click:function(i){return t.checkLargeImg(e.row.image_url)}}})]}},{key:"end",fn:function(e){return[t._v(" "+t._s(t._f("timeFilter")(e.row.trajectory[e.row.trajectory.length-1].timestamp))+" ")]}},{key:"channel",fn:function(e){return[t._v(" "+t._s(t.cameraFilter(e.row.camera.ip,"location"))+" ")]}},{key:"video",fn:function(e){return[-1===t.videoLoading.indexOf(e.row.track_id)?i("i",{staticClass:"el-icon-video-play",staticStyle:{"font-size":"20px"},on:{click:function(i){return t.openVideo(e.row)}}}):i("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"20px"}})]}}],null,!1,4248996090)})],1):t._e(),i("div",{staticClass:"pagintion_content"},[i("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.hanleCurrentPChange,"size-change":t.handleSizeChange}})],1)]},proxy:!0}],null,!1,935100155)}),i("my-dialog",{attrs:{isVisible:t.setTimeVisible,width:"490px",title:"时间设置"},on:{close:t.handleCloseSetime},scopedSlots:t._u([{key:"content",fn:function(){return[i("div",{staticStyle:{display:"flex"}},[i("span",{staticStyle:{width:"100px","line-height":"40px"}},[t._v(t._s("start"===t.pointType?"起点时间":"终点时间"))]),i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","default-time":"12:00:00"},model:{value:t.setTimeValue,callback:function(e){t.setTimeValue=e},expression:"setTimeValue"}})],1),i("span",{staticStyle:{display:"inline-block","margin-top":"8px","margin-left":"80px"}},[t._v("当前轨迹"+t._s("start"===t.pointType?"起点时间":"终点时间")+"为 "+t._s(t._f("timeFilter")(t.trackPointTime)))])]},proxy:!0},{key:"footer",fn:function(){return[i("div",[i("el-button",{on:{click:t.hideSetTimeVisible}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.patchPoint(t.pointType)}}},[t._v("确定")])],1)]},proxy:!0}],null,!1,4253022901)}),i("checkLargeImg",{attrs:{show:t.showLargeImg,imgUrl:t.imgList},on:{isClose:t.closeImg}})],1):i("recall-list",{attrs:{type:1},on:{missionDetail:t.missionDetail}}),i("MyDialog",{attrs:{title:"补全轨迹",isVisible:t.isShowPhoto,width:"80%"},on:{close:t.handleClosePhoto},scopedSlots:t._u([{key:"content",fn:function(){return[i("SearchPhoto",{attrs:{isShowPhoto:t.isShowPhoto,currentPid:t.currentPid,isReset:t.isReset,currentMissOut:t.currentMissOut},on:{patchTrackData:t.patchTrackData}})]},proxy:!0}],null,!1,3614902226)}),i("MyDialog",{staticClass:"task_dialog",attrs:{title:"创建轨迹回溯任务",isVisible:t.showTaskDialog,width:"30%"},on:{close:t.handleCloseTaskDialog},scopedSlots:t._u([{key:"content",fn:function(){return[i("ul",[i("li",[i("p",[t._v("任务名称:")]),i("el-input",{model:{value:t.newTask.name,callback:function(e){t.$set(t.newTask,"name",e)},expression:"newTask.name"}})],1),i("li",[i("p",[t._v("同行时间(秒):")]),i("el-input",{model:{value:t.newTask.duration,callback:function(e){t.$set(t.newTask,"duration",e)},expression:"newTask.duration"}})],1),i("li",[i("p",[t._v("最小间距(米):")]),i("el-input",{model:{value:t.newTask.instance,callback:function(e){t.$set(t.newTask,"instance",e)},expression:"newTask.instance"}})],1)])]},proxy:!0},{key:"footer",fn:function(){return[i("div",[i("el-button",{on:{click:t.handleCloseTaskDialog}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitPatchTask}},[t._v("确定")])],1)]},proxy:!0}],null,!1,2135356998)}),i("el-dialog",{attrs:{width:"860px",visible:t.videoVisible},on:{"update:visible":function(e){t.videoVisible=e}}},[i("video",{attrs:{src:t.trackVideo,width:"800",autoplay:"",controls:""}})]),i("div",{staticClass:"info_popover",style:t.infoStyle},[i("span",{staticClass:"info_popover_name"},[t._v(t._s(t.currentUserName))]),i("span",{staticClass:"info_popover_number"},[t._v(t._s(t.currentUserNumber))]),i("div",{staticClass:"info_popover_arrow"})])],1)},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user_card_title"},[i("span",[t._v("比对结果"),i("i",[t._v("(选择下面的照片后显示此人的轨迹)")])])])}],r=i("5530"),n=i("2909"),o=(i("99af"),i("4160"),i("d3b7"),i("159b"),i("b64b"),i("a9e3"),i("4795"),i("b0c0"),i("e9c4"),i("caad"),i("2532"),i("4de4"),i("c975"),i("a434"),i("45fc"),i("0d03"),i("4e82"),i("2f62")),c=i("5c96"),l=i("4af1"),h=i("406e"),u=i("f576"),d=i.n(u),m=i("8e6c"),p=i("b837"),g=i("be46"),f=i("7c8a"),_=i("510e"),k=i("8572"),v=i.n(k),y=i("0f11"),b=i.n(y),T=i("9e60"),I=i.n(T),D=i("fa93"),w=i.n(D),x=i("0f2a"),C=i.n(x),S=i("fefb"),L=i("d98f"),P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"search_photo"},[i("div",{staticClass:"search_photo_select"},[i("div",{staticClass:"search_photo_select_header"},[i("span",[t._v("已挑选"+t._s(t.allSelectList.length-1)+"张照片")]),i("div",[i("el-button",{attrs:{type:"primary"},on:{click:t.checkTrack}},[t._v(" 生成轨迹")])],1)]),i("div",{staticClass:"search_photo_select_list"},[1===t.currentPage?i("el-upload",{staticClass:"avatar-uploader",attrs:{"auto-upload":!1,action:"","show-file-list":!1,"on-change":t.beforeAvatarUpload}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]):t._e(),t._l(t.currentPageList,(function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHidden,expression:"!item.isHidden"}],key:e.cluster_id,staticClass:"item",style:e.showDel?"background-color: rgba(1,1,1,.3);":"",on:{mouseleave:function(i){return t.leaveImg(e)}}},[i("img",{attrs:{src:e.image_url,alt:""},on:{mouseover:function(i){return t.overImg(e)}}}),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showDel,expression:"item.showDel"}],staticClass:"del_img",attrs:{type:"primary"},on:{click:function(i){return t.delImg(e)}}},[t._v("删除")])],1)})),0===t.currentPageList.length?i("div",{staticClass:"empty"},[t._v("暂未选择照片")]):t._e()],2),i("div",{staticClass:"search_photo_select_pagination"},[i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":10,"current-page":t.currentPage,total:t.allSelectList.length},on:{"current-change":t.handleCurrentChange}})],1)]),i("div",{staticClass:"search_photo_top"},[i("div",{staticClass:"left"},[i("p",[t._v("第"+t._s(t.round)+"轮搜索结果")]),i("el-button",{staticClass:"next_btn",attrs:{type:"primary"},on:{click:t.nextSearch}},[t._v("下一轮搜索")])],1),i("div",{staticClass:"right"},[i("el-checkbox",{staticStyle:{"margin-right":"24px"},attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("全选")])],1)]),i("div",{staticClass:"search_photo_bottom"},[0!==t.dataList.length?i("div",{ref:"content",staticClass:"search_photo_bottom_result"},t._l(t.dataList,(function(e){return i("div",{key:e.cluster_id,staticClass:"result_list"},[i("div",{staticClass:"result_list_top"},[i("img",{attrs:{src:e.image_url,alt:""},on:{click:function(i){return t.checkLargeImg(e.image_url)}}})]),i("div",{staticClass:"result_list_bottom"},[i("div",[t._v(t._s(e.location))]),i("div",{staticClass:"info"},[i("span",[t._v(t._s(e.created_at))]),i("img",{staticClass:"check_img",attrs:{src:e.isCheck?t.radioCheckImg:t.radioImg,alt:""},on:{click:function(i){return t.checkItem(e)}}})])])])})),0):i("div",{ref:"content",staticClass:"search_photo_bottom_tip"},[t._v(" 无数据 ")])]),i("div",{staticClass:"search_photo_pagination"},[i("el-pagination",{attrs:{"current-page":t.allCurrentPage,"page-sizes":[10,20,30,40],"page-size":t.allPageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.allTotal},on:{"size-change":t.handleSizeAllChange,"current-change":t.handleCurrentAllChange}})],1)])},A=[],V=(i("ac1f"),i("1276"),i("fb6a"),i("a623"),i("a630"),i("3ca3"),i("6062"),i("ddb0"),i("1816")),E=i.n(V),j=i("2f56"),O=i.n(j),R=i("0ee0"),M=i.n(R),F=i("aa6f"),z=i.n(F),B=i("365c"),N={name:"SearchPhoto",props:{currentPid:{type:String,default:""},currentMissOut:{type:Array,default:Function},isShowPhoto:{type:Boolean,default:!1},isReset:{type:Boolean,default:!1}},data:function(){return{missionAreaOptions:[],checkedNodes:[],bellImg:E.a,radioImg:O.a,radioCheckImg:M.a,placeholder:z.a,dataList:[],visible:!1,queryId:"",round:0,photoCount:0,disabledItem:!1,isCheckAll:!1,isIndeterminate:!1,showLargeImg:!1,imgList:[],selectIdList:[],allSelectList:[],currentPageList:[],currentPage:1,pageSize:30,previewTracksData:[],allTrackList:[],isNextSearch:!1,allCurrentPage:1,allPageSize:10,allTotal:0,uploadImgList:[]}},mounted:function(){this.missionAreaOptions=this.areaData},computed:Object(r["a"])({},Object(o["b"])(["areaData","floorInfo","pidsDataQuery"])),watch:{isReset:function(){this.isReset&&this.getReset()},isShowPhoto:{handler:function(){this.isShowPhoto&&(this.allCurrentPage=1,this.allPageSize=10,0===this.round&&0===this.currentPageList.length?this.getMissData():(this.dataList=[],this.allPageSize=10,this.allCurrentPage=1,this.allTotal=0))},immediate:!0},areaData:function(){this.missionAreaOptions=this.areaData},dataList:{handler:function(){var t=this;this.dataList.forEach((function(e){e.isCheck&&!t.selectIdList.includes(e.cluster_id)?(t.selectIdList.push(e.cluster_id),t.allSelectList.push(Object(r["a"])(Object(r["a"])({},e),{},{showDel:!1}))):!e.isCheck&&t.selectIdList.includes(e.cluster_id)&&(t.removeElement(t.selectIdList,e.cluster_id),t.allSelectList.forEach((function(i,a){i.cluster_id===e.cluster_id&&t.allSelectList.splice(a,1)})))})),this.judgePage(),this.judgeSelectStatus()},deep:!0}},methods:{beforeAvatarUpload:function(t){var e=this,i=new FileReader;i.readAsDataURL(t.raw),i.onload=function(t){var i={image:t.target.result.split(",")[1]};Object(S["E"])(i).then((function(i){0===i.error_no&&(e.uploadImgList.push(i.data.image_id),e.allSelectList.splice(1,0,{cluster_id:i.data.image_id,image_url:t.target.result,isCheck:!0,showDel:!1}),e.selectIdList.unshift(i.data.image_id),e.currentPageList=e.allSelectList.slice(0,10))}))}},judgePage:function(){while(this.allSelectList.length+10<=10*this.currentPage&&1!==this.currentPage)this.currentPage=this.currentPage-1;1===this.currentPage?this.currentPageList=this.allSelectList.slice(0,10):this.currentPageList=this.allSelectList.slice(10*(this.currentPage-1),10*(this.currentPage-1)+10)},judgeSelectStatus:function(){var t=this.dataList.some((function(t){return!0===t.isCheck})),e=this.dataList.every((function(t){return!0===t.isCheck}));t?e?(this.isCheckAll=!0,this.isIndeterminate=!1):(this.isIndeterminate=!0,this.isCheckAll=!1):(this.isIndeterminate=!1,this.isCheckAll=!1)},handleSizeAllChange:function(t){this.allPageSize=t,0!==this.dataList.length&&this.getMissData(!0)},handleCurrentAllChange:function(t){this.allCurrentPage=t,0!==this.dataList.length&&this.getMissData(!0)},getMissData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0!==this.uploadImgList.length){var i=[].concat(Object(n["a"])(this.uploadImgList),Object(n["a"])(this.selectIdList));Array.from(new Set(i)).length!==i.length&&this.uploadImgList.forEach((function(e){t.removeElement(t.selectIdList,e)}))}var a={pid:this.currentPid,start_time:this.pidsDataQuery.start_time,end_time:this.pidsDataQuery.end_time,page:this.allCurrentPage,page_size:this.allPageSize,filters:this.currentMissOut,chosen_cids:e?[]:this.selectIdList,chosen_image_ids:this.uploadImgList,query_id:this.queryId||void 0};Object(S["k"])(a).then((function(e){0===e.error_no&&(t.queryId=e.data.query_id,t.checkedNodes=[],0===t.currentPageList.length&&0===t.round?(t.allCurrentPage=1,t.allPageSize=10,t.allTotal=0,e.data.cluster_infos.forEach((function(e){e.isCheck=!0,e.showDel=!1,t.selectIdList.push(e.cluster_id),t.allSelectList.push(e)})),t.allSelectList.unshift({cluster_id:"",image_url:"",isCheck:!0,showDel:!1,isHidden:!0}),t.currentPageList=t.allSelectList.slice(0,10),t.dataList=[]):(t.allCurrentPage=e.data.page,t.allPageSize=e.data.page_size,t.allTotal=e.data.total_element,e.data.cluster_infos.forEach((function(e){t.selectIdList.includes(e.cluster_id)?e.isCheck=!0:e.isCheck=!1})),t.dataList=e.data.cluster_infos,t.judgeSelectStatus()),t.isNextSearch=!1)}))},delImg:function(t){var e=this,i=[].concat(Object(n["a"])(this.uploadImgList),Object(n["a"])(this.selectIdList)),a=i.length-Array.from(new Set(i)).length;this.selectIdList.length-a===1&&this.selectIdList.slice(a,this.selectIdList.length).includes(t.cluster_id)?c["Message"].error("至少选择一张照片"):(this.uploadImgList.includes(t.cluster_id)&&this.removeElement(this.uploadImgList,t.cluster_id),this.dataList.forEach((function(e){e.cluster_id===t.cluster_id&&(e.isCheck=!1)})),this.allSelectList.forEach((function(i,a){t.cluster_id===i.cluster_id&&(e.allSelectList.splice(a,1),e.removeElement(e.selectIdList,t.cluster_id))})),this.judgePage())},leaveImg:function(t){t.showDel=!1},overImg:function(t){t.showDel=!0},handleCurrentChange:function(t){this.currentPage=t,this.currentPageList=this.allSelectList.slice(10*t-10,10*t)},closeImg:function(t){t&&(this.showLargeImg=!1,this.imgList=[])},checkLargeImg:function(t){this.showLargeImg=!0,this.imgList.push(t)},handleCheckAllChange:function(){var t=this;this.isCheckAll=!!this.isCheckAll,this.isIndeterminate=!1,this.dataList.forEach((function(e){e.isCheck=t.isCheckAll}))},getReset:function(t){this.disabledItem=!1,this.dataList=[],this.currentPageList=[],this.allSelectList=[],this.selectIdList=[],this.allTrackList=[],this.round=0,this.allPageSize=10,this.allCurrentPage=1,this.allTotal=0,this.currentPid="",this.queryId="",this.uploadImgList=[]},checkItem:function(t){var e=this;t.isCheck=!t.isCheck,this.dataList.forEach((function(i,a){t.cluster_id===i.cluster_id&&e.dataList.splice(a,1,t)}))},removeElement:function(t,e){return t.forEach((function(i,a){i===e&&t.splice(a,1)})),t},checkTrack:function(){var t=this,e={query_id:this.queryId,cluster_ids:this.selectIdList,preview:!0};Object(B["e"])(e).then((function(e){0===e.error_no&&(t.allTrackList=e.data.tracks,t.$emit("patchTrackData",t.allTrackList,t.selectIdList))}))},nextSearch:function(){this.round=this.round+1,this.isNextSearch=!0,this.getMissData()}}},Q=N,q=(i("134c"),i("d548"),i("2877")),H=Object(q["a"])(Q,P,A,!1,null,"2b7d8e9b",null),K=H.exports,J=i("fab6"),U=i("b857"),W=[{label:"名称",props:"name"},{type:"slot",slot:"image",props:"snap_image",label:"建档照",width:"100px"},{props:"progress",label:"进度",type:"slot",slot:"progress"},{props:"status",label:"状态",type:"slot",slot:"status"},{props:"peer_duration",label:"同行时间",type:"slot",slot:"peer_duration"},{props:"peer_closest_distance",label:"最小间距",type:"slot",slot:"peer_closest_distance"},{label:"创建时间",props:"created_at",type:"date",width:"150px"},{props:"",type:"slot",slot:"operation",label:"操作"}],X=[{type:"slot",slot:"image",props:"image_url",label:"人像照",width:"100px"},{label:"开始时间",props:"timestamp",type:"date"},{label:"结束时间",props:"end_at",type:"slot",slot:"end"},{label:"抓拍相机",props:"channel",type:"slot",slot:"channel"},{label:"操作",props:"",slot:"video",type:"slot",width:"60px"}],Z={data:function(){return{changeProgress:!1,currentData:{},taskPage:1,taskPageSize:10,taskTotal:0,allVideoData:{},isPlay:!1,currentVideo:"",currentTime:"",videoList:[],isShowPhoto:!1,total:0,taskName:"",playIcon:v.a,errorIcon:w.a,rightIcon:C.a,searchData:[],searchPeerData:[],securityData:{},tableData:[],taskTableData:[],cellStyle:{textAlign:"center"},headerCellStyle:{textAlign:"center"},rowStyle:{background:"#22253B"},contentRadio:"轨迹完善",radio:"列表",videoRadio:"1",detailQuery:{},pageSize:10,currentPage:1,currentRow:[],currentPid:"",currentTracks:[],detailVisible:!1,videoVisible:!1,tracksData:[],cameraList:[],tableHeight:0,videoLoading:[],trackVideo:"",catchImg:"",showTrackVideoData:{},chooseIndex:-1,similarity:70,floor:"F2",floors:[],queryParam:"",allFloorTracksData:[],avatar:"",currentHoverPid:"",lastFloorId:0,inputNameVisible:!1,tableColumn:W,detailTableColumn:X,imgList:[],showLargeImg:!1,defaultQuery:{},isSaveData:"",showMissionDetail:!1,currentMissOut:[],personalAllTracks:[],floorNumber:[],shortList:[],isReset:!1,newTask:{name:"",duration:15,instance:5},clusterIdList:[],showTaskDialog:!1,statusList:{0:"初始化",1:"进行中",2:"已完成",3:"异常"},isDisabled:!0,downValue:0,alertList:[],socketInterval:null,searchQuery:{},searchDetailQuery:{},trackIndex:0,trackLength:1e4,tracksIndexMap:{},tracksSectionIndex:0,currentTracksIndex:-1,currentFloorId:-1,groupsList:[],personalInfo:{},gap:70,boxViewStyle:{},boxesData:[],groupIdList:[],currentCheckId:"",checkHint:I.a,missOutsNumber:0,pointType:"start",setTimeValue:"",setTimeVisible:!1,mapCurrentFloorId:0,trackPointTime:0,currentUserName:"",currentUserNumber:"",infoStyle:{display:"none"},selectionList:[],playRate:"1x",rateListVisible:!1,rateList:["0.5x","1x","2x","4x","8x"],missionData:{},currentTaskId:""}},components:{searchModule:g["a"],Map:l["a"],MyDialog:m["a"],CommonTable:p["a"],checkLargeImg:f["a"],SearchPhoto:K,RecallList:J["a"],RecallDetail:U["a"]},computed:Object(o["b"])(["pidsData","pidsDataQuery","camerasData","place","floorInfo","trackTaskValue","trackTaskList"]),filters:{timeFilter:function(t){var e=_["a"].getTime(t/1e3);return"".concat(e.nowYear,"-").concat(e.nowMonth,"-").concat(e.nowDate," ").concat(e.nowHour,":").concat(e.nowMin,":").concat(e.nowSec)}},watch:{trackTaskList:function(){var t=this;this.taskTableData.forEach((function(e){t.trackTaskList.forEach((function(t){e.id===t.id&&(e.progress=t.progress,e.status=t.status)}))}))},trackTaskValue:{handler:function(){console.log(this.trackTaskValue),this.downValue=this.trackTaskValue},immediate:!0},showMissionDetail:function(){this.showMissionDetail||this.tracktimer&&clearTimeout(this.tracktimer)},pidsData:function(){this.isDisabled=!0,this.pageSize=10,this.currentPage=1,this.chooseIndex=-1,this.currentPid="",this.isSaveData="",this.personalAllTracks=[],this.missOutsNumber=0,this.securityData=this.pidsData?this.pidsData.security:{},this.queryParam=this.pidsData?this.pidsData.query_param:"",this.securityData.image_url?(this.searchData=this.pidsData.users,0===this.searchData.length&&c["Message"].error({message:"未找到对应的抓拍照，请调整相似度"})):this.pidsData&&this.pidsData.users?this.searchData=this.pidsData.users:this.searchData=[],this.tracksData=[],this.allFloorTracksData=[],this.similarity=this.pidsDataQuery.score?this.pidsDataQuery.score:60},place:{handler:function(t){this.floors=Object.keys(t),this.floor=this.floors[0]},immediate:!0},contentRadio:function(){this.contentRadio}},created:function(){var t=this;L["a"].$on("showTrackSearch",(function(e){t.showSaveData(e)}))},mounted:function(){var t=this.$route.params.id;this.showSaveData(t)},beforeDestroy:function(){this.tracktimer&&clearTimeout(this.tracktimer),this.ramf&&cancelAnimationFrame(this.ramf),this.$refs.media&&Object(h["b"])(this.$refs.media,this.resize),this.socketInterval&&clearInterval(this.socketInterval)},methods:{batchDel:function(){var t=this;if(0!==this.selectionList.length){var e=[];this.selectionList.forEach((function(t){e.push(t.id)})),c["MessageBox"].confirm("确定要执行批量删除操作吗？",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"reset_password"}).then((function(){Object(S["e"])({ids:e}).then((function(e){0===e.error_no&&(c["Message"].success({message:"批量删除成功"}),t.getPatchTaskList())}))}))["catch"]((function(){c["Message"].info({message:"已取消删除"})}))["finally"]((function(){t.$refs.children.$refs.singleTable.clearSelection()}))}else c["Message"].warning({message:"请选择要批量删除的数据"})},getSelection:function(t){this.selectionList=t},hanleTaskPageChange:function(t){this.taskPage=t,this.$store.commit("setTrackTaskPage",t),this.$store.commit("setTrackTaskSize",this.pageSize),this.getPatchTaskList()},handleTaskSizeChange:function(t){this.taskPageSize=t,this.$store.commit("setTrackTaskSize",t),this.$store.commit("setTrackTaskPage",this.currentPage),this.getPatchTaskList()},checkData:function(t){var e=this;this.currentTask=t.id,Object(S["a"])(t.id).then((function(t){if(0===t.error_no){e.videoList=t.data.video_infos,e.showMissionDetail=!0,e.allFloorTracksData=t.data.main_track;var i=t.data,a=i.group_users,s=i.main_track,r=i.self;e.showMissionDetail=!0,e.groupsList=a||[],e.groupIdList=[],e.groupsList.forEach((function(t){e.groupIdList.push(t.pid)})),e.allFloorTracksData=s,e.tracksIndexMap=e.getTracksIndexMap(e.allFloorTracksData),e.currentFloorId=e.tracksIndexMap[0].floorId,e.personalInfo=r,e.avatar=r.image_url,e.$nextTick((function(){var t=e.$refs.media;Object(h["a"])(t,e.resize),t.addEventListener("loadeddata",(function(){var i=t.videoHeight/t.videoWidth*t.offsetWidth;e.radio=i/t.videoHeight,e.boxViewStyle={height:"".concat(i,"px")},e.width=t.offsetWidth,e.height=t.offsetHeight})),document.getElementById("current_video").addEventListener("loadstart",(function(){document.getElementById("current_video").pause(),e.currentVideo.video_url&&clearTimeout(e.tracktimer)})),document.getElementById("current_video").addEventListener("canplay",(function(){e.isPlay?e.startPlay():e.trackPlayTimer()})),document.getElementById("current_video").addEventListener("canplaythrough",(function(){cancelAnimationFrame(e.ramf),e.playEvent()}))})),e.currentData=t.data.video_infos[0],e.currentVideo=e.currentData.video_url}}))},searchVideo:function(t){var e={};return this.videoList.forEach((function(i){i.start<=t&&i.end>=t&&(e=i)})),e},openTrackVideo:function(t){var e=this,i=t.timestamp;this.searchVideo(i).video_url!==this.currentVideo?(this.currentData=this.searchVideo(i),this.currentVideo=this.currentData.video_url,this.currentTime=(i-this.currentData.video_start)/1e3,this.$nextTick((function(){document.getElementById("current_video").currentTime=e.currentTime,e.$refs.media.playbackRate=Number(e.playRate.substring(0,e.playRate.length-1))}))):this.changeProgress?(this.currentTime=(i-this.currentData.video_start)/1e3,this.$nextTick((function(){document.getElementById("current_video").currentTime=e.currentTime})),this.changeProgress=!1):(i-this.currentData.video_start)/1e3-document.getElementById("current_video").currentTime>1/Number(this.playRate.substring(0,this.playRate.length-1))&&this.$nextTick((function(){e.currentTime=(i-e.currentData.video_start)/1e3,document.getElementById("current_video").currentTime=e.currentTime})),this.isPlay||setTimeout((function(){document.getElementById("current_video").pause()}))},delData:function(t){var e=this;c["MessageBox"].confirm("确定要删除吗？",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"reset_password"}).then((function(){Object(S["e"])({ids:[t]}).then((function(t){0===t.error_no&&(c["Message"].success({message:"删除成功"}),e.getPatchTaskList())}))}))["catch"]((function(){}))},handleCloseTaskDialog:function(){this.showTaskDialog=!1},createPatckTask:function(){this.showTaskDialog=!0},getPatchTaskList:function(){var t=this,e={page:this.taskPage,page_size:this.taskPageSize};Object(S["y"])(e).then((function(e){0===e.error_no&&(t.taskTableData=e.data.tasks,t.taskTotal=e.data.count)}))},submitPatchTask:function(){var t=this,e={first:this.pidsDataQuery,second:this.searchQuery,cluster_infos:this.clusterIdList,third:this.searchDetailQuery,first_result:this.pidsData},i={task_id:_["a"].guid(),name:this.newTask.name,snap_image:this.pidsDataQuery.image,peer_duration:Number(this.newTask.duration),peer_closest_distance:String(this.newTask.instance),param:JSON.stringify(e)};Object(S["c"])(i).then((function(e){0===e.error_no&&(c["Message"].success({message:"任务创建成功，轨迹回溯任务需要一定的处理时间，处理完成后可查看“轨迹回溯”"}),t.showTaskDialog=!1,t.contentRadio="轨迹回溯任务",t.getPatchTaskList())}))},patchTrackData:function(t,e){var i=this;this.clusterIdList=e,this.isShowPhoto=!1,t.forEach((function(t){i.floorNumber.includes(t.floor_id)||i.floorNumber.push(t.floor_id)}));var a=0;this.floorNumber.forEach((function(e){i.shortList[a]||(i.shortList[a]={}),i.shortList[a].floor_id=e,i.shortList[a].trajectory=i.getTrackNumber(e,t),a++})),this.personalAllTracks=Object(n["a"])(this.shortList)},getTrackNumber:function(t,e){var i=[];return e.forEach((function(e){e.floor_id===t&&i.push.apply(i,Object(n["a"])(e.trajectory))})),i},showBodyDialog:function(t){this.isShowPhoto=!0,this.isReset=!1,this.currentMissOut=[t]},handleClosePhoto:function(){this.isShowPhoto=!1},showSaveData:function(t){var e=this;t&&Object(S["r"])({id:t}).then((function(i){if(0===i.error_no){var a=i.data,s=a.firstResult,r=a.param,n=a.secondResult;e.searchData=s.users.filter((function(t){return t.pid===r.query.second.pid})),e.securityData=s.security.image_url?s.security:{},e.defaultQuery=r.query.first,e.allFloorTracksData=n.tracks,e.lastFloorId=n.last_floor_id,e.isSaveData=t}}))},rowStyleFun:function(){return{background:"#22253B"}},rowKey:function(t){return t.id},handleSizeChange:function(t){this.pageSize=t,this.currentPage=1,this.getDetailData()},hanleCurrentPChange:function(t){this.currentPage=t,this.getDetailData()},openVideo:function(t){var e=this;this.videoLoading.push(t.track_id),Object(S["A"])({track_id:t.track_id,start_time:t.timestamp,end_time:t.trajectory[t.trajectory.length-1].timestamp,camera_ip:t.camera.ip,trajectory:t.trajectory}).then((function(i){0!==i.error_no||e.videoVisible||(e.trackVideo=i.data.url,e.videoVisible=!0);var a=e.videoLoading.indexOf(t.track_id);e.videoLoading.splice(a,1)}))},showDeatil:function(t){this.detailQuery={pid:t,start_time:this.pidsDataQuery.start_time,end_time:this.pidsDataQuery.end_time,camera_ids:this.pidsDataQuery.camera_ids},this.currentPage=1,this.pageSize=10,this.getDetailData()},getDetailData:function(){var t=this;this.isSaveData?Object(S["s"])({id:this.isSaveData,page:this.currentPage,page_size:this.pageSize}).then((function(e){0===e.error_no&&(t.tableData=e.data.content,t.total=e.data.totalElements,t.detailVisible=!0)})):Object(S["j"])(Object(r["a"])(Object(r["a"])({},this.detailQuery),{},{page:this.currentPage,size:this.pageSize,query_param:this.queryParam})).then((function(e){0===e.error_no&&(t.tableData=e.data.content,t.total=e.data.totalElements,t.detailVisible=!0)}))},showStatus:function(t){return 0===t.check_status?"":1===t.check_status?"rightIcon":2===t.check_status?"errorIcon":""},trackChange:function(t){var e=this,i=t.pid,a=t.image,s=t.check_time,r=t.take_off_time;this.currentPid=i,this.shortList=[],this.isReset=!0,this.avatar=a,this.clusterIdList=[],this.allFloorTracksData=[],this.personalAllTracks=[],this.searchQuery={pid:this.currentPid,start_time:this.pidsDataQuery.start_time,end_time:this.pidsDataQuery.end_time,camera_ids:this.pidsDataQuery.camera_ids,query_param:this.queryParam,add_point:!0},this.securityData.image_url||(this.securityData.check_time="",this.securityData.take_off_time="",s&&(this.securityData.check_time=s),r&&(this.securityData.take_off_time=r)),Object(S["B"])({pid:this.currentPid,start_time:this.pidsDataQuery.start_time,end_time:this.pidsDataQuery.end_time,camera_ids:this.pidsDataQuery.camera_ids,query_param:this.queryParam,add_point:!0},!0).then((function(t){e.tracksData=[],e.allFloorTracksData=[],0===t.error_no&&(t.data.tracks.length>0?(e.searchDetailQuery={pid:e.currentPid,start_time:e.pidsDataQuery.start_time,end_time:e.pidsDataQuery.end_time,page:1,size:1},Object(S["j"])({pid:e.currentPid,start_time:e.pidsDataQuery.start_time,end_time:e.pidsDataQuery.end_time,page:1,size:1}).then((function(i){0===i.error_no&&(t.data.tracks&&0===t.data.tracks.length?e.isDisabled=!0:e.isDisabled=!1,e.allFloorTracksData=t.data.tracks,e.missOutsNumber=0,t.data.tracks.forEach((function(t){t.miss_outs&&(e.missOutsNumber+=t.miss_outs.length)})),e.lastFloorId=t.data.last_floor_id,e.mapCurrentFloorId=e.lastFloorId,e.showTrackVideoData=i.data.content[0])}))):(c["Message"].error("未查询到轨迹"),e.isDisabled=!0))}))},setCurrentFloor:function(t){this.mapCurrentFloorId=t},showVideo:function(){var t=this;Object(S["A"])({track_id:this.showTrackVideoData.track_id,start_time:this.showTrackVideoData.timestamp,end_time:this.showTrackVideoData.trajectory[this.showTrackVideoData.trajectory.length-1].timestamp,camera_ip:this.showTrackVideoData.camera.ip,trajectory:this.showTrackVideoData.trajectory},{},!0).then((function(e){0===e.error_no&&(t.trackVideo=e.data.url,t.videoVisible=!0)}))},getChoose:function(t){return this.chooseIndex===t?{border:"2px solid #FF8C00"}:{}},cameraFilter:function(t,e){var i="";return this.camerasData.forEach((function(a){a.ip===t&&(i=a[e])})),i},setCatchImg:function(t){this.catchImg=t},changeScore:function(){this.$store.dispatch("SEARCHPID",Object(r["a"])(Object(r["a"])({},this.pidsDataQuery),{},{score:this.similarity}))},turnFloor:function(t){this.floor=t},floorButtonStyle:function(t){return t===this.floor?{backgroundColor:"#F4AD41"}:{backgroundColor:"#A9A5A5"}},handleMouseEnter:function(t){var e=t.pid,i=t.name,a=t.number;this.currentHoverPid=e,this.securityData.image_url||(this.currentUserName=i,this.currentUserNumber=a,this.currentUserName&&this.currentUserNumber&&(this.infoStyle={top:"".concat(document.getElementById(e).getBoundingClientRect().top-60,"px"),left:"".concat(document.getElementById(e).getBoundingClientRect().left-18,"px")}))},tMouseEnter:function(t){this.currentHoverPid=t.pid},handleMouseLeave:function(){this.currentHoverPid="",this.infoStyle={display:"none"}},createTask:function(){this.inputNameVisible=!0},exportData:function(){var t=this,e=this.currentTask,i={download_type:"download_tracks_fillment_task",download_video:!1,admin_id:JSON.parse(sessionStorage.getItem("userInfo")).id,query:{track_fillment_task_id:e}};Object(S["f"])({param:JSON.stringify(i),task_id:_["a"].guid(),sign:(new d.a).update(JSON.stringify(i)).digest("hex"),name:this.taskName}).then((function(e){0===e.error_no&&c["Message"].success("创建成功"),t.inputNameVisible=!1}))},handleClose:function(){this.detailVisible=!1},closeImg:function(t){t&&(this.showLargeImg=!1,this.imgList=[])},checkLargeImg:function(t){this.showLargeImg=!0,this.imgList.push(t)},changeTab:function(t){this.contentRadio=t},patchAllTrack:function(){},showSetTimeVisible:function(t){var e,i=this;this.pointType=t,this.allFloorTracksData.some((function(t){return t.floor_id===i.mapCurrentFloorId&&(e=t.trajectory,!0)})),e&&e.length>0?("start"===t?(this.securityData.check_time?this.setTimeValue=new Date(this.securityData.check_time):this.setTimeValue=new Date(e[0].timestamp-18e5),this.trackPointTime=e[0].timestamp):(this.securityData.take_off_time?this.setTimeValue=new Date(this.securityData.take_off_time):this.setTimeValue=new Date(e[e.length-1].timestamp+18e5),this.trackPointTime=e[e.length-1].timestamp),this.setTimeVisible=!0):c["Message"].error("该楼层无轨迹")},hideSetTimeVisible:function(){this.setTimeVisible=!1,this.setTimeValue=""},patchPoint:function(t){var e=this,i=[],a=[];if(this.allFloorTracksData.some((function(t){return t.floor_id===e.mapCurrentFloorId&&(i=t.trajectory,a=t.miss_outs,!0)})),i&&i.length>0){if("start"===t)if(this.setTimeValue){if(this.setTimeValue.getTime()>i[0].timestamp)return void c["Message"].error("当前设置的时间晚于已有轨迹的起点时间，请重新设置。");this.currentMissOut=[{start_time:this.setTimeValue.getTime(),end_time:i[0].timestamp,filter_type:1,x:i[0].point.x,y:i[0].point.y,floor_id:this.mapCurrentFloorId}],this.setTimeVisible=!1}else c["Message"].error("请设置时间");else if("end"===t)if(this.setTimeValue){if(this.setTimeValue.getTime()<i[0].timestamp)return void c["Message"].error("当前设置的时间早于已有轨迹的终点时间，请重新设置。");this.currentMissOut=[{start_time:i[i.length-1].timestamp,end_time:this.setTimeValue.getTime(),filter_type:2,x:i[i.length-1].point.x,y:i[i.length-1].point.y,floor_id:this.mapCurrentFloorId}],this.setTimeVisible=!1}else c["Message"].error("请设置时间");else if("all"===t){a&&a.length>0||c["Message"].error("该层无可补轨迹");var s=[];a.forEach((function(t){var e=t.start_time,i=t.end_time,a=t.camera_ids;s.push({start_time:e,end_time:i,camera_ids:a})})),this.currentMissOut=s}this.isShowPhoto=!0,this.isReset=!1}else c["Message"].error("该层无可补轨迹")},handleCloseSetime:function(){this.setTimeVisible=!1},backMissionDetail:function(){this.showMissionDetail=!1},getTracksIndexMap:function(t){var e=this;this.trackLength=0;var i={},a=[];t.forEach((function(t){t.floor_index.forEach((function(e){a.push(Object(r["a"])(Object(r["a"])({},e),{},{floorId:t.floor_id}))})),e.trackLength+=t.trajectory.length-1})),a.sort((function(t,e){return t.index-e.index}));var s=0;return a.forEach((function(t){var e=t.index,a=t.start_point_index,r=t.floorId,n=t.end_point_index;i[s]={index:e,startAt:a,floorId:r},s+=n-a+1})),i},getTrackPoint:function(t,e){var i=this,a="";return t.some((function(t){return t.floor_id===i.currentFloorId&&(a=t.trajectory[e],!0)})),a},startPlay:function(){this.isPlay=!0,this.playIcon=v.a,clearTimeout(this.tracktimer),document.getElementById("current_video").play(),this.trackPlayTimer()},endPlay:function(){this.isPlay=!1,this.playIcon=b.a,document.getElementById("current_video").pause(),clearTimeout(this.tracktimer)},trackPlayTimer:function(){var t=this,e=0;Object.keys(this.tracksIndexMap).forEach((function(e){t.trackIndex>=e&&(t.tracksSectionIndex=e)})),this.currentFloorId!==this.tracksIndexMap[this.tracksSectionIndex].floorId&&(this.currentFloorId=this.tracksIndexMap[this.tracksSectionIndex].floorId),e=this.trackIndex-this.tracksSectionIndex+this.tracksIndexMap[this.tracksSectionIndex].startAt,this.currentTracksIndex=e,this.openTrackVideo(this.getTrackPoint(this.allFloorTracksData,e)),this.getTrackPoint(this.allFloorTracksData,e)&&this.trackIndex<this.trackLength&&this.isPlay?this.tracktimer=setTimeout((function(){t.trackIndex+=1,t.trackPlayTimer()}),1e3/this.playRate.substring(0,this.playRate.length-1)):setTimeout((function(){document.getElementById("current_video").pause(),t.isPlay=!1,t.playIcon=b.a}),1e3/this.playRate.substring(0,this.playRate.length-1))},trackIndexChange:function(){var t=this,e=0;Object.keys(this.tracksIndexMap).forEach((function(e){t.trackIndex>=e&&(t.tracksSectionIndex=e)})),this.currentFloorId!==this.tracksIndexMap[this.tracksSectionIndex].floorId&&(this.currentFloorId=this.tracksIndexMap[this.tracksSectionIndex].floorId),e=this.trackIndex-this.tracksSectionIndex+this.tracksIndexMap[this.tracksSectionIndex].startAt,this.currentTracksIndex=e,this.changeProgress=!0,this.openTrackVideo(this.getTrackPoint(this.allFloorTracksData,this.currentTracksIndex))},trackDone:function(){this.currentTime=(this.currentData.start-this.currentData.video_start)/1e3,document.getElementById("current_video").currentTime=this.currentTime,this.startPlay()},resize:function(){var t=this.$refs.media;if(t&&t.videoHeight){var e=t.videoHeight/t.videoWidth*t.offsetWidth;this.radio=e/t.videoHeight,this.boxViewStyle={height:"".concat(e,"px")},this.width=t.offsetWidth,this.height=t.offsetHeight}this.initCanvas()},initCanvas:function(){var t=this.$refs.canvas;this.context=t.getContext("2d");var e=window.devicePixelRatio||1,i=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,a=e/i;t.width=this.width*a,t.height=this.height*a,this.context.scale(a,a)},playEvent:function(){this.timerStart=performance.now(),this.initCanvas(),this.draw()},pauseEvent:function(){this.currentTime=this.$refs.media.currentTime},draw:function(){var t=this,e=performance.now()-this.timerStart;if(e>=this.gap){var i=this.$refs.media,a=i.currentTime;if(this.context.clearRect(0,0,this.width,this.height),this.getFrame(a)){var s=this.getFrame(a),r=s.boxes;this.currentBoxes=r,r.forEach((function(e){var i=e.detection_box,a=e.user_type,s=e.pid,r=e.tpid;t.drawRect({x:i.x,y:i.y,w:i.w,h:i.h,id:r+s,type:a})}))}this.timerStart=performance.now()}this.ramf=requestAnimationFrame(this.draw)},getFrame:function(t){var e=1e3*t+this.currentData.video_start,i={},a=0;return this.currentData.all_boxes.some((function(t){return t.timestamp>e||(a+=1,!1)})),i=this.currentData.all_boxes[a],i},drawRect:function(t){var e=this,i=function(t,i,a,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,n=a-t,o=s-i,c=t,l=i,h=Math.floor(Math.sqrt(n*n+o*o)/r),u=n/h,d=o/h;e.context.beginPath();for(var m=0;m<h;m++)m%2===0?e.context.moveTo(c,l):e.context.lineTo(c,l),c+=u,l+=d;e.context.lineTo(a,s)},a=function(t,a,s,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;i(t,a,t+s,a,n),e.context.stroke(),i(t+s,a,t+s,a+r,n),e.context.stroke(),i(t+s,a+r,t,a+r,n),e.context.stroke(),i(t,a+r,t,a,n),e.context.stroke()};t&&(this.context.beginPath(),1===t.type?this.context.strokeStyle="#C82525":this.context.strokeStyle="#F9C30B",3!==t.type||-1!==this.groupIdList.indexOf(t.id)?this.context.strokeRect(t.x*this.radio,t.y*this.radio,t.w*this.radio,t.h*this.radio):a(t.x*this.radio,t.y*this.radio,t.w*this.radio,t.h*this.radio))},getRectPosition:function(t){var e=this;this.isPlay&&this.endPlay();var i=function(t,i){var a=t.x,s=t.y,r=t.w,n=t.h,o=i.offsetX,c=i.offsetY,l=o/e.radio,h=c/e.radio;return l>a&&h>s&&l<a+r&&h<s+n},a="",s="";this.currentBoxes.some((function(e){var r=e.detection_box,n=e.tpid,o=e.pid,c=e.cid;return!!i(r,t)&&(a=n+o,s=c,!0)})),a&&-1===this.groupIdList.indexOf(a)&&this.personalInfo.pid!==a&&(this.groupIdList.push(a),Object(S["i"])(s).then((function(t){e.groupsList.unshift({image_url:t.data.face_url||t.data.body_url,pid:t.data.cid,id:a,name:t.data.name,number:t.data.number,check:1})}))),this.currentCheckId=a,document.getElementById(a)&&document.getElementById(a).scrollIntoView()},updatePeerData:function(){var t=this,e=[];this.groupsList.forEach((function(t){t.check&&e.push(t.pid)})),Object(S["D"])({task_id:this.currentTask,cluster_ids:e}).then((function(e){0===e.error_no&&t.backMissionDetail()}))},delListItem:function(t){var e=this.groupIdList.indexOf(t.id);this.groupIdList.splice(e,1),this.groupsList=this.groupsList.filter((function(e){return e.pid!==t.pid})),console.log(t),Object(S["d"])({id:this.currentTask,pids:[t.pid]})},showRateList:function(){this.rateListVisible=!this.rateListVisible},setRateList:function(t){this.playRate=t,this.$refs.media.playbackRate=Number(this.playRate.substring(0,this.playRate.length-1))},missionDetail:function(t,e){this.missionData=t,this.currentTaskId=e,this.showMissionDetail=!0}}},$=Z,G=(i("ec86"),i("f0d99"),Object(q["a"])($,a,s,!1,null,"04eb2385",null));e["default"]=G.exports},fa93:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAmNJREFUSA29Vj8sZEEY/82z6CQaiSVbCKfRyTVUXE6iIrmaVpxIVOqtVRKWaKkvoVJczhaCQnQKjmoLm2jU5Nbc75t58/bN/pmLvWWK92a++b7f731/Zr6n8I+hV1Y+oVKZx+vrV6rmoFTWmGj9wHcJUfQTHR2HqlD4HYJSzTb18vI4wTeg9XQzHU+u1AlJ19Xu7pUnjxd1RDqfz6Bc3iTBd+rU7TcCSck0Pd5Bf/+ayuf/pOQ+EL3oZZh+UGEqrdTCvMhwfqN3T842chPjSXtIBHJKPthgxgQJkQnX/3vivtuSSQriYXJgEl+pXFL21pw4nGZvzRB+lgKxHkl1tZ9EyJWpXJnQm1HG80akDUcuBwwOAhcXYCX6KgMDwNAQcHrqy2tXnZ2jGRrP1cq99Ry3x8aAkRFgf79KJuvVVaC7G7i9BR4fPTNvwQMfxSfek3uL42Pg+RmYmAAWFxkDpjFNcnYWJhEw3ioZvhibwLi/B7a27NcLWU+PJRJPzs+Bg4OAcbKVi5K7K5E1mNzdWbKXFxtGR5IOZQOzRMT7sXqOEuk7TLTWEYtBbuHwcDnp6gKur+tzFraW3bJ4VArqDQ9Xq0tysr1tw+gKZGEhaB5vliLTT0Kqs7O2hIXE5cTlTMgmJ4G+vhAChOPDDqy965aWfjFX0+HPanGXDVHt7X2xVcfOSJia+6VFYN9MS9cVkSEy7Vc6Y7sHMV1rtx4JAdsvn8U2chVjTAPp9Z8PaeVCa3p8NjvDa6nAZSs5k5+TAohhsIwv9uF5lJLDdN33/N1Kk8ncNEbpWaEfSKWO6AGbUvPxFzuZ5+uMRdCIAAAAAElFTkSuQmCC"}}]);