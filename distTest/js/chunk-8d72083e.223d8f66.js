(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8d72083e"],{"406e":function(e,t,s){"use strict";s.d(t,"a",(function(){return p})),s.d(t,"b",(function(){return m}));let r=null;function i(e){return r||(r=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,16)}).bind(window)),r(e)}let a=null;function n(e){a||(a=(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}).bind(window)),a(e)}function o(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),(document.querySelector("head")||document.body).appendChild(t),t}function l(e,t={}){let s=document.createElement(e);return Object.keys(t).forEach(e=>{s[e]=t[e]}),s}function d(e,t,s){let r=window.getComputedStyle(e,s||null)||{display:"none"};return r[t]}function c(e){if(!document.documentElement.contains(e))return{detached:!0,rendered:!1};let t=e;while(t!==document){if("none"===d(t,"display"))return{detached:!1,rendered:!1};t=t.parentNode}return{detached:!1,rendered:!0}}var u='.resize-triggers{visibility:hidden;opacity:0;pointer-events:none}.resize-contract-trigger,.resize-contract-trigger:before,.resize-expand-trigger,.resize-triggers{content:"";position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden}.resize-contract-trigger,.resize-expand-trigger{background:#eee;overflow:auto}.resize-contract-trigger:before{width:200%;height:200%}';let _=0,h=null;function p(e,t){e.__resize_mutation_handler__||(e.__resize_mutation_handler__=f.bind(e));let s=e.__resize_listeners__;if(!s)if(e.__resize_listeners__=[],window.ResizeObserver){let{offsetWidth:t,offsetHeight:s}=e,r=new ResizeObserver(()=>{(e.__resize_observer_triggered__||(e.__resize_observer_triggered__=!0,e.offsetWidth!==t||e.offsetHeight!==s))&&b(e)}),{detached:i,rendered:a}=c(e);e.__resize_observer_triggered__=!1===i&&!1===a,e.__resize_observer__=r,r.observe(e)}else if(e.attachEvent&&e.addEventListener)e.__resize_legacy_resize_handler__=function(){b(e)},e.attachEvent("onresize",e.__resize_legacy_resize_handler__),document.addEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);else if(_||(h=o(u)),v(e),e.__resize_rendered__=c(e).rendered,window.MutationObserver){let t=new MutationObserver(e.__resize_mutation_handler__);t.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e.__resize_mutation_observer__=t}e.__resize_listeners__.push(t),_++}function m(e,t){let s=e.__resize_listeners__;if(s){if(t&&s.splice(s.indexOf(t),1),!s.length||!t){if(e.detachEvent&&e.removeEventListener)return e.detachEvent("onresize",e.__resize_legacy_resize_handler__),void document.removeEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);e.__resize_observer__?(e.__resize_observer__.unobserve(e),e.__resize_observer__.disconnect(),e.__resize_observer__=null):(e.__resize_mutation_observer__&&(e.__resize_mutation_observer__.disconnect(),e.__resize_mutation_observer__=null),e.removeEventListener("scroll",w),e.removeChild(e.__resize_triggers__.triggers),e.__resize_triggers__=null),e.__resize_listeners__=null}!--_&&h&&h.parentNode.removeChild(h)}}function g(e){let{width:t,height:s}=e.__resize_last__,{offsetWidth:r,offsetHeight:i}=e;return r!==t||i!==s?{width:r,height:i}:null}function f(){let{rendered:e,detached:t}=c(this);e!==this.__resize_rendered__&&(!t&&this.__resize_triggers__&&(z(this),this.addEventListener("scroll",w,!0)),this.__resize_rendered__=e,b(this))}function w(){z(this),this.__resize_raf__&&n(this.__resize_raf__),this.__resize_raf__=i(()=>{let e=g(this);e&&(this.__resize_last__=e,b(this))})}function b(e){e&&e.__resize_listeners__&&e.__resize_listeners__.forEach(t=>{t.call(e,e)})}function v(e){let t=d(e,"position");t&&"static"!==t||(e.style.position="relative"),e.__resize_old_position__=t,e.__resize_last__={};let s=l("div",{className:"resize-triggers"}),r=l("div",{className:"resize-expand-trigger"}),i=l("div"),a=l("div",{className:"resize-contract-trigger"});r.appendChild(i),s.appendChild(r),s.appendChild(a),e.appendChild(s),e.__resize_triggers__={triggers:s,expand:r,expandChild:i,contract:a},z(e),e.addEventListener("scroll",w,!0),e.__resize_last__={width:e.offsetWidth,height:e.offsetHeight}}function z(e){let{expand:t,expandChild:s,contract:r}=e.__resize_triggers__,{scrollWidth:i,scrollHeight:a}=r,{offsetWidth:n,offsetHeight:o,scrollWidth:l,scrollHeight:d}=t;r.scrollLeft=i,r.scrollTop=a,s.style.width=n+1+"px",s.style.height=o+1+"px",t.scrollLeft=l,t.scrollTop=d}},"493a":function(e,t,s){"use strict";s("d692")},b28f:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user_manage"},[s("searchModule",{attrs:{"search-module":!0,type:"userManage","filters-item":[["userName","name","role"]]}}),s("div",{staticClass:"user_manage_result"},[s("div",{staticClass:"user_manage_result_operate"},[s("el-button",{attrs:{type:"primary",disabled:1===e.permission,icon:"el-icon-plus"},on:{click:function(t){return e.handleAddData()}}},[e._v(" 新建 ")]),s("el-button",{attrs:{disabled:1===e.permission},on:{click:function(t){return e.handleDeteleAll()}}},[e._v(" 删除 ")])],1),s("div",{ref:"tableContent",staticClass:"user_manage_result_data"},[s("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{height:e.tableHeight,data:e.tableData,"header-cell-style":e.headerCellStyle,"cell-style":e.headerCellStyle,"row-class-name":"user_row"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{type:"index",label:"序号",index:e.indexMethod}}),s("el-table-column",{attrs:{prop:"name",label:"用户名",width:"120"}}),s("el-table-column",{attrs:{prop:"roleName",width:"100",label:"角色"}}),s("el-table-column",{attrs:{prop:"real_name",label:"姓名"}}),s("el-table-column",{attrs:{prop:"department",label:"部门"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:t.row.delDeptTime>0?"del_style":""},[e._v(e._s(t.row.department))])]}}])}),s("el-table-column",{attrs:{prop:"phone",label:"电话",width:"110"}}),s("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"180"}}),s("el-table-column",{attrs:{prop:"portrait",label:"人像照"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("img",{attrs:{src:e.row.portrait,alt:""}})]}}])}),s("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"180"}}),s("el-table-column",{attrs:{prop:"reset",label:"重置"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(s){return e.handleResetPassword(t.row)}}},[e._v(" 重置密码 ")])]}}])}),s("el-table-column",{attrs:{prop:"operate",width:"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.handleChangeData(t.row)}}},[e._v("编辑")]),s("el-button",{class:1===e.permission?"icon_size":"icon",attrs:{type:"text",size:"small",disabled:1===e.permission},on:{click:function(s){return e.handleDeteleData(t.row)}}},[e._v(" 删除 ")])]}}])})],1),s("Dialog",{staticClass:"add_user",attrs:{isVisible:e.isShowDialog,width:"500",title:e.userEdit?"编辑信息":"新增用户"},on:{close:function(t){return e.handleCloseDialog()}},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("用户名：")]),s("el-input",{attrs:{type:"text"},model:{value:e.newUser.name,callback:function(t){e.$set(e.newUser,"name",t)},expression:"newUser.name"}})],1),e.userEdit?e._e():s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("密码：")]),s("setPassword",{ref:"pass",attrs:{type:"password"},on:{getPassword:e.getPassword}})],1),e.userEdit?e._e():s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("确认密码：")]),s("setPassword",{ref:"confirmPass",attrs:{type:"confirmPassword"},on:{getPassword:e.getPassword}})],1),s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("角色：")]),s("el-select",{model:{value:e.newUser.role,callback:function(t){e.$set(e.newUser,"role",t)},expression:"newUser.role"}},e._l(e.roleOptionList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("姓名：")]),s("el-input",{attrs:{type:"text"},model:{value:e.newUser.real_name,callback:function(t){e.$set(e.newUser,"real_name",t)},expression:"newUser.real_name"}})],1),s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("手机：")]),s("el-input",{attrs:{type:"text"},model:{value:e.newUser.phone,callback:function(t){e.$set(e.newUser,"phone",t)},expression:"newUser.phone"}})],1),s("div",{staticClass:"add_user_item"},[s("span",[s("span",{staticClass:"must_tip"},[e._v("*")]),e._v("邮箱：")]),s("el-input",{attrs:{type:"text"},model:{value:e.newUser.email,callback:function(t){e.$set(e.newUser,"email",t)},expression:"newUser.email"}})],1),s("div",{staticClass:"add_user_item"},[s("span",[e._v("个人照片：")]),s("el-upload",{staticClass:"avatar-uploader upload",attrs:{action:"","auto-upload":!1,"show-file-list":!1,"on-change":e.uploadImg}},[e.portrait?s("img",{staticClass:"avatar",attrs:{src:e.portrait}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"add_user_item-operate"},[s("el-button",{on:{click:function(t){return e.handleCancelDialog()}}},[e._v(" 取消 ")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleConfirmDialog()}}},[e._v(" 确定 ")])],1)]},proxy:!0}])})],1),s("div",{staticClass:"user_manage_result_pagination"},[s("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[1,10,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.hanleCurrentChange,"size-change":e.handleSizeChange}})],1)])],1)},i=[],a=s("5530"),n=(s("4160"),s("d3b7"),s("159b"),s("b0c0"),s("fb6a"),s("99af"),s("ac1f"),s("466d"),s("00b4"),s("406e")),o=s("5c96"),l=s("2f62"),d=s("f576"),c=s.n(d),u=s("be46"),_=s("0fea"),h=s("c24f"),p=s("510e"),m=s("1c86"),g=s("f306"),f=s("8e6c"),w={mixins:[g["a"]],components:{searchModule:u["a"],setPassword:m["a"],Dialog:f["a"]},name:"userManage",data:function(){return{headerCellStyle:{textAlign:"center"},name:"",username:"",role:"",roleOptionList:[],userData:[],tableData:[],isShowDialog:!1,newUser:{name:"",password:"",confirmPassword:"",role:"",real_name:"",department:"",phone:"",email:""},portrait:"",multipleSelection:[],userEdit:!1,currentPage:1,pageSize:10,total:0,currentId:"",tableHeight:0,page:1,permission:0}},mounted:function(){var e=this;this.getAdminData(),this.getInit(),this.$nextTick((function(){e.tableHeight=e.$refs.tableContent.offsetHeight,Object(n["a"])(e.$refs.tableContent,e.resize)}))},beforeDestroy:function(){Object(n["b"])(this.$refs.tableContent,this.resize)},computed:Object(a["a"])({},Object(l["b"])(["userQuery"])),watch:{userQuery:function(){this.userQuery.items?(this.userQuery.items.forEach((function(e){e.updated_at=p["a"].formatDateTime(e.updated_at),e.roleName=e.role.name,e.department=e.role.dept.name,e.delDeptTime=e.role.dept.deleted})),this.permission=this.userQuery.permission,this.pageSize=10,this.currentPage=this.page,this.userData=this.userQuery.items,this.tableData=this.userData.slice(this.pageSize*(this.currentPage-1),this.pageSize*this.currentPage),this.total=this.userQuery.count):this.tableData=[]}},methods:{getPassword:function(e){switch(e.type){case"password":this.newUser.password=e.value;break;case"confirmPassword":this.newUser.confirmPassword=e.value;break;default:break}},resize:function(){this.$refs.tableContent&&(this.tableHeight=this.$refs.tableContent.offsetHeight)},getInit:function(){var e=this;_["b"].getRoles().then((function(t){t.data.items.forEach((function(e){e.label="".concat(e.dept.name,"-").concat(e.name)})),e.roleOptionList=t.data.items}))},uploadImg:function(e){if(window.FileReader){var t=e.raw,s=this;if(t.type.match("image/*")){var r=new FileReader;r.readAsDataURL(t),r.onload=function(e){s.portrait=e.target.result}}else o["Message"].error({message:"上传文件格式不正确"})}},getAdminData:function(){this.$store.dispatch("SEARCHUSER",{})},handleSelectionChange:function(e){this.multipleSelection=e},handleAddData:function(){this.isShowDialog=!0},handleCloseDialog:function(){this.isShowDialog=!1,this.userEdit=!1,this.resetDialog()},resetDialog:function(){for(var e in this.newUser)this.newUser[e]="";this.portrait=""},handleConfirmDialog:function(){var e=this;if(!this.userEdit&&(""===this.newUser.password||""===this.newUser.confirmPassword))return this.isShowDialog=!0,void o["Message"].error({message:"请将信息填写完整"});if(""===this.newUser.name||""===this.newUser.role||""===this.newUser.real_name||""===this.newUser.phone||""===this.newUser.email)return this.isShowDialog=!0,void o["Message"].error({message:"请将信息填写完整"});if(this.newUser.password!==this.newUser.confirmPassword)return o["Message"].error({message:"密码前后不一致"}),void(this.isShowDialog=!0);if(/^1[3456789]\d{9}$/.test(this.newUser.phone))if(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(this.newUser.email)){if(/[^a-z|A-Z|0-9|_]/.test(this.newUser.name))return this.isShowDialog=!0,void o["Message"].error({message:"用户名需4-14位字符，只能包含字母(区分大小写)、数字和下划线"});if(this.newUser.name.length<4||this.newUser.name.length>14)return this.isShowDialog=!0,void o["Message"].error({message:"用户名需4-14位字符，只能包含字母(区分大小写)、数字和下划线"});var t={name:this.newUser.name,real_name:this.newUser.real_name,phone:this.newUser.phone,email:this.newUser.email,portrait:this.portrait,role_id:this.newUser.role};if(this.userEdit)_["b"].changeAdmin(this.currentId,t).then((function(t){0===t.error_no&&(o["Message"].success({message:"修改成功"}),e.userEdit=!1,e.$refs.multipleTable.clearSelection(),e.isShowDialog=!1,e.getAdminData(),e.currentId===JSON.parse(sessionStorage.getItem("userInfo")).id&&e.newUser.role!==JSON.parse(sessionStorage.getItem("userInfo")).role_id&&h["a"].logout().then((function(t){0===t.error_no&&(o["Message"].warning({message:"当前用户角色权限已更改，请重新登录"}),sessionStorage.clear(),e.$router.push({name:"login"}),e.$store.commit("setPages",[]))})))}));else{if(!p["a"].judgePassword(this.newUser.password))return this.isShowDialog=!0,void o["Message"].error({message:"密码由大写字母、小写字母、数字、特殊符号中的三种或三种以上组成的8-20位"});t.password=(new c.a).update(this.newUser.password).digest("hex"),_["b"].addAdmin(t).then((function(t){if(0===t.error_no){var s={current:e.currentPage,size:e.pageSize,total:e.total};e.page=p["a"].formatPage(s,"add",0,!0),e.getAdminData(),e.isShowDialog=!1,e.$refs.confirmPass&&(e.$refs.confirmPass.password=""),e.$refs.pass&&(e.$refs.pass.password=""),e.resetDialog()}}))}}else o["Message"].error({message:"邮箱地址有误"});else o["Message"].error({message:"手机号码有误"})},handleCancelDialog:function(){this.isShowDialog=!1,this.userEdit=!1,this.$refs.confirmPass&&(this.$refs.confirmPass.password=""),this.$refs.pass&&(this.$refs.pass.password="")},handleChangeData:function(e){this.newUser.role=e.role.id,this.isShowDialog=!0,this.userEdit=!0,this.portrait=e.portrait,this.newUser.name=e.name,this.newUser.real_name=e.real_name,this.newUser.phone=e.phone,this.newUser.email=e.email,this.currentId=e.id},handleDeteleAll:function(){var e=this;this.multipleSelection.length<1?o["Message"].error({message:"请选择一个任务再进行操作"}):o["MessageBox"].confirm("确定要删除吗？",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"reset_password"}).then((function(){var t=0;e.multipleSelection.forEach((function(s){_["b"].delAdmin(s.id).then((function(s){if(0===s.error_no&&(o["Message"].success({message:"删除成功"}),t+=1,t===e.multipleSelection.length)){var r={current:e.currentPage,size:e.pageSize,total:e.total};e.page=p["a"].formatPage(r,"delAll",e.multipleSelection.length),e.getAdminData()}}))}))}))["catch"]((function(){}))},handleDeteleData:function(e){var t=this;o["MessageBox"].confirm("确定要删除吗？",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"reset_password"}).then((function(){_["b"].delAdmin(e.id).then((function(e){if(0===e.error_no){o["Message"].success({message:"删除成功"});var s={current:t.currentPage,size:t.pageSize,total:t.total};t.page=p["a"].formatPage(s,"del"),t.getAdminData()}}))}))["catch"]((function(){}))},hanleCurrentChange:function(e){0!==this.total&&(this.tableData=this.userData.slice(this.pageSize*(e-1),this.pageSize*e)),this.currentPage=e},handleSizeChange:function(e){0!==this.total&&(this.tableData=this.userData.slice(e*(this.currentPage-1),e*this.currentPage)),this.pageSize=e},handleResetPassword:function(e){o["MessageBox"].confirm("确定要对该用户进行密码重置吗","密码重置",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"reset_password"}).then((function(){h["a"].resetPassword({admin_id:e.id}).then((function(e){0===e.error_no&&o["Message"].success({message:"重置成功"})}))}))}}},b=w,v=(s("493a"),s("2877")),z=Object(v["a"])(b,r,i,!1,null,null,null);t["default"]=z.exports},d692:function(e,t,s){}}]);