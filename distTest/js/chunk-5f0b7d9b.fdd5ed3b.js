(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f0b7d9b"],{"144c":function(e,t,i){"use strict";function r(e){return e&&""!==e&&"1"!==sessionStorage.getItem("showMenu")?"/znjc".concat(e):e}i.d(t,"a",(function(){return r}))},"355f":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"page_container container"},[i("div",{staticClass:"video_container border_radius"},[""!==e.currVideoCamera?i("div",{staticStyle:{position:"absolute",color:"white",left:"10px",top:"10px","background-color":"rgba(22,22,22,0.76)",padding:"2px 6px","border-radius":"5px"}},[e._v(" "+e._s(e.currVideoCamera)+" ")]):e._e(),""!==e.currentVideoUrl?i("video",{ref:"media",attrs:{height:"100%",autoplay:"",controls:"",muted:"",src:e.currentVideoUrl},domProps:{muted:!0},on:{ended:e.nextVideo}}):e._e(),i("div",{staticClass:"video_list_btn"},e._l(e.videoUrl,(function(t,r){return i("span",{key:t,class:e.currentVideoIndex===r?"current_span":"",on:{click:function(t){return e.changeIndex(r)}}},[e._v(" "+e._s(r+1)+" ")])})),0)]),i("div",{staticClass:"table_container border_radius"},[e._m(0),i("common-table",{attrs:{isShowIndex:!0,tableData:e.tableData,"row-style":e.getRowStyle,tableColArray:e.tableColumn},scopedSlots:e._u([{key:"time",fn:function(t){return[e._v(" "+e._s(new Date(t.row.alarm_time).toLocaleString())+" ")]}},{key:"type",fn:function(t){return[e._v(" "+e._s(e.getType(t.row.alarm_source_type))+" ")]}},{key:"operation",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.showVideo(t.row)}}},[e._v("视频")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.handleAlarm(t.row)}}},[e._v("处置")])]}}])})],1),i("el-dialog",{attrs:{width:"400px",title:"报警处置",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-radio",{attrs:{label:"1"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("确认")]),i("el-radio",{attrs:{label:"2"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("撤销")]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmHandle}},[e._v("确 定")])],1)],1)],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"table_header"},[i("span",[e._v("实时报警")])])}],a=i("b85c"),o=(i("4160"),i("d3b7"),i("159b"),i("a9e3"),i("5c96")),s=i("7f5c"),d=i("b837"),l=i("144c"),c=i("c930"),u=i("605c"),h={data:function(){return{tableData:[],tableColumn:[{label:"报警时间",props:"alarm_time",type:"slot",slot:"time",minWidth:"15%"},{label:"报警区域",props:"area_name",minWidth:"10%",tooltip:!0},{label:"报警类型",props:"alarm_source_type",type:"slot",slot:"type",minWidth:"10%"},{label:"报警原因",props:"alarm_reason",tooltip:!0,minWidth:"50%"},{label:"操作",props:"",type:"slot",slot:"operation",width:120}],videoUrl:[],videoCameraName:[],dialogVisible:!1,radio:"1",cameraList:[],currentVideoId:0,currentVideoIndex:0,currentVideoUrl:"",currVideoCamera:""}},components:{CommonTable:d["a"]},mounted:function(){this.initData()},methods:{initData:function(){var e=this;Object(s["g"])().then((function(t){e.cameraList=t.data||[]})),new c["a"](this,5e3,(function(){Object(s["d"])({page:1,page_size:50,type:2},!1).then((function(t){0===t.error_no&&(e.tableData=t.data.alarms||[])}))})).start(0,!0)},getRowStyle:function(e){var t=e.row;e.rowIndex;return t.id===this.currentVideoId?{background:"#d0e5f7"}:""},getType:function(e){var t="";return u["a"].forEach((function(i){i.id===e&&(t=i.label)})),t},handleAlarm:function(e){this.dialogVisible=!0,this.currentRow=e},confirmHandle:function(){var e=this;Object(s["w"])({id:this.currentRow.id,alarm_type:Number(this.radio)}).then((function(t){0===t.error_no&&o["Message"].success("处置成功"),e.dialogVisible=!1}))},showVideo:function(e){var t=this;this.currentVideoId=e.id,e.videos&&0!==e.videos.length?Object(s["r"])(e.videos).then((function(e){if(0===e.error_no){var i,r=[],n=[],s=Object(a["a"])(e.data);try{for(s.s();!(i=s.n()).done;){var d=i.value;if(""!==d.video_url){d.video_url=Object(l["a"])(d.video_url),r.push(d.video_url);var c,u=d.camera_id,h=Object(a["a"])(t.cameraList);try{for(h.s();!(c=h.n()).done;){var m=c.value;if(m.id===u){u=m.airport_name,u&&""!==u||(u=m.ip);break}}}catch(b){h.e(b)}finally{h.f()}n.push(u)}}}catch(b){s.e(b)}finally{s.f()}r.length>0?(t.videoVisible=!0,t.videoUrl=r,t.videoCameraName=n,t.currentVideoIndex=0,t.currentVideoUrl="",t.currVideoCamera="",t.videoUrl.length>t.currentVideoIndex&&(t.currentVideoUrl=t.videoUrl[t.currentVideoIndex],t.currVideoCamera=t.videoCameraName[t.currentVideoIndex])):(o["Message"].warning({message:"视频未下载"}),t.currentVideoIndex=0,t.currentVideoUrl="")}})):(o["Message"].warning({message:"没有可下载视频"}),this.currentVideoIndex=0,this.currentVideoUrl="",this.currVideoCamera="")},changeIndex:function(e){this.currentVideoIndex=e,this.currentVideoUrl="",this.currVideoCamera="",this.videoUrl.length>this.currentVideoIndex&&(this.currentVideoUrl=this.videoUrl[this.currentVideoIndex],this.currVideoCamera=this.videoCameraName[this.currentVideoIndex])},nextVideo:function(){if(1===this.videoUrl.length)return document.getElementById("media").currentTime=0,void document.getElementById("media").play();this.videoUrl.length-1>this.currentVideoIndex?this.currentVideoIndex++:this.currentVideoIndex=0,this.currentVideoUrl="",this.currVideoCamera="",this.videoUrl.length>this.currentVideoIndex&&(this.currentVideoUrl=this.videoUrl[this.currentVideoIndex],this.currVideoCamera=this.videoCameraName[this.currentVideoIndex])}}},m=h,b=(i("c6ee"),i("2877")),f=Object(b["a"])(m,r,n,!1,null,"c66ebc3c",null);t["default"]=f.exports},"38cf":function(e,t,i){var r=i("23e7"),n=i("1148");r({target:"String",proto:!0},{repeat:n})},"605c":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var r=[{id:5001,label:"客流密度"},{id:5002,label:"物品遗留"},{id:5003,label:"物品拿取"},{id:5004,label:"人员倒地"},{id:5005,label:"人员滞留"},{id:5006,label:"人员徘徊"},{id:5007,label:"人员聚集"},{id:5008,label:"剧烈运动/打斗"},{id:5009,label:"排队人数"},{id:5010,label:"客流量报警"}]},bac7:function(e,t,i){},c6ee:function(e,t,i){"use strict";i("bac7")},c930:function(e,t,i){"use strict";i("38cf"),i("4795");var r=function(e,t,i){var r=this;this.vueObj=e,this.handler=i,this.timeout=t,this.started=!1,this.repeat=0,this.id=-1,this.start=function(e,t){var i=this;this.started||(this.repeat=e,t&&this.handler(),this.id=setInterval((function(){i.handler(),i.repeat>0&&(i.repeat--,i.repeat<=0&&i.stop())}),this.timeout))},this.stop=function(){this.id>=0&&(clearInterval(this.id),this.id=-1),this.started=!1},null!==this.vueObj&&this.vueObj.$once("hook:beforeDestroy",(function(){r.stop()}));var n=this;return{start:function(e,t){return n.start(e,t),this},stop:function(){n.stop()}}};t["a"]=r}}]);