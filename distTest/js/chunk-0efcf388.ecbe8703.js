(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0efcf388"],{a18a:function(t,a,e){},e5f1:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("section",{staticClass:"exhibition_container"},[e("div",{staticClass:"page_header"},[e("div",{on:{click:t.showRealtimeTack}},[e("svg-icon",{staticClass:"check_icon",attrs:{"icon-class":"qiehuan"}})],1)]),e("div",{staticClass:"video_container"},[e("div",{staticClass:"video_container_header"},[t._v("轨迹视频回溯")]),e("div",{staticClass:"video"},[e("video",{directives:[{name:"show",rawName:"v-show",value:t.videoUrl,expression:"videoUrl"}],ref:"media",attrs:{width:"100%",muted:"",loop:"",autoplay:"",src:t.videoUrl},domProps:{muted:!0}}),e("div",{staticClass:"video_canvas",style:t.boxViewStyle},[e("canvas",{ref:"canvas",staticStyle:{width:"100%",height:"100%"}})])])]),e("div",{staticClass:"table_container"},[t._m(0),e("div",{staticClass:"table_border"}),e("div",{ref:"trackList",staticClass:"table_items"},[t._l(t.tableData,(function(a,i){return e("div",{key:a.id,staticClass:"table_item"},[e("span",[t._v(t._s(i+1))]),e("span",[e("div",{staticStyle:{width:"40px",height:"50px"}},[e("img",{attrs:{src:a.image_url,alt:""}})])]),e("span",[e("span",{staticStyle:{display:"block"}},[t._v(t._s(new Date(a.timestamp).toLocaleDateString()))]),e("span",{staticStyle:{display:"block"}},[t._v(t._s(new Date(a.timestamp).toLocaleTimeString()))])]),e("span",[e("span",{staticStyle:{display:"block"}},[t._v(t._s(new Date(a.trajectory[a.trajectory.length-1].timestamp).toLocaleDateString()))]),e("span",{staticStyle:{display:"block"}},[t._v(t._s(new Date(a.trajectory[a.trajectory.length-1].timestamp).toLocaleTimeString()))])]),e("span",[t._v(t._s(t.cameraFilter(a.camera.ip,"terminal")))]),e("span",[t._v(t._s(t.cameraFilter(a.camera.ip,"area")))]),e("span",[t._v(t._s(t.cameraFilter(a.camera.ip,"airport_name")))]),e("span",{staticStyle:{"max-width":"100px"}},[t.videoLoading!==a.track_id?e("i",{on:{click:function(e){return t.playVideo(a)}}},[e("svg-icon",{attrs:{"icon-class":"play_button"}})],1):e("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"14px",display:"inline",width:"14px"}})]),e("div",{staticClass:"table_border",staticStyle:{position:"absolute",bottom:"0"}})])})),e("div",{staticClass:"table_items_loading"})],2)]),e("div",{staticClass:"catch_container"},[e("span",{staticClass:"left_button",on:{click:t.rightPage}}),e("div",{staticClass:"catch_content"},t._l(t.catchData,(function(a){return e("div",{key:a.id,staticClass:"catch_item",on:{click:function(e){return t.getPidTracks(a)}}},[e("img",{attrs:{width:"100%",height:"100%",src:a.detected_image_url,alt:""}}),e("div",{directives:[{name:"show",rawName:"v-show",value:a.user_id===t.currentCatch,expression:"item.user_id === currentCatch"}],staticClass:"catch_item_border"})])})),0),e("span",{staticClass:"right_button",on:{click:t.leftPage}})]),e("div",{staticClass:"map_container"},[e("div",{staticClass:"map_container_header"},[t._v("全量轨迹图")]),e("div",{staticStyle:{padding:"56px 56px",width:"100%",height:"100%"}},[e("div",{staticStyle:{width:"100%",height:"100%","background-color":"rgba(1, 5, 29, 0.5)",padding:"19px 33px"}},[e("mapTrack",{attrs:{tracksData:t.tracks,isRealTimeTrack:!1,userImg:"",userPid:t.currentPid,gapTrack:t.gapTrack,currentTs:t.currentTs},on:{trackChange:t.getTrackTimestamp}})],1)])]),e("div",{staticClass:"page_footer"})])},r=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"table_header"},[e("span",[t._v("序号")]),e("span",[t._v("图片")]),e("span",[t._v("开始时间")]),e("span",[t._v("结束时间")]),e("span",[t._v("地点")]),e("span",[t._v("区域")]),e("span",[t._v("抓拍相机")]),e("span",[t._v("轨迹视频")])])}],s=e("2909"),c=(e("a9e3"),e("ac1f"),e("1276"),e("4795"),e("45fc"),e("d3b7"),e("2f62")),n=e("ef5a"),o=e("235f"),h={data:function(){return{tableData:[],currentCatch:"",catchData:[],currentPage:1,pageSize:6,tracks:[],currentPid:"",videoUrl:"",trackPage:1,trackSize:10,gapTrack:[],boxViewStyle:{},gap:700,videoLoading:"",currentTs:0}},computed:Object(c["b"])(["camerasData"]),components:{mapTrack:o["a"]},mounted:function(){var t=this;this.getCatchData(1,6),this.$refs.trackList.addEventListener("scroll",this.scrollEvent);var a=this.$refs.media;a.addEventListener("loadeddata",(function(){console.log("loaded");var e=a.videoHeight/a.videoWidth*a.offsetWidth;t.radio=e/a.videoHeight,t.boxViewStyle={height:"".concat(e,"px")},t.width=a.offsetWidth,t.height=a.offsetHeight,t.headTime=Number(t.videoUrl.split("_").reverse()[0].split("-")[1].split(".")[0]),t.timerStart=performance.now(),t.initCanvas(),a.currentTime=(t.gapTrack[0]-t.headTime)/1e3,t.ramf&&cancelAnimationFrame(t.ramf),t.draw()}))},beforeDestroy:function(){clearTimeout(this.timer),this.ramf&&cancelAnimationFrame(this.ramf)},methods:{getCatchData:function(t,a){var e=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;Object(n["d"])({page:t,page_size:a}).then((function(t){t.data.snaps&&(e.catchData=t.data.snaps),e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){e.currentPage=1,e.getCatchData(1,6)}),i)}))},showRealtimeTack:function(){console.log("push"),this.$router.push({name:"realtimeTrack"})},getPidTracks:function(t){var a=this;this.currentCatch=t.user_id,Object(n["c"])({pid:t.user_id,track_only:!0},!0).then((function(t){0===t.error_no&&(a.tracks=t.data.trajectory||[])})),this.trackPage=1,this.$refs.trackList.scrollTop=0,this.getTrackHistroy()},leftPage:function(){this.currentPage+=1,clearTimeout(this.timer),this.getCatchData(this.currentPage,6,1e4)},rightPage:function(){this.currentPage>1&&(this.currentPage-=1,clearTimeout(this.timer),this.getCatchData(this.currentPage,6,1e4))},getTrackHistroy:function(){var t=this;Object(n["b"])({page:this.trackPage,size:this.trackSize,pid:this.currentCatch}).then((function(a){if(a.data)if(t.tableData=a.data.content||[],t.tableData.length>0){var e=t.tableData[0];t.gapTrack=[e.timestamp,e.trajectory[e.trajectory.length-1].timestamp],t.trackBox=e.trajectory,t.videoLoading=e.track_id,Object(n["e"])({track_id:e.track_id,start_time:e.timestamp,end_time:e.trajectory[e.trajectory.length-1].timestamp,camera_ip:e.camera.ip}).then((function(a){0===a.error_no?t.videoUrl=a.data.video_url:t.videoUrl="",t.videoLoading=""}))}else t.videoUrl=""}))},getTrackTimestamp:function(){},cameraFilter:function(t,a){var e="";return this.camerasData.some((function(i){return i.ip===t&&(e=i[a],!0)})),e},playVideo:function(t){var a=this;this.videoLoading=t.track_id,Object(n["e"])({track_id:t.track_id,start_time:t.timestamp,end_time:t.trajectory[t.trajectory.length-1].timestamp,camera_ip:t.camera.ip}).then((function(e){a.gapTrack=[t.timestamp,t.trajectory[t.trajectory.length-1].timestamp],a.trackBox=t.trajectory,a.currentTs=0,0===e.error_no?a.videoUrl=e.data.video_url:a.videoUrl="",a.videoLoading=""}))},scrollEvent:function(){var t=this,a=this.$refs.trackList;Math.abs(a.scrollHeight-a.clientHeight-a.scrollTop)<1&&(this.trackPage+=1,Object(n["b"])({page:this.trackPage,size:this.trackSize,pid:this.currentCatch}).then((function(a){var e;0===a.error_no?a.data.content&&a.data.content.length>0?(e=t.tableData).push.apply(e,Object(s["a"])(a.data.content)):t.trackPage>1&&(t.trackPage-=1):t.trackPage>1&&(t.trackPage-=1)})))},initCanvas:function(){var t=this.$refs.canvas;this.context=t.getContext("2d");var a=window.devicePixelRatio||1,e=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,i=a/e;t.width=this.width*i,t.height=this.height*i,this.context.scale(i,i)},draw:function(){var t=performance.now()-this.timerStart;if(t>=this.gap){var a=this.$refs.media,e=a.currentTime;this.context.clearRect(0,0,this.width,this.height);var i=1e3*e+this.headTime;i>this.gapTrack[1]&&(i=this.gapTrack[0],this.$refs.media.currentTime=(i-this.headTime)/1e3),this.currentTs=i;var r=this.getFrame(i),s=r.detection_box;s&&this.drawRect({x:s.x,y:s.y,w:s.w,h:s.h}),this.timerStart=performance.now()}this.ramf=requestAnimationFrame(this.draw)},getFrame:function(t){var a={},e=0;return this.trackBox.some((function(a){return a.timestamp>t||(e+=1,!1)})),a=this.trackBox[e],a},drawRect:function(t){t&&(this.context.beginPath(),this.context.strokeStyle="#C82525",this.context.strokeRect(t.x*this.radio,t.y*this.radio,t.w*this.radio,t.h*this.radio))}}},d=h,l=(e("e66d"),e("2877")),m=Object(l["a"])(d,i,r,!1,null,"54958d1c",null);a["default"]=m.exports},e66d:function(t,a,e){"use strict";e("a18a")}}]);