(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-641653d2"],{"10a4":function(t,e,s){"use strict";s("eb40")},"442a":function(t,e,s){},"894d":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.showMissionDetail?s("recall-detail",{attrs:{missionData:t.missionData,currentTask:t.currentTaskId},on:{backRecallList:t.backMissionDetail}}):s("section",{staticClass:"patch_track_container"},[s("div",{staticClass:"patch_track_header"},[s("div",{staticClass:"table_control"},[s("ul",[s("li",{class:"轨迹查询"==t.contentRadio?"active":"",on:{click:function(e){return t.changeTab("轨迹查询")}}},[t._v(" 轨迹查询 ")]),s("li",{class:["轨迹回溯任务"==t.contentRadio?"active":"","number_position"],on:{click:function(e){return t.changeTab("轨迹回溯任务")}}},[t._v("轨迹回溯任务 "),s("span",[t._v(t._s(t.bodyTaskValue))])])]),s("div",[s("el-button",{staticClass:"task_button",attrs:{type:"primary",disabled:t.searchResult},on:{click:t.createPatckTask}},[t._v("创建轨迹回溯任务")])],1)])]),"轨迹查询"===t.contentRadio?s("section",{staticClass:"body_container"},[s("searchModule",{attrs:{"search-module":!0,type:"bodySearch",disabledItem:t.disabledItem,"filters-item":[["time","multiImg","target"]]},on:{reset:t.getReset}}),t.searchResult?s("div",{staticClass:"content"},[0!==t.round?s("div",{staticClass:"content_select"},[s("div",{staticClass:"content_select_header"},[s("span",[t._v("已挑选"+t._s(t.selectList.length)+"张照片")]),s("div",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.checkTrack(!0)}}},[t._v(" 预览轨迹")]),s("el-button",{attrs:{type:"primary"},on:{click:t.checkResult}},[t._v(" 生成轨迹")])],1)]),s("div",{staticClass:"content_select_list"},[t._l(t.currentPageList,(function(e){return s("div",{key:e.cluster_id,class:[e.showDel?"active_item":"","item"],on:{mouseleave:function(s){return t.leaveImg(e)}}},[s("img",{attrs:{src:e.image_url,alt:""},on:{mouseover:function(s){return t.overImg(e)}}}),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showDel,expression:"item.showDel"}],staticClass:"del_img",attrs:{type:"primary"},on:{click:function(s){return t.delImg(e)}}},[t._v("删除")])],1)})),0===t.currentPageList.length?s("div",{staticClass:"empty"},[t._v("暂未选择照片")]):t._e()],2),s("div",{staticClass:"content_select_pagination"},[s("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":10,"current-page":t.currentPage,total:t.selectList.length},on:{"current-change":t.handleCurrentChange}})],1)]):t._e(),0!==t.round?s("div",{staticClass:"content_top"},[s("div",{staticClass:"left"},[s("p",[t._v("第"+t._s(t.round)+"轮搜索结果")]),s("el-select",{attrs:{placeholder:"请选择或输入关键字",multiple:"","collapse-tags":"","reserve-keyword":"",filterable:""},on:{change:t.selectCamera},model:{value:t.checkedNodes,callback:function(e){t.checkedNodes=e},expression:"checkedNodes"}},t._l(t.missionAreaOptions,(function(t){return s("el-option",{key:t.id,attrs:{label:t.airport_name,value:t.id}})})),1),s("el-button",{staticClass:"next_btn",attrs:{type:"primary"},on:{click:t.nextSearch}},[t._v("下一轮搜索")])],1),s("div",{staticClass:"right"},[s("el-checkbox",{staticStyle:{"margin-right":"24px"},attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("全选")])],1)]):t._e(),0!==t.round?s("div",{staticClass:"content_bottom"},[s("div",{ref:"content",staticClass:"content_bottom_result"},t._l(t.dataList,(function(e){return s("div",{key:e.cluster_id,staticClass:"result_list"},[s("div",{staticClass:"result_list_top"},[s("img",{attrs:{src:e.image_url,alt:""},on:{click:function(s){return t.checkLargeImg(e.image_url)}}})]),s("div",{staticClass:"result_list_bottom"},[s("div",[t._v(t._s(e.location))]),s("div",{staticClass:"info"},[s("span",[t._v(t._s(e.created_at))]),s("img",{staticClass:"check_img",attrs:{src:e.isCheck?t.radioCheckImg:t.radioImg,alt:""},on:{click:function(s){return t.checkItem(e)}}})])])])})),0)]):t._e()]):s("div",{staticClass:"module"},[s("search-track-module",{attrs:{type:2,photoCount:t.photoCount,queryId:t.queryId,params:t.params,saveDataId:t.saveDataId,allFloorTracksData:t.allFloorTracksData}})],1),s("MyDialog",{staticClass:"track_dialog",attrs:{title:"预览轨迹",isVisible:t.visible,width:"1300px"},on:{close:t.closeDialog},scopedSlots:t._u([{key:"content",fn:function(){return[s("div",{staticClass:"count"},[s("img",{attrs:{src:t.bellImg,alt:""}}),t._v(" "+t._s(t.photoCount)+"张照片合成轨迹 ")]),s("div",{staticClass:"map_content"},[s("Map",{attrs:{oldmap:!1,floors:t.floorInfo,allTracks:t.previewTracksData,camerasData:t.camerasData}})],1)]},proxy:!0}],null,!1,1284709771)}),s("checkLargeImg",{attrs:{show:t.showLargeImg,imgUrl:t.imgList},on:{isClose:t.closeImg}})],1):s("recall-list",{attrs:{type:2},on:{missionDetail:t.missionDetail}}),s("MyDialog",{staticClass:"task_dialog",attrs:{title:"创建轨迹回溯任务",isVisible:t.showTaskDialog,width:"30%"},on:{close:t.handleCloseTaskDialog},scopedSlots:t._u([{key:"content",fn:function(){return[s("ul",[s("li",[s("p",[t._v("任务名称:")]),s("el-input",{model:{value:t.newTask.name,callback:function(e){t.$set(t.newTask,"name",e)},expression:"newTask.name"}})],1),s("li",[s("p",[t._v("同行时间(秒):")]),s("el-input",{model:{value:t.newTask.duration,callback:function(e){t.$set(t.newTask,"duration",e)},expression:"newTask.duration"}})],1),s("li",[s("p",[t._v("最小间距(米):")]),s("el-input",{model:{value:t.newTask.instance,callback:function(e){t.$set(t.newTask,"instance",e)},expression:"newTask.instance"}})],1)])]},proxy:!0},{key:"footer",fn:function(){return[s("div",[s("el-button",{on:{click:t.handleCloseTaskDialog}},[t._v("取消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.submitPatchTask}},[t._v("确定")])],1)]},proxy:!0}],null,!1,2135356998)})],1)},i=[],c=s("5530"),n=(s("4160"),s("d3b7"),s("159b"),s("caad"),s("2532"),s("a434"),s("fb6a"),s("45fc"),s("a623"),s("e9c4"),s("b0c0"),s("a9e3"),s("4af1")),r=s("2f62"),o=s("5c96"),l=s("be46"),u=s("1816"),h=s.n(u),d=s("2f56"),m=s.n(d),k=s("0ee0"),f=s.n(k),g=s("aa6f"),_=s.n(g),v=s("8e6c"),p=s("510e"),b=s("365c"),C=s("fefb"),L=s("d98f"),y=s("7c8a"),I=s("4f1a"),D=s("fab6"),w=s("b857"),T={name:"bodySearch",components:{searchModule:l["a"],MyDialog:v["a"],Map:n["a"],SearchTrackModule:I["a"],checkLargeImg:y["a"],RecallList:D["a"],RecallDetail:w["a"]},data:function(){return{missionAreaOptions:[],checkedNodes:[],bellImg:h.a,radioImg:m.a,radioCheckImg:f.a,placeholder:_.a,dataList:[],visible:!1,allFloorTracksData:[],camerasData:[],searchResult:!0,queryId:"",round:0,photoCount:0,disabledItem:!1,isCheckAll:!1,isIndeterminate:!1,showLargeImg:!1,params:{},imgList:[],selectIdList:[],selectList:[],currentPageList:[],currentPage:1,previewTracksData:[],saveDataId:"",contentRadio:"轨迹查询",downValue:0,newTask:{name:"",duration:15,instance:5},showTaskDialog:!1,showMissionDetail:!1,missionData:{},currentTaskId:""}},created:function(){var t=this;L["a"].$on("showBodyDetail",(function(e){t.isSaveData=!0,t.showSaveData(e)}))},beforeDestroy:function(){L["a"].$off("showBodyDetail")},mounted:function(){var t=this.$route.params.id;this.isSaveData=!0,this.showSaveData(t),this.missionAreaOptions=this.areaData},computed:Object(c["a"])({},Object(r["b"])(["areaData","floorInfo","bodyQuery","bodyTaskValue"])),watch:{areaData:function(){this.missionAreaOptions=this.areaData},bodyQuery:function(){var t=this;this.dataList=[],this.searchResult=!0,this.saveDataId="",Object(b["c"])(this.bodyQuery).then((function(e){0===e.error_no&&(e.data.cluster_infos.forEach((function(t){t.isCheck=!1})),t.round=e.data.round,t.queryId=e.data.query_id,t.dataList=e.data.cluster_infos,t.selectList=[],t.selectIdList=[],t.checkedNodes=[])}))},round:function(){this.round>1?this.disabledItem=!0:this.disabledItem=!1,this.$refs.content&&this.$refs.content.scrollTo(0,0)},dataList:{handler:function(){var t=this;this.dataList.forEach((function(e){e.isCheck&&!t.selectIdList.includes(e.cluster_id)?(t.selectIdList.push(e.cluster_id),t.selectList.push(Object(c["a"])(Object(c["a"])({},e),{},{showDel:!1}))):!e.isCheck&&t.selectIdList.includes(e.cluster_id)&&(t.removeElement(t.selectIdList,e.cluster_id),t.selectList.forEach((function(s,a){s.cluster_id===e.cluster_id&&t.selectList.splice(a,1)})))}));while(this.selectList.length+10<=10*this.currentPage&&1!==this.currentPage)this.currentPage=this.currentPage-1;1===this.currentPage?this.currentPageList=this.selectList.slice(0,10):this.currentPageList=this.selectList.slice(10*(this.currentPage-1),10*(this.currentPage-1)+10);var e=this.dataList.some((function(t){return!0===t.isCheck})),s=this.dataList.every((function(t){return!0===t.isCheck}));e?s?(this.isCheckAll=!0,this.isIndeterminate=!1):(this.isIndeterminate=!0,this.isCheckAll=!1):(this.isIndeterminate=!1,this.isCheckAll=!1)},deep:!0}},methods:{delImg:function(t){var e=this;this.dataList.forEach((function(e){e.cluster_id===t.cluster_id&&(e.isCheck=!1)})),this.selectList.forEach((function(s,a){t.cluster_id===s.cluster_id&&(e.selectList.splice(a,1),e.selectIdList.splice(a,1))})),this.selectList.length+10===10*this.currentPage&&1!==this.currentPage&&(this.currentPage=this.currentPage-1),1===this.currentPage?this.currentPageList=this.selectList.slice(0,10):this.currentPageList=this.selectList.slice(10*(this.currentPage-1),10*(this.currentPage-1)+10)},leaveImg:function(t){t.showDel=!1},overImg:function(t){t.showDel=!0},handleCurrentChange:function(t){this.currentPage=t,this.currentPageList=this.selectList.slice(10*t-10,10*t)},closeImg:function(t){t&&(this.showLargeImg=!1,this.imgList=[])},checkLargeImg:function(t){this.showLargeImg=!0,this.imgList.push(t)},handleCheckAllChange:function(){var t=this;this.isCheckAll=!!this.isCheckAll,this.isIndeterminate=!1,this.dataList.forEach((function(e){e.isCheck=t.isCheckAll}))},getReset:function(t){this.disabledItem=!1,this.dataList=[],this.selectIdList=[],this.selectList=[],this.camerasData=[],this.round=0,this.searchResult=!0},selectCamera:function(){var t=this,e=JSON.parse(JSON.stringify(this.dataList));e.forEach((function(e){t.selectIdList.includes(e.cluster_id)&&t.removeElement(t.selectIdList,e.cluster_id),t.selectList.forEach((function(s,a){s.cluster_id===e.cluster_id&&t.selectList.splice(a,1)}))}));var s={query_id:this.queryId,camera_ids:this.checkedNodes};Object(b["d"])(s).then((function(e){if(0===e.error_no){if(e.data)return e.data.forEach((function(t){t.isCheck=!1})),void(t.dataList=e.data);t.dataList=[]}}))},checkItem:function(t){var e=this;t.isCheck=!t.isCheck,this.dataList.forEach((function(s,a){t.cluster_id===s.cluster_id&&e.dataList.splice(a,1,t)}))},closeDialog:function(){this.visible=!1},removeElement:function(t,e){return t.forEach((function(s,a){s===e&&t.splice(a,1)})),t},checkTrack:function(t){var e=this;this.visible=t;var s={query_id:this.queryId,cluster_ids:this.selectIdList,preview:!0};this.params=s,Object(b["e"])(s).then((function(s){0===s.error_no&&(e.photoCount=s.data.total_count,t?e.previewTracksData=s.data.tracks:e.allFloorTracksData=s.data.tracks)}))},nextSearch:function(){var t=this;Object(b["c"])({query_id:this.queryId,cluster_ids:this.selectIdList}).then((function(e){0===e.error_no&&(e.data.cluster_infos.forEach((function(t){t.isCheck=!1})),t.round=e.data.round,t.queryId=e.data.query_id,t.dataList=e.data.cluster_infos,t.visible=!1,t.checkedNodes=[])}))},checkResult:function(){this.checkTrack(!1),this.searchResult=!1,this.visible=!1},showSaveData:function(t){var e=this;t&&Object(C["r"])({id:t}).then((function(s){if(0===s.error_no){var a=s.data,i=a.param,c=a.secondResult;e.allFloorTracksData=c.tracks,e.lastFloorId=c.last_floor_id,e.photoCount=i.query.second.cluster_ids.length,e.searchResult=!1,e.visible=!1,e.saveDataId=t}}))},createPatckTask:function(){this.showTaskDialog=!0,console.log(this.showTaskDialog)},handleCloseTaskDialog:function(){this.showTaskDialog=!1},changeTab:function(t){this.contentRadio=t},missionDetail:function(t,e){this.missionData=t,this.currentTaskId=e,this.showMissionDetail=!0},submitPatchTask:function(){var t=this,e={first:{start_time:this.bodyQuery.start_time,end_time:this.bodyQuery.end_time,image:this.bodyQuery.images_base_64[0]}},s={task_id:p["a"].guid(),name:this.newTask.name,query_id:this.queryId,peer_duration:Number(this.newTask.duration),peer_closest_distance:String(this.newTask.instance),param:JSON.stringify(e)};Object(C["c"])(s).then((function(e){0===e.error_no&&(o["Message"].success({message:"任务创建成功，轨迹回溯任务需要一定的处理时间，处理完成后可查看“轨迹回溯”"}),t.showTaskDialog=!1,t.contentRadio="轨迹回溯任务",t.getPatchTaskList())}))},backMissionDetail:function(){this.showMissionDetail=!1}}},P=T,R=(s("10a4"),s("de39"),s("2877")),O=Object(R["a"])(P,a,i,!1,null,"6a8dbc4b",null);e["default"]=O.exports},de39:function(t,e,s){"use strict";s("442a")},eb40:function(t,e,s){}}]);