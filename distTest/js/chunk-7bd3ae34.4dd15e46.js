(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bd3ae34"],{"06f8":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("9cb8"),i=n("ed3d"),o=n("4971"),s=n("d777"),a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},u=1,l=2,c=3,h=0,p=["fill","stroke","shadowColor"],d=function(){function t(t,e,n,r,i,o,s){this.prop=t,this.propFunc=e,this.begin=r,this._pos=r,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()}return t.prototype.fire=function(t){var e=this[t];e&&e()},t.prototype.setTime=function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},t.prototype.getTime=function(){return this._time},t.prototype.setPosition=function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},t.prototype.getPosition=function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},t.prototype.play=function(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},t.prototype.reverse=function(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},t.prototype.seek=function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},t.prototype.reset=function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},t.prototype.finish=function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},t.prototype.update=function(){this.setPosition(this.getPosition(this._time))},t.prototype.onEnterFrame=function(){var t=this.getTimer()-this._startTime;this.state===l?this.setTime(t):this.state===c&&this.setTime(this.duration-t)},t.prototype.pause=function(){this.state=u,this.fire("onPause")},t.prototype.getTimer=function(){return(new Date).getTime()},t}(),f=function(){function t(n){var o,u,l=this,c=n.node,p=c._id,f=n.easing||e.Easings.Linear,g=!!n.yoyo;o="undefined"===typeof n.duration?.3:0===n.duration?.001:n.duration,this.node=c,this._id=h++;var m=c.getLayer()||(c instanceof s.Konva["Stage"]?c.getLayers():null);for(u in m||r.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new i.Animation((function(){l.tween.onEnterFrame()}),m),this.tween=new d(u,(function(t){l._tweenFunc(t)}),f,0,1,1e3*o,g),this._addListeners(),t.attrs[p]||(t.attrs[p]={}),t.attrs[p][this._id]||(t.attrs[p][this._id]={}),t.tweens[p]||(t.tweens[p]={}),n)void 0===a[u]&&this._addAttr(u,n[u]);this.reset(),this.onFinish=n.onFinish,this.onReset=n.onReset}return t.prototype._addAttr=function(e,n){var i,o,s,a,u,l,c,h,d=this.node,f=d._id;if(s=t.tweens[f][e],s&&delete t.attrs[f][s][e],i=d.getAttr(e),r.Util._isArray(n))if(o=[],u=Math.max(n.length,i.length),"points"===e&&n.length!==i.length&&(n.length>i.length?(c=i,i=r.Util._prepareArrayForTween(i,n,d.closed())):(l=n,n=r.Util._prepareArrayForTween(n,i,d.closed()))),0===e.indexOf("fill"))for(a=0;a<u;a++)if(a%2===0)o.push(n[a]-i[a]);else{var g=r.Util.colorToRGBA(i[a]);h=r.Util.colorToRGBA(n[a]),i[a]=g,o.push({r:h.r-g.r,g:h.g-g.g,b:h.b-g.b,a:h.a-g.a})}else for(a=0;a<u;a++)o.push(n[a]-i[a]);else-1!==p.indexOf(e)?(i=r.Util.colorToRGBA(i),h=r.Util.colorToRGBA(n),o={r:h.r-i.r,g:h.g-i.g,b:h.b-i.b,a:h.a-i.a}):o=n-i;t.attrs[f][this._id][e]={start:i,diff:o,end:n,trueEnd:l,trueStart:c},t.tweens[f][e]=this._id},t.prototype._tweenFunc=function(e){var n,i,o,s,a,u,l,c,h=this.node,d=t.attrs[h._id][this._id];for(n in d){if(i=d[n],o=i.start,s=i.diff,c=i.end,r.Util._isArray(o))if(a=[],l=Math.max(o.length,c.length),0===n.indexOf("fill"))for(u=0;u<l;u++)u%2===0?a.push((o[u]||0)+s[u]*e):a.push("rgba("+Math.round(o[u].r+s[u].r*e)+","+Math.round(o[u].g+s[u].g*e)+","+Math.round(o[u].b+s[u].b*e)+","+(o[u].a+s[u].a*e)+")");else for(u=0;u<l;u++)a.push((o[u]||0)+s[u]*e);else a=-1!==p.indexOf(n)?"rgba("+Math.round(o.r+s.r*e)+","+Math.round(o.g+s.g*e)+","+Math.round(o.b+s.b*e)+","+(o.a+s.a*e)+")":o+s*e;h.setAttr(n,a)}},t.prototype._addListeners=function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){var n=e.node,r=t.attrs[n._id][e._id];r.points&&r.points.trueEnd&&n.setAttr("points",r.points.trueEnd),e.onFinish&&e.onFinish.call(e)},this.tween.onReset=function(){var n=e.node,r=t.attrs[n._id][e._id];r.points&&r.points.trueStart&&n.points(r.points.trueStart),e.onReset&&e.onReset()}},t.prototype.play=function(){return this.tween.play(),this},t.prototype.reverse=function(){return this.tween.reverse(),this},t.prototype.reset=function(){return this.tween.reset(),this},t.prototype.seek=function(t){return this.tween.seek(1e3*t),this},t.prototype.pause=function(){return this.tween.pause(),this},t.prototype.finish=function(){return this.tween.finish(),this},t.prototype.destroy=function(){var e,n=this.node._id,r=this._id,i=t.tweens[n];for(e in this.pause(),i)delete t.tweens[n][e];delete t.attrs[n][r]},t.attrs={},t.tweens={},t}();e.Tween=f,o.Node.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()};var n=new f(t);n.play()},e.Easings={BackEaseIn:function(t,e,n,r){var i=1.70158;return n*(t/=r)*t*((i+1)*t-i)+e},BackEaseOut:function(t,e,n,r){var i=1.70158;return n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},BackEaseInOut:function(t,e,n,r){var i=1.70158;return(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},ElasticEaseIn:function(t,e,n,r,i,o){var s=0;return 0===t?e:1===(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o)+e)},ElasticEaseOut:function(t,e,n,r,i,o){var s=0;return 0===t?e:1===(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-s)*(2*Math.PI)/o)+n+e)},ElasticEaseInOut:function(t,e,n,r,i,o){var s=0;return 0===t?e:2===(t/=r/2)?e+n:(o||(o=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o)*.5+n+e)},BounceEaseOut:function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,n,r,i){return r-e.Easings.BounceEaseOut(i-t,0,r,i)+n},BounceEaseInOut:function(t,n,r,i){return t<i/2?.5*e.Easings.BounceEaseIn(2*t,0,r,i)+n:.5*e.Easings.BounceEaseOut(2*t-i,0,r,i)+.5*r+n},EaseIn:function(t,e,n,r){return n*(t/=r)*t+e},EaseOut:function(t,e,n,r){return-n*(t/=r)*(t-2)+e},EaseInOut:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},StrongEaseOut:function(t,e,n,r){return n*((t=t/r-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,n,r){return n*t/r+e}}},"0f7f":function(t,e,n){(function(){"use strict";var e=n("d80b"),r=function(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)};r.prototype={valueOf:function(){return this.toString()},toString:function(){return"["+this.curves.map((function(t){return e.pointsToString(t.points)})).join(", ")+"]"},addCurve:function(t){this.curves.push(t),this._3d=this._3d||t._3d},length:function(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))},curve:function(t){return this.curves[t]},bbox:function(){for(var t=this.curves,n=t[0].bbox(),r=1;r<t.length;r++)e.expandbox(n,t[r].bbox());return n},offset:function(t){var e=[];return this.curves.forEach((function(n){e=e.concat(n.offset(t))})),new r(e)}},t.exports=r})()},"0ff5":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("ea61"),s=n("f0b4"),a=n("d6af"),u=n("f655"),l=n("fce6"),c=n("4546"),h=n("d777"),p="#",d="beforeDraw",f="draw",g=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],m=g.length,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hitCanvas=new u.HitCanvas({pixelRatio:1}),e}return r(e,t),e.prototype._setCanvasSize=function(t,e){this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._checkSmooth()},e.prototype._validateAdd=function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&i.Util.throw("You may only add groups and shapes to a layer.")},e.prototype.getIntersection=function(t,e){var n,r,i,o;if(!this.hitGraphEnabled()||!this.isVisible())return null;var s=1,a=!1;while(1){for(r=0;r<m;r++){if(i=g[r],n=this._getIntersection({x:t.x+i.x*s,y:t.y+i.y*s}),o=n.shape,o&&e)return o.findAncestor(e,!0);if(o)return o;if(a=!!n.antialiased,!n.antialiased)break}if(!a)return null;s+=1}},e.prototype._getIntersection=function(t){var e,n,r=this.hitCanvas.pixelRatio,o=this.hitCanvas.context.getImageData(Math.round(t.x*r),Math.round(t.y*r),1,1).data,s=o[3];return 255===s?(e=i.Util._rgbToHex(o[0],o[1],o[2]),n=l.shapes[p+e],n?{shape:n}:{antialiased:!0}):s>0?{antialiased:!0}:{}},e.prototype.drawScene=function(t,e){var n=this.getLayer(),r=t||n&&n.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),o.Container.prototype.drawScene.call(this,r,e),this._fire(f,{node:this}),this},e.prototype.drawHit=function(t,e){var n=this.getLayer(),r=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),o.Container.prototype.drawHit.call(this,r,e),this},e.prototype.clear=function(t){return a.BaseLayer.prototype.clear.call(this,t),this.getHitCanvas().getContext().clear(t),this},e.prototype.enableHitGraph=function(){return this.hitGraphEnabled(!0),this},e.prototype.disableHitGraph=function(){return this.hitGraphEnabled(!1),this},e.prototype.toggleHitCanvas=function(){if(this.parent){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}},e.prototype.setSize=function(e){var n=e.width,r=e.height;return t.prototype.setSize.call(this,{width:n,height:r}),this.hitCanvas.setSize(n,r),this},e}(a.BaseLayer);e.Layer=y,y.prototype.nodeType="Layer",h._registerNode(y),s.Factory.addGetterSetter(y,"hitGraphEnabled",!0,c.getBooleanValidator()),i.Collection.mapMethods(y)},1110:function(t,e,n){"use strict";n("c94b")},"122f":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.Threshold=function(t){var e,n=255*this.threshold(),r=t.data,i=r.length;for(e=0;e<i;e+=1)r[e]=r[e]<n?0:255},r.Factory.addGetterSetter(i.Node,"threshold",.5,o.getNumberValidator(),r.Factory.afterSetFilter)},1780:function(t,e,n){var r,i,o;(function(t){var n,o,s="0.5.4",a="hasOwnProperty",u=/[\.\/]/,l=/\s*,\s*/,c="*",h=function(t,e){return t-e},p={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if("undefined"!=typeof this[t])return this[t]},f=function(){var t=this.length;while(--t)if("undefined"!=typeof this[t])return this[t]},g=Object.prototype.toString,m=String,y=Array.isArray||function(t){return t instanceof Array||"[object Array]"==g.call(t)},v=function(t,e){var r,i=o,s=Array.prototype.slice.call(arguments,2),a=v.listeners(t),u=0,l=[],c={},p=[],g=n;p.firstDefined=d,p.lastDefined=f,n=t,o=0;for(var m=0,y=a.length;m<y;m++)"zIndex"in a[m]&&(l.push(a[m].zIndex),a[m].zIndex<0&&(c[a[m].zIndex]=a[m]));l.sort(h);while(l[u]<0)if(r=c[l[u++]],p.push(r.apply(e,s)),o)return o=i,p;for(m=0;m<y;m++)if(r=a[m],"zIndex"in r)if(r.zIndex==l[u]){if(p.push(r.apply(e,s)),o)break;do{if(u++,r=c[l[u]],r&&p.push(r.apply(e,s)),o)break}while(r)}else c[r.zIndex]=r;else if(p.push(r.apply(e,s)),o)break;return o=i,n=g,p};v._events=p,v.listeners=function(t){var e,n,r,i,o,s,a,l,h=y(t)?t:t.split(u),d=p,f=[d],g=[];for(i=0,o=h.length;i<o;i++){for(l=[],s=0,a=f.length;s<a;s++){d=f[s].n,n=[d[h[i]],d[c]],r=2;while(r--)e=n[r],e&&(l.push(e),g=g.concat(e.f||[]))}f=l}return g},v.separator=function(t){t?(t=m(t).replace(/(?=[\.\^\]\[\-])/g,"\\"),t="["+t+"]",u=new RegExp(t)):u=/[\.\/]/},v.on=function(t,e){if("function"!=typeof e)return function(){};for(var n=y(t)?y(t[0])?t:[t]:m(t).split(l),r=0,i=n.length;r<i;r++)(function(t){for(var n,r=y(t)?t:m(t).split(u),i=p,o=0,s=r.length;o<s;o++)i=i.n,i=i.hasOwnProperty(r[o])&&i[r[o]]||(i[r[o]]={n:{}});for(i.f=i.f||[],o=0,s=i.f.length;o<s;o++)if(i.f[o]==e){n=!0;break}!n&&i.f.push(e)})(n[r]);return function(t){+t==+t&&(e.zIndex=+t)}},v.f=function(t){var e=[].slice.call(arguments,1);return function(){v.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},v.stop=function(){o=1},v.nt=function(t){var e=y(n)?n.join("."):n;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},v.nts=function(){return y(n)?n:n.split(u)},v.off=v.unbind=function(t,e){if(t){var n=y(t)?y(t[0])?t:[t]:m(t).split(l);if(n.length>1)for(var r=0,i=n.length;r<i;r++)v.off(n[r],e);else{n=y(t)?t:m(t).split(u);var o,s,h,d,f,g=[p],x=[];for(r=0,i=n.length;r<i;r++)for(d=0;d<g.length;d+=h.length-2){if(h=[d,1],o=g[d].n,n[r]!=c)o[n[r]]&&(h.push(o[n[r]]),x.unshift({n:o,name:n[r]}));else for(s in o)o[a](s)&&(h.push(o[s]),x.unshift({n:o,name:s}));g.splice.apply(g,h)}for(r=0,i=g.length;r<i;r++){o=g[r];while(o.n){if(e){if(o.f){for(d=0,f=o.f.length;d<f;d++)if(o.f[d]==e){o.f.splice(d,1);break}!o.f.length&&delete o.f}for(s in o.n)if(o.n[a](s)&&o.n[s].f){var _=o.n[s].f;for(d=0,f=_.length;d<f;d++)if(_[d]==e){_.splice(d,1);break}!_.length&&delete o.n[s].f}}else for(s in delete o.f,o.n)o.n[a](s)&&o.n[s].f&&delete o.n[s].f;o=o.n}}t:for(r=0,i=x.length;r<i;r++){for(s in o=x[r],o.n[o.name].f)continue t;for(s in o.n[o.name].n)continue t;delete o.n[o.name]}}}else v._events=p={n:{}}},v.once=function(t,e){var n=function(){return v.off(t,n),e.apply(this,arguments)};return v.on(t,n)},v.version=s,v.toString=function(){return"You are running Eve "+s},t.eve=v,i=[],r=function(){return v}.apply(e,i)})("undefined"!=typeof window?window:this),function(n,s){i=[r],o=function(t){return s(n,t)}.apply(e,i),void 0===o||(t.exports=o)}(window||this,(function(t,e){var n=function(e){var n,r={},i=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){return setTimeout(t,16,(new Date).getTime()),!0},o=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},s=0,a="M"+(+new Date).toString(36),u=function(){return a+(s++).toString(36)},l=Date.now||function(){return+new Date},c=function(t){var e=this;if(null==t)return e.s;var n=e.s-t;e.b+=e.dur*n,e.B+=e.dur*n,e.s=t},h=function(t){var e=this;if(null==t)return e.spd;e.spd=t},p=function(t){var e=this;if(null==t)return e.dur;e.s=e.s*t/e.dur,e.dur=t},d=function(){var t=this;delete r[t.id],t.update(),e("mina.stop."+t.id,t)},f=function(){var t=this;t.pdif||(delete r[t.id],t.update(),t.pdif=t.get()-t.b)},g=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,r[t.id]=t,y())},m=function(){var t,e=this;if(o(e.start)){t=[];for(var n=0,r=e.start.length;n<r;n++)t[n]=+e.start[n]+(e.end[n]-e.start[n])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},y=function(t){if(t){var o=0;for(var s in r)if(r.hasOwnProperty(s)){var a=r[s],u=a.get();o++,a.s=(u-a.b)/(a.dur/a.spd),a.s>=1&&(delete r[s],a.s=1,o--,function(t){setTimeout((function(){e("mina.finish."+t.id,t)}))}(a)),a.update()}n=!!o&&i(y)}else n||(n=i(y))},v=function(t,e,n,i,o,s,a){var l={id:u(),start:t,end:e,b:n,s:0,dur:i-n,spd:1,get:o,set:s,easing:a||v.linear,status:c,speed:h,duration:p,stop:d,pause:f,resume:g,update:m};r[l.id]=l;var x,_=0;for(x in r)if(r.hasOwnProperty(x)&&(_++,2==_))break;return 1==_&&y(),l};return v.time=l,v.getById=function(t){return r[t]||null},v.linear=function(t){return t},v.easeout=function(t){return Math.pow(t,1.7)},v.easein=function(t){return Math.pow(t,.48)},v.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),r=n-e,i=Math.pow(Math.abs(r),1/3)*(r<0?-1:1),o=-n-e,s=Math.pow(Math.abs(o),1/3)*(o<0?-1:1),a=i+s+.5;return 3*(1-a)*a*a+a*a*a},v.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},v.backout=function(t){if(0==t)return 0;t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},v.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},v.bounce=function(t){var e,n=7.5625,r=2.75;return t<1/r?e=n*t*t:t<2/r?(t-=1.5/r,e=n*t*t+.75):t<2.5/r?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e},t.mina=v,v}("undefined"==typeof e?function(){}:e),r=function(t){function n(t,e){if(t){if(t.nodeType)return $(t);if(P(t,"array")&&n.set)return n.set.apply(n,t);if(t instanceof Z)return t;if(null==e)try{return t=r.doc.querySelector(String(t)),$(t)}catch(i){return null}}return t=null==t?"100%":t,e=null==e?"100%":e,new Q(t,e)}n.version="0.5.1",n.toString=function(){return"Snap v"+this.version},n._={};var r={win:t.window,doc:t.window.document};n._.glob=r;var i="hasOwnProperty",o=String,s=parseFloat,a=parseInt,u=Math,l=u.max,c=u.min,h=u.abs,p=(u.pow,u.PI),d=(u.round,""),f=Object.prototype.toString,m=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,y=(n._.separator=/[,\s]+/,/[\s]*,[\s]*/),v={hs:1,rg:1},x=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,_=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,b=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\s]*,?[\s]*/gi,w=0,M="S"+(+new Date).toString(36),E=function(t){return(t&&t.type?t.type:d)+M+(w++).toString(36)},S="http://www.w3.org/1999/xlink",T="http://www.w3.org/2000/svg",C={};n.url=function(t){return"url('#"+t+"')"};function A(t,e){if(e){if("#text"==t&&(t=r.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=r.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=A(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(S,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(T,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var n in e)if(e[i](n)){var s=o(e[n]);s?"xlink:"==n.substring(0,6)?t.setAttributeNS(S,n.substring(6),s):"xml:"==n.substring(0,4)?t.setAttributeNS(T,n.substring(4),s):t.setAttribute(n,s):t.removeAttribute(n)}}else"text"in e&&(t.nodeValue=e.text)}else t=r.doc.createElementNS(T,t);return t}function P(t,e){return e=o.prototype.toLowerCase.call(e),"finite"==e?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||("null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||f.call(t).slice(8,-1).toLowerCase()==e)}function L(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var n in t)t[i](n)&&(e[n]=L(t[n]));return e}function I(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}function R(t,e,n){function r(){var o=Array.prototype.slice.call(arguments,0),s=o.join("␀"),a=r.cache=r.cache||{},u=r.count=r.count||[];return a[i](s)?(I(u,s),n?n(a[s]):a[s]):(u.length>=1e3&&delete a[u.shift()],u.push(s),a[s]=t.apply(e,o),n?n(a[s]):a[s])}return r}function N(t,e,n,r,i,o){if(null==i){var s=t-n,a=e-r;return s||a?(180+180*u.atan2(-a,-s)/p+360)%360:0}return N(t,e,i,o)-N(n,r,i,o)}function O(t){return t%360*p/180}function D(t){return 180*t/p%360}n._.$=A,n._.id=E,n.format=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(t,n,r){var i=r;return n.replace(e,(function(t,e,n,r,o){e=e||r,i&&(e in i&&(i=i[e]),"function"==typeof i&&o&&(i=i()))})),i=(null==i||i==r?t:i)+"",i};return function(e,r){return o(e).replace(t,(function(t,e){return n(t,e,r)}))}}(),n._.clone=L,n._.cacher=R,n.rad=O,n.deg=D,n.sin=function(t){return u.sin(n.rad(t))},n.tan=function(t){return u.tan(n.rad(t))},n.cos=function(t){return u.cos(n.rad(t))},n.asin=function(t){return n.deg(u.asin(t))},n.acos=function(t){return n.deg(u.acos(t))},n.atan=function(t){return n.deg(u.atan(t))},n.atan2=function(t){return n.deg(u.atan2(t))},n.angle=N,n.len=function(t,e,r,i){return Math.sqrt(n.len2(t,e,r,i))},n.len2=function(t,e,n,r){return(t-n)*(t-n)+(e-r)*(e-r)},n.closestPoint=function(t,e,n){function r(t){var r=t.x-e,i=t.y-n;return r*r+i*i}for(var i,o,s,a,u=t.node,l=u.getTotalLength(),c=l/u.pathSegList.numberOfItems*.125,h=1/0,p=0;p<=l;p+=c)(a=r(s=u.getPointAtLength(p)))<h&&(i=s,o=p,h=a);c*=.5;while(c>.5){var d,f,g,m,y,v;(g=o-c)>=0&&(y=r(d=u.getPointAtLength(g)))<h?(i=d,o=g,h=y):(m=o+c)<=l&&(v=r(f=u.getPointAtLength(m)))<h?(i=f,o=m,h=v):c*=.5}return i={x:i.x,y:i.y,length:o,distance:Math.sqrt(h)},i},n.is=P,n.snapTo=function(t,e,n){if(n=P(n,"finite")?n:10,P(t,"array")){var r=t.length;while(r--)if(h(t[r]-e)<=n)return t[r]}else{t=+t;var i=e%t;if(i<n)return e-i;if(i>t-n)return e-i+t}return e},n.getRGB=R((function(t){if(!t||(t=o(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:z};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:z};if(!v[i](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=F(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:z};var e,r,h,p,d,f,g=t.match(m);return g?(g[2]&&(h=a(g[2].substring(5),16),r=a(g[2].substring(3,5),16),e=a(g[2].substring(1,3),16)),g[3]&&(h=a((d=g[3].charAt(3))+d,16),r=a((d=g[3].charAt(2))+d,16),e=a((d=g[3].charAt(1))+d,16)),g[4]&&(f=g[4].split(y),e=s(f[0]),"%"==f[0].slice(-1)&&(e*=2.55),r=s(f[1]),"%"==f[1].slice(-1)&&(r*=2.55),h=s(f[2]),"%"==f[2].slice(-1)&&(h*=2.55),"rgba"==g[1].toLowerCase().slice(0,4)&&(p=s(f[3])),f[3]&&"%"==f[3].slice(-1)&&(p/=100)),g[5]?(f=g[5].split(y),e=s(f[0]),"%"==f[0].slice(-1)&&(e/=100),r=s(f[1]),"%"==f[1].slice(-1)&&(r/=100),h=s(f[2]),"%"==f[2].slice(-1)&&(h/=100),("deg"==f[0].slice(-3)||"°"==f[0].slice(-1))&&(e/=360),"hsba"==g[1].toLowerCase().slice(0,4)&&(p=s(f[3])),f[3]&&"%"==f[3].slice(-1)&&(p/=100),n.hsb2rgb(e,r,h,p)):g[6]?(f=g[6].split(y),e=s(f[0]),"%"==f[0].slice(-1)&&(e/=100),r=s(f[1]),"%"==f[1].slice(-1)&&(r/=100),h=s(f[2]),"%"==f[2].slice(-1)&&(h/=100),("deg"==f[0].slice(-3)||"°"==f[0].slice(-1))&&(e/=360),"hsla"==g[1].toLowerCase().slice(0,4)&&(p=s(f[3])),f[3]&&"%"==f[3].slice(-1)&&(p/=100),n.hsl2rgb(e,r,h,p)):(e=c(u.round(e),255),r=c(u.round(r),255),h=c(u.round(h),255),p=c(l(p,0),1),g={r:e,g:r,b:h,toString:z},g.hex="#"+(16777216|h|r<<8|e<<16).toString(16).slice(1),g.opacity=P(p,"finite")?p:1,g)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:z}}),n),n.hsb=R((function(t,e,r){return n.hsb2rgb(t,e,r).hex})),n.hsl=R((function(t,e,r){return n.hsl2rgb(t,e,r).hex})),n.rgb=R((function(t,e,n,r){if(P(r,"finite")){var i=u.round;return"rgba("+[i(t),i(e),i(n),+r.toFixed(2)]+")"}return"#"+(16777216|n|e<<8|t<<16).toString(16).slice(1)}));var F=function(t){var e=r.doc.getElementsByTagName("head")[0]||r.doc.getElementsByTagName("svg")[0],n="rgb(255, 0, 0)";return F=R((function(t){if("red"==t.toLowerCase())return n;e.style.color=n,e.style.color=t;var i=r.doc.defaultView.getComputedStyle(e,d).getPropertyValue("color");return i==n?null:i})),F(t)},k=function(){return"hsb("+[this.h,this.s,this.b]+")"},B=function(){return"hsl("+[this.h,this.s,this.l]+")"},z=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},G=function(t,e,r){if(null==e&&P(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,e=t.g,t=t.r),null==e&&P(t,string)){var i=n.getRGB(t);t=i.r,e=i.g,r=i.b}return(t>1||e>1||r>1)&&(t/=255,e/=255,r/=255),[t,e,r]},U=function(t,e,r,i){t=u.round(255*t),e=u.round(255*e),r=u.round(255*r);var o={r:t,g:e,b:r,opacity:P(i,"finite")?i:1,hex:n.rgb(t,e,r),toString:z};return P(i,"finite")&&(o.opacity=i),o};n.color=function(t){var e;return P(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=n.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):P(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=n.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.opacity=1,t.hex=e.hex):(P(t,"string")&&(t=n.getRGB(t)),P(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(e=n.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=n.rgb2hsb(t),t.v=e.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=z,t},n.hsb2rgb=function(t,e,n,r){var i,o,s,a,u;return P(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(n=t.b,e=t.s,r=t.o,t=t.h),t*=360,t=t%360/60,u=n*e,a=u*(1-h(t%2-1)),i=o=s=n-u,t=~~t,i+=[u,a,0,0,a,u][t],o+=[a,u,u,a,0,0][t],s+=[0,0,a,u,u,a][t],U(i,o,s,r)},n.hsl2rgb=function(t,e,n,r){var i,o,s,a,u;return P(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(n=t.l,e=t.s,t=t.h),(t>1||e>1||n>1)&&(t/=360,e/=100,n/=100),t*=360,t=t%360/60,u=2*e*(n<.5?n:1-n),a=u*(1-h(t%2-1)),i=o=s=n-u/2,t=~~t,i+=[u,a,0,0,a,u][t],o+=[a,u,u,a,0,0][t],s+=[0,0,a,u,u,a][t],U(i,o,s,r)},n.rgb2hsb=function(t,e,n){var r,i,o,s;return n=G(t,e,n),t=n[0],e=n[1],n=n[2],o=l(t,e,n),s=o-c(t,e,n),r=0==s?null:o==t?(e-n)/s:o==e?(n-t)/s+2:(t-e)/s+4,r=(r+360)%6*60/360,i=0==s?0:s/o,{h:r,s:i,b:o,toString:k}},n.rgb2hsl=function(t,e,n){var r,i,o,s,a,u;return n=G(t,e,n),t=n[0],e=n[1],n=n[2],s=l(t,e,n),a=c(t,e,n),u=s-a,r=0==u?null:s==t?(e-n)/u:s==e?(n-t)/u+2:(t-e)/u+4,r=(r+360)%6*60/360,o=(s+a)/2,i=0==u?0:o<.5?u/(2*o):u/(2-2*o),{h:r,s:i,l:o,toString:B}},n.parsePathString=function(t){if(!t)return null;var e=n.path(t);if(e.arr)return n.path.clone(e.arr);var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},i=[];return P(t,"array")&&P(t[0],"array")&&(i=n.path.clone(t)),i.length||o(t).replace(x,(function(t,e,n){var o=[],s=e.toLowerCase();if(n.replace(b,(function(t,e){e&&o.push(+e)})),"m"==s&&o.length>2&&(i.push([e].concat(o.splice(0,2))),s="l",e="m"==e?"l":"L"),"o"==s&&1==o.length&&i.push([e,o[0]]),"r"==s)i.push([e].concat(o));else while(o.length>=r[s])if(i.push([e].concat(o.splice(0,r[s]))),!r[s])break})),i.toString=n.path.toString,e.arr=n.path.clone(i),i};var V=n.parseTransformString=function(t){if(!t)return null;var e=[];return P(t,"array")&&P(t[0],"array")&&(e=n.path.clone(t)),e.length||o(t).replace(_,(function(t,n,r){var i=[];n.toLowerCase();r.replace(b,(function(t,e){e&&i.push(+e)})),e.push([n].concat(i))})),e.toString=n.path.toString,e};function H(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,(function(t,n,r){return r=r.split(/\s*,\s*|\s+/),"rotate"==n&&1==r.length&&r.push(0,0),"scale"==n&&(r.length>2?r=r.slice(0,2):2==r.length&&r.push(0,0),1==r.length&&r.push(r[0],0,0)),"skewX"==n?e.push(["m",1,0,u.tan(O(r[0])),1,0,0]):"skewY"==n?e.push(["m",1,u.tan(O(r[0])),0,1,0,0]):e.push([n.charAt(0)].concat(r)),t})),e}function j(t,e){var r=V(t),i=new n.Matrix;if(r)for(var s=0,a=r.length;s<a;s++){var u,l,c,h,p,d=r[s],f=d.length,g=o(d[0]).toLowerCase(),m=d[0]!=g,y=m?i.invert():0;"t"==g&&2==f?i.translate(d[1],0):"t"==g&&3==f?m?(u=y.x(0,0),l=y.y(0,0),c=y.x(d[1],d[2]),h=y.y(d[1],d[2]),i.translate(c-u,h-l)):i.translate(d[1],d[2]):"r"==g?2==f?(p=p||e,i.rotate(d[1],p.x+p.width/2,p.y+p.height/2)):4==f&&(m?(c=y.x(d[2],d[3]),h=y.y(d[2],d[3]),i.rotate(d[1],c,h)):i.rotate(d[1],d[2],d[3])):"s"==g?2==f||3==f?(p=p||e,i.scale(d[1],d[f-1],p.x+p.width/2,p.y+p.height/2)):4==f?m?(c=y.x(d[2],d[3]),h=y.y(d[2],d[3]),i.scale(d[1],d[1],c,h)):i.scale(d[1],d[1],d[2],d[3]):5==f&&(m?(c=y.x(d[3],d[4]),h=y.y(d[3],d[4]),i.scale(d[1],d[2],c,h)):i.scale(d[1],d[2],d[3],d[4])):"m"==g&&7==f&&i.add(d[1],d[2],d[3],d[4],d[5],d[6])}return i}n._.svgTransform2string=H,n._.rgTransform=/^[a-z][\s]*-?\.?\d/i,n._.transform2matrix=j,n._unit2px=Y;r.doc.contains||r.doc.compareDocumentPosition;function W(t){var e=t.node.ownerSVGElement&&$(t.node.ownerSVGElement)||t.node.parentNode&&$(t.node.parentNode)||n.select("svg")||n(0,0),r=e.select("defs"),i=null!=r&&r.node;return i||(i=J("defs",e.node).node),i}function q(t){return t.node.ownerSVGElement&&$(t.node.ownerSVGElement)||n.select("svg")}function Y(t,e,n){var r=q(t).node,i={},o=r.querySelector(".svg---mgr");function s(t){if(null==t)return d;if(t==+t)return t;A(o,{width:t});try{return o.getBBox().width}catch(e){return 0}}function a(t){if(null==t)return d;if(t==+t)return t;A(o,{height:t});try{return o.getBBox().height}catch(e){return 0}}function u(r,o){null==e?i[r]=o(t.attr(r)||0):r==e&&(i=o(null==n?t.attr(r)||0:n))}switch(o||(o=A("rect"),A(o,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),r.appendChild(o)),t.type){case"rect":u("rx",s),u("ry",a);case"image":u("width",s),u("height",a);case"text":u("x",s),u("y",a);break;case"circle":u("cx",s),u("cy",a),u("r",s);break;case"ellipse":u("cx",s),u("cy",a),u("rx",s),u("ry",a);break;case"line":u("x1",s),u("x2",s),u("y1",a),u("y2",a);break;case"marker":u("refX",s),u("markerWidth",s),u("refY",a),u("markerHeight",a);break;case"radialGradient":u("fx",s),u("fy",a);break;case"tspan":u("dx",s),u("dy",a);break;default:u(e,s)}return r.removeChild(o),i}function X(t){P(t,"array")||(t=Array.prototype.slice.call(arguments,0));var e=0,n=0,r=this.node;while(this[e])delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach((function(t){r.appendChild(t.node)})):r.appendChild(t[e].node);var i=r.childNodes;for(e=0;e<i.length;e++)this[n++]=$(i[e]);return this}function Z(t){if(t.snap in C)return C[t.snap];var e;try{e=t.ownerSVGElement}catch(o){}this.node=t,e&&(this.paper=new Q(e)),this.type=t.tagName||t.nodeName;var n=this.id=E(this);if(this.anims={},this._={transform:[]},t.snap=n,C[n]=this,"g"==this.type&&(this.add=X),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var r in Q.prototype)Q.prototype[i](r)&&(this[r]=Q.prototype[r])}function K(t){this.node=t}function J(t,e){var n=A(t);e.appendChild(n);var r=$(n);return r}function Q(t,e){var n,o,s,a=Q.prototype;if(t&&t.tagName&&"svg"==t.tagName.toLowerCase()){if(t.snap in C)return C[t.snap];var u=t.ownerDocument;for(var l in n=new Z(t),o=t.getElementsByTagName("desc")[0],s=t.getElementsByTagName("defs")[0],o||(o=A("desc"),o.appendChild(u.createTextNode("Created with Snap")),n.node.appendChild(o)),s||(s=A("defs"),n.node.appendChild(s)),n.defs=s,a)a[i](l)&&(n[l]=a[l]);n.paper=n.root=n}else n=J("svg",r.doc.body),A(n.node,{height:e,version:1.1,width:t,xmlns:T});return n}function $(t){return t?t instanceof Z||t instanceof K?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new Q(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new Q(t.contentDocument.getElementsByTagName("svg")[0]):new Z(t):t}function tt(t,e){for(var n=0,r=t.length;n<r;n++){var i={type:t[n].type,attr:t[n].attr()},o=t[n].children();e.push(i),o.length&&tt(o,i.childNodes=[])}}n._.getSomeDefs=W,n._.getSomeSVG=q,n.select=function(t){return t=o(t).replace(/([^\\]):/g,"$1\\:"),$(r.doc.querySelector(t))},n.selectAll=function(t){for(var e=r.doc.querySelectorAll(t),i=(n.set||Array)(),o=0;o<e.length;o++)i.push($(e[o]));return i},setInterval((function(){for(var t in C)if(C[i](t)){var e=C[t],n=e.node;("svg"!=e.type&&!n.ownerSVGElement||"svg"==e.type&&(!n.parentNode||"ownerSVGElement"in n.parentNode&&!n.ownerSVGElement))&&delete C[t]}}),1e4),Z.prototype.attr=function(t,n){var r=this,o=r.node;if(!t){if(1!=o.nodeType)return{text:o.nodeValue};for(var s=o.attributes,a={},u=0,l=s.length;u<l;u++)a[s[u].nodeName]=s[u].nodeValue;return a}if(P(t,"string")){if(!(arguments.length>1))return e("snap.util.getattr."+t,r).firstDefined();var c={};c[t]=n,t=c}for(var h in t)t[i](h)&&e("snap.util.attr."+h,r,t[h]);return r},n.parse=function(t){var e=r.doc.createDocumentFragment(),n=!0,i=r.doc.createElement("div");if(t=o(t),t.match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",n=!1),i.innerHTML=t,t=i.getElementsByTagName("svg")[0],t)if(n)e=t;else while(t.firstChild)e.appendChild(t.firstChild);return new K(e)},n.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),e=r.doc.createDocumentFragment(),i=0,o=t.length;i<o;i++){var s=t[i];s.node&&s.node.nodeType&&e.appendChild(s.node),s.nodeType&&e.appendChild(s),"string"==typeof s&&e.appendChild(n.parse(s).node)}return new K(e)},n._.make=J,n._.wrap=$,Q.prototype.el=function(t,e){var n=J(t,this.node);return e&&n.attr(e),n},Z.prototype.children=function(){for(var t=[],e=this.node.childNodes,r=0,i=e.length;r<i;r++)t[r]=n(e[r]);return t},Z.prototype.toJSON=function(){var t=[];return tt([this],t),t[0]},e.on("snap.util.getattr",(function(){var t=e.nt();t=t.substring(t.lastIndexOf(".")+1);var n=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return et[i](n)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(n):A(this.node,t)}));var et={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",(function(t){var n=e.nt(),r={};n=n.substring(n.lastIndexOf(".")+1),r[n]=t;var o=n.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()})),s=n.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));et[i](s)?this.node.style[o]=null==t?d:t:A(this.node,r)})),Q.prototype,n.ajax=function(t,n,r,i){var o=new XMLHttpRequest,s=E();if(o){if(P(n,"function"))i=r,r=n,n=null;else if(P(n,"object")){var a=[];for(var u in n)n.hasOwnProperty(u)&&a.push(encodeURIComponent(u)+"="+encodeURIComponent(n[u]));n=a.join("&")}return o.open(n?"POST":"GET",t,!0),n&&(o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded")),r&&(e.once("snap.ajax."+s+".0",r),e.once("snap.ajax."+s+".200",r),e.once("snap.ajax."+s+".304",r)),o.onreadystatechange=function(){4==o.readyState&&(e("snap.ajax."+s+"."+o.status,i,o),e.off("snap.ajax."+s+".0"),e.off("snap.ajax."+s+".200"),e.off("snap.ajax."+s+".304"))},4==o.readyState?o:(o.send(n),o)}},n.load=function(t,e,r){n.ajax(t,(function(t){var i=n.parse(t.responseText);r?e.call(r,i):e(i)}))};var nt=function(t){var e=t.getBoundingClientRect(),n=t.ownerDocument,r=n.body,i=n.documentElement,o=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,a=e.top+(g.win.pageYOffset||i.scrollTop||r.scrollTop)-o,u=e.left+(g.win.pageXOffset||i.scrollLeft||r.scrollLeft)-s;return{y:a,x:u}};return n.getElementByPoint=function(t,e){var n=this,i=(n.canvas,r.doc.elementFromPoint(t,e));if(r.win.opera&&"svg"==i.tagName){var o=nt(i),s=i.createSVGRect();s.x=t-o.x,s.y=e-o.y,s.width=s.height=1;var a=i.getIntersectionList(s,null);a.length&&(i=a[a.length-1])}return i?$(i):null},n.plugin=function(t){t(n,Z,Q,r,K)},r.win.Snap=n,n}(t||this);return r.plugin((function(n,r,i,o,s){var a=r.prototype,u=n.is,l=String,c=n._unit2px,h=n._.$,p=n._.make,d=n._.getSomeDefs,f="hasOwnProperty",g=n._.wrap;a.getBBox=function(t){if("tspan"==this.type)return n._.box(this.node.getClientRects().item(0));if(!n.Matrix||!n.path)return this.node.getBBox();var e=this,r=new n.Matrix;if(e.removed)return n._.box();while("use"==e.type)if(t||(r=r.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else{var i=e.attr("xlink:href");e=e.original=e.node.ownerDocument.getElementById(i.substring(i.indexOf("#")+1))}var o=e._,s=n.path.get[e.type]||n.path.get.deflt;try{return t?(o.bboxwt=s?n.path.getBBox(e.realPath=s(e)):n._.box(e.node.getBBox()),n._.box(o.bboxwt)):(e.realPath=s(e),e.matrix=e.transform().localMatrix,o.bbox=n.path.getBBox(n.path.map(e.realPath,r.add(e.matrix))),n._.box(o.bbox))}catch(a){return n._.box()}};var m=function(){return this.string};function y(t,e){if(null==e){var r=!0;if(e="linearGradient"==t.type||"radialGradient"==t.type?t.node.getAttribute("gradientTransform"):"pattern"==t.type?t.node.getAttribute("patternTransform"):t.node.getAttribute("transform"),!e)return new n.Matrix;e=n._.svgTransform2string(e)}else e=n._.rgTransform.test(e)?l(e).replace(/\.{3}|\u2026/g,t._.transform||""):n._.svgTransform2string(e),u(e,"array")&&(e=n.path?n.path.toString.call(e):l(e)),t._.transform=e;var i=n._.transform2matrix(e,t.getBBox(1));if(r)return i;t.matrix=i}function v(t){var e,r=t.selectAll("*"),i=/^\s*url\(("|'|)(.*)\1\)\s*$/,o=[],s={};function a(t,e){var r=h(t.node,e);r=r&&r.match(i),r=r&&r[2],r&&"#"==r.charAt()&&(r=r.substring(1),r&&(s[r]=(s[r]||[]).concat((function(r){var i={};i[e]=n.url(r),h(t.node,i)}))))}function u(t){var e=h(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1),e&&(s[e]=(s[e]||[]).concat((function(e){t.attr("xlink:href","#"+e)}))))}for(var l=0,c=r.length;l<c;l++){e=r[l],a(e,"fill"),a(e,"stroke"),a(e,"filter"),a(e,"mask"),a(e,"clip-path"),u(e);var p=h(e.node,"id");p&&(h(e.node,{id:e.id}),o.push({old:p,id:e.id}))}for(l=0,c=o.length;l<c;l++){var d=s[o[l].old];if(d)for(var f=0,g=d.length;f<g;f++)d[f](o[l].id)}}a.transform=function(t){var e=this._;if(null==t){var r,i=this,o=new n.Matrix(this.node.getCTM()),s=y(this),a=[s],u=new n.Matrix,c=s.toTransformString(),p=l(s)==l(this.matrix)?l(e.transform):c;while("svg"!=i.type&&(i=i.parent()))a.push(y(i));r=a.length;while(r--)u.add(a[r]);return{string:p,globalMatrix:o,totalMatrix:u,localMatrix:s,diffMatrix:o.clone().add(s.invert()),global:o.toTransformString(),total:u.toTransformString(),local:c,toString:m}}return t instanceof n.Matrix?(this.matrix=t,this._.transform=t.toTransformString()):y(this,t),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?h(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?h(this.node,{patternTransform:this.matrix}):h(this.node,{transform:this.matrix})),this},a.parent=function(){return g(this.node.parentNode)},a.append=a.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach((function(t){e.add(t)})),this}t=g(t),this.node.appendChild(t.node),t.paper=this.paper}return this},a.appendTo=function(t){return t&&(t=g(t),t.append(this)),this},a.prepend=function(t){if(t){if("set"==t.type){var e,n=this;return t.forEach((function(t){e?e.after(t):n.prepend(t),e=t})),this}t=g(t);var r=t.parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),r&&r.add()}return this},a.prependTo=function(t){return t=g(t),t.prepend(this),this},a.before=function(t){if("set"==t.type){var e=this;return t.forEach((function(t){var n=t.parent();e.node.parentNode.insertBefore(t.node,e.node),n&&n.add()})),this.parent().add(),this}t=g(t);var n=t.parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),n&&n.add(),t.paper=this.paper,this},a.after=function(t){t=g(t);var e=t.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},a.insertBefore=function(t){t=g(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},a.insertAfter=function(t){t=g(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},a.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},a.select=function(t){return g(this.node.querySelector(t))},a.selectAll=function(t){for(var e=this.node.querySelectorAll(t),r=(n.set||Array)(),i=0;i<e.length;i++)r.push(g(e[i]));return r},a.asPX=function(t,e){return null==e&&(e=this.attr(t)),+c(this,t,e)},a.use=function(){var t,e=this.node.id;return e||(e=this.id,h(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?p(this.type,this.node.parentNode):p("use",this.node.parentNode),h(t.node,{"xlink:href":"#"+e}),t.original=this,t},a.clone=function(){var t=g(this.node.cloneNode(!0));return h(t.node,"id")&&h(t.node,{id:t.id}),v(t),t.insertAfter(this),t},a.toDefs=function(){var t=d(this);return t.appendChild(this.node),this},a.pattern=a.toPattern=function(t,e,n,r){var i=p("pattern",d(this));return null==t&&(t=this.getBBox()),u(t,"object")&&"x"in t&&(e=t.y,n=t.width,r=t.height,t=t.x),h(i.node,{x:t,y:e,width:n,height:r,patternUnits:"userSpaceOnUse",id:i.id,viewBox:[t,e,n,r].join(" ")}),i.node.appendChild(this.node),i},a.marker=function(t,e,n,r,i,o){var s=p("marker",d(this));return null==t&&(t=this.getBBox()),u(t,"object")&&"x"in t&&(e=t.y,n=t.width,r=t.height,i=t.refX||t.cx,o=t.refY||t.cy,t=t.x),h(s.node,{viewBox:[t,e,n,r].join(" "),markerWidth:n,markerHeight:r,orient:"auto",refX:i||0,refY:o||0,id:s.id}),s.node.appendChild(this.node),s};var x={};function _(t){return function(){var e=t?"<"+this.type:"",n=this.node.attributes,r=this.node.childNodes;if(t)for(var i=0,o=n.length;i<o;i++)e+=" "+n[i].name+'="'+n[i].value.replace(/"/g,'\\"')+'"';if(r.length){for(t&&(e+=">"),i=0,o=r.length;i<o;i++)3==r[i].nodeType?e+=r[i].nodeValue:1==r[i].nodeType&&(e+=g(r[i]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}a.data=function(t,r){var i=x[this.id]=x[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,i,null),i;if(1==arguments.length){if(n.is(t,"object")){for(var o in t)t[f](o)&&this.data(o,t[o]);return this}return e("snap.data.get."+this.id,this,i[t],t),i[t]}return i[t]=r,e("snap.data.set."+this.id,this,r,t),this},a.removeData=function(t){return null==t?x[this.id]={}:x[this.id]&&delete x[this.id][t],this},a.outerSVG=a.toString=_(1),a.innerSVG=_(),a.toDataURL=function(){if(t&&t.btoa){var e=this.getBBox(),r=n.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(r)))}},s.prototype.select=a.select,s.prototype.selectAll=a.selectAll})),r.plugin((function(t,r,i,o,s){var a=r.prototype,u=t.is,l=String,c="hasOwnProperty";function h(t,e,n){return function(r){var i=r.slice(t,e);return 1==i.length&&(i=i[0]),n?n(i):i}}var p=function(t,e,r,i){"function"!=typeof r||r.length||(i=r,r=n.linear),this.attr=t,this.dur=e,r&&(this.easing=r),i&&(this.callback=i)};t._.Animation=p,t.animation=function(t,e,n,r){return new p(t,e,n,r)},a.inAnim=function(){var t=this,e=[];for(var n in t.anims)t.anims[c](n)&&function(t){e.push({anim:new p(t._attrs,t.dur,t.easing,t._callback),mina:t,curStatus:t.status(),status:function(e){return t.status(e)},stop:function(){t.stop()}})}(t.anims[n]);return e},t.animate=function(t,r,i,o,s,a){"function"!=typeof s||s.length||(a=s,s=n.linear);var u=n.time(),l=n(t,r,u,u+o,n.time,i,s);return a&&e.once("mina.finish."+l.id,a),l},a.stop=function(){for(var t=this.inAnim(),e=0,n=t.length;e<n;e++)t[e].stop();return this},a.animate=function(t,r,i,o){"function"!=typeof i||i.length||(o=i,i=n.linear),t instanceof p&&(o=t.callback,i=t.easing,r=t.dur,t=t.attr);var s,a,d,f,g=[],m=[],y={},v=this;for(var x in t)if(t[c](x)){v.equal?(f=v.equal(x,l(t[x])),s=f.from,a=f.to,d=f.f):(s=+v.attr(x),a=+t[x]);var _=u(s,"array")?s.length:1;y[x]=h(g.length,g.length+_,d),g=g.concat(s),m=m.concat(a)}var b=n.time(),w=n(g,m,b,b+r,n.time,(function(t){var e={};for(var n in y)y[c](n)&&(e[n]=y[n](t));v.attr(e)}),i);return v.anims[w.id]=w,w._attrs=t,w._callback=o,e("snap.animcreated."+v.id,w),e.once("mina.finish."+w.id,(function(){e.off("mina.*."+w.id),delete v.anims[w.id],o&&o.call(v)})),e.once("mina.stop."+w.id,(function(){e.off("mina.*."+w.id),delete v.anims[w.id]})),v}})),r.plugin((function(t,e,n,r,i){var o=Object.prototype.toString,s=String,a=Math,u="";function l(t,e,n,r,i,s){if(null==e&&"[object SVGMatrix]"==o.call(t))return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f);null!=t?(this.a=+t,this.b=+e,this.c=+n,this.d=+r,this.e=+i,this.f=+s):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}(function(e){function n(t){return t[0]*t[0]+t[1]*t[1]}function r(t){var e=a.sqrt(n(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,n,r,i,o){if(t&&t instanceof l)return this.add(t.a,t.b,t.c,t.d,t.e,t.f);var s=t*this.a+e*this.c,a=t*this.b+e*this.d;return this.e+=i*this.a+o*this.c,this.f+=i*this.b+o*this.d,this.c=n*this.a+r*this.c,this.d=n*this.b+r*this.d,this.a=s,this.b=a,this},l.prototype.multLeft=function(t,e,n,r,i,o){if(t&&t instanceof l)return this.multLeft(t.a,t.b,t.c,t.d,t.e,t.f);var s=t*this.a+n*this.b,a=t*this.c+n*this.d,u=t*this.e+n*this.f+i;return this.b=e*this.a+r*this.b,this.d=e*this.c+r*this.d,this.f=e*this.e+r*this.f+o,this.a=s,this.c=a,this.e=u,this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new l(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new l(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.e+=t*this.a+e*this.c,this.f+=t*this.b+e*this.d,this},e.scale=function(t,e,n,r){return null==e&&(e=t),(n||r)&&this.translate(n,r),this.a*=t,this.b*=t,this.c*=e,this.d*=e,(n||r)&&this.translate(-n,-r),this},e.rotate=function(e,n,r){e=t.rad(e),n=n||0,r=r||0;var i=+a.cos(e).toFixed(9),o=+a.sin(e).toFixed(9);return this.add(i,o,-o,i,n,r),this.add(1,0,0,1,-n,-r)},e.skewX=function(t){return this.skew(t,0)},e.skewY=function(t){return this.skew(0,t)},e.skew=function(e,n){e=e||0,n=n||0,e=t.rad(e),n=t.rad(n);var r=a.tan(e).toFixed(9),i=a.tan(n).toFixed(9);return this.add(1,i,r,1,0,0)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[s.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var i=[[this.a,this.b],[this.c,this.d]];e.scalex=a.sqrt(n(i[0])),r(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=a.sqrt(n(i[1])),r(i[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var o=i[0][1],s=i[1][1];return s<0?(e.rotate=t.deg(a.acos(s)),o<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(a.asin(o)),e.isSimple=!+e.shear.toFixed(9)&&(e.scalex.toFixed(9)==e.scaley.toFixed(9)||!e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:u)+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:u)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:u))}})(l.prototype),t.Matrix=l,t.matrix=function(t,e,n,r,i,o){return new l(t,e,n,r,i,o)}})),r.plugin((function(t,n,r,i,o){var s=t._.make,a=t._.wrap,u=t.is,l=t._.getSomeDefs,c=/^url\((['"]?)([^)]+)\1\)$/,h=t._.$,p=t.url,d=String,f=t._.separator,g="";function m(r){return function(i){if(e.stop(),i instanceof o&&1==i.node.childNodes.length&&("radialGradient"==i.node.firstChild.tagName||"linearGradient"==i.node.firstChild.tagName||"pattern"==i.node.firstChild.tagName)&&(i=i.node.firstChild,l(this).appendChild(i),i=a(i)),i instanceof n)if("radialGradient"==i.type||"linearGradient"==i.type||"pattern"==i.type){i.node.id||h(i.node,{id:i.id});var s=p(i.node.id)}else s=i.attr(r);else if(s=t.color(i),s.error){var u=t(l(this).ownerSVGElement).gradient(i);u?(u.node.id||h(u.node,{id:u.id}),s=p(u.node.id)):s=i}else s=d(s);var c={};c[r]=s,h(this.node,c),this.node.style[r]=g}}t.deurl=function(t){var e=String(t).match(c);return e?e[2]:t},e.on("snap.util.attr.mask",(function(t){if(t instanceof n||t instanceof o){if(e.stop(),t instanceof o&&1==t.node.childNodes.length&&(t=t.node.firstChild,l(this).appendChild(t),t=a(t)),"mask"==t.type)var r=t;else r=s("mask",l(this)),r.node.appendChild(t.node);!r.node.id&&h(r.node,{id:r.id}),h(this.node,{mask:p(r.id)})}})),function(t){e.on("snap.util.attr.clip",t),e.on("snap.util.attr.clip-path",t),e.on("snap.util.attr.clipPath",t)}((function(t){if(t instanceof n||t instanceof o){e.stop();var r,i=t.node;while(i){if("clipPath"===i.nodeName){r=new n(i);break}if("svg"===i.nodeName){r=void 0;break}i=i.parentNode}r||(r=s("clipPath",l(this)),r.node.appendChild(t.node),!r.node.id&&h(r.node,{id:r.id})),h(this.node,{"clip-path":p(r.node.id||r.id)})}})),e.on("snap.util.attr.fill",m("fill")),e.on("snap.util.attr.stroke",m("stroke"));var y=/^([lr])(?:\(([^)]*)\))?(.*)$/i;function v(t){e.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function x(t){for(var e=[],n=t.childNodes,r=0,i=n.length;r<i;r++){var o=n[r];3==o.nodeType&&e.push(o.nodeValue),"tspan"==o.tagName&&(1==o.childNodes.length&&3==o.firstChild.nodeType?e.push(o.firstChild.nodeValue):e.push(x(o)))}return e}function _(){return e.stop(),this.node.style.fontSize}e.on("snap.util.grad.parse",(function(t){t=d(t);var e=t.match(y);if(!e)return null;var n=e[1],r=e[2],i=e[3];r=r.split(/\s*,\s*/).map((function(t){return+t==t?+t:t})),1==r.length&&0==r[0]&&(r=[]),i=i.split("-"),i=i.map((function(t){t=t.split(":");var e={color:t[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}));var o=i.length,s=0,a=0;function u(t,e){for(var n=(e-s)/(t-a),r=a;r<t;r++)i[r].offset=+(+s+n*(r-a)).toFixed(2);a=t,s=e}o--;for(var l=0;l<o;l++)"offset"in i[l]&&u(l,i[l].offset);return i[o].offset=i[o].offset||100,u(o,i[o].offset),{type:n,params:r,stops:i}})),e.on("snap.util.attr.d",(function(n){e.stop(),u(n,"array")&&u(n[0],"array")&&(n=t.path.toString.call(n)),n=d(n),n.match(/[ruo]/i)&&(n=t.path.toAbsolute(n)),h(this.node,{d:n})}))(-1),e.on("snap.util.attr.#text",(function(t){e.stop(),t=d(t);var n=i.doc.createTextNode(t);while(this.node.firstChild)this.node.removeChild(this.node.firstChild);this.node.appendChild(n)}))(-1),e.on("snap.util.attr.path",(function(t){e.stop(),this.attr({d:t})}))(-1),e.on("snap.util.attr.class",(function(t){e.stop(),this.node.className.baseVal=t}))(-1),e.on("snap.util.attr.viewBox",(function(t){var n;n=u(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):u(t,"array")?t.join(" "):t,h(this.node,{viewBox:n}),e.stop()}))(-1),e.on("snap.util.attr.transform",(function(t){this.transform(t),e.stop()}))(-1),e.on("snap.util.attr.r",(function(t){"rect"==this.type&&(e.stop(),h(this.node,{rx:t,ry:t}))}))(-1),e.on("snap.util.attr.textpath",(function(t){if(e.stop(),"text"==this.type){var r,i,o;if(!t&&this.textPath){i=this.textPath;while(i.node.firstChild)this.node.appendChild(i.node.firstChild);return i.remove(),void delete this.textPath}if(u(t,"string")){var s=l(this),c=a(s.parentNode).path(t);s.appendChild(c.node),r=c.id,c.attr({id:r})}else t=a(t),t instanceof n&&(r=t.attr("id"),r||(r=t.id,t.attr({id:r})));if(r)if(i=this.textPath,o=this.node,i)i.attr({"xlink:href":"#"+r});else{i=h("textPath",{"xlink:href":"#"+r});while(o.firstChild)i.appendChild(o.firstChild);o.appendChild(i),this.textPath=a(i)}}}))(-1),e.on("snap.util.attr.text",(function(t){if("text"==this.type){var n=this.node,r=function(t){var e=h("tspan");if(u(t,"array"))for(var n=0;n<t.length;n++)e.appendChild(r(t[n]));else e.appendChild(i.doc.createTextNode(t));return e.normalize&&e.normalize(),e};while(n.firstChild)n.removeChild(n.firstChild);var o=r(t);while(o.firstChild)n.appendChild(o.firstChild)}e.stop()}))(-1),e.on("snap.util.attr.fontSize",v)(-1),e.on("snap.util.attr.font-size",v)(-1),e.on("snap.util.getattr.transform",(function(){return e.stop(),this.transform()}))(-1),e.on("snap.util.getattr.textpath",(function(){return e.stop(),this.textPath}))(-1),function(){function n(n){return function(){e.stop();var r=i.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+n);return"none"==r?r:t(i.doc.getElementById(r.match(c)[1]))}}function r(t){return function(n){e.stop();var r="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""!=n&&n){if("marker"==n.type){var i=n.node.id;return i||h(n.node,{id:n.id}),void(this.node.style[r]=p(i))}}else this.node.style[r]="none"}}e.on("snap.util.getattr.marker-end",n("end"))(-1),e.on("snap.util.getattr.markerEnd",n("end"))(-1),e.on("snap.util.getattr.marker-start",n("start"))(-1),e.on("snap.util.getattr.markerStart",n("start"))(-1),e.on("snap.util.getattr.marker-mid",n("mid"))(-1),e.on("snap.util.getattr.markerMid",n("mid"))(-1),e.on("snap.util.attr.marker-end",r("end"))(-1),e.on("snap.util.attr.markerEnd",r("end"))(-1),e.on("snap.util.attr.marker-start",r("start"))(-1),e.on("snap.util.attr.markerStart",r("start"))(-1),e.on("snap.util.attr.marker-mid",r("mid"))(-1),e.on("snap.util.attr.markerMid",r("mid"))(-1)}(),e.on("snap.util.getattr.r",(function(){if("rect"==this.type&&h(this.node,"rx")==h(this.node,"ry"))return e.stop(),h(this.node,"rx")}))(-1),e.on("snap.util.getattr.text",(function(){if("text"==this.type||"tspan"==this.type){e.stop();var t=x(this.node);return 1==t.length?t[0]:t}}))(-1),e.on("snap.util.getattr.#text",(function(){return this.node.textContent}))(-1),e.on("snap.util.getattr.fill",(function(n){if(!n){e.stop();var r=e("snap.util.getattr.fill",this,!0).firstDefined();return t(t.deurl(r))||r}}))(-1),e.on("snap.util.getattr.stroke",(function(n){if(!n){e.stop();var r=e("snap.util.getattr.stroke",this,!0).firstDefined();return t(t.deurl(r))||r}}))(-1),e.on("snap.util.getattr.viewBox",(function(){e.stop();var n=h(this.node,"viewBox");return n?(n=n.split(f),t._.box(+n[0],+n[1],+n[2],+n[3])):void 0}))(-1),e.on("snap.util.getattr.points",(function(){var t=h(this.node,"points");return e.stop(),t?t.split(f):void 0}))(-1),e.on("snap.util.getattr.path",(function(){var t=h(this.node,"d");return e.stop(),t}))(-1),e.on("snap.util.getattr.class",(function(){return this.node.className.baseVal}))(-1),e.on("snap.util.getattr.fontSize",_)(-1),e.on("snap.util.getattr.font-size",_)(-1)})),r.plugin((function(t,e,n,r,i){var o=/\S+/g,s=String,a=e.prototype;a.addClass=function(t){var e,n,r,i,a=s(t||"").match(o)||[],u=this.node,l=u.className.baseVal,c=l.match(o)||[];if(a.length){e=0;while(r=a[e++])n=c.indexOf(r),~n||c.push(r);i=c.join(" "),l!=i&&(u.className.baseVal=i)}return this},a.removeClass=function(t){var e,n,r,i,a=s(t||"").match(o)||[],u=this.node,l=u.className.baseVal,c=l.match(o)||[];if(c.length){e=0;while(r=a[e++])n=c.indexOf(r),~n&&c.splice(n,1);i=c.join(" "),l!=i&&(u.className.baseVal=i)}return this},a.hasClass=function(t){var e=this.node,n=e.className.baseVal,r=n.match(o)||[];return!!~r.indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var n,r,i,s,a=(t||"").match(o)||[],u=this.node,l=u.className.baseVal,c=l.match(o)||[];n=0;while(i=a[n++])r=c.indexOf(i),~r?c.splice(r,1):c.push(i);return s=c.join(" "),l!=s&&(u.className.baseVal=s),this}})),r.plugin((function(t,n,r,i,o){var s={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},a=String,u=/[a-z]+$/i,l=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;function c(t){return t}function h(t){return function(e){return+e.toFixed(3)+t}}e.on("snap.util.attr",(function(t){var n=a(t).match(l);if(n){var r=e.nt(),i=r.substring(r.lastIndexOf(".")+1),o=this.attr(i),c={};e.stop();var h=n[3]||"",p=o.match(u),d=s[n[1]];if(p&&p==h?t=d(parseFloat(o),+n[2]):(o=this.asPX(i),t=d(this.asPX(i),this.asPX(i,n[2]+h))),isNaN(o)||isNaN(t))return;c[i]=t,this.attr(c)}}))(-10),e.on("snap.util.equal",(function(t,n){var r=a(this.attr(t)||""),i=a(n).match(l);if(i){e.stop();var o=i[3]||"",p=r.match(u),d=s[i[1]];return p&&p==o?{from:parseFloat(r),to:d(parseFloat(r),+i[2]),f:h(p)}:(r=this.asPX(t),{from:r,to:d(r,this.asPX(t,i[2]+o)),f:c})}}))(-10)})),r.plugin((function(n,r,i,o,s){var a=i.prototype,u=n.is;a.rect=function(t,e,n,r,i,o){var s;return null==o&&(o=i),u(t,"object")&&"[object Object]"==t?s=t:null!=t&&(s={x:t,y:e,width:n,height:r},null!=i&&(s.rx=i,s.ry=o)),this.el("rect",s)},a.circle=function(t,e,n){var r;return u(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,r:n}),this.el("circle",r)};var l=function(){function t(){this.parentNode.removeChild(this)}return function(e,n){var r=o.doc.createElement("img"),i=o.doc.body;r.style.cssText="position:absolute;left:-9999em;top:-9999em",r.onload=function(){n.call(r),r.onload=r.onerror=null,i.removeChild(r)},r.onerror=t,i.appendChild(r),r.src=e}}();a.image=function(t,e,r,i,o){var s=this.el("image");if(u(t,"object")&&"src"in t)s.attr(t);else if(null!=t){var a={"xlink:href":t,preserveAspectRatio:"none"};null!=e&&null!=r&&(a.x=e,a.y=r),null!=i&&null!=o?(a.width=i,a.height=o):l(t,(function(){n._.$(s.node,{width:this.offsetWidth,height:this.offsetHeight})})),n._.$(s.node,a)}return s},a.ellipse=function(t,e,n,r){var i;return u(t,"object")&&"[object Object]"==t?i=t:null!=t&&(i={cx:t,cy:e,rx:n,ry:r}),this.el("ellipse",i)},a.path=function(t){var e;return u(t,"object")&&!u(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},a.group=a.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.svg=function(t,e,n,r,i,o,s,a){var l={};return u(t,"object")&&null==e?l=t:(null!=t&&(l.x=t),null!=e&&(l.y=e),null!=n&&(l.width=n),null!=r&&(l.height=r),null!=i&&null!=o&&null!=s&&null!=a&&(l.viewBox=[i,o,s,a])),this.el("svg",l)},a.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},a.ptrn=function(t,e,n,r,i,o,s,a){if(u(t,"object"))var l=t;else l={patternUnits:"userSpaceOnUse"},t&&(l.x=t),e&&(l.y=e),null!=n&&(l.width=n),null!=r&&(l.height=r),l.viewBox=null!=i&&null!=o&&null!=s&&null!=a?[i,o,s,a]:[t||0,e||0,n||0,r||0];return this.el("pattern",l)},a.use=function(t){return null!=t?(t instanceof r&&(t.attr("id")||t.attr({id:n._.id(t)}),t=t.attr("id")),"#"==String(t).charAt()&&(t=t.substring(1)),this.el("use",{"xlink:href":"#"+t})):r.prototype.use.call(this)},a.symbol=function(t,e,n,r){var i={};return null!=t&&null!=e&&null!=n&&null!=r&&(i.viewBox=[t,e,n,r]),this.el("symbol",i)},a.text=function(t,e,n){var r={};return u(t,"object")?r=t:null!=t&&(r={x:t,y:e,text:n||""}),this.el("text",r)},a.line=function(t,e,n,r){var i={};return u(t,"object")?i=t:null!=t&&(i={x1:t,x2:n,y1:e,y2:r}),this.el("line",i)},a.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return u(t,"object")&&!u(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},a.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return u(t,"object")&&!u(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){var r=n._.$;function i(){return this.selectAll("stop")}function o(t,e){var i=r("stop"),o={offset:+e+"%"};t=n.color(t),o["stop-color"]=t.hex,t.opacity<1&&(o["stop-opacity"]=t.opacity),r(i,o);for(var s,a=this.stops(),u=0;u<a.length;u++){var l=parseFloat(a[u].attr("offset"));if(l>e){this.node.insertBefore(i,a[u].node),s=!0;break}}return s||this.node.appendChild(i),this}function s(){if("linearGradient"==this.type){var t=r(this.node,"x1")||0,e=r(this.node,"x2")||1,i=r(this.node,"y1")||0,o=r(this.node,"y2")||0;return n._.box(t,i,math.abs(e-t),math.abs(o-i))}var s=this.node.cx||.5,a=this.node.cy||.5,u=this.node.r||0;return n._.box(s-u,a-u,2*u,2*u)}function u(t){var r=t,i=this.stops();if("string"==typeof t&&(r=e("snap.util.grad.parse",null,"l(0,0,0,1)"+t).firstDefined().stops),n.is(r,"array")){for(var o=0;o<i.length;o++)if(r[o]){var s=n.color(r[o].color),a={offset:r[o].offset+"%"};a["stop-color"]=s.hex,s.opacity<1&&(a["stop-opacity"]=s.opacity),i[o].attr(a)}else i[o].remove();for(o=i.length;o<r.length;o++)this.addStop(r[o].color,r[o].offset);return this}}function l(t,n){var i,o=e("snap.util.grad.parse",null,n).firstDefined();if(!o)return null;o.params.unshift(t),i="l"==o.type.toLowerCase()?c.apply(0,o.params):h.apply(0,o.params),o.type!=o.type.toLowerCase()&&r(i.node,{gradientUnits:"userSpaceOnUse"});for(var s=o.stops,a=s.length,u=0;u<a;u++){var l=s[u];i.addStop(l.color,l.offset)}return i}function c(t,e,a,l,c){var h=n._.make("linearGradient",t);return h.stops=i,h.addStop=o,h.getBBox=s,h.setStops=u,null!=e&&r(h.node,{x1:e,y1:a,x2:l,y2:c}),h}function h(t,e,a,u,l,c){var h=n._.make("radialGradient",t);return h.stops=i,h.addStop=o,h.getBBox=s,null!=e&&r(h.node,{cx:e,cy:a,r:u}),null!=l&&null!=c&&r(h.node,{fx:l,fy:c}),h}a.gradient=function(t){return l(this.defs,t)},a.gradientLinear=function(t,e,n,r){return c(this.defs,t,e,n,r)},a.gradientRadial=function(t,e,n,r,i){return h(this.defs,t,e,n,r,i)},a.toString=function(){var t,e=this.node.ownerDocument,r=e.createDocumentFragment(),i=e.createElement("div"),o=this.node.cloneNode(!0);return r.appendChild(i),i.appendChild(o),n._.$(o,{xmlns:"http://www.w3.org/2000/svg"}),t=i.innerHTML,r.removeChild(r.firstChild),t},a.toDataURL=function(){if(t&&t.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},a.clear=function(){var t,e=this.node.firstChild;while(e)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):a.clear.call({node:e}),e=t}}()})),r.plugin((function(t,e,n,r){var i=e.prototype,o=t.is,s=t._.clone,a="hasOwnProperty",u=/,?([a-z]),?/gi,l=parseFloat,c=Math,h=c.PI,p=c.min,d=c.max,f=c.pow,g=c.abs;function m(t){var e=m.ps=m.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var n in e)e[a](n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])})),e[t]}function y(t,e,n,r){return null==t&&(t=e=n=r=0),null==e&&(e=t.y,n=t.width,r=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:r,h:r,x2:t+n,y2:e+r,cx:t+n/2,cy:e+r/2,r1:c.min(n,r)/2,r2:c.max(n,r)/2,r0:c.sqrt(n*n+r*r)/2,path:z(t,e,n,r),vb:[t,e,n,r].join(" ")}}function v(){return this.join(",").replace(u,"$1")}function x(t){var e=s(t);return e.toString=v,e}function _(t,e,n,r,i,o,s,a,u){return null==u?L(t,e,n,r,i,o,s,a):S(t,e,n,r,i,o,s,a,I(t,e,n,r,i,o,s,a,u))}function b(n,r){function i(t){return+(+t).toFixed(3)}return t._.cacher((function(t,o,s){t instanceof e&&(t=t.attr("d")),t=Z(t);for(var a,u,l,c,h,p="",d={},f=0,g=0,m=t.length;g<m;g++){if(l=t[g],"M"==l[0])a=+l[1],u=+l[2];else{if(c=_(a,u,l[1],l[2],l[3],l[4],l[5],l[6]),f+c>o){if(r&&!d.start){if(h=_(a,u,l[1],l[2],l[3],l[4],l[5],l[6],o-f),p+=["C"+i(h.start.x),i(h.start.y),i(h.m.x),i(h.m.y),i(h.x),i(h.y)],s)return p;d.start=p,p=["M"+i(h.x),i(h.y)+"C"+i(h.n.x),i(h.n.y),i(h.end.x),i(h.end.y),i(l[5]),i(l[6])].join(),f+=c,a=+l[5],u=+l[6];continue}if(!n&&!r)return h=_(a,u,l[1],l[2],l[3],l[4],l[5],l[6],o-f),h}f+=c,a=+l[5],u=+l[6]}p+=l.shift()+l}return d.end=p,h=n?f:r?d:S(a,u,l[0],l[1],l[2],l[3],l[4],l[5],1),h}),null,t._.clone)}var w=b(1),M=b(),E=b(0,1);function S(t,e,n,r,i,o,s,a,u){var l=1-u,p=f(l,3),d=f(l,2),g=u*u,m=g*u,y=p*t+3*d*u*n+3*l*u*u*i+m*s,v=p*e+3*d*u*r+3*l*u*u*o+m*a,x=t+2*u*(n-t)+g*(i-2*n+t),_=e+2*u*(r-e)+g*(o-2*r+e),b=n+2*u*(i-n)+g*(s-2*i+n),w=r+2*u*(o-r)+g*(a-2*o+r),M=l*t+u*n,E=l*e+u*r,S=l*i+u*s,T=l*o+u*a,C=90-180*c.atan2(x-b,_-w)/h;return{x:y,y:v,m:{x:x,y:_},n:{x:b,y:w},start:{x:M,y:E},end:{x:S,y:T},alpha:C}}function T(e,n,r,i,o,s,a,u){t.is(e,"array")||(e=[e,n,r,i,o,s,a,u]);var l=X.apply(null,e);return y(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)}function C(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function A(t,e){return t=y(t),e=y(e),C(e,t.x,t.y)||C(e,t.x2,t.y)||C(e,t.x,t.y2)||C(e,t.x2,t.y2)||C(t,e.x,e.y)||C(t,e.x2,e.y)||C(t,e.x,e.y2)||C(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function P(t,e,n,r,i){var o=-3*e+9*n-9*r+3*i,s=t*o+6*e-12*n+6*r;return t*s-3*e+3*n}function L(t,e,n,r,i,o,s,a,u){null==u&&(u=1),u=u>1?1:u<0?0:u;for(var l=u/2,h=12,p=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],d=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,g=0;g<h;g++){var m=l*p[g]+l,y=P(m,t,n,i,s),v=P(m,e,r,o,a),x=y*y+v*v;f+=d[g]*c.sqrt(x)}return l*f}function I(t,e,n,r,i,o,s,a,u){if(!(u<0||L(t,e,n,r,i,o,s,a)<u)){var l,c=1,h=c/2,p=c-h,d=.01;l=L(t,e,n,r,i,o,s,a,p);while(g(l-u)>d)h/=2,p+=(l<u?1:-1)*h,l=L(t,e,n,r,i,o,s,a,p);return p}}function R(t,e,n,r,i,o,s,a){if(!(d(t,n)<p(i,s)||p(t,n)>d(i,s)||d(e,r)<p(o,a)||p(e,r)>d(o,a))){var u=(t*r-e*n)*(i-s)-(t-n)*(i*a-o*s),l=(t*r-e*n)*(o-a)-(e-r)*(i*a-o*s),c=(t-n)*(o-a)-(e-r)*(i-s);if(c){var h=u/c,f=l/c,g=+h.toFixed(2),m=+f.toFixed(2);if(!(g<+p(t,n).toFixed(2)||g>+d(t,n).toFixed(2)||g<+p(i,s).toFixed(2)||g>+d(i,s).toFixed(2)||m<+p(e,r).toFixed(2)||m>+d(e,r).toFixed(2)||m<+p(o,a).toFixed(2)||m>+d(o,a).toFixed(2)))return{x:h,y:f}}}}function N(t,e,n){var r=T(t),i=T(e);if(!A(r,i))return n?0:[];for(var o=L.apply(0,t),s=L.apply(0,e),a=~~(o/8),u=~~(s/8),l=[],c=[],h={},p=n?0:[],d=0;d<a+1;d++){var f=S.apply(0,t.concat(d/a));l.push({x:f.x,y:f.y,t:d/a})}for(d=0;d<u+1;d++)f=S.apply(0,e.concat(d/u)),c.push({x:f.x,y:f.y,t:d/u});for(d=0;d<a;d++)for(var m=0;m<u;m++){var y=l[d],v=l[d+1],x=c[m],_=c[m+1],b=g(v.x-y.x)<.001?"y":"x",w=g(_.x-x.x)<.001?"y":"x",M=R(y.x,y.y,v.x,v.y,x.x,x.y,_.x,_.y);if(M){if(h[M.x.toFixed(4)]==M.y.toFixed(4))continue;h[M.x.toFixed(4)]=M.y.toFixed(4);var E=y.t+g((M[b]-y[b])/(v[b]-y[b]))*(v.t-y.t),C=x.t+g((M[w]-x[w])/(_[w]-x[w]))*(_.t-x.t);E>=0&&E<=1&&C>=0&&C<=1&&(n?p++:p.push({x:M.x,y:M.y,t1:E,t2:C}))}}return p}function O(t,e){return F(t,e)}function D(t,e){return F(t,e,1)}function F(t,e,n){t=Z(t),e=Z(e);for(var r,i,o,s,a,u,l,c,h,p,d=n?0:[],f=0,g=t.length;f<g;f++){var m=t[f];if("M"==m[0])r=a=m[1],i=u=m[2];else{"C"==m[0]?(h=[r,i].concat(m.slice(1)),r=h[6],i=h[7]):(h=[r,i,r,i,a,u,a,u],r=a,i=u);for(var y=0,v=e.length;y<v;y++){var x=e[y];if("M"==x[0])o=l=x[1],s=c=x[2];else{"C"==x[0]?(p=[o,s].concat(x.slice(1)),o=p[6],s=p[7]):(p=[o,s,o,s,l,c,l,c],o=l,s=c);var _=N(h,p,n);if(n)d+=_;else{for(var b=0,w=_.length;b<w;b++)_[b].segment1=f,_[b].segment2=y,_[b].bez1=h,_[b].bez2=p;d=d.concat(_)}}}}}return d}function k(t,e,n){var r=B(t);return C(r,e,n)&&F(t,[["M",e,n],["H",r.x2+10]],1)%2==1}function B(t){var e=m(t);if(e.bbox)return s(e.bbox);if(!t)return y();t=Z(t);for(var n,r=0,i=0,o=[],a=[],u=0,l=t.length;u<l;u++)if(n=t[u],"M"==n[0])r=n[1],i=n[2],o.push(r),a.push(i);else{var c=X(r,i,n[1],n[2],n[3],n[4],n[5],n[6]);o=o.concat(c.min.x,c.max.x),a=a.concat(c.min.y,c.max.y),r=n[5],i=n[6]}var h=p.apply(0,o),f=p.apply(0,a),g=d.apply(0,o),v=d.apply(0,a),x=y(h,f,g-h,v-f);return e.bbox=s(x),x}function z(t,e,n,r,i){if(i)return[["M",+t+ +i,e],["l",n-2*i,0],["a",i,i,0,0,1,i,i],["l",0,r-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-n,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-r],["a",i,i,0,0,1,i,-i],["z"]];var o=[["M",t,e],["l",n,0],["l",0,r],["l",-n,0],["z"]];return o.toString=v,o}function G(t,e,n,r,i){if(null==i&&null==r&&(r=n),t=+t,e=+e,n=+n,r=+r,null!=i)var o=Math.PI/180,s=t+n*Math.cos(-r*o),a=t+n*Math.cos(-i*o),u=e+n*Math.sin(-r*o),l=e+n*Math.sin(-i*o),c=[["M",s,u],["A",n,n,0,+(i-r>180),0,a,l]];else c=[["M",t,e],["m",0,-r],["a",n,r,0,1,1,0,2*r],["a",n,r,0,1,1,0,-2*r],["z"]];return c.toString=v,c}var U=t._unit2px,V={path:function(t){return t.attr("path")},circle:function(t){var e=U(t);return G(e.cx,e.cy,e.r)},ellipse:function(t){var e=U(t);return G(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=U(t);return z(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=U(t);return z(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return z(e.x,e.y,e.width,e.height)}};function H(e){var n=m(e),r=String.prototype.toLowerCase;if(n.rel)return x(n.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var i=[],o=0,s=0,a=0,u=0,l=0;"M"==e[0][0]&&(o=e[0][1],s=e[0][2],a=o,u=s,l++,i.push(["M",o,s]));for(var c=l,h=e.length;c<h;c++){var p=i[c]=[],d=e[c];if(d[0]!=r.call(d[0]))switch(p[0]=r.call(d[0]),p[0]){case"a":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+(d[6]-o).toFixed(3),p[7]=+(d[7]-s).toFixed(3);break;case"v":p[1]=+(d[1]-s).toFixed(3);break;case"m":a=d[1],u=d[2];default:for(var f=1,g=d.length;f<g;f++)p[f]=+(d[f]-(f%2?o:s)).toFixed(3)}else{p=i[c]=[],"m"==d[0]&&(a=d[1]+o,u=d[2]+s);for(var y=0,_=d.length;y<_;y++)i[c][y]=d[y]}var b=i[c].length;switch(i[c][0]){case"z":o=a,s=u;break;case"h":o+=+i[c][b-1];break;case"v":s+=+i[c][b-1];break;default:o+=+i[c][b-2],s+=+i[c][b-1]}}return i.toString=v,n.rel=x(i),i}function j(e){var n=m(e);if(n.abs)return x(n.abs);if(o(e,"array")&&o(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var r,i=[],s=0,a=0,u=0,l=0,c=0;"M"==e[0][0]&&(s=+e[0][1],a=+e[0][2],u=s,l=a,c++,i[0]=["M",s,a]);for(var h,p,d=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),f=c,g=e.length;f<g;f++){if(i.push(h=[]),p=e[f],r=p[0],r!=r.toUpperCase())switch(h[0]=r.toUpperCase(),h[0]){case"A":h[1]=p[1],h[2]=p[2],h[3]=p[3],h[4]=p[4],h[5]=p[5],h[6]=+p[6]+s,h[7]=+p[7]+a;break;case"V":h[1]=+p[1]+a;break;case"H":h[1]=+p[1]+s;break;case"R":for(var y=[s,a].concat(p.slice(1)),_=2,b=y.length;_<b;_++)y[_]=+y[_]+s,y[++_]=+y[_]+a;i.pop(),i=i.concat(J(y,d));break;case"O":i.pop(),y=G(s,a,p[1],p[2]),y.push(y[0]),i=i.concat(y);break;case"U":i.pop(),i=i.concat(G(s,a,p[1],p[2],p[3])),h=["U"].concat(i[i.length-1].slice(-2));break;case"M":u=+p[1]+s,l=+p[2]+a;default:for(_=1,b=p.length;_<b;_++)h[_]=+p[_]+(_%2?s:a)}else if("R"==r)y=[s,a].concat(p.slice(1)),i.pop(),i=i.concat(J(y,d)),h=["R"].concat(p.slice(-2));else if("O"==r)i.pop(),y=G(s,a,p[1],p[2]),y.push(y[0]),i=i.concat(y);else if("U"==r)i.pop(),i=i.concat(G(s,a,p[1],p[2],p[3])),h=["U"].concat(i[i.length-1].slice(-2));else for(var w=0,M=p.length;w<M;w++)h[w]=p[w];if(r=r.toUpperCase(),"O"!=r)switch(h[0]){case"Z":s=+u,a=+l;break;case"H":s=h[1];break;case"V":a=h[1];break;case"M":u=h[h.length-2],l=h[h.length-1];default:s=h[h.length-2],a=h[h.length-1]}}return i.toString=v,n.abs=x(i),i}function W(t,e,n,r){return[t,e,n,r,n,r]}function q(t,e,n,r,i,o){var s=1/3,a=2/3;return[s*t+a*n,s*e+a*r,s*i+a*n,s*o+a*r,i,o]}function Y(e,n,r,i,o,s,a,u,l,p){var d,f=120*h/180,m=h/180*(+o||0),y=[],v=t._.cacher((function(t,e,n){var r=t*c.cos(n)-e*c.sin(n),i=t*c.sin(n)+e*c.cos(n);return{x:r,y:i}}));if(!r||!i)return[e,n,u,l,u,l];if(p)C=p[0],A=p[1],S=p[2],T=p[3];else{d=v(e,n,-m),e=d.x,n=d.y,d=v(u,l,-m),u=d.x,l=d.y;c.cos(h/180*o),c.sin(h/180*o);var x=(e-u)/2,_=(n-l)/2,b=x*x/(r*r)+_*_/(i*i);b>1&&(b=c.sqrt(b),r*=b,i*=b);var w=r*r,M=i*i,E=(s==a?-1:1)*c.sqrt(g((w*M-w*_*_-M*x*x)/(w*_*_+M*x*x))),S=E*r*_/i+(e+u)/2,T=E*-i*x/r+(n+l)/2,C=c.asin(((n-T)/i).toFixed(9)),A=c.asin(((l-T)/i).toFixed(9));C=e<S?h-C:C,A=u<S?h-A:A,C<0&&(C=2*h+C),A<0&&(A=2*h+A),a&&C>A&&(C-=2*h),!a&&A>C&&(A-=2*h)}var P=A-C;if(g(P)>f){var L=A,I=u,R=l;A=C+f*(a&&A>C?1:-1),u=S+r*c.cos(A),l=T+i*c.sin(A),y=Y(u,l,r,i,o,0,a,I,R,[A,L,S,T])}P=A-C;var N=c.cos(C),O=c.sin(C),D=c.cos(A),F=c.sin(A),k=c.tan(P/4),B=4/3*r*k,z=4/3*i*k,G=[e,n],U=[e+B*O,n-z*N],V=[u+B*F,l-z*D],H=[u,l];if(U[0]=2*G[0]-U[0],U[1]=2*G[1]-U[1],p)return[U,V,H].concat(y);y=[U,V,H].concat(y).join().split(",");for(var j=[],W=0,q=y.length;W<q;W++)j[W]=W%2?v(y[W-1],y[W],m).y:v(y[W],y[W+1],m).x;return j}function X(t,e,n,r,i,o,s,a){for(var u,l,h,f,m,y,v,x,_=[],b=[[],[]],w=0;w<2;++w)if(0==w?(l=6*t-12*n+6*i,u=-3*t+9*n-9*i+3*s,h=3*n-3*t):(l=6*e-12*r+6*o,u=-3*e+9*r-9*o+3*a,h=3*r-3*e),g(u)<1e-12){if(g(l)<1e-12)continue;f=-h/l,0<f&&f<1&&_.push(f)}else v=l*l-4*h*u,x=c.sqrt(v),v<0||(m=(-l+x)/(2*u),0<m&&m<1&&_.push(m),y=(-l-x)/(2*u),0<y&&y<1&&_.push(y));var M,E=_.length,S=E;while(E--)f=_[E],M=1-f,b[0][E]=M*M*M*t+3*M*M*f*n+3*M*f*f*i+f*f*f*s,b[1][E]=M*M*M*e+3*M*M*f*r+3*M*f*f*o+f*f*f*a;return b[0][S]=t,b[1][S]=e,b[0][S+1]=s,b[1][S+1]=a,b[0].length=b[1].length=S+2,{min:{x:p.apply(0,b[0]),y:p.apply(0,b[1])},max:{x:d.apply(0,b[0]),y:d.apply(0,b[1])}}}function Z(t,e){var n=!e&&m(t);if(!e&&n.curve)return x(n.curve);for(var r=j(t),i=e&&j(e),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,n){var r,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(Y.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==n||"S"==n?(r=2*e.x-e.bx,i=2*e.y-e.by):(r=e.x,i=e.y),t=["C",r,i].concat(t.slice(1));break;case"T":"Q"==n||"T"==n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(q(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(q(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(W(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(W(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(W(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(W(e.x,e.y,e.X,e.Y));break}return t},u=function(t,e){if(t[e].length>7){t[e].shift();var n=t[e];while(n.length)h[e]="A",i&&(p[e]="A"),t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),v=d(r.length,i&&i.length||0)}},c=function(t,e,n,o,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",o.x,o.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],v=d(r.length,i&&i.length||0))},h=[],p=[],f="",g="",y=0,v=d(r.length,i&&i.length||0);y<v;y++){r[y]&&(f=r[y][0]),"C"!=f&&(h[y]=f,y&&(g=h[y-1])),r[y]=a(r[y],o,g),"A"!=h[y]&&"C"==f&&(h[y]="C"),u(r,y),i&&(i[y]&&(f=i[y][0]),"C"!=f&&(p[y]=f,y&&(g=p[y-1])),i[y]=a(i[y],s,g),"A"!=p[y]&&"C"==f&&(p[y]="C"),u(i,y)),c(r,i,o,s,y),c(i,r,s,o,y);var _=r[y],b=i&&i[y],w=_.length,M=i&&b.length;o.x=_[w-2],o.y=_[w-1],o.bx=l(_[w-4])||o.x,o.by=l(_[w-3])||o.y,s.bx=i&&(l(b[M-4])||s.x),s.by=i&&(l(b[M-3])||s.y),s.x=i&&b[M-2],s.y=i&&b[M-1]}return i||(n.curve=x(r)),i?[r,i]:r}function K(t,e){if(!e)return t;var n,r,i,o,s,a,u;for(t=Z(t),i=0,s=t.length;i<s;i++)for(u=t[i],o=1,a=u.length;o<a;o+=2)n=e.x(u[o],u[o+1]),r=e.y(u[o],u[o+1]),u[o]=n,u[o+1]=r;return t}function J(t,e){for(var n=[],r=0,i=t.length;i-2*!e>r;r+=2){var o=[{x:+t[r-2],y:+t[r-1]},{x:+t[r],y:+t[r+1]},{x:+t[r+2],y:+t[r+3]},{x:+t[r+4],y:+t[r+5]}];e?r?i-4==r?o[3]={x:+t[0],y:+t[1]}:i-2==r&&(o[2]={x:+t[0],y:+t[1]},o[3]={x:+t[2],y:+t[3]}):o[0]={x:+t[i-2],y:+t[i-1]}:i-4==r?o[3]=o[2]:r||(o[0]={x:+t[r],y:+t[r+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n}t.path=m,t.path.getTotalLength=w,t.path.getPointAtLength=M,t.path.getSubpath=function(t,e,n){if(this.getTotalLength(t)-n<1e-6)return E(t,e).end;var r=E(t,n,1);return e?E(r,e).end:r},i.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},i.getPointAtLength=function(t){return M(this.attr("d"),t)},i.getSubpath=function(e,n){return t.path.getSubpath(this.attr("d"),e,n)},t._.box=y,t.path.findDotsAtSegment=S,t.path.bezierBBox=T,t.path.isPointInsideBBox=C,t.closest=function(e,n,r,i){var o=100,s=y(e-o/2,n-o/2,o,o),a=[],u=r[0].hasOwnProperty("x")?function(t){return{x:r[t].x,y:r[t].y}}:function(t){return{x:r[t],y:i[t]}},l=0;while(o<=1e6&&!l){for(var c=0,h=r.length;c<h;c++){var p=u(c);if(C(s,p.x,p.y)){l++,a.push(p);break}}l||(o*=2,s=y(e-o/2,n-o/2,o,o))}if(1e6!=o){var d,f=1/0;for(c=0,h=a.length;c<h;c++){var g=t.len(e,n,a[c].x,a[c].y);f>g&&(f=g,a[c].len=g,d=a[c])}return d}},t.path.isBBoxIntersect=A,t.path.intersection=O,t.path.intersectionNumber=D,t.path.isPointInside=k,t.path.getBBox=B,t.path.get=V,t.path.toRelative=H,t.path.toAbsolute=j,t.path.toCubic=Z,t.path.map=K,t.path.toString=v,t.path.clone=x})),r.plugin((function(t,r,i,o){var s=Math.max,a=Math.min,u=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,n=t.length;e<n;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},l=u.prototype;l.push=function(){for(var t,e,n=0,r=arguments.length;n<r;n++)t=arguments[n],t&&(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},l.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},l.forEach=function(t,e){for(var n=0,r=this.items.length;n<r;n++)if(!1===t.call(e,this.items[n],n))return this;return this},l.animate=function(r,i,o,s){"function"!=typeof o||o.length||(s=o,o=n.linear),r instanceof t._.Animation&&(s=r.callback,o=r.easing,i=o.dur,r=r.attr);var a=arguments;if(t.is(r,"array")&&t.is(a[a.length-1],"array"))var u=!0;var l,c=function(){l?this.b=l:l=this.b},h=0,p=this,d=s&&function(){++h==p.length&&s.call(this)};return this.forEach((function(t,n){e.once("snap.animcreated."+t.id,c),u?a[n]&&t.animate.apply(t,a[n]):t.animate(r,i,o,d)}))},l.remove=function(){while(this.length)this.pop().remove();return this},l.bind=function(t,e,n){var r={};if("function"==typeof e)this.bindings[t]=e;else{var i=n||t;this.bindings[t]=function(t){r[i]=t,e.attr(r)}}return this},l.attr=function(t){var e={};for(var n in t)this.bindings[n]?this.bindings[n](t[n]):e[n]=t[n];for(var r=0,i=this.items.length;r<i;r++)this.items[r].attr(e);return this},l.clear=function(){while(this.length)this.pop()},l.splice=function(t,e,n){t=t<0?s(this.length+t,0):t,e=s(0,a(this.length-t,e));var r,i=[],o=[],l=[];for(r=2;r<arguments.length;r++)l.push(arguments[r]);for(r=0;r<e;r++)o.push(this[t+r]);for(;r<this.length-t;r++)i.push(this[t+r]);var c=l.length;for(r=0;r<c+i.length;r++)this.items[t+r]=this[t+r]=r<c?l[r]:i[r-c];r=this.items.length=this.length-=e-c;while(this[r])delete this[r++];return new u(o)},l.exclude=function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},l.insertAfter=function(t){var e=this.items.length;while(e--)this.items[e].insertAfter(t);return this},l.getBBox=function(){for(var t=[],e=[],n=[],r=[],i=this.items.length;i--;)if(!this.items[i].removed){var o=this.items[i].getBBox();t.push(o.x),e.push(o.y),n.push(o.x+o.width),r.push(o.y+o.height)}return t=a.apply(0,t),e=a.apply(0,e),n=s.apply(0,n),r=s.apply(0,r),{x:t,y:e,x2:n,y2:r,width:n-t,height:r-e,cx:t+(n-t)/2,cy:e+(r-e)/2}},l.clone=function(t){t=new u;for(var e=0,n=this.items.length;e<n;e++)t.push(this.items[e].clone());return t},l.toString=function(){return"Snap‘s set"},l.type="set",t.Set=u,t.set=function(){var t=new u;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}})),r.plugin((function(t,n,r,i){var o={},s=/[%a-z]+$/i,a=String;function u(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function l(e,n,r){e=e||new t.Matrix,n=n||new t.Matrix,e=t.parseTransformString(e.toTransformString())||[],n=t.parseTransformString(n.toTransformString())||[];for(var i,o,s,a,l=Math.max(e.length,n.length),c=[],h=[],p=0;p<l;p++){if(s=e[p]||u(n[p]),a=n[p]||u(s),s[0]!=a[0]||"r"==s[0].toLowerCase()&&(s[2]!=a[2]||s[3]!=a[3])||"s"==s[0].toLowerCase()&&(s[3]!=a[3]||s[4]!=a[4])){e=t._.transform2matrix(e,r()),n=t._.transform2matrix(n,r()),c=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],h=[["m",n.a,n.b,n.c,n.d,n.e,n.f]];break}for(c[p]=[],h[p]=[],i=0,o=Math.max(s.length,a.length);i<o;i++)i in s&&(c[p][i]=s[i]),i in a&&(h[p][i]=a[i])}return{from:g(c),to:g(h),f:f(c)}}function c(t){return t}function h(t){return function(e){return+e.toFixed(3)+t}}function p(t){return t.join(" ")}function d(e){return t.rgb(e[0],e[1],e[2],e[3])}function f(t){var e,n,r,i,o,s,a=0,u=[];for(e=0,n=t.length;e<n;e++){for(o="[",s=['"'+t[e][0]+'"'],r=1,i=t[e].length;r<i;r++)s[r]="val["+a+++"]";o+=s+"]",u[e]=o}return Function("val","return Snap.path.toString.call(["+u+"])")}function g(t){for(var e=[],n=0,r=t.length;n<r;n++)for(var i=1,o=t[n].length;i<o;i++)e.push(t[n][i]);return e}function m(t){return isFinite(t)}function y(e,n){return!(!t.is(e,"array")||!t.is(n,"array"))&&e.toString()==n.toString()}o.stroke=o.fill="colour",n.prototype.equal=function(t,n){return e("snap.util.equal",this,t,n).firstDefined()},e.on("snap.util.equal",(function(e,n){var r,i,u=a(this.attr(e)||""),v=this;if("colour"==o[e])return r=t.color(u),i=t.color(n),{from:[r.r,r.g,r.b,r.opacity],to:[i.r,i.g,i.b,i.opacity],f:d};if("viewBox"==e)return r=this.attr(e).vb.split(" ").map(Number),i=n.split(" ").map(Number),{from:r,to:i,f:p};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return"string"==typeof n&&(n=a(n).replace(/\.{3}|\u2026/g,u)),u=this.matrix,n=t._.rgTransform.test(n)?t._.transform2matrix(n,this.getBBox()):t._.transform2matrix(t._.svgTransform2string(n),this.getBBox()),l(u,n,(function(){return v.getBBox(1)}));if("d"==e||"path"==e)return r=t.path.toCubic(u,n),{from:g(r[0]),to:g(r[1]),f:f(r[0])};if("points"==e)return r=a(u).split(t._.separator),i=a(n).split(t._.separator),{from:r,to:i,f:function(t){return t}};if(m(u)&&m(n))return{from:parseFloat(u),to:parseFloat(n),f:c};var x=u.match(s),_=a(n).match(s);return x&&y(x,_)?{from:parseFloat(u),to:parseFloat(n),f:h(x)}:{from:this.asPX(e),to:this.asPX(e,n),f:c}}))})),r.plugin((function(t,n,r,i){for(var o=n.prototype,s="hasOwnProperty",a=("createTouch"in i.doc),u=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],l={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},c=function(t,e){var n="y"==t?"scrollTop":"scrollLeft",r=e&&e.node?e.node.ownerDocument:i.doc;return r[n in r.documentElement?"documentElement":"body"][n]},h=function(){return this.originalEvent.preventDefault()},p=function(){return this.originalEvent.stopPropagation()},d=function(t,e,n,r){var i=a&&l[e]?l[e]:e,o=function(i){var o=c("y",r),u=c("x",r);if(a&&l[s](e))for(var d=0,f=i.targetTouches&&i.targetTouches.length;d<f;d++)if(i.targetTouches[d].target==t||t.contains(i.targetTouches[d].target)){var g=i;i=i.targetTouches[d],i.originalEvent=g,i.preventDefault=h,i.stopPropagation=p;break}var m=i.clientX+u,y=i.clientY+o;return n.call(r,i,m,y)};return e!==i&&t.addEventListener(e,o,!1),t.addEventListener(i,o,!1),function(){return e!==i&&t.removeEventListener(e,o,!1),t.removeEventListener(i,o,!1),!0}},f=[],g=function(t){var n,r=t.clientX,i=t.clientY,o=c("y"),s=c("x"),u=f.length;while(u--){if(n=f[u],a){var l,h=t.touches&&t.touches.length;while(h--)if(l=t.touches[h],l.identifier==n.el._drag.id||n.el.node.contains(l.target)){r=l.clientX,i=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var p=n.el.node;p.nextSibling,p.parentNode,p.style.display;r+=s,i+=o,e("snap.drag.move."+n.el.id,n.move_scope||n.el,r-n.el._drag.x,i-n.el._drag.y,r,i,t)}},m=function(n){t.unmousemove(g).unmouseup(m);var r,i=f.length;while(i--)r=f[i],r.el._drag={},e("snap.drag.end."+r.el.id,r.end_scope||r.start_scope||r.move_scope||r.el,n),e.off("snap.drag.*."+r.el.id);f=[]},y=u.length;y--;)(function(e){t[e]=o[e]=function(n,r){if(t.is(n,"function"))this.events=this.events||[],this.events.push({name:e,f:n,unbind:d(this.node||document,e,n,r||this)});else for(var i=0,o=this.events.length;i<o;i++)if(this.events[i].name==e)try{this.events[i].f.call(this)}catch(s){}return this},t["un"+e]=o["un"+e]=function(t){var n=this.events||[],r=n.length;while(r--)if(n[r].name==e&&(n[r].f==t||!t))return n[r].unbind(),n.splice(r,1),!n.length&&delete this.events,this;return this}})(u[y]);o.hover=function(t,e,n,r){return this.mouseover(t,n).mouseout(e,r||n)},o.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var v=[];o.drag=function(n,r,i,o,s,a){var u,l=this;if(!arguments.length)return l.drag((function(t,e){this.attr({transform:u+(u?"T":"t")+[t,e]})}),(function(){u=this.transform().local}));function c(u,c,h){(u.originalEvent||u).preventDefault(),l._drag.x=c,l._drag.y=h,l._drag.id=u.identifier,!f.length&&t.mousemove(g).mouseup(m),f.push({el:l,move_scope:o,start_scope:s,end_scope:a}),r&&e.on("snap.drag.start."+l.id,r),n&&e.on("snap.drag.move."+l.id,n),i&&e.on("snap.drag.end."+l.id,i),e("snap.drag.start."+l.id,s||o||l,c,h,u)}function h(t,n,r){e("snap.draginit."+l.id,l,t,n,r)}return e.on("snap.draginit."+l.id,c),l._drag={},v.push({el:l,start:c,init:h}),l.mousedown(h),l},o.undrag=function(){var n=v.length;while(n--)v[n].el==this&&(this.unmousedown(v[n].init),v.splice(n,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!v.length&&t.unmousemove(g).unmouseup(m),this}})),r.plugin((function(t,n,r,i){n.prototype;var o=r.prototype,s=/^\s*url\((.+)\)/,a=String,u=t._.$;t.filter={},o.filter=function(e){var r=this;"svg"!=r.type&&(r=r.paper);var i=t.parse(a(e)),o=t._.id(),s=(r.node.offsetWidth,r.node.offsetHeight,u("filter"));return u(s,{id:o,filterUnits:"userSpaceOnUse"}),s.appendChild(i.node),r.defs.appendChild(s),new n(s)},e.on("snap.util.getattr.filter",(function(){e.stop();var n=u(this.node,"filter");if(n){var r=a(n).match(s);return r&&t.select(r[1])}})),e.on("snap.util.attr.filter",(function(r){if(r instanceof n&&"filter"==r.type){e.stop();var i=r.node.id;i||(u(r.node,{id:r.id}),i=r.id),u(this.node,{filter:t.url(i)})}r&&"none"!=r||(e.stop(),this.node.removeAttribute("filter"))})),t.filter.blur=function(e,n){null==e&&(e=2);var r=null==n?e:[e,n];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:r})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,n,r,i,o){return null==o&&(null==i?(o=r,r=4,i="#000"):(o=i,i=r,r=4)),null==r&&(r=4),null==o&&(o=1),null==e&&(e=0,n=2),null==n&&(n=e),i=t.color(i),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:i,dx:e,dy:n,blur:r,opacity:o})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}})),r.plugin((function(t,e,n,r,i){var o=t._.box,s=t.is,a=/^[^a-z]*([tbmlrc])/i,u=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&s(t,"string")&&(e=t,t=null),t=t||this.paper;var n=t.getBBox?t.getBBox():o(t),r=this.getBBox(),i={};switch(e=e&&e.match(a),e=e?e[1].toLowerCase():"c",e){case"t":i.dx=0,i.dy=n.y-r.y;break;case"b":i.dx=0,i.dy=n.y2-r.y2;break;case"m":i.dx=0,i.dy=n.cy-r.cy;break;case"l":i.dx=n.x-r.x,i.dy=0;break;case"r":i.dx=n.x2-r.x2,i.dy=0;break;default:i.dx=n.cx-r.cx,i.dy=0;break}return i.toString=u,i},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}})),r.plugin((function(e,n,r,i){var o="#ffebee#ffcdd2#ef9a9a#e57373#ef5350#f44336#e53935#d32f2f#c62828#b71c1c#ff8a80#ff5252#ff1744#d50000",s="#FCE4EC#F8BBD0#F48FB1#F06292#EC407A#E91E63#D81B60#C2185B#AD1457#880E4F#FF80AB#FF4081#F50057#C51162",a="#F3E5F5#E1BEE7#CE93D8#BA68C8#AB47BC#9C27B0#8E24AA#7B1FA2#6A1B9A#4A148C#EA80FC#E040FB#D500F9#AA00FF",u="#EDE7F6#D1C4E9#B39DDB#9575CD#7E57C2#673AB7#5E35B1#512DA8#4527A0#311B92#B388FF#7C4DFF#651FFF#6200EA",l="#E8EAF6#C5CAE9#9FA8DA#7986CB#5C6BC0#3F51B5#3949AB#303F9F#283593#1A237E#8C9EFF#536DFE#3D5AFE#304FFE",c="#E3F2FD#BBDEFB#90CAF9#64B5F6#64B5F6#2196F3#1E88E5#1976D2#1565C0#0D47A1#82B1FF#448AFF#2979FF#2962FF",h="#E1F5FE#B3E5FC#81D4FA#4FC3F7#29B6F6#03A9F4#039BE5#0288D1#0277BD#01579B#80D8FF#40C4FF#00B0FF#0091EA",p="#E0F7FA#B2EBF2#80DEEA#4DD0E1#26C6DA#00BCD4#00ACC1#0097A7#00838F#006064#84FFFF#18FFFF#00E5FF#00B8D4",d="#E0F2F1#B2DFDB#80CBC4#4DB6AC#26A69A#009688#00897B#00796B#00695C#004D40#A7FFEB#64FFDA#1DE9B6#00BFA5",f="#E8F5E9#C8E6C9#A5D6A7#81C784#66BB6A#4CAF50#43A047#388E3C#2E7D32#1B5E20#B9F6CA#69F0AE#00E676#00C853",g="#F1F8E9#DCEDC8#C5E1A5#AED581#9CCC65#8BC34A#7CB342#689F38#558B2F#33691E#CCFF90#B2FF59#76FF03#64DD17",m="#F9FBE7#F0F4C3#E6EE9C#DCE775#D4E157#CDDC39#C0CA33#AFB42B#9E9D24#827717#F4FF81#EEFF41#C6FF00#AEEA00",y="#FFFDE7#FFF9C4#FFF59D#FFF176#FFEE58#FFEB3B#FDD835#FBC02D#F9A825#F57F17#FFFF8D#FFFF00#FFEA00#FFD600",v="#FFF8E1#FFECB3#FFE082#FFD54F#FFCA28#FFC107#FFB300#FFA000#FF8F00#FF6F00#FFE57F#FFD740#FFC400#FFAB00",x="#FFF3E0#FFE0B2#FFCC80#FFB74D#FFA726#FF9800#FB8C00#F57C00#EF6C00#E65100#FFD180#FFAB40#FF9100#FF6D00",_="#FBE9E7#FFCCBC#FFAB91#FF8A65#FF7043#FF5722#F4511E#E64A19#D84315#BF360C#FF9E80#FF6E40#FF3D00#DD2C00",b="#EFEBE9#D7CCC8#BCAAA4#A1887F#8D6E63#795548#6D4C41#5D4037#4E342E#3E2723",w="#FAFAFA#F5F5F5#EEEEEE#E0E0E0#BDBDBD#9E9E9E#757575#616161#424242#212121",M="#ECEFF1#CFD8DC#B0BEC5#90A4AE#78909C#607D8B#546E7A#455A64#37474F#263238";function E(t){t=t.split(/(?=#)/);var e=new String(t[5]);return e[50]=t[0],e[100]=t[1],e[200]=t[2],e[300]=t[3],e[400]=t[4],e[500]=t[5],e[600]=t[6],e[700]=t[7],e[800]=t[8],e[900]=t[9],t[10]&&(e.A100=t[10],e.A200=t[11],e.A400=t[12],e.A700=t[13]),e}e.mui={},e.flat={},e.mui.red=E(o),e.mui.pink=E(s),e.mui.purple=E(a),e.mui.deeppurple=E(u),e.mui.indigo=E(l),e.mui.blue=E(c),e.mui.lightblue=E(h),e.mui.cyan=E(p),e.mui.teal=E(d),e.mui.green=E(f),e.mui.lightgreen=E(g),e.mui.lime=E(m),e.mui.yellow=E(y),e.mui.amber=E(v),e.mui.orange=E(x),e.mui.deeporange=E(_),e.mui.brown=E(b),e.mui.grey=E(w),e.mui.bluegrey=E(M),e.flat.turquoise="#1abc9c",e.flat.greensea="#16a085",e.flat.sunflower="#f1c40f",e.flat.orange="#f39c12",e.flat.emerland="#2ecc71",e.flat.nephritis="#27ae60",e.flat.carrot="#e67e22",e.flat.pumpkin="#d35400",e.flat.peterriver="#3498db",e.flat.belizehole="#2980b9",e.flat.alizarin="#e74c3c",e.flat.pomegranate="#c0392b",e.flat.amethyst="#9b59b6",e.flat.wisteria="#8e44ad",e.flat.clouds="#ecf0f1",e.flat.silver="#bdc3c7",e.flat.wetasphalt="#34495e",e.flat.midnightblue="#2c3e50",e.flat.concrete="#95a5a6",e.flat.asbestos="#7f8c8d",e.importMUIColors=function(){for(var n in e.mui)e.mui.hasOwnProperty(n)&&(t[n]=e.mui[n])}})),r}))},"1ab9":function(t,e,n){var r=n("4f4d"),i=n("2514"),o=Object.hasOwnProperty,s={};for(var a in r)o.call(r,a)&&(s[r[a]]=a);var u=t.exports={to:{},get:{}};function l(t,e,n){return Math.min(Math.max(e,t),n)}function c(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}u.get=function(t){var e,n,r=t.substring(0,3).toLowerCase();switch(r){case"hsl":e=u.get.hsl(t),n="hsl";break;case"hwb":e=u.get.hwb(t),n="hwb";break;default:e=u.get.rgb(t),n="rgb";break}return e?{model:n,value:e}:null},u.get.rgb=function(t){if(!t)return null;var e,n,i,s=/^#([a-f0-9]{3,4})$/i,a=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,u=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,c=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,h=/^(\w+)$/,p=[0,0,0,1];if(e=t.match(a)){for(i=e[2],e=e[1],n=0;n<3;n++){var d=2*n;p[n]=parseInt(e.slice(d,d+2),16)}i&&(p[3]=parseInt(i,16)/255)}else if(e=t.match(s)){for(e=e[1],i=e[3],n=0;n<3;n++)p[n]=parseInt(e[n]+e[n],16);i&&(p[3]=parseInt(i+i,16)/255)}else if(e=t.match(u)){for(n=0;n<3;n++)p[n]=parseInt(e[n+1],0);e[4]&&(e[5]?p[3]=.01*parseFloat(e[4]):p[3]=parseFloat(e[4]))}else{if(!(e=t.match(c)))return(e=t.match(h))?"transparent"===e[1]?[0,0,0,0]:o.call(r,e[1])?(p=r[e[1]],p[3]=1,p):null:null;for(n=0;n<3;n++)p[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?p[3]=.01*parseFloat(e[4]):p[3]=parseFloat(e[4]))}for(n=0;n<3;n++)p[n]=l(p[n],0,255);return p[3]=l(p[3],0,1),p},u.get.hsl=function(t){if(!t)return null;var e=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){var r=parseFloat(n[4]),i=(parseFloat(n[1])%360+360)%360,o=l(parseFloat(n[2]),0,100),s=l(parseFloat(n[3]),0,100),a=l(isNaN(r)?1:r,0,1);return[i,o,s,a]}return null},u.get.hwb=function(t){if(!t)return null;var e=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){var r=parseFloat(n[4]),i=(parseFloat(n[1])%360+360)%360,o=l(parseFloat(n[2]),0,100),s=l(parseFloat(n[3]),0,100),a=l(isNaN(r)?1:r,0,1);return[i,o,s,a]}return null},u.to.hex=function(){var t=i(arguments);return"#"+c(t[0])+c(t[1])+c(t[2])+(t[3]<1?c(Math.round(255*t[3])):"")},u.to.rgb=function(){var t=i(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},u.to.rgb.percent=function(){var t=i(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},u.to.hsl=function(){var t=i(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},u.to.hwb=function(){var t=i(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},u.to.keyword=function(t){return s[t.slice(0,3)]}},"1aeb":function(t,e){t.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t}},"1bd8":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("f709"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(e){t.prototype._sceneFunc.call(this,e);var n=2*Math.PI,r=this.points(),i=r,o=0!==this.tension()&&r.length>4;o&&(i=this.getTensionPoints());var s,a,u=r.length;o?(s=r[u-2]-(i[i.length-2]+i[i.length-4])/2,a=r[u-1]-(i[i.length-1]+i[i.length-3])/2):(s=r[u-2]-r[u-4],a=r[u-1]-r[u-3]);var l=(Math.atan2(a,s)+n)%n,c=this.pointerLength(),h=this.pointerWidth();e.save(),e.beginPath(),e.translate(r[u-2],r[u-1]),e.rotate(l),e.moveTo(0,0),e.lineTo(-c,h/2),e.lineTo(-c,-h/2),e.closePath(),e.restore(),this.pointerAtBeginning()&&(e.save(),e.translate(r[0],r[1]),o?(s=(i[0]+i[2])/2-r[0],a=(i[1]+i[3])/2-r[1]):(s=r[2]-r[0],a=r[3]-r[1]),e.rotate((Math.atan2(-a,-s)+n)%n),e.moveTo(0,0),e.lineTo(-c,h/2),e.lineTo(-c,-h/2),e.closePath(),e.restore());var p=this.dashEnabled();p&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),p&&(this.attrs.dashEnabled=!0)},e.prototype.getSelfRect=function(){var e=t.prototype.getSelfRect.call(this),n=this.pointerWidth()/2;return{x:e.x-n,y:e.y-n,width:e.width+2*n,height:e.height+2*n}},e}(s.Line);e.Arrow=l,l.prototype.className="Arrow",u._registerNode(l),o.Factory.addGetterSetter(l,"pointerLength",10,a.getNumberValidator()),o.Factory.addGetterSetter(l,"pointerWidth",10,a.getNumberValidator()),o.Factory.addGetterSetter(l,"pointerAtBeginning",!1),i.Collection.mapMethods(l)},"1c49":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("9cb8"),s=n("4546"),a=function(t,e,n){var r,i,o,s,a=t.data,u=e.data,l=t.width,c=t.height,h=n.polarCenterX||l/2,p=n.polarCenterY||c/2,d=0,f=0,g=0,m=0,y=Math.sqrt(h*h+p*p);i=l-h,o=c-p,s=Math.sqrt(i*i+o*o),y=s>y?s:y;var v,x,_,b,w=c,M=l,E=360/M*Math.PI/180;for(x=0;x<M;x+=1)for(_=Math.sin(x*E),b=Math.cos(x*E),v=0;v<w;v+=1)i=Math.floor(h+y*v/w*b),o=Math.floor(p+y*v/w*_),r=4*(o*l+i),d=a[r+0],f=a[r+1],g=a[r+2],m=a[r+3],r=4*(x+v*l),u[r+0]=d,u[r+1]=f,u[r+2]=g,u[r+3]=m},u=function(t,e,n){var r,i,o,s,a,u,l=t.data,c=e.data,h=t.width,p=t.height,d=n.polarCenterX||h/2,f=n.polarCenterY||p/2,g=0,m=0,y=0,v=0,x=Math.sqrt(d*d+f*f);i=h-d,o=p-f,u=Math.sqrt(i*i+o*o),x=u>x?u:x;var _,b,w,M,E=p,S=h,T=n.polarRotation||0;for(i=0;i<h;i+=1)for(o=0;o<p;o+=1)s=i-d,a=o-f,_=Math.sqrt(s*s+a*a)*E/x,b=(180*Math.atan2(a,s)/Math.PI+360+T)%360,b=b*S/360,w=Math.floor(b),M=Math.floor(_),r=4*(M*h+w),g=l[r+0],m=l[r+1],y=l[r+2],v=l[r+3],r=4*(o*h+i),c[r+0]=g,c[r+1]=m,c[r+2]=y,c[r+3]=v};e.Kaleidoscope=function(t){var e,n,r,i,s,l,c,h,p,d,f=t.width,g=t.height,m=Math.round(this.kaleidoscopePower()),y=Math.round(this.kaleidoscopeAngle()),v=Math.floor(f*(y%360)/360);if(!(m<1)){var x=o.Util.createCanvasElement();x.width=f,x.height=g;var _=x.getContext("2d").getImageData(0,0,f,g);a(t,_,{polarCenterX:f/2,polarCenterY:g/2});var b=f/Math.pow(2,m);while(b<=8)b*=2,m-=1;b=Math.ceil(b);var w=b,M=0,E=w,S=1;for(v+b>f&&(M=w,E=0,S=-1),n=0;n<g;n+=1)for(e=M;e!==E;e+=S)r=Math.round(e+v)%f,p=4*(f*n+r),s=_.data[p+0],l=_.data[p+1],c=_.data[p+2],h=_.data[p+3],d=4*(f*n+e),_.data[d+0]=s,_.data[d+1]=l,_.data[d+2]=c,_.data[d+3]=h;for(n=0;n<g;n+=1)for(w=Math.floor(b),i=0;i<m;i+=1){for(e=0;e<w+1;e+=1)p=4*(f*n+e),s=_.data[p+0],l=_.data[p+1],c=_.data[p+2],h=_.data[p+3],d=4*(f*n+2*w-e-1),_.data[d+0]=s,_.data[d+1]=l,_.data[d+2]=c,_.data[d+3]=h;w*=2}u(_,t,{polarRotation:0})}},r.Factory.addGetterSetter(i.Node,"kaleidoscopePower",2,s.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"kaleidoscopeAngle",0,s.getNumberValidator(),r.Factory.afterSetFilter)},"1f21":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.radius(),0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.radius()},e.prototype.getHeight=function(){return 2*this.radius()},e.prototype.setWidth=function(t){this.radius()!==t/2&&this.radius(t/2)},e.prototype.setHeight=function(t){this.radius()!==t/2&&this.radius(t/2)},e}(s.Shape);e.Circle=l,l.prototype._centroid=!0,l.prototype.className="Circle",l.prototype._attrsAffectingSize=["radius"],u._registerNode(l),o.Factory.addGetterSetter(l,"radius",0,a.getNumberValidator()),i.Collection.mapMethods(l)},2013:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.Posterize=function(t){var e,n=Math.round(254*this.levels())+1,r=t.data,i=r.length,o=255/n;for(e=0;e<i;e+=1)r[e]=Math.floor(r[e]/o)*o},r.Factory.addGetterSetter(i.Node,"levels",.5,o.getNumberValidator(),r.Factory.afterSetFilter)},"229a":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._useBufferCanvas=function(){return!(!this.hasShadow()&&1===this.getAbsoluteOpacity()||!this.hasStroke()||!this.getStage())},e.prototype._sceneFunc=function(t){var e,n,r,i=this.width(),o=this.height(),s=this.image();s&&(e=this.cropWidth(),n=this.cropHeight(),r=e&&n?[s,this.cropX(),this.cropY(),e,n,0,0,i,o]:[s,0,0,i,o]),(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,i,o),t.closePath(),t.fillStrokeShape(this)),s&&t.drawImage.apply(t,r)},e.prototype._hitFunc=function(t){var e=this.width(),n=this.height();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){var t,e=this.image();return t=this.attrs.width,null!==t&&void 0!==t?t:e?e.width:0},e.prototype.getHeight=function(){var t,e=this.image();return t=this.attrs.height,null!==t&&void 0!==t?t:e?e.height:0},e.fromURL=function(t,n){var r=i.Util.createImageElement();r.onload=function(){var t=new e({image:r});n(t)},r.crossOrigin="Anonymous",r.src=t},e}(s.Shape);e.Image=l,l.prototype.className="Image",u._registerNode(l),o.Factory.addGetterSetter(l,"image"),o.Factory.addComponentsGetterSetter(l,"crop",["x","y","width","height"]),o.Factory.addGetterSetter(l,"cropX",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"cropY",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"cropWidth",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"cropHeight",0,a.getNumberValidator()),i.Collection.mapMethods(l)},"22b5":function(t,e,n){"use strict";(function(t){var n,r={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-r.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*r.Bounce.In(2*t):.5*r.Bounce.Out(2*t-1)+.5}}};n="undefined"===typeof self&&"undefined"!==typeof t&&t.hrtime?function(){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};var i=n,o=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=i()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;while(n.length>0){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var o=this._tweens[n[r]],s=!e;o&&!1===o.update(t,s)&&!e&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),s={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=s.Utils.Linear;return e<0?o(t[0],t[1],r):e>1?o(t[n],t[n-1],n-r):o(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,o=s.Utils.Bernstein,a=0;a<=r;a++)n+=i(1-e,r-a)*i(e,a)*t[a]*o(r,a);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),o=s.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),o(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):o(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=s.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var r=e;r>1;r--)n*=r;return t[e]=n,n}}(),CatmullRom:function(t,e,n,r,i){var o=.5*(n-t),s=.5*(r-e),a=i*i,u=i*a;return(2*e-2*n+o+s)*u+(-3*e+3*n-2*o-s)*a+o*i+e}}},a=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),u=new o,l=function(){function t(t,e){void 0===e&&(e=u),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=r.Linear.None,this._interpolationFunction=s.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=a.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"===typeof t?i()+parseFloat(t):t:i(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,r){for(var i in n){var o=t[i],s=Array.isArray(o),a=s?"array":typeof o,u=!s&&Array.isArray(n[i]);if("undefined"!==a&&"function"!==a){if(u){var l=n[i];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,o)),n[i]=[o].concat(l)}if("object"!==a&&!s||!o||u)"undefined"===typeof e[i]&&(e[i]=o),s||(e[i]*=1),r[i]=u?n[i].slice().reverse():e[i]||0;else{for(var c in e[i]=s?[]:{},o)e[i][c]=o[c];r[i]=s?[]:{},this._setupProperties(o,e[i],n[i],r[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=i()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=i()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=i()),void 0===e&&(e=!0),this._isPaused)return!0;var n,r,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var s=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!==typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,u=this._chainedTweens.length;a<u;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var o=e[i]||0,s=n[i],a=Array.isArray(t[i]),u=Array.isArray(s),l=!a&&u;l?t[i]=this._interpolationFunction(s,r):"object"===typeof s&&s?this._updateProperties(t[i],o,s,r):(s=this._handleRelativeValue(o,s),"number"===typeof s&&(t[i]=o+(s-o)*r))}},t.prototype._handleRelativeValue=function(t,e){return"string"!==typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"===typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),c="18.6.4",h=a.nextId,p=u,d=p.getAll.bind(p),f=p.removeAll.bind(p),g=p.add.bind(p),m=p.remove.bind(p),y=p.update.bind(p),v={Easing:r,Group:o,Interpolation:s,now:i,Sequence:a,nextId:h,Tween:l,VERSION:c,getAll:d,removeAll:f,add:g,remove:m,update:y};e["a"]=v}).call(this,n("4362"))},2514:function(t,e,n){"use strict";var r=n("b8fa"),i=Array.prototype.concat,o=Array.prototype.slice,s=t.exports=function(t){for(var e=[],n=0,s=t.length;n<s;n++){var a=t[n];r(a)?e=i.call(e,o.call(a)):e.push(a)}return e};s.wrap=function(t){return function(){return t(s(arguments))}}},2630:function(t,e,n){},"26c8":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e,n,r,i=this.sides(),o=this.radius();for(t.beginPath(),t.moveTo(0,0-o),e=1;e<i;e++)n=o*Math.sin(2*e*Math.PI/i),r=-1*o*Math.cos(2*e*Math.PI/i),t.lineTo(n,r);t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.radius()},e.prototype.getHeight=function(){return 2*this.radius()},e.prototype.setWidth=function(t){this.radius(t/2)},e.prototype.setHeight=function(t){this.radius(t/2)},e}(s.Shape);e.RegularPolygon=l,l.prototype.className="RegularPolygon",l.prototype._centroid=!0,l.prototype._attrsAffectingSize=["radius"],u._registerNode(l),o.Factory.addGetterSetter(l,"radius",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"sides",0,a.getNumberValidator()),i.Collection.mapMethods(l)},"2a01":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("8c18"),u=n("5414"),l=n("4546"),c=n("d777"),h="",p="normal";function d(t){t.fillText(this.partialText,0,0)}function f(t){t.strokeText(this.partialText,0,0)}var g=function(t){function e(e){var n=t.call(this,e)||this;return n.dummyCanvas=i.Util.createCanvasElement(),n.dataArray=[],n.dataArray=a.Path.parsePathData(n.attrs.data),n.on("dataChange.konva",(function(){this.dataArray=a.Path.parsePathData(this.attrs.data),this._setTextData()})),n.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva",n._setTextData),e&&e["getKerning"]&&(i.Util.warn('getKerning TextPath API is deprecated. Please use "kerningFunc" instead.'),n.kerningFunc(e["getKerning"])),n._setTextData(),n}return r(e,t),e.prototype._sceneFunc=function(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),n=this.fill(),r=this.fontSize(),i=this.glyphInfo;"underline"===e&&t.beginPath();for(var o=0;o<i.length;o++){t.save();var s=i[o].p0;t.translate(s.x,s.y),t.rotate(i[o].rotation),this.partialText=i[o].text,t.fillStrokeShape(this),"underline"===e&&(0===o&&t.moveTo(0,r/2+1),t.lineTo(r,r/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=n,t.lineWidth=r/20,t.stroke()),t.restore()},e.prototype._hitFunc=function(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var n=e[0].p0;t.moveTo(n.x,n.y)}for(var r=0;r<e.length;r++){var i=e[r].p1;t.lineTo(i.x,i.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()},e.prototype.getTextWidth=function(){return this.textWidth},e.prototype.getTextHeight=function(){return i.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},e.prototype.setText=function(t){return u.Text.prototype.setText.call(this,t)},e.prototype._getContextFont=function(){return u.Text.prototype._getContextFont.call(this)},e.prototype._getTextSize=function(t){var e=this.dummyCanvas,n=e.getContext("2d");n.save(),n.font=this._getContextFont();var r=n.measureText(t);return n.restore(),{width:r.width,height:parseInt(this.attrs.fontSize,10)}},e.prototype._setTextData=function(){var t=this,e=this._getTextSize(this.attrs.text),n=this.letterSpacing(),r=this.align(),i=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var o=Math.max(this.textWidth+((this.attrs.text||"").length-1)*n,0);this.glyphInfo=[];for(var s=0,u=0;u<t.dataArray.length;u++)t.dataArray[u].pathLength>0&&(s+=t.dataArray[u].pathLength);var l=0;"center"===r&&(l=Math.max(0,s/2-o/2)),"right"===r&&(l=Math.max(0,s-o));for(var c,h,p,d=this.text().split(""),f=this.text().split(" ").length-1,g=-1,m=0,y=function(){m=0;for(var e=t.dataArray,n=g+1;n<e.length;n++){if(e[n].pathLength>0)return g=n,e[n];"M"===e[n].command&&(c={x:e[n].points[0],y:e[n].points[1]})}return{}},v=function(e){var i=t._getTextSize(e).width+n;" "===e&&"justify"===r&&(i+=(s-o)/f);var u=0,l=0;h=void 0;while(Math.abs(i-u)/i>.01&&l<25){l++;var d=u;while(void 0===p)p=y(),p&&d+p.pathLength<i&&(d+=p.pathLength,p=void 0);if(p==={}||void 0===c)return;var g=!1;switch(p.command){case"L":a.Path.getLineLength(c.x,c.y,p.points[0],p.points[1])>i?h=a.Path.getPointOnLine(i,c.x,c.y,p.points[0],p.points[1],c.x,c.y):p=void 0;break;case"A":var v=p.points[4],x=p.points[5],_=p.points[4]+x;0===m?m=v+1e-8:i>u?m+=Math.PI/180*x/Math.abs(x):m-=Math.PI/360*x/Math.abs(x),(x<0&&m<_||x>=0&&m>_)&&(m=_,g=!0),h=a.Path.getPointOnEllipticalArc(p.points[0],p.points[1],p.points[2],p.points[3],m,p.points[6]);break;case"C":0===m?m=i>p.pathLength?1e-8:i/p.pathLength:i>u?m+=(i-u)/p.pathLength:m-=(u-i)/p.pathLength,m>1&&(m=1,g=!0),h=a.Path.getPointOnCubicBezier(m,p.start.x,p.start.y,p.points[0],p.points[1],p.points[2],p.points[3],p.points[4],p.points[5]);break;case"Q":0===m?m=i/p.pathLength:i>u?m+=(i-u)/p.pathLength:m-=(u-i)/p.pathLength,m>1&&(m=1,g=!0),h=a.Path.getPointOnQuadraticBezier(m,p.start.x,p.start.y,p.points[0],p.points[1],p.points[2],p.points[3]);break}void 0!==h&&(u=a.Path.getLineLength(c.x,c.y,h.x,h.y)),g&&(g=!1,p=void 0)}},x="C",_=t._getTextSize(x).width+n,b=l/_-1,w=0;w<b;w++){if(v(x),void 0===c||void 0===h)break;c=h}for(var M=0;M<d.length;M++){if(v(d[M]),void 0===c||void 0===h)break;var E=a.Path.getLineLength(c.x,c.y,h.x,h.y),S=0;if(i)try{S=i(d[M-1],d[M])*this.fontSize()}catch(A){S=0}c.x+=S,h.x+=S,this.textWidth+=S;var T=a.Path.getPointOnLine(S+E/2,c.x,c.y,h.x,h.y),C=Math.atan2(h.y-c.y,h.x-c.x);this.glyphInfo.push({transposeX:T.x,transposeY:T.y,text:d[M],rotation:C,p0:c,p1:h}),c=h}},e.prototype.getSelfRect=function(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach((function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)}));for(var e,n,r=t[0]||0,i=t[0]||0,o=t[1]||0,s=t[1]||0,a=0;a<t.length/2;a++)e=t[2*a],n=t[2*a+1],r=Math.min(r,e),i=Math.max(i,e),o=Math.min(o,n),s=Math.max(s,n);var u=this.fontSize();return{x:r-u/2,y:o-u/2,width:i-r+u,height:s-o+u}},e}(s.Shape);e.TextPath=g,g.prototype._fillFunc=d,g.prototype._strokeFunc=f,g.prototype._fillFuncHit=d,g.prototype._strokeFuncHit=f,g.prototype.className="TextPath",g.prototype._attrsAffectingSize=["text","fontSize","data"],c._registerNode(g),o.Factory.addGetterSetter(g,"data"),o.Factory.addGetterSetter(g,"fontFamily","Arial"),o.Factory.addGetterSetter(g,"fontSize",12,l.getNumberValidator()),o.Factory.addGetterSetter(g,"fontStyle",p),o.Factory.addGetterSetter(g,"align","left"),o.Factory.addGetterSetter(g,"letterSpacing",0,l.getNumberValidator()),o.Factory.addGetterSetter(g,"textBaseline","middle"),o.Factory.addGetterSetter(g,"fontVariant",p),o.Factory.addGetterSetter(g,"text",h),o.Factory.addGetterSetter(g,"textDecoration",null),o.Factory.addGetterSetter(g,"kerningFunc",null),i.Collection.mapMethods(g)},"2d16":function(t,e,n){(function(){"use strict";var e=Math.abs,r=Math.min,i=Math.max,o=Math.cos,s=Math.sin,a=Math.acos,u=Math.sqrt,l=Math.PI,c={x:0,y:0,z:0},h=n("d80b"),p=n("0f7f"),d=function(t){var n=t&&t.forEach?t:[].slice.call(arguments),r=!1;if("object"===typeof n[0]){r=n.length;var i=[];n.forEach((function(t){["x","y","z"].forEach((function(e){"undefined"!==typeof t[e]&&i.push(t[e])}))})),n=i}var o=!1,s=n.length;if(r){if(r>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");o=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var a=!o&&(9===s||12===s)||t&&t[0]&&"undefined"!==typeof t[0].z;this._3d=a;for(var u=[],l=0,c=a?3:2;l<s;l+=c){var p={x:n[l],y:n[l+1]};a&&(p.z=n[l+2]),u.push(p)}this.order=u.length-1,this.points=u;var d=["x","y"];a&&d.push("z"),this.dims=d,this.dimlen=d.length,function(t){for(var n=t.order,r=t.points,i=h.align(r,{p1:r[0],p2:r[n]}),o=0;o<i.length;o++)if(e(i[o].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()},f=n("4c3b");function g(t,e,n,r,i){"undefined"===typeof i&&(i=.5);var o=h.projectionratio(i,t),s=1-o,a={x:o*e.x+s*r.x,y:o*e.y+s*r.y},u=h.abcratio(i,t),l={x:n.x+(n.x-a.x)/u,y:n.y+(n.y-a.y)/u};return{A:l,B:n,C:a}}d.SVGtoBeziers=function(t){return f(d,t)},d.quadraticFromPoints=function(t,e,n,r){if("undefined"===typeof r&&(r=.5),0===r)return new d(e,e,n);if(1===r)return new d(t,e,e);var i=g(2,t,e,n,r);return new d(t,i.A,n)},d.cubicFromPoints=function(t,e,n,r,i){"undefined"===typeof r&&(r=.5);var o=g(3,t,e,n,r);"undefined"===typeof i&&(i=h.dist(e,o.C));var s=i*(1-r)/r,a=h.dist(t,n),u=(n.x-t.x)/a,l=(n.y-t.y)/a,c=i*u,p=i*l,f=s*u,m=s*l,y={x:e.x-c,y:e.y-p},v={x:e.x+f,y:e.y+m},x=o.A,_={x:x.x+(y.x-x.x)/(1-r),y:x.y+(y.y-x.y)/(1-r)},b={x:x.x+(v.x-x.x)/r,y:x.y+(v.y-x.y)/r},w={x:t.x+(_.x-t.x)/r,y:t.y+(_.y-t.y)/r},M={x:n.x+(b.x-n.x)/(1-r),y:n.y+(b.y-n.y)/(1-r)};return new d(t,w,M,n)};var m=function(){return h};d.getUtils=m,d.PolyBezier=p,d.prototype={getUtils:m,valueOf:function(){return this.toString()},toString:function(){return h.pointsToString(this.points)},toSVG:function(t){if(this._3d)return!1;for(var e=this.points,n=e[0].x,r=e[0].y,i=["M",n,r,2===this.order?"Q":"C"],o=1,s=e.length;o<s;o++)i.push(e[o].x),i.push(e[o].y);return i.join(" ")},setRatios:function(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]},verify:function(){var t=this.coordDigest();t!==this._print&&(this._print=t,this.update())},coordDigest:function(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")},update:function(t){this._lut=[],this.dpoints=h.derive(this.points,this._3d),this.computedirection()},computedirection:function(){var t=this.points,e=h.angle(t[0],t[this.order],t[1]);this.clockwise=e>0},length:function(){return h.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(var e=0;e<=t;e++)this._lut.push(this.compute(e/t));return this._lut},on:function(t,e){e=e||5;for(var n,r=this.getLUT(),i=[],o=0,s=0;s<r.length;s++)n=r[s],h.dist(n,t)<e&&(i.push(n),o+=s/r.length);return!!i.length&&o/i.length},project:function(t){var e,n,r,i,o=this.getLUT(),s=o.length-1,a=h.closest(o,t),u=a.mdist,l=a.mpos,c=(l-1)/s,p=(l+1)/s,d=.1/s;for(u+=1,n=c,e=n;n<p+d;n+=d)r=this.compute(n),i=h.dist(t,r),i<u&&(u=i,e=n);return r=this.compute(e),r.t=e,r.d=u,r},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){return this.ratios?h.computeWithRatios(t,this.points,this.ratios,this._3d):h.compute(t,this.points,this._3d,this.ratios)},raise:function(){for(var t,e,n=this.points,r=[n[0]],i=n.length,o=1;o<i;o++)t=n[o],e=n[o-1],r[o]={x:(i-o)/i*t.x+o/i*e.x,y:(i-o)/i*t.y+o/i*e.y};return r[i]=n[i-1],new d(r)},derivative:function(t){var e,n,r=1-t,i=0,o=this.dpoints[0];2===this.order&&(o=[o[0],o[1],c],e=r,n=t),3===this.order&&(e=r*r,n=r*t*2,i=t*t);var s={x:e*o[0].x+n*o[1].x+i*o[2].x,y:e*o[0].y+n*o[1].y+i*o[2].y};return this._3d&&(s.z=e*o[0].z+n*o[1].z+i*o[2].z),s},curvature:function(t){return h.curvature(t,this.points,this._3d)},inflections:function(){return h.inflections(this.points)},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var e=this.derivative(t),n=u(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}},__normal3:function(t){var e=this.derivative(t),n=this.derivative(t+.01),r=u(e.x*e.x+e.y*e.y+e.z*e.z),i=u(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;var o={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},s=u(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=s,o.y/=s,o.z/=s;var a=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z],l={x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z};return l},hull:function(t){var e,n=this.points,r=[],i=[],o=0,s=0,a=0;i[o++]=n[0],i[o++]=n[1],i[o++]=n[2],3===this.order&&(i[o++]=n[3]);while(n.length>1){for(r=[],s=0,a=n.length-1;s<a;s++)e=h.lerp(t,n[s],n[s+1]),i[o++]=e,r.push(e);n=r}return i},split:function(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;var n=this.hull(t),r={left:2===this.order?new d([n[0],n[3],n[5]]):new d([n[0],n[4],n[7],n[9]]),right:2===this.order?new d([n[5],n[4],n[2]]):new d([n[9],n[8],n[6],n[3]]),span:n};if(r.left._t1=h.map(0,0,1,this._t1,this._t2),r.left._t2=h.map(t,0,1,this._t1,this._t2),r.right._t1=h.map(t,0,1,this._t1,this._t2),r.right._t2=h.map(1,0,1,this._t1,this._t2),!e)return r;e=h.map(e,t,1,0,1);var i=r.right.split(e);return i.left},extrema:function(){var t,e,n=this.dims,r={},i=[];return n.forEach(function(n){e=function(t){return t[n]},t=this.dpoints[0].map(e),r[n]=h.droots(t),3===this.order&&(t=this.dpoints[1].map(e),r[n]=r[n].concat(h.droots(t))),r[n]=r[n].filter((function(t){return t>=0&&t<=1})),i=i.concat(r[n].sort(h.numberSort))}.bind(this)),i=i.sort(h.numberSort).filter((function(t,e){return i.indexOf(t)===e})),r.values=i,r},bbox:function(){var t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=h.getminmax(this,n,t[n])}.bind(this)),e},overlaps:function(t){var e=this.bbox(),n=t.bbox();return h.bboxoverlap(e,n)},offset:function(t,e){if("undefined"!==typeof e){var n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){var o=this.normal(0),s=this.points.map((function(e){var n={x:e.x+t*o.x,y:e.y+t*o.y};return e.z&&r.z&&(n.z=e.z+t*o.z),n}));return[new d(s)]}var a=this.reduce();return a.map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))},simple:function(){if(3===this.order){var t=h.angle(this.points[0],this.points[3],this.points[1]),n=h.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&n<0||t<0&&n>0)return!1}var r=this.normal(0),i=this.normal(1),o=r.x*i.x+r.y*i.y;this._3d&&(o+=r.z*i.z);var s=e(a(o));return s<l/3},reduce:function(){var t,n,r=0,i=0,o=.01,s=[],a=[],u=this.extrema().values;for(-1===u.indexOf(0)&&(u=[0].concat(u)),-1===u.indexOf(1)&&u.push(1),r=u[0],t=1;t<u.length;t++)i=u[t],n=this.split(r,i),n._t1=r,n._t2=i,s.push(n),r=i;return s.forEach((function(t){r=0,i=0;while(i<=1)for(i=r+o;i<=1+o;i+=o)if(n=t.split(r,i),!n.simple()){if(i-=o,e(r-i)<o)return[];n=t.split(r,i),n._t1=h.map(r,0,1,t._t1,t._t2),n._t2=h.map(i,0,1,t._t1,t._t2),a.push(n),r=i;break}r<1&&(n=t.split(r,1),n._t1=h.map(r,0,1,t._t1,t._t2),n._t2=t._t2,a.push(n))})),a},scale:function(t){var e=this.order,n=!1;if("function"===typeof t&&(n=t),n&&2===e)return this.raise().scale(n);var r=this.clockwise,i=n?n(0):t,o=n?n(1):t,s=[this.offset(0,10),this.offset(1,10)],a=h.lli4(s[0],s[0].c,s[1],s[1].c);if(!a)throw new Error("cannot scale this curve. Try reducing it first.");var l=this.points,c=[];return[0,1].forEach(function(t){var n=c[t*e]=h.copy(l[t*e]);n.x+=(t?o:i)*s[t].n.x,n.y+=(t?o:i)*s[t].n.y}.bind(this)),n?([0,1].forEach(function(i){if(2!==this.order||!i){var o=l[i+1],s={x:o.x-a.x,y:o.y-a.y},h=n?n((i+1)/e):t;n&&!r&&(h=-h);var p=u(s.x*s.x+s.y*s.y);s.x/=p,s.y/=p,c[i+1]={x:o.x+h*s.x,y:o.y+h*s.y}}}.bind(this)),new d(c)):([0,1].forEach(function(t){if(2!==this.order||!t){var n=c[t*e],r=this.derivative(t),i={x:n.x+r.x,y:n.y+r.y};c[t+1]=h.lli4(n,i,a,l[t+1])}}.bind(this)),new d(c))},outline:function(t,e,n,r){e="undefined"===typeof e?t:e;var i,o=this.reduce(),s=o.length,a=[],u=[],l=0,c=this.length(),d="undefined"!==typeof n&&"undefined"!==typeof r;function f(t,e,n,r,i){return function(o){var s=r/n,a=(r+i)/n,u=e-t;return h.map(o,0,1,t+s*u,t+a*u)}}o.forEach((function(i){w=i.length(),d?(a.push(i.scale(f(t,n,c,l,w))),u.push(i.scale(f(-e,-r,c,l,w)))):(a.push(i.scale(t)),u.push(i.scale(-e))),l+=w})),u=u.map((function(t){return i=t.points,i[3]?t.points=[i[3],i[2],i[1],i[0]]:t.points=[i[2],i[1],i[0]],t})).reverse();var g=a[0].points[0],m=a[s-1].points[a[s-1].points.length-1],y=u[s-1].points[u[s-1].points.length-1],v=u[0].points[0],x=h.makeline(y,g),_=h.makeline(m,v),b=[x].concat(a).concat([_]).concat(u),w=b.length;return new p(b)},outlineshapes:function(t,e,n){e=e||t;for(var r=this.outline(t,e).curves,i=[],o=1,s=r.length;o<s/2;o++){var a=h.makeshape(r[o],r[s-o],n);a.startcap.virtual=o>1,a.endcap.virtual=o<s/2-1,i.push(a)}return i},intersects:function(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof d&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)},lineIntersects:function(t){var e=r(t.p1.x,t.p2.x),n=r(t.p1.y,t.p2.y),o=i(t.p1.x,t.p2.x),s=i(t.p1.y,t.p2.y),a=this;return h.roots(this.points,t).filter((function(t){var r=a.get(t);return h.between(r.x,e,o)&&h.between(r.y,n,s)}))},selfintersects:function(t){var e,n,r,i,o=this.reduce(),s=o.length-2,a=[];for(e=0;e<s;e++)r=o.slice(e,e+1),i=o.slice(e+2),n=this.curveintersects(r,i,t),a=a.concat(n);return a},curveintersects:function(t,e,n){var r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));var i=[];return r.forEach((function(t){var e=h.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i},arcs:function(t){t=t||.5;var e=[];return this._iterate(t,e)},_error:function(t,n,r,i){var o=(i-r)/4,s=this.get(r+o),a=this.get(i-o),u=h.dist(t,n),l=h.dist(t,s),c=h.dist(t,a);return e(l-u)+e(c-u)},_iterate:function(t,e){var n,r=0,i=1;do{n=0,i=1;var a,u,l,c,p,d=this.get(r),f=!1,g=!1,m=i,y=1;do{g=f,c=l,m=(r+i)/2,a=this.get(m),u=this.get(i),l=h.getccenter(d,a,u),l.interval={start:r,end:i};var v=this._error(l,d,r,i);if(f=v<=t,p=g&&!f,p||(y=i),f){if(i>=1){if(l.interval.end=y=1,c=l,i>1){var x={x:l.x+l.r*o(l.e),y:l.y+l.r*s(l.e)};l.e+=h.angle({x:l.x,y:l.y},x,this.get(1))}break}i+=(i-r)/2}else i=m}while(!p&&n++<100);if(n>=100)break;c=c||l,e.push(c),r=y}while(i<1);return e}},t.exports=d})()},"2fb2":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("ea61"),s=n("d6af"),a=n("d777"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._validateAdd=function(t){var e=t.getType();"Shape"!==e&&i.Util.throw("You may only add shapes to a fast layer.")},e.prototype._setCanvasSize=function(t,e){this.canvas.setSize(t,e),this._checkSmooth()},e.prototype.hitGraphEnabled=function(){return!1},e.prototype.drawScene=function(t){var e=this.getLayer(),n=t||e&&e.getCanvas();return this.clearBeforeDraw()&&n.getContext().clear(),o.Container.prototype.drawScene.call(this,n),this},e.prototype.draw=function(){return this.drawScene(),this},e}(s.BaseLayer);e.FastLayer=u,u.prototype.nodeType="FastLayer",a._registerNode(u),i.Collection.mapMethods(u)},3191:function(t,e,n){(function(e,n){t.exports=n()})(0,(function(){var t=function(){function e(t){return i.appendChild(t.dom),t}function n(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";r=t}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),n(++r%i.children.length)}),!1);var o=(performance||Date).now(),s=o,a=0,u=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:e,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-o,200),t>s+1e3&&(u.update(1e3*a/(t-s),100),s=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:i,setMode:n}};return t.Panel=function(t,e,n){var r=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,u=48*s,l=3*s,c=2*s,h=3*s,p=15*s,d=74*s,f=30*s,g=document.createElement("canvas");g.width=a,g.height=u,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*s+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,a,u),m.fillStyle=e,m.fillText(t,l,c),m.fillRect(h,p,d,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(h,p,d,f),{dom:g,update:function(u,y){r=Math.min(r,u),i=Math.max(i,u),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,a,p),m.fillStyle=e,m.fillText(o(u)+" "+t+" ("+o(r)+"-"+o(i)+")",l,c),m.drawImage(g,h+s,p,d-s,f,h,p,d-s,f),m.fillRect(h+d-s,p,s,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(h+d-s,p,s,o((1-u/y)*f))}}},t}))},"362d":function(t,e,n){var r=n("fd15").Konva;r._injectGlobal(r),e["default"]=r,t.exports=e["default"]},"36da":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=n("9cb8"),o=n("4971"),s=n("ea61"),a=n("eba4"),u=n("0ff5"),l=n("2fb2"),c=n("f35c"),h=n("df93"),p=n("fce6"),d=n("ed3d"),f=n("06f8"),g=n("c527"),m=n("f655");e.Konva=i.Util._assign(r.Konva,{Collection:i.Collection,Util:i.Util,Transform:i.Transform,Node:o.Node,ids:o.ids,names:o.names,Container:s.Container,Stage:a.Stage,stages:a.stages,Layer:u.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:h.DD,Shape:p.Shape,shapes:p.shapes,Animation:d.Animation,Tween:f.Tween,Easings:f.Easings,Context:g.Context,Canvas:m.Canvas})},"383f":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.radiusX(),n=this.radiusY();t.beginPath(),t.save(),e!==n&&t.scale(1,n/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.radiusX()},e.prototype.getHeight=function(){return 2*this.radiusY()},e.prototype.setWidth=function(t){this.radiusX(t/2)},e.prototype.setHeight=function(t){this.radiusY(t/2)},e}(s.Shape);e.Ellipse=l,l.prototype.className="Ellipse",l.prototype._centroid=!0,l.prototype._attrsAffectingSize=["radiusX","radiusY"],u._registerNode(l),o.Factory.addComponentsGetterSetter(l,"radius",["x","y"]),o.Factory.addGetterSetter(l,"radiusX",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"radiusY",0,a.getNumberValidator()),i.Collection.mapMethods(l)},"405a":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("9cb8"),o=n("4971"),s=n("4546");e.Pixelate=function(t){var e,n,r,o,s,a,u,l,c,h,p,d,f,g,m=Math.ceil(this.pixelSize()),y=t.width,v=t.height,x=Math.ceil(y/m),_=Math.ceil(v/m),b=t.data;if(m<=0)i.Util.error("pixelSize value can not be <= 0");else for(d=0;d<x;d+=1)for(f=0;f<_;f+=1){for(o=0,s=0,a=0,u=0,l=d*m,c=l+m,h=f*m,p=h+m,g=0,e=l;e<c;e+=1)if(!(e>=y))for(n=h;n<p;n+=1)n>=v||(r=4*(y*n+e),o+=b[r+0],s+=b[r+1],a+=b[r+2],u+=b[r+3],g+=1);for(o/=g,s/=g,a/=g,u/=g,e=l;e<c;e+=1)if(!(e>=y))for(n=h;n<p;n+=1)n>=v||(r=4*(y*n+e),b[r+0]=o,b[r+1]=s,b[r+2]=a,b[r+3]=u)}},r.Factory.addGetterSetter(o.Node,"pixelSize",8,s.getNumberValidator(),r.Factory.afterSetFilter)},"441e":function(t,e){function n(){}function r(t,e){return Math.floor(Math.random()*(e-t+1))+t}n.maxFromBits=function(t){return Math.pow(2,t)},n.limitUI04=n.maxFromBits(4),n.limitUI06=n.maxFromBits(6),n.limitUI08=n.maxFromBits(8),n.limitUI12=n.maxFromBits(12),n.limitUI14=n.maxFromBits(14),n.limitUI16=n.maxFromBits(16),n.limitUI32=n.maxFromBits(32),n.limitUI40=n.maxFromBits(40),n.limitUI48=n.maxFromBits(48),n.randomUI04=function(){return r(0,n.limitUI04-1)},n.randomUI06=function(){return r(0,n.limitUI06-1)},n.randomUI08=function(){return r(0,n.limitUI08-1)},n.randomUI12=function(){return r(0,n.limitUI12-1)},n.randomUI14=function(){return r(0,n.limitUI14-1)},n.randomUI16=function(){return r(0,n.limitUI16-1)},n.randomUI32=function(){return r(0,n.limitUI32-1)},n.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},n.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},n.paddedString=function(t,e,n){t=String(t),n=n||"0";for(var r=e-t.length;r>0;r>>>=1,n+=n)1&r&&(t=n+t);return t},n.prototype.fromParts=function(t,e,r,i,o,s){return this.version=r>>12&15,this.hex=n.paddedString(t.toString(16),8)+"-"+n.paddedString(e.toString(16),4)+"-"+n.paddedString(r.toString(16),4)+"-"+n.paddedString(i.toString(16),2)+n.paddedString(o.toString(16),2)+"-"+n.paddedString(s.toString(16),12),this},n.prototype.toString=function(){return this.hex},n.prototype.toURN=function(){return"urn:uuid:"+this.hex},n.prototype.toBytes=function(){for(var t=this.hex.split("-"),e=[],n=0,r=0;r<t.length;r++)for(var i=0;i<t[r].length;i+=2)e[n++]=parseInt(t[r].substr(i,2),16);return e},n.prototype.equals=function(t){return t instanceof UUID&&this.hex===t.hex},n.getTimeFieldValues=function(t){var e=t-Date.UTC(1582,9,15),n=e/4294967296*1e4&268435455;return{low:1e4*(268435455&e)%4294967296,mid:65535&n,hi:n>>>16,timestamp:e}},n._create4=function(){return(new n).fromParts(n.randomUI32(),n.randomUI16(),16384|n.randomUI12(),128|n.randomUI06(),n.randomUI08(),n.randomUI48())},n._create1=function(){var t=(new Date).getTime(),e=n.randomUI14(),r=1099511627776*(1|n.randomUI08())+n.randomUI40(),i=n.randomUI04(),o=0,s=1/4;t!=o?(t<o&&e++,o=t,i=n.randomUI04()):Math.random()<s&&i<9984?i+=1+n.randomUI04():e++;var a=n.getTimeFieldValues(o),u=a.low+i,l=4095&a.hi|4096;e&=16383;var c=e>>>8|128,h=255&e;return(new n).fromParts(u,a.mid,l,c,h,r)},n.create=function(t){return t=t||4,this["_create"+t]()},n.fromTime=function(t,e){e=e||!1;var r=n.getTimeFieldValues(t),i=r.low,o=4095&r.hi|4096;return!1===e?(new n).fromParts(i,r.mid,o,0,0,0):(new n).fromParts(i,r.mid,o,128|n.limitUI06,n.limitUI08-1,n.limitUI48-1)},n.firstFromTime=function(t){return n.fromTime(t,!1)},n.lastFromTime=function(t){return n.fromTime(t,!0)},n.fromURN=function(t){var e,r=/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i;return(e=r.exec(t))?(new n).fromParts(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16),parseInt(e[5],16),parseInt(e[6],16)):null},n.fromBytes=function(t){if(t.length<5)return null;for(var e="",r=0,i=[4,2,2,2,6],o=0;o<i.length;o++){for(var s=0;s<i[o];s++){var a=t[r++].toString(16);1==a.length&&(a="0"+a),e+=a}6!==i[o]&&(e+="-")}return n.fromURN(e)},n.fromBinary=function(t){for(var e=[],r=0;r<t.length;r++)if(e[r]=t.charCodeAt(r),e[r]>255||e[r]<0)throw new Error("Unexpected byte in binary data.");return n.fromBytes(e)},n.new=function(){return this.create(4)},n.newTS=function(){return this.create(1)},t.exports=n},4546:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=n("9cb8");function o(t){return i.Util._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||i.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}function s(t){return t>255?255:t<0?0:Math.round(t)}function a(t){return t>1?1:t<1e-4?1e-4:t}function u(){if(r.Konva.isUnminified)return function(t,e){return i.Util._isNumber(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function l(){if(r.Konva.isUnminified)return function(t,e){var n=i.Util._isNumber(t),r="auto"===t;return n||r||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function c(){if(r.Konva.isUnminified)return function(t,e){return i.Util._isString(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function h(){if(r.Konva.isUnminified)return function(t,e){return i.Util._isFunction(t)||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}}function p(){if(r.Konva.isUnminified)return function(t,e){return i.Util._isArray(t)?t.forEach((function(t){i.Util._isNumber(t)||i.Util.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.'),t}}function d(){if(r.Konva.isUnminified)return function(t,e){var n=!0===t||!1===t;return n||i.Util.warn(o(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}function f(t){if(r.Konva.isUnminified)return function(e,n){return i.Util.isObject(e)||i.Util.warn(o(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}e.RGBComponent=s,e.alphaComponent=a,e.getNumberValidator=u,e.getNumberOrAutoValidator=l,e.getStringValidator=c,e.getFunctionValidator=h,e.getNumberArrayValidator=p,e.getBooleanValidator=d,e.getComponentValidator=f},"461e":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.HSV=function(t){var e,n,r,i,o,s=t.data,a=s.length,u=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,h=u*l*Math.cos(c*Math.PI/180),p=u*l*Math.sin(c*Math.PI/180),d=.299*u+.701*h+.167*p,f=.587*u-.587*h+.33*p,g=.114*u-.114*h-.497*p,m=.299*u-.299*h-.328*p,y=.587*u+.413*h+.035*p,v=.114*u-.114*h+.293*p,x=.299*u-.3*h+1.25*p,_=.587*u-.586*h-1.05*p,b=.114*u+.886*h-.2*p;for(e=0;e<a;e+=4)n=s[e+0],r=s[e+1],i=s[e+2],o=s[e+3],s[e+0]=d*n+f*r+g*i,s[e+1]=m*n+y*r+v*i,s[e+2]=x*n+_*r+b*i,s[e+3]=o},r.Factory.addGetterSetter(i.Node,"hue",0,o.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"saturation",0,o.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"value",0,o.getNumberValidator(),r.Factory.afterSetFilter)},4971:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("9cb8"),i=n("f0b4"),o=n("f655"),s=n("d777"),a=n("df93"),u=n("4546");e.ids={},e.names={};var l=function(t,n){n&&(e.ids[n]=t)};e._removeId=function(t,n){t&&e.ids[t]===n&&delete e.ids[t]},e._addName=function(t,n){n&&(e.names[n]||(e.names[n]=[]),e.names[n].push(t))},e._removeName=function(t,n){if(t){var r=e.names[t];if(r){for(var i=0;i<r.length;i++){var o=r[i];o._id===n&&r.splice(i,1)}0===r.length&&delete e.names[t]}}};var c="absoluteOpacity",h="absoluteTransform",p="absoluteScale",d="canvas",f="Change",g="children",m="konva",y="listening",v="mouseenter",x="mouseleave",_="name",b="set",w="Shape",M=" ",E="stage",S="transform",T="Stage",C="visible",A=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(M),P=["scaleXChange.konva","scaleYChange.konva"].join(M),L=new r.Collection,I=1,R=function(){function t(t){var e=this;this._id=I++,this.eventListeners={},this.attrs={},this.index=0,this.parent=null,this._cache=new Map,this._lastPos=null,this._filterUpToDate=!1,this._isUnderCache=!1,this.children=L,this._dragEventId=null,this.setAttrs(t),this.on(A,(function(){e._clearCache(S),e._clearSelfAndDescendantCache(h)})),this.on(P,(function(){e._clearSelfAndDescendantCache(p)})),this.on("visibleChange.konva",(function(){e._clearSelfAndDescendantCache(C)})),this.on("listeningChange.konva",(function(){e._clearSelfAndDescendantCache(y)})),this.on("opacityChange.konva",(function(){e._clearSelfAndDescendantCache(c)}))}return t.prototype.hasChildren=function(){return!1},t.prototype.getChildren=function(){return L},t.prototype._clearCache=function(t){t?this._cache.delete(t):this._cache.clear()},t.prototype._getCache=function(t,e){var n=this._cache.get(t);return void 0===n&&(n=e.call(this),this._cache.set(t,n)),n},t.prototype._getCanvasCache=function(){return this._cache.get(d)},t.prototype._clearSelfAndDescendantCache=function(t){this._clearCache(t),this.isCached()||this.children&&this.children.each((function(e){e._clearSelfAndDescendantCache(t)}))},t.prototype.clearCache=function(){return this._cache.delete(d),this._clearSelfAndDescendantCache(),this},t.prototype.cache=function(t){var e=t||{},n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var i=Math.ceil(e.width||n.width),s=Math.ceil(e.height||n.height),a=e.pixelRatio,u=void 0===e.x?n.x:e.x,l=void 0===e.y?n.y:e.y,h=e.offset||0,f=e.drawBorder||!1;if(i&&s){i+=2*h,s+=2*h,u-=h,l-=h;var g=new o.SceneCanvas({pixelRatio:a,width:i,height:s}),m=new o.SceneCanvas({pixelRatio:a,width:i,height:s}),y=new o.HitCanvas({pixelRatio:1,width:i,height:s}),v=g.getContext(),x=y.getContext();return y.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(g.getContext()._context.imageSmoothingEnabled=!1,m.getContext()._context.imageSmoothingEnabled=!1,y.getContext()._context.imageSmoothingEnabled=!1),v.save(),x.save(),v.translate(-u,-l),x.translate(-u,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(p),this.drawScene(g,this,!0),this.drawHit(y,this,!0),this._isUnderCache=!1,v.restore(),x.restore(),f&&(v.save(),v.beginPath(),v.rect(0,0,i,s),v.closePath(),v.setAttr("strokeStyle","red"),v.setAttr("lineWidth",5),v.stroke(),v.restore()),this._cache.set(d,{scene:g,filter:m,hit:y,x:u,y:l}),this}r.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")},t.prototype.isCached=function(){return this._cache.has("canvas")},t.prototype.getClientRect=function(t){throw new Error('abstract "getClientRect" method call')},t.prototype._transformedRect=function(t,e){var n,r,i,o,s=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],a=this.getAbsoluteTransform(e);return s.forEach((function(t){var e=a.point(t);void 0===n&&(n=i=e.x,r=o=e.y),n=Math.min(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y)})),{x:n,y:r,width:i-n,height:o-r}},t.prototype._drawCachedSceneCanvas=function(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);var e=this._getCanvasCache();t.translate(e.x,e.y);var n=this._getCachedSceneCanvas(),r=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/r,n.height/r),t.restore()},t.prototype._drawCachedHitCanvas=function(t){var e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0),t.restore()},t.prototype._getCachedSceneCanvas=function(){var t,e,n,i,o=this.filters(),s=this._getCanvasCache(),a=s.scene,u=s.filter,l=u.getContext();if(o){if(!this._filterUpToDate){var c=a.pixelRatio;try{for(t=o.length,l.clear(),l.drawImage(a._canvas,0,0,a.getWidth()/c,a.getHeight()/c),e=l.getImageData(0,0,u.getWidth(),u.getHeight()),n=0;n<t;n++)i=o[n],"function"===typeof i?(i.call(this,e),l.putImageData(e,0,0)):r.Util.error("Filter should be type of function, but got "+typeof i+" instead. Please check correct filters")}catch(h){r.Util.error("Unable to apply filter. "+h.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return u}return a},t.prototype.on=function(t,e){if(3===arguments.length)return this._delegate.apply(this,arguments);var n,r,i,o,s,a=t.split(M),u=a.length;for(n=0;n<u;n++)r=a[n],i=r.split("."),o=i[0],s=i[1]||"",this.eventListeners[o]||(this.eventListeners[o]=[]),this.eventListeners[o].push({name:s,handler:e});return this},t.prototype.off=function(t,e){var n,r,i,o,s,a,u=(t||"").split(M),l=u.length;if(!t)for(r in this.eventListeners)this._off(r);for(n=0;n<l;n++)if(i=u[n],o=i.split("."),s=o[0],a=o[1],s)this.eventListeners[s]&&this._off(s,a,e);else for(r in this.eventListeners)this._off(r,a,e);return this},t.prototype.dispatchEvent=function(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this},t.prototype.addEventListener=function(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this},t.prototype.removeEventListener=function(t){return this.off(t),this},t.prototype._delegate=function(t,e,n){var i=this;this.on(t,(function(t){for(var o=t.target.findAncestors(e,!0,i),s=0;s<o.length;s++)t=r.Util.cloneObject(t),t.currentTarget=o[s],n.call(o[s],t)}))},t.prototype.remove=function(){return this.isDragging()&&this.stopDrag(),a.DD._dragElements.delete(this._id),this._remove(),this},t.prototype._clearCaches=function(){this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(p),this._clearSelfAndDescendantCache(E),this._clearSelfAndDescendantCache(C),this._clearSelfAndDescendantCache(y)},t.prototype._remove=function(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)},t.prototype.destroy=function(){e._removeId(this.id(),this);for(var t=(this.name()||"").split(/\s/g),n=0;n<t.length;n++){var r=t[n];e._removeName(r,this._id)}return this.remove(),this},t.prototype.getAttr=function(t){var e="get"+r.Util._capitalize(t);return r.Util._isFunction(this[e])?this[e]():this.attrs[t]},t.prototype.getAncestors=function(){var t=this.getParent(),e=new r.Collection;while(t)e.push(t),t=t.getParent();return e},t.prototype.getAttrs=function(){return this.attrs||{}},t.prototype.setAttrs=function(t){var e,n;if(!t)return this;for(e in t)e!==g&&(n=b+r.Util._capitalize(e),r.Util._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]));return this},t.prototype.isListening=function(){return this._getCache(y,this._isListening)},t.prototype._isListening=function(){var t=this.listening(),e=this.getParent();return"inherit"===t?!e||e.isListening():t},t.prototype.isVisible=function(){return this._getCache(C,this._isVisible)},t.prototype._isVisible=function(t){var e=this.visible(),n=this.getParent();return"inherit"===e?!n||n===t||n._isVisible(t):t&&t!==n?e&&n._isVisible(t):e},t.prototype.shouldDrawHit=function(){var t=this.getLayer();return!t&&this.isListening()&&this.isVisible()||t&&t.hitGraphEnabled()&&this.isListening()&&this.isVisible()},t.prototype.show=function(){return this.visible(!0),this},t.prototype.hide=function(){return this.visible(!1),this},t.prototype.getZIndex=function(){return this.index||0},t.prototype.getAbsoluteZIndex=function(){var t,e,n,r,i=this.getDepth(),o=this,s=0;function a(u){for(t=[],e=u.length,n=0;n<e;n++)r=u[n],s++,r.nodeType!==w&&(t=t.concat(r.getChildren().toArray())),r._id===o._id&&(n=e);t.length>0&&t[0].getDepth()<=i&&a(t)}return o.nodeType!==T&&a(o.getStage().getChildren()),s},t.prototype.getDepth=function(){var t=0,e=this.parent;while(e)t++,e=e.parent;return t},t.prototype.setPosition=function(t){return this.x(t.x),this.y(t.y),this},t.prototype.getPosition=function(){return{x:this.x(),y:this.y()}},t.prototype.getAbsolutePosition=function(t){var e=!1,n=this.parent;while(n){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);var i=this.getAbsoluteTransform(t).getMatrix(),o=new r.Transform,s=this.offset();return o.m=i.slice(),o.translate(s.x,s.y),o.getTranslation()},t.prototype.setAbsolutePosition=function(t){var e,n=this._clearTransform();return this.attrs.x=n.x,this.attrs.y=n.y,delete n.x,delete n.y,e=this.getAbsoluteTransform(),e.invert(),e.translate(t.x,t.y),t={x:this.attrs.x+e.getTranslation().x,y:this.attrs.y+e.getTranslation().y},this.setPosition({x:t.x,y:t.y}),this._setTransform(n),this},t.prototype._setTransform=function(t){var e;for(e in t)this.attrs[e]=t[e];this._clearCache(S),this._clearSelfAndDescendantCache(h)},t.prototype._clearTransform=function(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(S),this._clearSelfAndDescendantCache(h),t},t.prototype.move=function(t){var e=t.x,n=t.y,r=this.x(),i=this.y();return void 0!==e&&(r+=e),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this},t.prototype._eachAncestorReverse=function(t,e){var n,r,i=[],o=this.getParent();if(e&&e._id===this._id)t(this);else{i.unshift(this);while(o&&(!e||o._id!==e._id))i.unshift(o),o=o.parent;for(n=i.length,r=0;r<n;r++)t(i[r])}},t.prototype.rotate=function(t){return this.rotation(this.rotation()+t),this},t.prototype.moveToTop=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},t.prototype.moveUp=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveDown=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)},t.prototype.moveToBottom=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},t.prototype.setZIndex=function(t){if(!this.parent)return r.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&r.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},t.prototype.getAbsoluteOpacity=function(){return this._getCache(c,this._getAbsoluteOpacity)},t.prototype._getAbsoluteOpacity=function(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t},t.prototype.moveTo=function(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this},t.prototype.toObject=function(){var t,e,n,i,o,s={},a=this.getAttrs();for(t in s.attrs={},a)e=a[t],o=r.Util.isObject(e)&&!r.Util._isPlainObject(e)&&!r.Util._isArray(e),o||(n="function"===typeof this[t]&&this[t],delete a[t],i=n?n.call(this):null,a[t]=e,i!==e&&(s.attrs[t]=e));return s.className=this.getClassName(),r.Util._prepareToStringify(s)},t.prototype.toJSON=function(){return JSON.stringify(this.toObject())},t.prototype.getParent=function(){return this.parent},t.prototype.findAncestors=function(t,e,n){var r=[];e&&this._isMatch(t)&&r.push(this);var i=this.parent;while(i){if(i===n)return r;i._isMatch(t)&&r.push(i),i=i.parent}return r},t.prototype.isAncestorOf=function(t){return!1},t.prototype.findAncestor=function(t,e,n){return this.findAncestors(t,e,n)[0]},t.prototype._isMatch=function(t){if(!t)return!1;if("function"===typeof t)return t(this);var e,n,i=t.replace(/ /g,"").split(","),o=i.length;for(e=0;e<o;e++)if(n=i[e],r.Util.isValidSelector(n)||(r.Util.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),r.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),r.Util.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1},t.prototype.getLayer=function(){var t=this.getParent();return t?t.getLayer():null},t.prototype.getStage=function(){return this._getCache(E,this._getStage)},t.prototype._getStage=function(){var t=this.getParent();return t?t.getStage():void 0},t.prototype.fire=function(t,e,n){return e=e||{},e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this},t.prototype.getAbsoluteTransform=function(t){return t?this._getAbsoluteTransform(t):this._getCache(h,this._getAbsoluteTransform)},t.prototype._getAbsoluteTransform=function(t){var e;if(t)return e=new r.Transform,this._eachAncestorReverse((function(t){var n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this.parent?this.parent.getAbsoluteTransform().copy():new r.Transform;var n=this.transformsEnabled();return"all"===n?e.multiply(this.getTransform()):"position"===n&&e.translate(this.x()-this.offsetX(),this.y()-this.offsetY()),e},t.prototype.getAbsoluteScale=function(t){return t?this._getAbsoluteScale(t):this._getCache(p,this._getAbsoluteScale)},t.prototype._getAbsoluteScale=function(t){var e=this;while(e)e._isUnderCache&&(t=e),e=e.getParent();var n=1,r=1;return this._eachAncestorReverse((function(t){n*=t.scaleX(),r*=t.scaleY()}),t),{x:n,y:r}},t.prototype.getAbsoluteRotation=function(){var t=this,e=0;while(t)e+=t.rotation(),t=t.getParent();return e},t.prototype.getTransform=function(){return this._getCache(S,this._getTransform)},t.prototype._getTransform=function(){var t=new r.Transform,e=this.x(),n=this.y(),i=s.Konva.getAngle(this.rotation()),o=this.scaleX(),a=this.scaleY(),u=this.skewX(),l=this.skewY(),c=this.offsetX(),h=this.offsetY();return 0===e&&0===n||t.translate(e,n),0!==i&&t.rotate(i),0===u&&0===l||t.skew(u,l),1===o&&1===a||t.scale(o,a),0===c&&0===h||t.translate(-1*c,-1*h),t},t.prototype.clone=function(t){var e,n,i,o,s,a=r.Util.cloneObject(this.attrs);for(e in t)a[e]=t[e];var u=new this.constructor(a);for(e in this.eventListeners)for(n=this.eventListeners[e],i=n.length,o=0;o<i;o++)s=n[o],s.name.indexOf(m)<0&&(u.eventListeners[e]||(u.eventListeners[e]=[]),u.eventListeners[e].push(s));return u},t.prototype._toKonvaCanvas=function(t){t=t||{};var e=this.getClientRect(),n=this.getStage(),r=void 0!==t.x?t.x:e.x,i=void 0!==t.y?t.y:e.y,s=t.pixelRatio||1,a=new o.SceneCanvas({width:t.width||e.width||(n?n.width():0),height:t.height||e.height||(n?n.height():0),pixelRatio:s}),u=a.getContext();return u.save(),(r||i)&&u.translate(-1*r,-1*i),this.drawScene(a),u.restore(),a},t.prototype.toCanvas=function(t){return this._toKonvaCanvas(t)._canvas},t.prototype.toDataURL=function(t){t=t||{};var e=t.mimeType||null,n=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(r),r},t.prototype.toImage=function(t){if(!t||!t.callback)throw"callback required for toImage method config argument";var e=t.callback;delete t.callback,r.Util._urlToImage(this.toDataURL(t),(function(t){e(t)}))},t.prototype.setSize=function(t){return this.width(t.width),this.height(t.height),this},t.prototype.getSize=function(){return{width:this.width(),height:this.height()}},t.prototype.getClassName=function(){return this.className||this.nodeType},t.prototype.getType=function(){return this.nodeType},t.prototype.getDragDistance=function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance},t.prototype._off=function(t,e,n){var r,i,o,s=this.eventListeners[t];for(r=0;r<s.length;r++)if(i=s[r].name,o=s[r].handler,("konva"!==i||"konva"===e)&&(!e||i===e)&&(!n||n===o)){if(s.splice(r,1),0===s.length){delete this.eventListeners[t];break}r--}},t.prototype._fireChangeEvent=function(t,e,n){this._fire(t+f,{oldVal:e,newVal:n})},t.prototype.setId=function(t){var n=this.id();return e._removeId(n,this),l(this,t),this._setAttr("id",t),this},t.prototype.setName=function(t){var n,r,i=(this.name()||"").split(/\s/g),o=(t||"").split(/\s/g);for(r=0;r<i.length;r++)n=i[r],-1===o.indexOf(n)&&n&&e._removeName(n,this._id);for(r=0;r<o.length;r++)n=o[r],-1===i.indexOf(n)&&n&&e._addName(this,n);return this._setAttr(_,t),this},t.prototype.addName=function(t){if(!this.hasName(t)){var e=this.name(),n=e?e+" "+t:t;this.setName(n)}return this},t.prototype.hasName=function(t){if(!t)return!1;var e=this.name();if(!e)return!1;var n=(e||"").split(/\s/g);return-1!==n.indexOf(t)},t.prototype.removeName=function(t){var e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.setName(e.join(" "))),this},t.prototype.setAttr=function(t,e){var n=this[b+r.Util._capitalize(t)];return r.Util._isFunction(n)?n.call(this,e):this._setAttr(t,e),this},t.prototype._setAttr=function(t,e){var n=this.attrs[t];(n!==e||r.Util.isObject(e))&&(void 0===e||null===e?delete this.attrs[t]:this.attrs[t]=e,this._fireChangeEvent(t,n,e))},t.prototype._setComponentAttr=function(t,e,n){var r;void 0!==n&&(r=this.attrs[t],r||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,r,n))},t.prototype._fireAndBubble=function(t,e,n){e&&this.nodeType===w&&(e.target=this);var r=(t===v||t===x)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n);if(!r){this._fire(t,e);var i=(t===v||t===x)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}},t.prototype._fire=function(t,e){var n,r=this.eventListeners[t];if(r)for(e=e||{},e.currentTarget=this,e.type=t,n=0;n<r.length;n++)r[n].handler.call(this,e)},t.prototype.draw=function(){return this.drawScene(),this.drawHit(),this},t.prototype._createDragElement=function(t){var e=t?t.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition(),i=n._getPointerById(e)||n._changedPointerPositions[0]||r;a.DD._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-r.x,y:i.y-r.y},dragStatus:"ready",pointerId:e})},t.prototype.startDrag=function(t){a.DD._dragElements.has(this._id)||this._createDragElement(t);var e=a.DD._dragElements.get(this._id);e.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},!0)},t.prototype._setDragPosition=function(t,e){var n=this.getStage()._getPointerById(e.pointerId);if(n){var i={x:n.x-e.offset.x,y:n.y-e.offset.y},o=this.dragBoundFunc();if(void 0!==o){var s=o.call(this,i,t);s?i=s:r.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=i}},t.prototype.stopDrag=function(t){var e=a.DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),a.DD._endDragBefore(t),a.DD._endDragAfter(t)},t.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()},t.prototype.isDragging=function(){var t=a.DD._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus},t.prototype._listenDrag=function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){var e=this,n=void 0!==t.evt["button"],r=!n||s.Konva.dragButtons.indexOf(t.evt["button"])>=0;if(r&&!this.isDragging()){var i=!1;a.DD._dragElements.forEach((function(t){e.isAncestorOf(t.node)&&(i=!0)})),i||this._createDragElement(t)}}))},t.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage();t&&a.DD._dragElements.has(this._id)&&this.stopDrag()}},t.prototype._dragCleanup=function(){this.off("mousedown.konva"),this.off("touchstart.konva")},t.create=function(t,e){return r.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)},t._createNode=function(e,n){var i,o,a,u=t.prototype.getClassName.call(e),l=e.children;n&&(e.attrs.container=n),s._NODES_REGISTRY[u]||(r.Util.warn('Can not find a node with class name "'+u+'". Fallback to "Shape".'),u="Shape");var c=s._NODES_REGISTRY[u];if(i=new c(e.attrs),l)for(o=l.length,a=0;a<o;a++)i.add(t._createNode(l[a]));return i},t}();e.Node=R,R.prototype.nodeType="Node",R.prototype._attrsAffectingSize=[],i.Factory.addGetterSetter(R,"zIndex"),i.Factory.addGetterSetter(R,"absolutePosition"),i.Factory.addGetterSetter(R,"position"),i.Factory.addGetterSetter(R,"x",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"y",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"globalCompositeOperation","source-over",u.getStringValidator()),i.Factory.addGetterSetter(R,"opacity",1,u.getNumberValidator()),i.Factory.addGetterSetter(R,"name","",u.getStringValidator()),i.Factory.addGetterSetter(R,"id","",u.getStringValidator()),i.Factory.addGetterSetter(R,"rotation",0,u.getNumberValidator()),i.Factory.addComponentsGetterSetter(R,"scale",["x","y"]),i.Factory.addGetterSetter(R,"scaleX",1,u.getNumberValidator()),i.Factory.addGetterSetter(R,"scaleY",1,u.getNumberValidator()),i.Factory.addComponentsGetterSetter(R,"skew",["x","y"]),i.Factory.addGetterSetter(R,"skewX",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"skewY",0,u.getNumberValidator()),i.Factory.addComponentsGetterSetter(R,"offset",["x","y"]),i.Factory.addGetterSetter(R,"offsetX",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"offsetY",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"dragDistance",null,u.getNumberValidator()),i.Factory.addGetterSetter(R,"width",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"height",0,u.getNumberValidator()),i.Factory.addGetterSetter(R,"listening","inherit",(function(t){var e=!0===t||!1===t||"inherit"===t;return e||r.Util.warn(t+' is a not valid value for "listening" attribute. The value may be true, false or "inherit".'),t})),i.Factory.addGetterSetter(R,"preventDefault",!0,u.getBooleanValidator()),i.Factory.addGetterSetter(R,"filters",null,(function(t){return this._filterUpToDate=!1,t})),i.Factory.addGetterSetter(R,"visible","inherit",(function(t){var e=!0===t||!1===t||"inherit"===t;return e||r.Util.warn(t+' is a not valid value for "visible" attribute. The value may be true, false or "inherit".'),t})),i.Factory.addGetterSetter(R,"transformsEnabled","all",u.getStringValidator()),i.Factory.addGetterSetter(R,"size"),i.Factory.addGetterSetter(R,"dragBoundFunc"),i.Factory.addGetterSetter(R,"draggable",!1,u.getBooleanValidator()),i.Factory.backCompat(R,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),r.Collection.mapMethods(R)},"4af1":function(t,e,n){"use strict";n.d(e,"a",(function(){return K}));var r={};n.r(r),n.d(r,"ACESFilmicToneMapping",(function(){return Kt})),n.d(r,"AddEquation",(function(){return xt})),n.d(r,"AddOperation",(function(){return Wt})),n.d(r,"AdditiveAnimationBlendMode",(function(){return Un})),n.d(r,"AdditiveBlending",(function(){return gt})),n.d(r,"AlphaFormat",(function(){return Le})),n.d(r,"AlwaysDepth",(function(){return Ft})),n.d(r,"AlwaysStencilFunc",(function(){return vr})),n.d(r,"AmbientLight",(function(){return xg})),n.d(r,"AmbientLightProbe",(function(){return Vg})),n.d(r,"AnimationClip",(function(){return pf})),n.d(r,"AnimationLoader",(function(){return bf})),n.d(r,"AnimationMixer",(function(){return bm})),n.d(r,"AnimationObjectGroup",(function(){return xm})),n.d(r,"AnimationUtils",(function(){return Qd})),n.d(r,"ArcCurve",(function(){return Pf})),n.d(r,"ArrayCamera",(function(){return mh})),n.d(r,"ArrowHelper",(function(){return hy})),n.d(r,"Audio",(function(){return $g})),n.d(r,"AudioAnalyser",(function(){return om})),n.d(r,"AudioContext",(function(){return zg})),n.d(r,"AudioListener",(function(){return Qg})),n.d(r,"AudioLoader",(function(){return Gg})),n.d(r,"AxesHelper",(function(){return py})),n.d(r,"AxisHelper",(function(){return gv})),n.d(r,"BackSide",(function(){return lt})),n.d(r,"BasicDepthPacking",(function(){return $n})),n.d(r,"BasicShadowMap",(function(){return it})),n.d(r,"BinaryTextureLoader",(function(){return _v})),n.d(r,"Bone",(function(){return ep})),n.d(r,"BooleanKeyframeTrack",(function(){return of})),n.d(r,"BoundingBoxHelper",(function(){return mv})),n.d(r,"Box2",(function(){return Im})),n.d(r,"Box3",(function(){return Xr})),n.d(r,"Box3Helper",(function(){return sy})),n.d(r,"BoxBufferGeometry",(function(){return cs})),n.d(r,"BoxGeometry",(function(){return cs})),n.d(r,"BoxHelper",(function(){return oy})),n.d(r,"BufferAttribute",(function(){return wo})),n.d(r,"BufferGeometry",(function(){return Ho})),n.d(r,"BufferGeometryLoader",(function(){return Cg})),n.d(r,"ByteType",(function(){return xe})),n.d(r,"Cache",(function(){return gf})),n.d(r,"Camera",(function(){return ys})),n.d(r,"CameraHelper",(function(){return ny})),n.d(r,"CanvasRenderer",(function(){return wv})),n.d(r,"CanvasTexture",(function(){return Lp})),n.d(r,"CatmullRomCurve3",(function(){return Df})),n.d(r,"CineonToneMapping",(function(){return Zt})),n.d(r,"CircleBufferGeometry",(function(){return Rp})),n.d(r,"CircleGeometry",(function(){return Rp})),n.d(r,"ClampToEdgeWrapping",(function(){return se})),n.d(r,"Clock",(function(){return qg})),n.d(r,"Color",(function(){return vo})),n.d(r,"ColorKeyframeTrack",(function(){return sf})),n.d(r,"CompressedTexture",(function(){return Pp})),n.d(r,"CompressedTextureLoader",(function(){return wf})),n.d(r,"ConeBufferGeometry",(function(){return Op})),n.d(r,"ConeGeometry",(function(){return Op})),n.d(r,"CubeCamera",(function(){return bs})),n.d(r,"CubeReflectionMapping",(function(){return $t})),n.d(r,"CubeRefractionMapping",(function(){return te})),n.d(r,"CubeTexture",(function(){return ws})),n.d(r,"CubeTextureLoader",(function(){return Ef})),n.d(r,"CubeUVReflectionMapping",(function(){return re})),n.d(r,"CubeUVRefractionMapping",(function(){return ie})),n.d(r,"CubicBezierCurve",(function(){return qf})),n.d(r,"CubicBezierCurve3",(function(){return Yf})),n.d(r,"CubicInterpolant",(function(){return tf})),n.d(r,"CullFaceBack",(function(){return et})),n.d(r,"CullFaceFront",(function(){return nt})),n.d(r,"CullFaceFrontBack",(function(){return rt})),n.d(r,"CullFaceNone",(function(){return tt})),n.d(r,"Curve",(function(){return Cf})),n.d(r,"CurvePath",(function(){return tg})),n.d(r,"CustomBlending",(function(){return vt})),n.d(r,"CustomToneMapping",(function(){return Jt})),n.d(r,"CylinderBufferGeometry",(function(){return Np})),n.d(r,"CylinderGeometry",(function(){return Np})),n.d(r,"Cylindrical",(function(){return Pm})),n.d(r,"DataTexture",(function(){return Es})),n.d(r,"DataTexture2DArray",(function(){return gl})),n.d(r,"DataTexture3D",(function(){return ml})),n.d(r,"DataTextureLoader",(function(){return Sf})),n.d(r,"DataUtils",(function(){return gy})),n.d(r,"DecrementStencilOp",(function(){return ar})),n.d(r,"DecrementWrapStencilOp",(function(){return lr})),n.d(r,"DefaultLoadingManager",(function(){return yf})),n.d(r,"DepthFormat",(function(){return Fe})),n.d(r,"DepthStencilFormat",(function(){return ke})),n.d(r,"DepthTexture",(function(){return Ip})),n.d(r,"DirectionalLight",(function(){return vg})),n.d(r,"DirectionalLightHelper",(function(){return $m})),n.d(r,"DiscreteInterpolant",(function(){return nf})),n.d(r,"DodecahedronBufferGeometry",(function(){return Fp})),n.d(r,"DodecahedronGeometry",(function(){return Fp})),n.d(r,"DoubleSide",(function(){return ct})),n.d(r,"DstAlphaFactor",(function(){return Lt})),n.d(r,"DstColorFactor",(function(){return Rt})),n.d(r,"DynamicBufferAttribute",(function(){return ov})),n.d(r,"DynamicCopyUsage",(function(){return Tr})),n.d(r,"DynamicDrawUsage",(function(){return _r})),n.d(r,"DynamicReadUsage",(function(){return Mr})),n.d(r,"EdgesGeometry",(function(){return Up})),n.d(r,"EdgesHelper",(function(){return yv})),n.d(r,"EllipseCurve",(function(){return Af})),n.d(r,"EqualDepth",(function(){return zt})),n.d(r,"EqualStencilFunc",(function(){return dr})),n.d(r,"EquirectangularReflectionMapping",(function(){return ee})),n.d(r,"EquirectangularRefractionMapping",(function(){return ne})),n.d(r,"Euler",(function(){return Ri})),n.d(r,"EventDispatcher",(function(){return Lr})),n.d(r,"ExtrudeBufferGeometry",(function(){return Md})),n.d(r,"ExtrudeGeometry",(function(){return Md})),n.d(r,"FaceColors",(function(){return Xy})),n.d(r,"FileLoader",(function(){return _f})),n.d(r,"FlatShading",(function(){return ht})),n.d(r,"Float16BufferAttribute",(function(){return Lo})),n.d(r,"Float32Attribute",(function(){return dv})),n.d(r,"Float32BufferAttribute",(function(){return Io})),n.d(r,"Float64Attribute",(function(){return fv})),n.d(r,"Float64BufferAttribute",(function(){return Ro})),n.d(r,"FloatType",(function(){return Ee})),n.d(r,"Fog",(function(){return Sh})),n.d(r,"FogExp2",(function(){return Eh})),n.d(r,"Font",(function(){return Og})),n.d(r,"FontLoader",(function(){return kg})),n.d(r,"FrontSide",(function(){return ut})),n.d(r,"Frustum",(function(){return Cs})),n.d(r,"GLBufferAttribute",(function(){return Em})),n.d(r,"GLSL1",(function(){return Ar})),n.d(r,"GLSL3",(function(){return Pr})),n.d(r,"GammaEncoding",(function(){return Yn})),n.d(r,"GreaterDepth",(function(){return Ut})),n.d(r,"GreaterEqualDepth",(function(){return Gt})),n.d(r,"GreaterEqualStencilFunc",(function(){return yr})),n.d(r,"GreaterStencilFunc",(function(){return gr})),n.d(r,"GridHelper",(function(){return Xm})),n.d(r,"Group",(function(){return yh})),n.d(r,"HalfFloatType",(function(){return Se})),n.d(r,"HemisphereLight",(function(){return ig})),n.d(r,"HemisphereLightHelper",(function(){return Ym})),n.d(r,"HemisphereLightProbe",(function(){return Ug})),n.d(r,"IcosahedronBufferGeometry",(function(){return Td})),n.d(r,"IcosahedronGeometry",(function(){return Td})),n.d(r,"ImageBitmapLoader",(function(){return Rg})),n.d(r,"ImageLoader",(function(){return Mf})),n.d(r,"ImageUtils",(function(){return kr})),n.d(r,"ImmediateRenderObject",(function(){return Dm})),n.d(r,"IncrementStencilOp",(function(){return sr})),n.d(r,"IncrementWrapStencilOp",(function(){return ur})),n.d(r,"InstancedBufferAttribute",(function(){return Tg})),n.d(r,"InstancedBufferGeometry",(function(){return Sg})),n.d(r,"InstancedInterleavedBuffer",(function(){return Mm})),n.d(r,"InstancedMesh",(function(){return lp})),n.d(r,"Int16Attribute",(function(){return lv})),n.d(r,"Int16BufferAttribute",(function(){return To})),n.d(r,"Int32Attribute",(function(){return hv})),n.d(r,"Int32BufferAttribute",(function(){return Ao})),n.d(r,"Int8Attribute",(function(){return sv})),n.d(r,"Int8BufferAttribute",(function(){return Mo})),n.d(r,"IntType",(function(){return we})),n.d(r,"InterleavedBuffer",(function(){return Ch})),n.d(r,"InterleavedBufferAttribute",(function(){return Ph})),n.d(r,"Interpolant",(function(){return $d})),n.d(r,"InterpolateDiscrete",(function(){return On})),n.d(r,"InterpolateLinear",(function(){return Dn})),n.d(r,"InterpolateSmooth",(function(){return Fn})),n.d(r,"InvertStencilOp",(function(){return cr})),n.d(r,"JSONLoader",(function(){return Mv})),n.d(r,"KeepStencilOp",(function(){return ir})),n.d(r,"KeyframeTrack",(function(){return rf})),n.d(r,"LOD",(function(){return Xh})),n.d(r,"LatheBufferGeometry",(function(){return Cd})),n.d(r,"LatheGeometry",(function(){return Cd})),n.d(r,"Layers",(function(){return Ni})),n.d(r,"LensFlare",(function(){return Sv})),n.d(r,"LessDepth",(function(){return kt})),n.d(r,"LessEqualDepth",(function(){return Bt})),n.d(r,"LessEqualStencilFunc",(function(){return fr})),n.d(r,"LessStencilFunc",(function(){return pr})),n.d(r,"Light",(function(){return rg})),n.d(r,"LightProbe",(function(){return wg})),n.d(r,"Line",(function(){return mp})),n.d(r,"Line3",(function(){return Om})),n.d(r,"LineBasicMaterial",(function(){return cp})),n.d(r,"LineCurve",(function(){return Xf})),n.d(r,"LineCurve3",(function(){return Zf})),n.d(r,"LineDashedMaterial",(function(){return Kd})),n.d(r,"LineLoop",(function(){return _p})),n.d(r,"LinePieces",(function(){return qy})),n.d(r,"LineSegments",(function(){return xp})),n.d(r,"LineStrip",(function(){return Wy})),n.d(r,"LinearEncoding",(function(){return Wn})),n.d(r,"LinearFilter",(function(){return de})),n.d(r,"LinearInterpolant",(function(){return ef})),n.d(r,"LinearMipMapLinearFilter",(function(){return ye})),n.d(r,"LinearMipMapNearestFilter",(function(){return ge})),n.d(r,"LinearMipmapLinearFilter",(function(){return me})),n.d(r,"LinearMipmapNearestFilter",(function(){return fe})),n.d(r,"LinearToneMapping",(function(){return Yt})),n.d(r,"Loader",(function(){return vf})),n.d(r,"LoaderUtils",(function(){return Eg})),n.d(r,"LoadingManager",(function(){return mf})),n.d(r,"LogLuvEncoding",(function(){return Zn})),n.d(r,"LoopOnce",(function(){return In})),n.d(r,"LoopPingPong",(function(){return Nn})),n.d(r,"LoopRepeat",(function(){return Rn})),n.d(r,"LuminanceAlphaFormat",(function(){return Oe})),n.d(r,"LuminanceFormat",(function(){return Ne})),n.d(r,"MOUSE",(function(){return Q})),n.d(r,"Material",(function(){return co})),n.d(r,"MaterialLoader",(function(){return Mg})),n.d(r,"Math",(function(){return Nr})),n.d(r,"MathUtils",(function(){return Nr})),n.d(r,"Matrix3",(function(){return Dr})),n.d(r,"Matrix4",(function(){return wi})),n.d(r,"MaxEquation",(function(){return Mt})),n.d(r,"Mesh",(function(){return as})),n.d(r,"MeshBasicMaterial",(function(){return xo})),n.d(r,"MeshDepthMaterial",(function(){return uh})),n.d(r,"MeshDistanceMaterial",(function(){return lh})),n.d(r,"MeshFaceMaterial",(function(){return Ky})),n.d(r,"MeshLambertMaterial",(function(){return Xd})),n.d(r,"MeshMatcapMaterial",(function(){return Zd})),n.d(r,"MeshNormalMaterial",(function(){return Yd})),n.d(r,"MeshPhongMaterial",(function(){return Wd})),n.d(r,"MeshPhysicalMaterial",(function(){return jd})),n.d(r,"MeshStandardMaterial",(function(){return Hd})),n.d(r,"MeshToonMaterial",(function(){return qd})),n.d(r,"MinEquation",(function(){return wt})),n.d(r,"MirroredRepeatWrapping",(function(){return ae})),n.d(r,"MixOperation",(function(){return jt})),n.d(r,"MultiMaterial",(function(){return Jy})),n.d(r,"MultiplyBlending",(function(){return yt})),n.d(r,"MultiplyOperation",(function(){return Ht})),n.d(r,"NearestFilter",(function(){return ue})),n.d(r,"NearestMipMapLinearFilter",(function(){return pe})),n.d(r,"NearestMipMapNearestFilter",(function(){return ce})),n.d(r,"NearestMipmapLinearFilter",(function(){return he})),n.d(r,"NearestMipmapNearestFilter",(function(){return le})),n.d(r,"NeverDepth",(function(){return Dt})),n.d(r,"NeverStencilFunc",(function(){return hr})),n.d(r,"NoBlending",(function(){return dt})),n.d(r,"NoColors",(function(){return Yy})),n.d(r,"NoToneMapping",(function(){return qt})),n.d(r,"NormalAnimationBlendMode",(function(){return Gn})),n.d(r,"NormalBlending",(function(){return ft})),n.d(r,"NotEqualDepth",(function(){return Vt})),n.d(r,"NotEqualStencilFunc",(function(){return mr})),n.d(r,"NumberKeyframeTrack",(function(){return af})),n.d(r,"Object3D",(function(){return Yi})),n.d(r,"ObjectLoader",(function(){return Ag})),n.d(r,"ObjectSpaceNormalMap",(function(){return nr})),n.d(r,"OctahedronBufferGeometry",(function(){return Ad})),n.d(r,"OctahedronGeometry",(function(){return Ad})),n.d(r,"OneFactor",(function(){return St})),n.d(r,"OneMinusDstAlphaFactor",(function(){return It})),n.d(r,"OneMinusDstColorFactor",(function(){return Nt})),n.d(r,"OneMinusSrcAlphaFactor",(function(){return Pt})),n.d(r,"OneMinusSrcColorFactor",(function(){return Ct})),n.d(r,"OrthographicCamera",(function(){return mg})),n.d(r,"PCFShadowMap",(function(){return ot})),n.d(r,"PCFSoftShadowMap",(function(){return st})),n.d(r,"PMREMGenerator",(function(){return Dy})),n.d(r,"ParametricBufferGeometry",(function(){return Pd})),n.d(r,"ParametricGeometry",(function(){return Pd})),n.d(r,"Particle",(function(){return $y})),n.d(r,"ParticleBasicMaterial",(function(){return nv})),n.d(r,"ParticleSystem",(function(){return tv})),n.d(r,"ParticleSystemMaterial",(function(){return rv})),n.d(r,"Path",(function(){return eg})),n.d(r,"PerspectiveCamera",(function(){return vs})),n.d(r,"Plane",(function(){return Ji})),n.d(r,"PlaneBufferGeometry",(function(){return Ls})),n.d(r,"PlaneGeometry",(function(){return Ls})),n.d(r,"PlaneHelper",(function(){return ay})),n.d(r,"PointCloud",(function(){return Qy})),n.d(r,"PointCloudMaterial",(function(){return ev})),n.d(r,"PointLight",(function(){return gg})),n.d(r,"PointLightHelper",(function(){return Hm})),n.d(r,"Points",(function(){return Tp})),n.d(r,"PointsMaterial",(function(){return bp})),n.d(r,"PolarGridHelper",(function(){return Zm})),n.d(r,"PolyhedronBufferGeometry",(function(){return Dp})),n.d(r,"PolyhedronGeometry",(function(){return Dp})),n.d(r,"PositionalAudio",(function(){return im})),n.d(r,"PropertyBinding",(function(){return vm})),n.d(r,"PropertyMixer",(function(){return sm})),n.d(r,"QuadraticBezierCurve",(function(){return Kf})),n.d(r,"QuadraticBezierCurve3",(function(){return Jf})),n.d(r,"Quaternion",(function(){return jr})),n.d(r,"QuaternionKeyframeTrack",(function(){return lf})),n.d(r,"QuaternionLinearInterpolant",(function(){return uf})),n.d(r,"REVISION",(function(){return J})),n.d(r,"RGBADepthPacking",(function(){return tr})),n.d(r,"RGBAFormat",(function(){return Re})),n.d(r,"RGBAIntegerFormat",(function(){return He})),n.d(r,"RGBA_ASTC_10x10_Format",(function(){return dn})),n.d(r,"RGBA_ASTC_10x5_Format",(function(){return cn})),n.d(r,"RGBA_ASTC_10x6_Format",(function(){return hn})),n.d(r,"RGBA_ASTC_10x8_Format",(function(){return pn})),n.d(r,"RGBA_ASTC_12x10_Format",(function(){return fn})),n.d(r,"RGBA_ASTC_12x12_Format",(function(){return gn})),n.d(r,"RGBA_ASTC_4x4_Format",(function(){return en})),n.d(r,"RGBA_ASTC_5x4_Format",(function(){return nn})),n.d(r,"RGBA_ASTC_5x5_Format",(function(){return rn})),n.d(r,"RGBA_ASTC_6x5_Format",(function(){return on})),n.d(r,"RGBA_ASTC_6x6_Format",(function(){return sn})),n.d(r,"RGBA_ASTC_8x5_Format",(function(){return an})),n.d(r,"RGBA_ASTC_8x6_Format",(function(){return un})),n.d(r,"RGBA_ASTC_8x8_Format",(function(){return ln})),n.d(r,"RGBA_BPTC_Format",(function(){return mn})),n.d(r,"RGBA_ETC2_EAC_Format",(function(){return tn})),n.d(r,"RGBA_PVRTC_2BPPV1_Format",(function(){return Je})),n.d(r,"RGBA_PVRTC_4BPPV1_Format",(function(){return Ke})),n.d(r,"RGBA_S3TC_DXT1_Format",(function(){return We})),n.d(r,"RGBA_S3TC_DXT3_Format",(function(){return qe})),n.d(r,"RGBA_S3TC_DXT5_Format",(function(){return Ye})),n.d(r,"RGBDEncoding",(function(){return Qn})),n.d(r,"RGBEEncoding",(function(){return Xn})),n.d(r,"RGBEFormat",(function(){return De})),n.d(r,"RGBFormat",(function(){return Ie})),n.d(r,"RGBIntegerFormat",(function(){return Ve})),n.d(r,"RGBM16Encoding",(function(){return Jn})),n.d(r,"RGBM7Encoding",(function(){return Kn})),n.d(r,"RGB_ETC1_Format",(function(){return Qe})),n.d(r,"RGB_ETC2_Format",(function(){return $e})),n.d(r,"RGB_PVRTC_2BPPV1_Format",(function(){return Ze})),n.d(r,"RGB_PVRTC_4BPPV1_Format",(function(){return Xe})),n.d(r,"RGB_S3TC_DXT1_Format",(function(){return je})),n.d(r,"RGFormat",(function(){return Ge})),n.d(r,"RGIntegerFormat",(function(){return Ue})),n.d(r,"RawShaderMaterial",(function(){return Vd})),n.d(r,"Ray",(function(){return bi})),n.d(r,"Raycaster",(function(){return Sm})),n.d(r,"RectAreaLight",(function(){return _g})),n.d(r,"RedFormat",(function(){return Be})),n.d(r,"RedIntegerFormat",(function(){return ze})),n.d(r,"ReinhardToneMapping",(function(){return Xt})),n.d(r,"RepeatWrapping",(function(){return oe})),n.d(r,"ReplaceStencilOp",(function(){return or})),n.d(r,"ReverseSubtractEquation",(function(){return bt})),n.d(r,"RingBufferGeometry",(function(){return Ld})),n.d(r,"RingGeometry",(function(){return Ld})),n.d(r,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return An})),n.d(r,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Sn})),n.d(r,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return Tn})),n.d(r,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return Cn})),n.d(r,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return Pn})),n.d(r,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return Ln})),n.d(r,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return yn})),n.d(r,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return vn})),n.d(r,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return xn})),n.d(r,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return _n})),n.d(r,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return bn})),n.d(r,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return wn})),n.d(r,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return Mn})),n.d(r,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return En})),n.d(r,"Scene",(function(){return Th})),n.d(r,"SceneUtils",(function(){return Ev})),n.d(r,"ShaderChunk",(function(){return Qu})),n.d(r,"ShaderLib",(function(){return tl})),n.d(r,"ShaderMaterial",(function(){return ms})),n.d(r,"ShadowMaterial",(function(){return Ud})),n.d(r,"Shape",(function(){return ng})),n.d(r,"ShapeBufferGeometry",(function(){return Id})),n.d(r,"ShapeGeometry",(function(){return Id})),n.d(r,"ShapePath",(function(){return Ng})),n.d(r,"ShapeUtils",(function(){return _d})),n.d(r,"ShortType",(function(){return _e})),n.d(r,"Skeleton",(function(){return ip})),n.d(r,"SkeletonHelper",(function(){return Um})),n.d(r,"SkinnedMesh",(function(){return tp})),n.d(r,"SmoothShading",(function(){return pt})),n.d(r,"Sphere",(function(){return di})),n.d(r,"SphereBufferGeometry",(function(){return Nd})),n.d(r,"SphereGeometry",(function(){return Nd})),n.d(r,"Spherical",(function(){return Am})),n.d(r,"SphericalHarmonics3",(function(){return bg})),n.d(r,"SplineCurve",(function(){return Qf})),n.d(r,"SpotLight",(function(){return cg})),n.d(r,"SpotLightHelper",(function(){return km})),n.d(r,"Sprite",(function(){return jh})),n.d(r,"SpriteMaterial",(function(){return Lh})),n.d(r,"SrcAlphaFactor",(function(){return At})),n.d(r,"SrcAlphaSaturateFactor",(function(){return Ot})),n.d(r,"SrcColorFactor",(function(){return Tt})),n.d(r,"StaticCopyUsage",(function(){return Sr})),n.d(r,"StaticDrawUsage",(function(){return xr})),n.d(r,"StaticReadUsage",(function(){return wr})),n.d(r,"StereoCamera",(function(){return Wg})),n.d(r,"StreamCopyUsage",(function(){return Cr})),n.d(r,"StreamDrawUsage",(function(){return br})),n.d(r,"StreamReadUsage",(function(){return Er})),n.d(r,"StringKeyframeTrack",(function(){return cf})),n.d(r,"SubtractEquation",(function(){return _t})),n.d(r,"SubtractiveBlending",(function(){return mt})),n.d(r,"TOUCH",(function(){return $})),n.d(r,"TangentSpaceNormalMap",(function(){return er})),n.d(r,"TetrahedronBufferGeometry",(function(){return Od})),n.d(r,"TetrahedronGeometry",(function(){return Od})),n.d(r,"TextBufferGeometry",(function(){return Dd})),n.d(r,"TextGeometry",(function(){return Dd})),n.d(r,"Texture",(function(){return zr})),n.d(r,"TextureLoader",(function(){return Tf})),n.d(r,"TorusBufferGeometry",(function(){return Fd})),n.d(r,"TorusGeometry",(function(){return Fd})),n.d(r,"TorusKnotBufferGeometry",(function(){return kd})),n.d(r,"TorusKnotGeometry",(function(){return kd})),n.d(r,"Triangle",(function(){return uo})),n.d(r,"TriangleFanDrawMode",(function(){return jn})),n.d(r,"TriangleStripDrawMode",(function(){return Hn})),n.d(r,"TrianglesDrawMode",(function(){return Vn})),n.d(r,"TubeBufferGeometry",(function(){return Bd})),n.d(r,"TubeGeometry",(function(){return Bd})),n.d(r,"UVMapping",(function(){return Qt})),n.d(r,"Uint16Attribute",(function(){return cv})),n.d(r,"Uint16BufferAttribute",(function(){return Co})),n.d(r,"Uint32Attribute",(function(){return pv})),n.d(r,"Uint32BufferAttribute",(function(){return Po})),n.d(r,"Uint8Attribute",(function(){return av})),n.d(r,"Uint8BufferAttribute",(function(){return Eo})),n.d(r,"Uint8ClampedAttribute",(function(){return uv})),n.d(r,"Uint8ClampedBufferAttribute",(function(){return So})),n.d(r,"Uniform",(function(){return wm})),n.d(r,"UniformsLib",(function(){return $u})),n.d(r,"UniformsUtils",(function(){return ds})),n.d(r,"UnsignedByteType",(function(){return ve})),n.d(r,"UnsignedInt248Type",(function(){return Pe})),n.d(r,"UnsignedIntType",(function(){return Me})),n.d(r,"UnsignedShort4444Type",(function(){return Te})),n.d(r,"UnsignedShort5551Type",(function(){return Ce})),n.d(r,"UnsignedShort565Type",(function(){return Ae})),n.d(r,"UnsignedShortType",(function(){return be})),n.d(r,"VSMShadowMap",(function(){return at})),n.d(r,"Vector2",(function(){return Or})),n.d(r,"Vector3",(function(){return Wr})),n.d(r,"Vector4",(function(){return Ur})),n.d(r,"VectorKeyframeTrack",(function(){return hf})),n.d(r,"Vertex",(function(){return iv})),n.d(r,"VertexColors",(function(){return Zy})),n.d(r,"VideoTexture",(function(){return Ap})),n.d(r,"WebGL1Renderer",(function(){return Mh})),n.d(r,"WebGLCubeRenderTarget",(function(){return Ms})),n.d(r,"WebGLMultisampleRenderTarget",(function(){return Hr})),n.d(r,"WebGLRenderTarget",(function(){return Vr})),n.d(r,"WebGLRenderTargetCube",(function(){return bv})),n.d(r,"WebGLRenderer",(function(){return wh})),n.d(r,"WebGLUtils",(function(){return gh})),n.d(r,"WireframeGeometry",(function(){return zd})),n.d(r,"WireframeHelper",(function(){return vv})),n.d(r,"WrapAroundEnding",(function(){return zn})),n.d(r,"XHRLoader",(function(){return xv})),n.d(r,"ZeroCurvatureEnding",(function(){return kn})),n.d(r,"ZeroFactor",(function(){return Et})),n.d(r,"ZeroSlopeEnding",(function(){return Bn})),n.d(r,"ZeroStencilOp",(function(){return rr})),n.d(r,"sRGBEncoding",(function(){return qn}));var i={};n.r(i),n.d(i,"create",(function(){return Pv})),n.d(i,"clone",(function(){return Lv})),n.d(i,"copy",(function(){return Iv})),n.d(i,"fromValues",(function(){return Rv})),n.d(i,"set",(function(){return Nv})),n.d(i,"identity",(function(){return Ov})),n.d(i,"transpose",(function(){return Dv})),n.d(i,"invert",(function(){return Fv})),n.d(i,"adjoint",(function(){return kv})),n.d(i,"determinant",(function(){return Bv})),n.d(i,"multiply",(function(){return zv})),n.d(i,"translate",(function(){return Gv})),n.d(i,"scale",(function(){return Uv})),n.d(i,"rotate",(function(){return Vv})),n.d(i,"rotateX",(function(){return Hv})),n.d(i,"rotateY",(function(){return jv})),n.d(i,"rotateZ",(function(){return Wv})),n.d(i,"fromTranslation",(function(){return qv})),n.d(i,"fromScaling",(function(){return Yv})),n.d(i,"fromRotation",(function(){return Xv})),n.d(i,"fromXRotation",(function(){return Zv})),n.d(i,"fromYRotation",(function(){return Kv})),n.d(i,"fromZRotation",(function(){return Jv})),n.d(i,"fromRotationTranslation",(function(){return Qv})),n.d(i,"fromQuat2",(function(){return $v})),n.d(i,"getTranslation",(function(){return tx})),n.d(i,"getScaling",(function(){return ex})),n.d(i,"getRotation",(function(){return nx})),n.d(i,"fromRotationTranslationScale",(function(){return rx})),n.d(i,"fromRotationTranslationScaleOrigin",(function(){return ix})),n.d(i,"fromQuat",(function(){return ox})),n.d(i,"frustum",(function(){return sx})),n.d(i,"perspectiveNO",(function(){return ax})),n.d(i,"perspective",(function(){return ux})),n.d(i,"perspectiveZO",(function(){return lx})),n.d(i,"perspectiveFromFieldOfView",(function(){return cx})),n.d(i,"orthoNO",(function(){return hx})),n.d(i,"ortho",(function(){return px})),n.d(i,"orthoZO",(function(){return dx})),n.d(i,"lookAt",(function(){return fx})),n.d(i,"targetTo",(function(){return gx})),n.d(i,"str",(function(){return mx})),n.d(i,"frob",(function(){return yx})),n.d(i,"add",(function(){return vx})),n.d(i,"subtract",(function(){return xx})),n.d(i,"multiplyScalar",(function(){return _x})),n.d(i,"multiplyScalarAndAdd",(function(){return bx})),n.d(i,"exactEquals",(function(){return wx})),n.d(i,"equals",(function(){return Mx})),n.d(i,"mul",(function(){return Ex})),n.d(i,"sub",(function(){return Sx}));var o={};n.r(o),n.d(o,"create",(function(){return Tx})),n.d(o,"clone",(function(){return Cx})),n.d(o,"fromValues",(function(){return Ax})),n.d(o,"copy",(function(){return Px})),n.d(o,"set",(function(){return Lx})),n.d(o,"add",(function(){return Ix})),n.d(o,"subtract",(function(){return Rx})),n.d(o,"multiply",(function(){return Nx})),n.d(o,"divide",(function(){return Ox})),n.d(o,"ceil",(function(){return Dx})),n.d(o,"floor",(function(){return Fx})),n.d(o,"min",(function(){return kx})),n.d(o,"max",(function(){return Bx})),n.d(o,"round",(function(){return zx})),n.d(o,"scale",(function(){return Gx})),n.d(o,"scaleAndAdd",(function(){return Ux})),n.d(o,"distance",(function(){return Vx})),n.d(o,"squaredDistance",(function(){return Hx})),n.d(o,"length",(function(){return jx})),n.d(o,"squaredLength",(function(){return Wx})),n.d(o,"negate",(function(){return qx})),n.d(o,"inverse",(function(){return Yx})),n.d(o,"normalize",(function(){return Xx})),n.d(o,"dot",(function(){return Zx})),n.d(o,"cross",(function(){return Kx})),n.d(o,"lerp",(function(){return Jx})),n.d(o,"random",(function(){return Qx})),n.d(o,"transformMat2",(function(){return $x})),n.d(o,"transformMat2d",(function(){return t_})),n.d(o,"transformMat3",(function(){return e_})),n.d(o,"transformMat4",(function(){return n_})),n.d(o,"rotate",(function(){return r_})),n.d(o,"angle",(function(){return i_})),n.d(o,"zero",(function(){return o_})),n.d(o,"str",(function(){return s_})),n.d(o,"exactEquals",(function(){return a_})),n.d(o,"equals",(function(){return u_})),n.d(o,"len",(function(){return l_})),n.d(o,"sub",(function(){return c_})),n.d(o,"mul",(function(){return h_})),n.d(o,"div",(function(){return p_})),n.d(o,"dist",(function(){return d_})),n.d(o,"sqrDist",(function(){return f_})),n.d(o,"sqrLen",(function(){return g_})),n.d(o,"forEach",(function(){return m_}));var s={};n.r(s),n.d(s,"create",(function(){return y_})),n.d(s,"clone",(function(){return v_})),n.d(s,"length",(function(){return x_})),n.d(s,"fromValues",(function(){return __})),n.d(s,"copy",(function(){return b_})),n.d(s,"set",(function(){return w_})),n.d(s,"add",(function(){return M_})),n.d(s,"subtract",(function(){return E_})),n.d(s,"multiply",(function(){return S_})),n.d(s,"divide",(function(){return T_})),n.d(s,"ceil",(function(){return C_})),n.d(s,"floor",(function(){return A_})),n.d(s,"min",(function(){return P_})),n.d(s,"max",(function(){return L_})),n.d(s,"round",(function(){return I_})),n.d(s,"scale",(function(){return R_})),n.d(s,"scaleAndAdd",(function(){return N_})),n.d(s,"distance",(function(){return O_})),n.d(s,"squaredDistance",(function(){return D_})),n.d(s,"squaredLength",(function(){return F_})),n.d(s,"negate",(function(){return k_})),n.d(s,"inverse",(function(){return B_})),n.d(s,"normalize",(function(){return z_})),n.d(s,"dot",(function(){return G_})),n.d(s,"cross",(function(){return U_})),n.d(s,"lerp",(function(){return V_})),n.d(s,"hermite",(function(){return H_})),n.d(s,"bezier",(function(){return j_})),n.d(s,"random",(function(){return W_})),n.d(s,"transformMat4",(function(){return q_})),n.d(s,"transformMat3",(function(){return Y_})),n.d(s,"transformQuat",(function(){return X_})),n.d(s,"rotateX",(function(){return Z_})),n.d(s,"rotateY",(function(){return K_})),n.d(s,"rotateZ",(function(){return J_})),n.d(s,"angle",(function(){return Q_})),n.d(s,"zero",(function(){return $_})),n.d(s,"str",(function(){return tb})),n.d(s,"exactEquals",(function(){return eb})),n.d(s,"equals",(function(){return nb})),n.d(s,"sub",(function(){return rb})),n.d(s,"mul",(function(){return ib})),n.d(s,"div",(function(){return ob})),n.d(s,"dist",(function(){return sb})),n.d(s,"sqrDist",(function(){return ab})),n.d(s,"len",(function(){return ub})),n.d(s,"sqrLen",(function(){return lb})),n.d(s,"forEach",(function(){return cb}));var a={};n.r(a),n.d(a,"create",(function(){return hb})),n.d(a,"clone",(function(){return pb})),n.d(a,"fromValues",(function(){return db})),n.d(a,"copy",(function(){return fb})),n.d(a,"set",(function(){return gb})),n.d(a,"add",(function(){return mb})),n.d(a,"subtract",(function(){return yb})),n.d(a,"multiply",(function(){return vb})),n.d(a,"divide",(function(){return xb})),n.d(a,"ceil",(function(){return _b})),n.d(a,"floor",(function(){return bb})),n.d(a,"min",(function(){return wb})),n.d(a,"max",(function(){return Mb})),n.d(a,"round",(function(){return Eb})),n.d(a,"scale",(function(){return Sb})),n.d(a,"scaleAndAdd",(function(){return Tb})),n.d(a,"distance",(function(){return Cb})),n.d(a,"squaredDistance",(function(){return Ab})),n.d(a,"length",(function(){return Pb})),n.d(a,"squaredLength",(function(){return Lb})),n.d(a,"negate",(function(){return Ib})),n.d(a,"inverse",(function(){return Rb})),n.d(a,"normalize",(function(){return Nb})),n.d(a,"dot",(function(){return Ob})),n.d(a,"cross",(function(){return Db})),n.d(a,"lerp",(function(){return Fb})),n.d(a,"random",(function(){return kb})),n.d(a,"transformMat4",(function(){return Bb})),n.d(a,"transformQuat",(function(){return zb})),n.d(a,"zero",(function(){return Gb})),n.d(a,"str",(function(){return Ub})),n.d(a,"exactEquals",(function(){return Vb})),n.d(a,"equals",(function(){return Hb})),n.d(a,"sub",(function(){return Wb})),n.d(a,"mul",(function(){return qb})),n.d(a,"div",(function(){return Yb})),n.d(a,"dist",(function(){return Xb})),n.d(a,"sqrDist",(function(){return Zb})),n.d(a,"len",(function(){return Kb})),n.d(a,"sqrLen",(function(){return Jb})),n.d(a,"forEach",(function(){return Qb}));var u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"video-content"},[n("video",{directives:[{name:"show",rawName:"v-show",value:t.videoUrl,expression:"videoUrl"}],ref:"mediaa",attrs:{preload:"",autoplay:"",crossorigin:"Anonymous",name:"media",width:t.width,height:t.height}},[n("source",{attrs:{src:t.videoUrl,type:"video/mp4"}})]),n("canvas",{ref:"canvas",staticClass:"video-canvas",style:t.canvasStyle()}),n("canvas",{directives:[{name:"show",rawName:"v-show",value:t.clipCanvas,expression:"clipCanvas"}],staticClass:"clip-canvas",style:t.canvasStyle(),attrs:{id:"clipCanvas"}}),t.clipBtn?n("div",{staticClass:"clip-btn",style:t.clipBtnStyle()},[n("div",{on:{click:t.cancelClip}},[t._v("取消")]),n("div",{on:{click:t.saveClip}},[t._v("保存")]),n("div",{on:{click:t.searchClip}},[t._v("查询")])]):t._e(),n("div",{ref:"controls",staticClass:"my-controls"},[n("div",{staticClass:"controls_crop"},[n("i",{staticClass:"el-icon-crop",on:{click:t.cropClick}})]),n("div",{staticClass:"controls_btn"},[n("i",{class:t.btnClass,on:{click:t.btnClick}})]),n("div",{staticClass:"controls_currentBar"},[n("el-progress",{attrs:{percentage:t.percentage,format:t.format}})],1)])])},l=[],c=(n("e25e"),n("d401"),n("0d03"),n("d3b7"),n("25f0"),n("99af"),n("4160"),n("159b"),{props:["videoUrl","trackData","start_time","end_time","width","height","gap"],data:function(){return{playing:!0,btnClass:"el-icon-video-pause",percentage:0,timerStart:0,currentTime:0,context:"",ratio:0,ramf:"",clipCanvas:!1,clipBtnX:0,clipBtnY:0,clipBtn:!1,clipImage:"",x:0,y:0,w:0,h:0}},watch:{videoUrl:function(){this.videoUrl&&(this.currentTime=this.start_time,this.percentage=0),this.$refs.mediaa.load(),window.cancelAnimationFrame(this.ramf),this.context&&this.context.clearRect(0,0,this.width,this.height)},trackData:function(){this.trackData&&(this.percentage=0)}},mounted:function(){this.$refs.controls.width=this.width,this.videoUrl&&this.trackData&&(this.$refs.mediaa.addEventListener("play",this.playEvent),this.$refs.mediaa.addEventListener("pause",this.pauseEvent))},beforeDestroy:function(){window.cancelAnimationFrame(this.ramf)},methods:{cropClick:function(){"el-icon-video-pause"===this.btnClass&&this.btnClick();var t=this;this.clipBtn=!1,this.initCanvas(),this.clipCanvas=!0;var e=this.width,n=this.height,r=document.querySelector("#clipCanvas"),i=r.getContext("2d"),o=window.devicePixelRatio||1,s=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,a=o/s;r.width=this.width*a,r.height=this.height*a,i.scale(a,a),i.fillStyle="rgba(0, 0, 0, 0, 0.1)",i.strokeStyle="rgba(0,143,255,1)",i.fillRect(0,0,e,n);var u=null,l={};function c(t,r,o,s){i.clearRect(0,0,e,n),i.beginPath(),i.globalCompositeOperation="source-over",i.fillRect(0,0,e,n),i.globalCompositeOperation="destination-out",i.fillRect(t,r,o,s),i.globalCompositeOperation="source-over",i.strokeRect(t,r,o,s),l={x:t,y:r,w:o,h:s}}function h(t,e,n){var r=document.createElement("canvas");r.height=t.h*n,r.width=t.w*n;var i=r.getContext("2d"),o=e.getImageData(t.x*n,t.y*n,t.w*n,t.h*n);return i.putImageData(o,0,0),r.toDataURL("image/jpeg")}r.onmousedown=function(t){u={x:t.offsetX,y:t.offsetY}},r.onmousemove=function(t){u&&c(u.x,u.y,t.offsetX-u.x,t.offsetY-u.y)},document.addEventListener("mouseup",(function(){if(u){t.clipBtnX=u.x,t.clipBtnY=u.y,t.clipBtn=!0,u=null;var e=document.createElement("canvas");e.width=t.width*t.ratio,e.height=t.height*t.ratio;var n=e.getContext("2d");n.drawImage(t.$refs.mediaa,0,0,t.width*t.ratio,t.height*t.ratio,0,0,t.width*t.ratio,t.height*t.ratio),t.clipImage=h(l,n,t.ratio)}}))},cancelClip:function(){this.clipCanvas=!1,this.clipBtn=!1,this.btnClick()},saveClip:function(){this.clipCanvas=!1,this.clipBtn=!1;var t=document.createElement("a");t.href=this.clipImage,t.setAttribute("download","截图.jpeg"),t.click()},searchClip:function(){this.$emit("searchClip")},clipBtnStyle:function(){return{top:this.clipBtnY-20+"px",left:this.clipBtnX+"px"}},btnClick:function(){var t=this.$refs.mediaa;this.clipCanvas=!1,"el-icon-video-pause"===this.btnClass?(this.btnClass="el-icon-video-play",t.pause()):(this.btnClass="el-icon-video-pause",t.play())},format:function(t){if(isNaN(t))return"00:00";var e=parseInt(t/100*(this.end_time-this.start_time)),n=0;e>=60&&(n=parseInt(e/60).toString(),e=parseInt(e%60).toString());var r=parseInt(this.end_time-this.start_time),i=0;return r>=60&&(i=parseInt(r/60).toString(),r=parseInt(r%60).toString()),isNaN(n)||isNaN(e)?"":"".concat(n,":").concat(e,"/").concat(i,":").concat(r)},canvasStyle:function(){return{width:this.width+"px",height:this.height+"px"}},playEvent:function(){this.timerStart=performance.now(),0===this.currentTime&&(this.currentTime=this.start_time),this.$refs.mediaa.currentTime=this.currentTime,this.btnClass="el-icon-video-pause";var t=(this.$refs.mediaa.currentTime-this.start_time)/(this.end_time-this.start_time);t>1&&(t=1),t>0&&(this.percentage=100*t),this.initCanvas(),this.draw()},pauseEvent:function(){this.currentTime=this.$refs.mediaa.currentTime},draw:function(){var t=performance.now()-this.timerStart;if(t>=this.gap){var e=this.$refs.mediaa;if(e.currentTime<=this.end_time){var n=e.currentTime,r=this.getFrame(n),i=(this.$refs.mediaa.currentTime-this.start_time)/(this.end_time-this.start_time);i>1&&(i=1),i>0&&(this.percentage=100*i),this.drawRect(r)}else e.pause(),this.percentage=100,this.btnClass="el-icon-video-play";this.timerStart=performance.now()}this.ramf=requestAnimationFrame(this.draw)},getFrame:function(t){if(this.trackData.length>0){var e=[],n=this.$refs.mediaa.videoWidth/this.width;this.ratio=n;var r=Math.round(1e3*t/this.gap);return r>this.trackData[this.trackData.length-1].i?null:(this.trackData.forEach((function(t){t.i==r&&e.push({x:t.x/n,y:t.y/n,width:t.w/n,height:t.h/n})})),e)}return[]},drawRect:function(t){t&&t.length>0?(this.context.clearRect(0,0,this.width,this.height),this.context.strokeStyle="#FFA500",this.context.strokeRect(t[0].x,t[0].y,t[0].width,t[0].height)):t||this.context.clearRect(0,0,this.width,this.height)},initCanvas:function(){var t=this.$refs.canvas;this.context=t.getContext("2d");var e=window.devicePixelRatio||1,n=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,r=e/n;t.width=this.width*r,t.height=this.height*r,this.context.scale(r,r)}}}),h=c,p=(n("6bed"),n("2877")),d=Object(p["a"])(h,u,l,!1,null,"a0dbdae4",null),f=(d.exports,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")}),g=[],m=(n("a9e3"),n("4795"),n("5c96")),y=null,v={props:{validTime:{type:Number,default:0},hidMsg:{type:Boolean,default:!1}},data:function(){return{time:0,timeTemp:null}},methods:{pageOperate:function(){this.time=0}},mounted:function(){var t=this;this.timeTemp=setInterval((function(){t.time++,t.hidMsg&&t.time<60*t.validTime?y&&y.close():t.time==60*t.validTime&&(y=m["Message"].warning({dangerouslyUseHTMLString:!0,message:'<div>您已长时间未操作系统，为了安全已自动退出，请重新登录。<span id="errorMsg" style="margin-left: 30px;color: #1890FF;cursor: pointer">我知道了</span></div>',showClose:!1,duration:0}),t.$emit("getExpiry",!0),clearInterval(t.timeTemp),document.getElementById("errorMsg").addEventListener("click",(function(){y.close()})))}),1e3),window.addEventListener("mousedown",this.pageOperate),window.addEventListener("keypress",this.pageOperate),window.addEventListener("popstate",this.pageOperate)},beforeDestroy:function(){window.removeEventListener("mousedown",this.pageOperate),window.removeEventListener("keypress",this.pageOperate),window.removeEventListener("popstate",this.pageOperate),clearInterval(this.timeTemp)}},x=v,_=Object(p["a"])(x,f,g,!1,null,null,null),b=(_.exports,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map_container"},[n("div",{staticClass:"map_container_buttons"},[t.showFloorTool?n("div",{staticClass:"map_container_buttons_floor",on:{click:t.handleFloorClick}},[n("span",{staticClass:"map_container_buttons_floor_terminal",attrs:{"data-set":"terminal"}},[t._v(" "+t._s(t.currentTerminal)+" "),n("i",{staticClass:"el-icon-caret-bottom",attrs:{"data-set":"terminal"}})]),t._l(t.floor[t.currentTerminal],(function(e){return n("span",{key:e,staticClass:"map_container_buttons_floor_floor",style:t.floorStyle(e),attrs:{"data-set":"floor"}},[t._v(" "+t._s(e)+" "),n("svg-icon",{directives:[{name:"show",rawName:"v-show",value:t.floorHaveTrack(e),expression:"floorHaveTrack(item)"}],staticClass:"map_container_buttons_floor_hint",attrs:{"icon-class":"haveTrackImg"}})],1)})),n("div",{staticClass:"map_container_buttons_floor_list",style:t.termianOptionStyle},t._l(t.terminal,(function(e){return n("span",{key:e,staticClass:"map_container_buttons_floor_list_item",style:t.terminalButtonStyle(e),attrs:{"data-set":"check"}},[n("span",{staticStyle:{position:"relative"},attrs:{"data-set":"check"}},[t._v(" "+t._s(e)+" "),n("svg-icon",{directives:[{name:"show",rawName:"v-show",value:t.terminalHaveTrack(e),expression:"terminalHaveTrack(item)"}],staticClass:"map_container_buttons_terminal_hint",attrs:{"icon-class":"haveTrackImg"}})],1)])})),0)],2):t._e()]),t.showZoomTool?n("div",{staticClass:"map_container_buttons_zoom"},[n("span",{on:{click:t.mapZoomIn}},[n("img",{attrs:{src:t.zoominIcon,alt:""}})]),n("span",{on:{click:t.mapZoomOut}},[n("img",{attrs:{src:t.zoomoutIcon,alt:""}})]),n("span",{on:{click:t.mapRecover}},[n("img",{attrs:{src:t.resizeIcon,alt:""}})])]):t._e(),t.oldmap?n("div",{staticClass:"map_container_content",style:t.containerStyle},[t.showTrackMap?n("mapTrack",{ref:"map",attrs:{tracksData:t.tracksData,ownerTrackData:t.ownerTrackData,place:t.place,zoom:t.height}}):n("iframe",{staticStyle:{width:"100%","min-height":"338px",background:"#ccc"},attrs:{src:t.frameUrl,id:"threeMap",name:"threeMap"}})],1):n("svg-map",t._g({ref:"svgmap",attrs:{tracksData:t.tracksData,ownerTrackData:t.ownerTrackData,floorIndex:t.floorIndex,place:t.place,avatar:t.avatar,realtimeTs:t.realtimeTs,lastFloorId:t.lastFloorId,isRealTimeTrack:t.isRealTimeTrack,heatmapFloorData:t.heatMapData[t.currentFloor.id],cameras:t.cameras,setPointList:t.pointList,holeData:t.holeData,currentFloor:t.currentFloor}},t.$listeners))],1)}),w=[],M=n("2909"),E=(n("45fc"),n("d81d"),n("c975"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"mapContainer",class:t.getClass},[t.isRealTimeTrack&&t.tracksData.length>0?n("img",{staticClass:"icon_img",style:t.iconStyle,attrs:{src:t.userImg,width:"30",height:"35",alt:""}}):t._e(),n("canvas",{ref:"map_canvas",staticClass:"can can_size",attrs:{id:"mapCanvas"},on:{mousemove:t.showTrackDate}}),n("img",{staticClass:"map_img_size",attrs:{src:t.mapImg,alt:""}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showDateTip,expression:"showDateTip"}],staticClass:"date_tip",style:t.dateTipStyle()},[t._v(" "+t._s(t.dateTip)),n("br")])])}),S=[],T=n("1da1"),C=(n("ac1f"),n("1276"),n("cb29"),n("96cf"),n("406e"));const A={handleTrackData(t,e=1){function n(){self.onmessage=function(t){const e=[];t.data.data.forEach(n=>{e.push({pos_x:n.point.x/t.data.ratio,pos_y:n.point.y/t.data.ratio,timestamp:n.timestamp})}),self.postMessage(e)}}let r=new Blob(["("+n.toString()+")()"]),i=window.URL.createObjectURL(r),o=new Worker(i);return o.postMessage({data:t,ratio:e}),o},getTime(t){let e=new Date(1e3*t),n={};function r(t){return t>=10?t.toString():"0"+t}let i=new Array("星期日","星期一","星期二","星期三","星期四","星期五","星期六");return n.nowYear=e.getFullYear(),n.nowMonth=r(e.getMonth()+1),n.nowDate=r(e.getDate()),n.nowDay=i[e.getDay()],n.nowHour=r(e.getHours()),n.nowMin=r(e.getMinutes()),n.nowSec=r(e.getSeconds()),n}};var P=A;const L=function(t,e="min",n){let r=[];return console.log(n),n?t.forEach(t=>{r.push(t[n])}):r=t,console.log(r),"min"===e?Math.min(...r):Math.max(...r)};var I={props:{tracksData:{type:Array,default:function(){return[]}},cameraList:{type:Array,default:function(){return[]}},ownerTrackData:{type:Array,default:function(){return[]}},isRealTimeTrack:{type:Boolean,default:function(){return!1}},isShowTrackTime:{type:Boolean,default:function(){return!0}},userImg:{type:String,default:function(){return""}},userPid:{type:String,default:""},zoom:{type:Boolean,default:!1},place:{type:String,default:""}},data:function(){return{mapImg:"",context:{},cacheCanvas:"",cacheContext:"",width:0,height:0,imgWidth:0,imgheight:0,ratio:0,canvasRatio:1,iconStyle:{},historyTracks:[],realtimeTracks:[],timer:0,mouseTimer:0,dateTipX:0,dateTipY:0,showDateTip:!1,dateTip:"",scale:1}},computed:{getClass:function(){return this.zoom?"map__container map_size_height":"map__container map_size_width"}},watch:{tracksData:{handler:function(t){var e=this;return Object(T["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.isRealTimeTrack?e.realtimeTracks.length>0&&t.length>0?t[0].timestamp!==e.realtimeTracks[0].timestamp&&(e.realtimeTracks=t):e.realtimeTracks=t:t&&t.length>=0&&(e.webworker?e.webworker.postMessage({data:t,ratio:e.ratio}):e.webworker=P.handleTrackData(t,e.ratio),e.webworker.onmessage=function(t){e.historyTracks=t.data,e.initCanvas(),e.showTrack(e.historyTracks),console.log("begin")});case 1:case"end":return n.stop()}}),n)})))()},immediate:!0},ownerTrackData:{handler:function(t){0!==t.length&&(this.initCanvas(),t.length>0&&this.showPeerTrack())},immediate:!0},place:{handler:function(){var t=this;this.$nextTick((function(){t.place&&(t.mapImg=t.place,t.imgWidth=t.place.split("/").reverse()[0].split(".")[0].split("_").reverse()[0].split("*")[0],t.imgheight=t.place.split("/").reverse()[0].split(".")[0].split("_").reverse()[0].split("*")[1],t.ratio=t.imgWidth/t.$refs.mapContainer.offsetWidth,t.width=t.$refs.mapContainer.offsetWidth,t.height=t.imgheight/t.ratio,console.log("reset place"),t.initCanvas(),Object(C["a"])(t.$refs.mapContainer,t.resize))}))},immediate:!0},userPid:function(){console.log("reset pid"),this.initCanvas()},realtimeTracks:function(t,e){t.length>0&&(0!==e.length&&t[0].timestamp!==e[0].timestamp||0===e.length)&&this.showTrack()}},mounted:function(){var t=this.$refs.map_canvas;this.context=t.getContext("2d");var e=window.devicePixelRatio||1,n=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1;this.canvasRatio=e/n,this.isRealTimeTrack||(this.cacheCanvas=document.createElement("canvas"),this.cacheContext=this.cacheCanvas.getContext("2d"))},beforeDestroy:function(){Object(C["b"])(this.$refs.mapContainer,this.resize),clearTimeout(this.timer),this.webworker&&this.webworker.terminate()},methods:{resize:function(){this.ratio=this.imgWidth/this.$refs.mapContainer.offsetWidth,this.width=this.$refs.mapContainer.offsetWidth,this.height=this.imgheight/this.ratio,console.log("reset size"),!this.isRealTimeTrack&&this.width&&(this.webworker?this.webworker.postMessage({data:this.tracksData,ratio:this.ratio}):this.webworker=P.handleTrackData(this.tracksData,this.ratio))},changePosition:function(t){if(0!==t.pos_x&&0!==t.pos_y){var e=t.pos_y/this.ratio,n=t.pos_x/this.ratio;return{top:e-35+"px",left:n-15+"px"}}return{display:"none"}},drawPi:function(t,e){var n=this.context;n.beginPath(),n.arc(t/this.ratio,e/this.ratio,2,0,2*Math.PI,!0),n.fill()},drawCachePi:function(t,e){var n=this.cacheContext;n.beginPath(),n.arc(t,e,2,0,2*Math.PI,!0),n.fill()},showTrack:function(t){var e=this,n=0,r=function t(){e.context.fillStyle="rgb(255, ".concat(255-parseInt(255*n/e.tracksData.length),", 0)"),e.drawPi(e.realtimeTracks[n].pos_x,e.realtimeTracks[n].pos_y),e.iconStyle=e.changePosition(e.tracksData[n]),e.$emit("trackChange",e.realtimeTracks[n].timestamp),n++,console.log(n),n<e.realtimeTracks.length?e.timer=setTimeout((function(){t()}),1e3):clearTimeout(e.timer)};this.isRealTimeTrack?r():(t.forEach((function(n,r){e.cacheContext.fillStyle="rgb(255, ".concat(255-parseInt(255*r/t.length),", 0)"),e.drawCachePi(n.pos_x,n.pos_y)})),this.ownerTrackData&&(this.cacheContext.fillStyle="rgb(0, 100, 0)",this.ownerTrackData.forEach((function(t){e.drawCachePi(t.pos_x/e.ratio,t.pos_y/e.ratio)}))),this.context.drawImage(this.cacheCanvas,0,0,this.width,this.height))},showPeerTrack:function(){var t=this;this.ownerTrackData&&(this.cacheContext.fillStyle="rgb(0, 100, 0)",this.ownerTrackData.forEach((function(e){t.drawCachePi(e.pos_x/t.ratio,e.pos_y/t.ratio)}))),this.context.drawImage(this.cacheCanvas,0,0,this.width,this.height)},initCanvas:function(){var t=this.$refs.map_canvas;t.width=this.width*this.canvasRatio,t.height=this.height*this.canvasRatio,this.cacheCanvas&&(this.cacheCanvas.width=this.width*this.canvasRatio,this.cacheCanvas.height=this.height*this.canvasRatio,this.cacheContext.scale(this.canvasRatio,this.canvasRatio)),this.context.scale(this.canvasRatio,this.canvasRatio),this.showDateTip=!1,clearTimeout(this.timer)},showTrackDate:function(t){var e=this;this.mouseTimer&&clearTimeout(this.mouseTimer),this.mouseTimer=setTimeout((function(){var n=e.$refs.map_canvas.getBoundingClientRect(),r=t.clientX-n.left,i=t.clientY-n.top;e.dateTipX=r,e.dateTipY=i,e.showDateTip=!1,e.dateTip="";for(var o=e.historyTracks.length-1;o>=0;o--)if(r>e.historyTracks[o].pos_x-2&&r<e.historyTracks[o].pos_x+2&&i>e.historyTracks[o].pos_y-2&&i<e.historyTracks[o].pos_y+2){e.showDateTip=!0;var s=P.getTime(e.historyTracks[o].timestamp/1e3);e.dateTip="".concat(s.nowYear,"/").concat(s.nowMonth,"/").concat(s.nowDate," ").concat(s.nowHour,":").concat(s.nowMin,":").concat(s.nowSec),console.log(o+"bingo"+e.historyTracks[o].timestamp);break}}),1e3)},dateTipStyle:function(){return{left:this.dateTipX-15+"px",top:this.dateTipY-40+"px"}},mapZoomIn:function(){console.log("zoom in"),this.scale<3&&(this.scale+=1,this.$refs.mapContainer.style.height=100*this.scale+"%")},mapZoomOut:function(){console.log("zoom out"),this.scale>1&&(this.scale-=1,this.$refs.mapContainer.style.height=100*this.scale+"%")},mapZoomRecover:function(){console.log("recover"),this.scale=1,this.$refs.mapContainer.style.height="100%"}}},R=I,N=(n("98be"),Object(p["a"])(R,E,S,!1,null,"2d66982a",null)),O=N.exports,D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",{staticClass:"map",attrs:{id:"map-box"}},[r("div",{staticClass:"map_container",attrs:{id:"map-avatar"},on:{click:t.handleClick,contextmenu:function(e){return e.preventDefault(),t.closePath.apply(null,arguments)}}},[r("svg",{staticStyle:{width:"100%",height:"100%",position:"absolute","user-select":"none"},attrs:{id:"mapsvg",draggable:"false",xmlns:"http://www.w3.org/2000/svg",version:"1.1"}},[t._l(t.pointList,(function(e,n){return r("circle",{key:n,attrs:{name:"svgcircle",cx:e.x,cy:e.y,r:2/t.currentLevel,fill:"red"}})})),r("path",{attrs:{fill:"none",opacity:".5",stroke:"red",id:"mapPath"}}),r("path",{attrs:{fill:"none",stroke:"blue",id:"strokePath"}}),r("circle",{attrs:{id:"mousepoint",r:3/t.currentLevel,fill:"none",cx:t.pointStyle.left,cy:t.pointStyle.top}}),r("g",{attrs:{id:"gtrack"}}),r("g",{attrs:{id:"ptrack"}}),r("g",{attrs:{id:"track"}})],2),r("div",{staticClass:"heat_map"},[r("div",{ref:"heatmap",staticStyle:{width:"100%",height:"100%"}}),t._l(t.cameras,(function(e){return[r("img",{key:e.id,staticClass:"map_content_icon",style:t.setIconStyle(e),attrs:{src:t.Icon,alt:""},on:{click:function(n){return t.handleCameraClick(e)}}})]})),t.tracksData.length>0&&0===t.ownerTrackData.length&&t.lastFloorId?t._l(t.floorIndex,(function(e,n){return r("div",{key:e.end_point_index,staticClass:"monitor_container",style:t.getStyleByIndex(e.end_point_index,e.end_point_hint)},[t.lastFloorId===t.currentFloor.id&&n===t.floorIndex.length-1?r("img",{staticClass:"monitor_play",attrs:{src:t.monitorIcon,alt:""},on:{click:t.showTrackVideo}}):r("img",{staticClass:"monitor_play",attrs:{src:t.checkFloor,alt:""}}),r("div",{staticClass:"monitor_content"},[r("span",[t._v(t._s(e.end_point_hint))])])])})):t._e(),t.holeData.length>0?t._l(t.holeData,(function(e){return r("el-tooltip",{key:e.start_point_index,style:t.getHoleStyleByIndex(e.start_point_index),attrs:{content:new Date(e.start_time).toLocaleString()+" ~ "+new Date(e.end_time).toLocaleString(),placement:"top"}},[r("img",{staticClass:"map_content_icon",attrs:{src:n("f632"),alt:""},on:{click:function(n){return t.handleholeClick(e)}}})])})):t._e(),[r("img",{directives:[{name:"show",rawName:"v-show",value:t.realtimeTs>=0,expression:"realtimeTs >= 0"}],ref:"avatar",staticClass:"avatar",attrs:{src:t.avatar,alt:""}})]],2)])])},F=[],k=(n("b680"),n("aecf")),B=n.n(k),z=n("b77d"),G=n.n(z),U=n("c209"),V=n.n(U),H={props:{maxLevel:{type:Number,default:3},minLevel:{type:Number,default:.5},setPointList:{type:Array,default:function(){return[]}},place:{type:String,default:""},isRealTimeTrack:{type:Boolean,default:!1},tracksData:{type:Array,default:function(){return[]}},ownerTrackData:{type:Array,default:function(){return[]}},heatmapFloorData:{type:Array,default:function(){return[]}},cameras:{type:Array,default:function(){return[]}},currentFloor:{type:Object,default:{}},lastFloorId:{type:Number,default:1},floorIndex:{type:Array,default:function(){return[]}},holeData:{type:Array,default:function(){return[]}},realtimeTs:{type:Number,default:-1},avatar:{type:String,default:""}},data:function(){return{drawPoint:!1,pointList:[],currentLevel:1,pointStyle:{},imgScale:1,loaded:!1,showIcon:!0,Icon:B.a,monitorIcon:G.a,checkFloor:V.a,iconStyle:{},historyTracks:[],DELTA:1.1}},watch:{setPointList:{handler:function(t){this.addPath(t)}},place:{handler:function(){var t=this;this.loaded=!1,this.showIcon=!1,this.imgLoadPromise?this.imgLoadPromise.then((function(e){t.clearPath(),t.oDiv.removeChild(e),t.clearTracks(),t.clearPtracks(),t.clearGtracks(),t.imgLoadPromise=t.initMap()}))["catch"]((function(){console.warn("地图加载失败。。。")})):this.imgLoadPromise=this.initMap()}},tracksData:{handler:function(){this.loaded&&this.initTracksData()}},ownerTrackData:{handler:function(){this.loaded&&this.initOwnerTracksData()}},heatmapFloorData:function(){this.setHeatmapData()},realtimeTs:function(t,e){if(0!==this.historyTracks.length){if(t>e)for(var n=e+1;n<=t;n++){var r=this.historyTracks[n].timestamp;document.getElementById("data-id-".concat(r))&&document.getElementById("data-id-".concat(r)).setAttribute("fill","rgb(255, 255, 0)")}else for(var i=e;i>t;i--)if(this.historyTracks[i]){var o=this.historyTracks[i].timestamp;document.getElementById("data-id-".concat(o))&&document.getElementById("data-id-".concat(o)).setAttribute("fill","#B5AEAE")}this.$refs.avatar.style.top=this.historyTracks[t].pos_y-35+"px",this.$refs.avatar.style.left=this.historyTracks[t].pos_x-16+"px"}}},mounted:function(){this.oBox=document.querySelector("#map-box"),this.oDiv=document.querySelector("#map-avatar"),this.imgLoadPromise=this.initMap(),this.initListener()},beforeDestroy:function(){clearTimeout(this.timer),this.webworker&&this.webworker.terminate(),this.xwebworker&&this.xwebworker.terminate(),this.pwebworker&&this.pwebworker.terminate()},methods:{initMap:function(){var t=this;if(this.place){var e=new Image;return e.id="mapimg",e.src=this.place,e.style.width="100%",e.draggable=!1,console.log(this.place),new Promise((function(n,r){e.onload=function(){t.initSize(e),t.initTracksData(),t.initOwnerTracksData(),t.loaded=!0,t.$emit("onload"),n(e)},e.onerror=function(){r(e)}}))}},initListener:function(){var t,e,n=this,r=this.oDiv,i=this.oBox,o=this.DELTA,s=function(i){var o=n.getTransform(r);t=i.clientX-o.transX,e=i.clientY-o.transY,document.addEventListener("mousemove",a),document.addEventListener("mouseup",u)},a=function(i){var o=n.getTransform(r).multiple,s=i.clientX-t,a=i.clientY-e;r.style.transform="matrix(".concat(o,", 0, 0, ").concat(o,", ").concat(s,", ").concat(a,")"),n.getMapTransform()},u=function t(e){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",t)},l=function(t){var e=n.getTransform(r),s=e.multiple,a=e.transX,u=e.transY,l=i.getBoundingClientRect(),c=l.top,h=l.left,p=o;t.deltaY>0&&(p=1/o);var d=s*p;d>n.maxLevel?(p=n.maxLevel/s,s=n.maxLevel):d<n.minLevel?(p=n.minLevel/s,s=n.minLevel):s=d,n.zoomPoint(p),n.currentLevel=s;var f={x:(p-1)*r.clientWidth*.5,y:(p-1)*r.clientHeight*.5},g=t.clientX-h,m=t.clientY-c,y={transX:a-=(p-1)*(g-a)-f.x,transY:u-=(p-1)*(m-u)-f.y};r.style.transform="matrix(".concat(s,", 0, 0, ").concat(s,", ").concat(y.transX,", ").concat(y.transY,")"),n.getMapTransform(),t.preventDefault()},c=function(){i.addEventListener("mousedown",s),i.addEventListener("wheel",l)};c()},initSize:function(t){var e,n,r=this.oBox.getBoundingClientRect(),i=r.width,o=r.height,s=t.naturalWidth,a=t.naturalHeight,u=s/a,l=i/o;u>=l?s>i?(e=i,n=i/s*a):(e=s,n=a):a>o?(e=o/a*s,n=o):(e=s,n=a),this.oDiv.style.width=e+"px",this.oDiv.style.height=n+"px",this.width=e,this.height=n,this.imgScale=a/n,this.oDiv.appendChild(t),this.transformX=.5*(i-e),this.transformY=.5*(o-n),this.oDiv.style.transform="translate("+this.transformX+"px, "+this.transformY+"px)",this.getMapTransform(),this.svgPathEle=document.getElementById("mapPath"),this.setPointList.length>0&&this.addPath(this.setPointList)},initMousePoint:function(){var t=this,e=function(e){t.pointStyle={left:e.offsetX,top:e.offsetY}},n=function(t){document.getElementById("mousepoint").setAttribute("fill","none")},r=function(t){document.getElementById("mousepoint").setAttribute("fill","#87CEFA")};this.oDiv.addEventListener("mousemove",e),this.oDiv.addEventListener("mouseleave",n),this.oDiv.addEventListener("mouseenter",r)},startDrawPoint:function(){this.clearPath(),this.drawPoint=!0,this.initMousePoint()},getTransform:function(t){var e=getComputedStyle(t).transform.split(",");return{transX:isNaN(+e[e.length-2])?0:+e[e.length-2],transY:isNaN(+e[e.length-1].split(")")[0])?0:+e[e.length-1].split(")")[0],multiple:+e[3]}},endDrawPoint:function(){this.drawPoint=!1},zoomPoint:function(t){if(this.svgPathEle){var e=document.getElementsByName("svgcircle");e.forEach((function(e){var n=e.getAttribute("r");e.setAttribute("r",n*t)}))}},handleClick:function(t){if(this.drawPoint){var e=t.offsetX,n=t.offsetY;if(this.svgPathEle||(this.svgPathEle=document.getElementById("mapPath")),this.pointList.push({x:e,y:n}),1===this.pointList.length)this.svgPathEle.setAttribute("d","M ".concat(e,", ").concat(n));else if(this.pointList.length>1){var r=this.svgPathEle.getAttribute("d");this.svgPathEle.setAttribute("d","".concat(r," L ").concat(e,", ").concat(n))}}},closePath:function(){this.svgPathEle&&(this.svgPathEle.setAttribute("fill","red"),this.endDrawPoint(),this.getPointList(),this.getCurrentFloor(),this.svgPathEle.addEventListener("click",this.getStroke))},getStroke:function(){var t=L(this.pointList,"min","x"),e=L(this.pointList,"min","y"),n=L(this.pointList,"max","x")-t,r=L(this.pointList,"max","y")-e;document.getElementById("strokePath").setAttribute("d","M ".concat(t,", ").concat(e," L ").concat(t+n," ").concat(e,"L ").concat(t+n," ").concat(e+r,"L ").concat(t," ").concat(e+r,"z"))},clearPath:function(){this.svgPathEle&&(this.svgPathEle.removeAttribute("d"),this.svgPathEle.setAttribute("fill","none"),this.svgPathEle.removeEventListener("click",this.getStroke),document.getElementById("strokePath").removeAttribute("d"),this.pointList=[])},getPointList:function(){var t=this,e=[];this.pointList.forEach((function(n){e.push({x:n.x*t.imgScale,y:n.y*t.imgScale})})),this.$emit("getPointList",e)},addPath:function(t){var e=this;this.pointList=t,this.d="",t.forEach((function(t,n){0===n?e.d="M ".concat(t.x/e.imgScale,", ").concat(t.y/e.imgScale):e.d+="L ".concat(t.x/e.imgScale,", ").concat(t.y/e.imgScale)})),this.d&&(this.svgPathEle=document.getElementById("mapPath"),this.svgPathEle.setAttribute("d",this.d),this.svgPathEle.setAttribute("fill","red"))},showTrack:function(t,e){var n=this;if(t){var r="";this.isRealTimeTrack?t.forEach((function(t,e){r&&r.pos_x===t.pos_x&&r.pos_y===t.pos_y||(r=t,e>n.realtimeTs?n.drawPtrackPi(t.pos_x,t.pos_y,"#B5AEAE",t.timestamp):n.drawPtrackPi(t.pos_x,t.pos_y,"rgb(255, 255, 0)",t.timestamp))})):1===e?(t.forEach((function(e,i){r&&r.pos_x===e.pos_x&&r.pos_y===e.pos_y||(r=e,n.drawTrackPi(e.pos_x,e.pos_y,"rgb(255, ".concat(255-parseInt(255*i/t.length),", 0)"),i))})),t.length>0&&(this.showIcon=!0)):2===e&&t.forEach((function(t){r&&r.pos_x===t.pos_x&&r.pos_y===t.pos_y||(r=t,n.drawGtrackPi(t.pos_x,t.pos_y,"#21FEDC"))})),this.$emit("trackDone")}},changePosition:function(t){if(t&&t.pos_x>0&&t.pos_y>0){var e=t.pos_y,n=t.pos_x;return{top:e-47+"px",left:n-42.5+"px"}}return{display:"none"}},getStyleByIndex:function(t,e){if(!this.showIcon||!e)return{display:"none"};var n=this.historyTracks[t];if(n&&n.pos_x>0&&n.pos_y>0){var r=n.pos_y,i=n.pos_x;return{top:r-47+"px",left:i-42.5+"px"}}return{display:"none"}},getHoleStyleByIndex:function(t){var e=this.historyTracks[t];if(e&&e.pos_x>0&&e.pos_y>0){var n=e.pos_y,r=e.pos_x;return{top:n-8+"px",left:r-8+"px"}}return{display:"none"}},drawTrackPi:function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",t),r.setAttribute("cy",e),r.setAttribute("r",2),r.setAttribute("fill",n),document.getElementById("track").appendChild(r)},drawGtrackPi:function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",t),r.setAttribute("cy",e),r.setAttribute("r",2),r.setAttribute("fill",n),document.getElementById("gtrack").appendChild(r)},drawPtrackPi:function(t,e,n,r){if(!document.getElementById("data-id-".concat(r))){var i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",2),i.setAttribute("id","data-id-".concat(r)),i.setAttribute("fill",n),document.getElementById("ptrack").appendChild(i)}},clearTracks:function(){document.getElementById("track").innerHTML=""},clearPtracks:function(){document.getElementById("ptrack").innerHTML=""},clearGtracks:function(){document.getElementById("gtrack").innerHTML=""},mapZoomIn:function(){var t=this.getTransform(this.oDiv),e=t.multiple,n=t.transX,r=t.transY;e*=this.DELTA,this.oDiv.style.transform="matrix(".concat(e,", 0, 0, ").concat(e,", ").concat(n,", ").concat(r,")"),this.getMapTransform()},mapZoomOut:function(){var t=this.getTransform(this.oDiv),e=t.multiple,n=t.transX,r=t.transY;e/=this.DELTA,this.oDiv.style.transform="matrix(".concat(e,", 0, 0, ").concat(e,", ").concat(n,", ").concat(r,")"),this.getMapTransform()},mapZoomRecover:function(){var t=this.getTransform(this.oDiv);t.transX,t.transY;this.oDiv.style.transform="matrix(".concat(1,", 0, 0, ",1,", ",this.transformX,", ").concat(this.transformY,")"),this.getMapTransform()},getMapTransform:function(){var t=this.oDiv.getBoundingClientRect(),e=t.top,n=t.left,r=t.width,i=t.height;this.$emit("getTranslate",{top:e,left:n,width:r,height:i,imgScale:this.imgScale,currentLevel:this.currentLevel})},initHeatmap:function(t){this.heatmapMax=t,this.heatmapInstance||(this.heatmapInstance=window.h337.create({container:this.$refs.heatmap}))},setHeatmapData:function(){var t=this,e=[];this.heatmapFloorData&&this.heatmapFloorData.forEach((function(n){e.push({value:n.value,x:Number((n.x/t.imgScale).toFixed(6)),y:Number((n.y/t.imgScale).toFixed(6))})})),this.heatmapInstance.setData({data:e,max:this.heatmapMax||10})},setIconStyle:function(t){return 0===t.pos_x&&0===t.pos_y?{display:"none"}:{top:"".concat(t.pos_y/this.imgScale-24,"px"),left:"".concat(t.pos_x/this.imgScale-10,"px")}},initTracksData:function(){var t=this;this.isRealTimeTrack?this.initPatchTracksData():(this.clearTracks(),this.tracksData&&this.tracksData.length>0&&(this.webworker?this.webworker.postMessage({data:this.tracksData,ratio:this.imgScale}):(this.webworker=P.handleTrackData(this.tracksData,this.imgScale),this.webworker.onmessage=function(e){t.historyTracks=e.data,t.showTrack(t.historyTracks,1),console.log("begin")})))},initPatchTracksData:function(){var t=this;this.clearPtracks(),this.tracksData&&this.tracksData.length>0&&(this.pwebworker?this.pwebworker.postMessage({data:this.tracksData,ratio:this.imgScale}):(this.pwebworker=P.handleTrackData(this.tracksData,this.imgScale),this.pwebworker.onmessage=function(e){t.historyTracks=e.data,t.showTrack(t.historyTracks,3),t.avatar&&t.realtimeTs>=0&&(t.$refs.avatar.style.top=t.historyTracks[t.realtimeTs].pos_y-35+"px",t.$refs.avatar.style.left=t.historyTracks[t.realtimeTs].pos_x-16+"px"),console.log("begin")}))},initOwnerTracksData:function(){var t=this;this.clearGtracks(),this.ownerTrackData&&this.ownerTrackData.length>0&&(this.xwebworker?this.xwebworker.postMessage({data:this.ownerTrackData,ratio:this.imgScale}):(this.xwebworker=P.handleTrackData(this.ownerTrackData,this.imgScale),this.xwebworker.onmessage=function(e){t.historyOwnerTracks=e.data,t.showTrack(t.historyOwnerTracks,2),console.log("begin")}))},handleMapOnload:function(){this.$emit("onload")},handleCameraClick:function(t){this.$emit("cameraIconClick",t)},showTrackVideo:function(){this.$emit("showLastVideo")},handleholeClick:function(t){this.$emit("showBodyDialog",t)},getCurrentFloor:function(){this.$emit("getCurrentFloor",this.currentFloor)}}},j=H,W=(n("1110"),Object(p["a"])(j,D,F,!1,null,"7a6e252f",null)),q=W.exports,Y={props:{floors:{type:Array,default:function(){return[]}},allTracks:{type:Array,default:function(){return[]}},personalAllTracks:{type:Array,default:function(){return[]}},frameUrl:{type:String,default:function(){return""}},camerasData:{type:Array,default:function(){return[]}},cameraType:{type:Object,default:function(){return{DID:"./DID.svg",FID:"./FID.svg"}}},isRealTimeTrack:{type:Boolean,default:!1},height:{type:Boolean,default:!0},containerStyle:{type:Object,default:function(){return{}}},showZoomTool:{type:Boolean,default:!0},showFloorTool:{type:Boolean,default:!0},oldmap:{type:Boolean,default:!0},setPointList:{type:Object,default:function(){return{}}},heatMapData:{type:Object,default:function(){return{}}},showCameraIcon:{type:Boolean,default:!1},lastFloorId:{type:Number,default:0},realtimeTs:{type:Number,default:-1},avatar:{type:String,default:""},currentFloorId:{type:Number,default:0}},components:{mapTrack:O,SvgMap:q},data:function(){return{terminal:[],floor:"",currentTerminal:"",currentFloor:{},haveTrackFloors:[],showTOptions:!1,showTrackMap:!0,place:"",tracksData:[],floorIndex:[],holeData:[],ownerTrackData:[],currentMapId:"",pointList:[],cameras:[],zoominIcon:n("9c8b"),zoomoutIcon:n("8673"),resizeIcon:n("de26")}},computed:{termianOptionStyle:function(){return this.showTOptions?{display:"block"}:{}}},watch:{floors:{handler:function(t){t&&t.length>0&&this.setFloorData()},immediate:!0},allTracks:{handler:function(t){var e=this;if(t){if(!this.showTrackMap){var n=document.getElementById("threeMap").contentWindow;n.initMap&&n.clearPoi()}this.lastFloorId&&this.currentFloor.id!==this.lastFloorId&&this.floors.some((function(t){return t.id===e.lastFloorId&&(e.currentFloor=t,e.currentTerminal=t.terminal,e.mapChange(t.id,t.type,t.source),!0)})),this.tracksData=[],this.floorIndex=[],this.holeData=[],t.some((function(t){if(e.currentFloor.id===t.floor_id){if(e.tracksData=t.trajectory,e.floorIndex=t.floor_index,t.miss_outs&&(e.holeData=t.miss_outs),1===e.currentFloor.type){var n=document.getElementById("threeMap").contentWindow;n.initMap&&e.drawTracksData(n)}return!0}return!1}))}},immediate:!0},personalAllTracks:{handler:function(t){var e=this;t&&(this.ownerTrackData=[],t.some((function(t){if(e.currentFloor.id===t.floor_id)return e.ownerTrackData=t.trajectory,!0})))},immediate:!0},showCameraIcon:{handler:function(){this.getFloorCameras()}},currentFloorId:{handler:function(t){var e=this;this.floors.some((function(n){if(n.id===t)return e.currentFloor=n,e.getFloorCameras(),e.mapChange(n.id,n.type,n.source),!0}))}}},created:function(){var t=this;window.iframeOnload=function(){var e=document.getElementById("threeMap").contentWindow;e.initMap(t.currentMapId),t.threeMapZoom=e.getLevel(),t.drawTracksData(e)},window.handleMapClick=function(e){e.graphic&&e.graphic.symbol&&e.graphic.symbol.id&&t.getCameraVideo(e.graphic.symbol.id)}},methods:{mapZoomIn:function(){if(this.currentMapId){var t=document.getElementById("threeMap").contentWindow;t.initMap&&t.mapZoomIn()}else this.oldmap?this.$refs.map.mapZoomIn():this.$refs.svgmap.mapZoomIn()},mapZoomOut:function(){if(this.currentMapId){var t=document.getElementById("threeMap").contentWindow;t.initMap&&t.mapZoomOut()}else this.oldmap?this.$refs.map.mapZoomOut():this.$refs.svgmap.mapZoomOut()},mapRecover:function(){if(this.currentMapId){var t=document.getElementById("threeMap").contentWindow;t.initMap&&t.setLevel()}else this.oldmap?this.$refs.map.mapZoomRecover():this.$refs.svgmap.mapZoomRecover()},handleFloorClick:function(t){var e=this;t.target.dataset.set&&("terminal"===t.target.dataset.set?this.showTerminalOptions():"floor"===t.target.dataset.set?this.floors.some((function(n){if(n.terminal===e.currentTerminal&&t.target.innerText===n.floor)return e.currentFloor=n,e.$emit("setCurrentFloor",n.id),e.getFloorCameras(),e.mapChange(n.id,n.type,n.source),!0})):"check"===t.target.dataset.set&&this.switchTermianl(t))},mapChange:function(t,e,n){var r=this;this.tracksData=[],this.ownerTrackData=[],this.holeData=[],this.allTracks.some((function(e){if(e.floor_id===t)return r.tracksData=e.trajectory,r.floorIndex=e.floor_index,e.miss_outs&&(r.holeData=e.miss_outs),!0})),this.personalAllTracks.some((function(e){if(e.floor_id===t)return r.ownerTrackData=e.trajectory,!0})),2===e?(this.showTrackMap=!0,this.place=n,this.setPList()):1===e&&(this.showTrackMap=!1,this.$nextTick((function(){r.switchMap(n)})))},switchMap:function(t){var e=document.getElementById("threeMap").contentWindow;this.currentMapId=t,e.initMap&&(e.initMap(t),this.drawTracksData(e))},switchTermianl:function(t){-1!==this.terminal.indexOf(t.target.innerText)&&(this.currentTerminal=t.target.innerText,this.showTOptions=!1)},floorStyle:function(t){if(this.currentFloor.terminal===this.currentTerminal&&this.currentFloor.floor===t)return{backgroundColor:"#F4AD41",color:"#fff"}},floorHaveTrack:function(t){var e=this,n=!1;return this.personalAllTracks.length<1&&this.allTracks.length<1||[].concat(Object(M["a"])(this.personalAllTracks),Object(M["a"])(this.allTracks)).some((function(r){var i=e.getFloorInfo(r.floor_id);return i.terminal===e.currentTerminal&&i.floor===t&&(n=!0,!0)})),n},terminalHaveTrack:function(t){var e=this,n=!1;return this.personalAllTracks.length<1&&this.allTracks.length<1||[].concat(Object(M["a"])(this.personalAllTracks),Object(M["a"])(this.allTracks)).some((function(r){var i=e.getFloorInfo(r.floor_id);return i.terminal===t&&(n=!0,!0)})),n},getFloorInfo:function(t){var e={};return this.floors.some((function(n){if(n.id===t)return e=n,!0})),e},terminalButtonStyle:function(t){return t===this.currentTerminal?{background:"#F5F7FA",color:"#1989FA"}:{}},showTerminalOptions:function(){this.showTOptions?this.showTOptions=!1:this.showTOptions=!0},setFloorData:function(){var t,e,n=this,r=[],i={};this.floors.forEach((function(o){-1===r.indexOf(o.terminal)?(r.push(o.terminal),i[o.terminal]=[o.floor]):i[o.terminal].push(o.floor),o.id===n.currentFloorId&&(t=o.terminal,e=o)})),this.terminal=r,this.floor=i,t&&e?(this.currentTerminal=t,this.currentFloor=e):(this.currentTerminal=this.terminal[0],this.currentFloor=this.floors[0]),this.getFloorCameras(),2===this.currentFloor.type?(this.showTrackMap=!0,this.currentMapId="",this.place=this.currentFloor.source,this.setPList()):1===this.currentFloor.type&&(this.showTrackMap=!1,this.$nextTick((function(){n.switchMap(n.currentFloor.source)})))},drawTracksData:function(t){var e=this;this.tracksData.forEach((function(n){var r="";n.camera_id&&(r=e.getCameraType(n.camera_id)),t.drawCameraLoc(n.point,r,n.camera_id)}))},getCameraType:function(t){var e=this,n="";return this.camerasData.some((function(r){if(r.id===t)return n=1===r.type?e.cameraType.DID:e.cameraType.FID,!0})),n},getCameraVideo:function(t){var e=this;this.camerasData.some((function(n){if(n.id===t)return e.$emit("getVideoUrl",t),!0}))},setPList:function(){this.setPointList[this.currentFloor.id]?this.pointList=this.setPointList[this.currentFloor.id]:this.pointList=[]},getFloorCameras:function(){var t=this,e=[];this.showCameraIcon?(this.camerasData.forEach((function(n){t.currentFloor.floor_code===n.floor&&e.push(n)})),this.cameras=e):this.cameras=e}}},X=Y,Z=(n("df50"),Object(p["a"])(X,b,w,!1,null,"abcd2436",null)),K=Z.exports;
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const J="127",Q={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},$={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},tt=0,et=1,nt=2,rt=3,it=0,ot=1,st=2,at=3,ut=0,lt=1,ct=2,ht=1,pt=2,dt=0,ft=1,gt=2,mt=3,yt=4,vt=5,xt=100,_t=101,bt=102,wt=103,Mt=104,Et=200,St=201,Tt=202,Ct=203,At=204,Pt=205,Lt=206,It=207,Rt=208,Nt=209,Ot=210,Dt=0,Ft=1,kt=2,Bt=3,zt=4,Gt=5,Ut=6,Vt=7,Ht=0,jt=1,Wt=2,qt=0,Yt=1,Xt=2,Zt=3,Kt=4,Jt=5,Qt=300,$t=301,te=302,ee=303,ne=304,re=306,ie=307,oe=1e3,se=1001,ae=1002,ue=1003,le=1004,ce=1004,he=1005,pe=1005,de=1006,fe=1007,ge=1007,me=1008,ye=1008,ve=1009,xe=1010,_e=1011,be=1012,we=1013,Me=1014,Ee=1015,Se=1016,Te=1017,Ce=1018,Ae=1019,Pe=1020,Le=1021,Ie=1022,Re=1023,Ne=1024,Oe=1025,De=Re,Fe=1026,ke=1027,Be=1028,ze=1029,Ge=1030,Ue=1031,Ve=1032,He=1033,je=33776,We=33777,qe=33778,Ye=33779,Xe=35840,Ze=35841,Ke=35842,Je=35843,Qe=36196,$e=37492,tn=37496,en=37808,nn=37809,rn=37810,on=37811,sn=37812,an=37813,un=37814,ln=37815,cn=37816,hn=37817,pn=37818,dn=37819,fn=37820,gn=37821,mn=36492,yn=37840,vn=37841,xn=37842,_n=37843,bn=37844,wn=37845,Mn=37846,En=37847,Sn=37848,Tn=37849,Cn=37850,An=37851,Pn=37852,Ln=37853,In=2200,Rn=2201,Nn=2202,On=2300,Dn=2301,Fn=2302,kn=2400,Bn=2401,zn=2402,Gn=2500,Un=2501,Vn=0,Hn=1,jn=2,Wn=3e3,qn=3001,Yn=3007,Xn=3002,Zn=3003,Kn=3004,Jn=3005,Qn=3006,$n=3200,tr=3201,er=0,nr=1,rr=0,ir=7680,or=7681,sr=7682,ar=7683,ur=34055,lr=34056,cr=5386,hr=512,pr=513,dr=514,fr=515,gr=516,mr=517,yr=518,vr=519,xr=35044,_r=35048,br=35040,wr=35045,Mr=35049,Er=35041,Sr=35046,Tr=35050,Cr=35042,Ar="100",Pr="300 es";function Lr(){}Object.assign(Lr.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners,r=n[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,r=e.length;n<r;n++)e[n].call(this,t);t.target=null}}});const Ir=[];for(let mM=0;mM<256;mM++)Ir[mM]=(mM<16?"0":"")+mM.toString(16);let Rr=1234567;const Nr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=Ir[255&t]+Ir[t>>8&255]+Ir[t>>16&255]+Ir[t>>24&255]+"-"+Ir[255&e]+Ir[e>>8&255]+"-"+Ir[e>>16&15|64]+Ir[e>>24&255]+"-"+Ir[63&n|128]+Ir[n>>8&255]+"-"+Ir[n>>16&255]+Ir[n>>24&255]+Ir[255&r]+Ir[r>>8&255]+Ir[r>>16&255]+Ir[r>>24&255];return i.toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:function(t,e,n){return(1-n)*t+n*e},damp:function(t,e,n,r){return Nr.lerp(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(Nr.euclideanModulo(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Rr=t%2147483647),Rr=16807*Rr%2147483647,(Rr-1)/2147483646},degToRad:function(t){return t*Nr.DEG2RAD},radToDeg:function(t){return t*Nr.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),u=s(n/2),l=o((e+r)/2),c=s((e+r)/2),h=o((e-r)/2),p=s((e-r)/2),d=o((r-e)/2),f=s((r-e)/2);switch(i){case"XYX":t.set(a*c,u*h,u*p,a*l);break;case"YZY":t.set(u*p,a*c,u*h,a*l);break;case"ZXZ":t.set(u*h,u*p,a*c,a*l);break;case"XZX":t.set(a*c,u*f,u*d,a*l);break;case"YXY":t.set(u*d,a*c,u*f,a*l);break;case"ZYZ":t.set(u*f,u*d,a*c,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Or{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){const t=Math.atan2(-this.y,-this.x)+Math.PI;return t}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Or.prototype.isVector2=!0;class Dr{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,u){const l=this.elements;return l[0]=t,l[1]=r,l[2]=s,l[3]=e,l[4]=i,l[5]=a,l[6]=n,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[3],a=n[6],u=n[1],l=n[4],c=n[7],h=n[2],p=n[5],d=n[8],f=r[0],g=r[3],m=r[6],y=r[1],v=r[4],x=r[7],_=r[2],b=r[5],w=r[8];return i[0]=o*f+s*y+a*_,i[3]=o*g+s*v+a*b,i[6]=o*m+s*x+a*w,i[1]=u*f+l*y+c*_,i[4]=u*g+l*v+c*b,i[7]=u*m+l*x+c*w,i[2]=h*f+p*y+d*_,i[5]=h*g+p*v+d*b,i[8]=h*m+p*x+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],l=t[8];return e*o*l-e*s*u-n*i*l+n*s*a+r*i*u-r*o*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],l=t[8],c=l*o-s*u,h=s*a-l*i,p=u*i-o*a,d=e*c+n*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=c*f,t[1]=(r*u-l*n)*f,t[2]=(s*n-r*o)*f,t[3]=h*f,t[4]=(l*e-r*a)*f,t[5]=(r*i-s*e)*f,t[6]=p*f,t[7]=(n*a-u*e)*f,t[8]=(o*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,s){const a=Math.cos(i),u=Math.sin(i);return this.set(n*a,n*u,-n*(a*o+u*s)+o+t,-r*u,r*a,-r*(-u*o+a*s)+s+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],u=r[4],l=r[7];return r[0]=e*i+n*a,r[3]=e*o+n*u,r[6]=e*s+n*l,r[1]=-n*i+e*a,r[4]=-n*o+e*u,r[7]=-n*s+e*l,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let Fr;Dr.prototype.isMatrix3=!0;const kr={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Fr&&(Fr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Fr.width=t.width,Fr.height=t.height;const n=Fr.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Fr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}};let Br=0;class zr extends Lr{constructor(t=zr.DEFAULT_IMAGE,e=zr.DEFAULT_MAPPING,n=se,r=se,i=de,o=me,s=Re,a=ve,u=1,l=Wn){super(),Object.defineProperty(this,"id",{value:Br++}),this.uuid=Nr.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=u,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Or(0,0),this.repeat=new Or(1,1),this.center=new Or(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Nr.generateUUID()),!e&&void 0===t.images[r.uuid]){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Gr(r[t].image)):e.push(Gr(r[t]))}else e=Gr(r);t.images[r.uuid]={uuid:r.uuid,url:e}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Qt)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case oe:t.x=t.x-Math.floor(t.x);break;case se:t.x=t.x<0?0:1;break;case ae:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case oe:t.y=t.y-Math.floor(t.y);break;case se:t.y=t.y<0?0:1;break;case ae:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function Gr(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?kr.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zr.DEFAULT_IMAGE=void 0,zr.DEFAULT_MAPPING=Qt,zr.prototype.isTexture=!0;class Ur{constructor(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const o=.01,s=.1,a=t.elements,u=a[0],l=a[4],c=a[8],h=a[1],p=a[5],d=a[9],f=a[2],g=a[6],m=a[10];if(Math.abs(l-h)<o&&Math.abs(c-f)<o&&Math.abs(d-g)<o){if(Math.abs(l+h)<s&&Math.abs(c+f)<s&&Math.abs(d+g)<s&&Math.abs(u+p+m-3)<s)return this.set(1,0,0,0),this;e=Math.PI;const t=(u+1)/2,a=(p+1)/2,y=(m+1)/2,v=(l+h)/4,x=(c+f)/4,_=(d+g)/4;return t>a&&t>y?t<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=v/n,i=x/n):a>y?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=_/r):y<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=x/i,r=_/i),this.set(n,r,i,e),this}let y=Math.sqrt((g-d)*(g-d)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(y)<.001&&(y=1),this.x=(g-d)/y,this.y=(c-f)/y,this.z=(h-l)/y,this.w=Math.acos((u+p+m-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Ur.prototype.isVector4=!0;class Vr extends Lr{constructor(t,e,n){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Ur(0,0,t,e),this.scissorTest=!1,this.viewport=new Ur(0,0,t,e),n=n||{},this.texture=new zr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:de,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Vr.prototype.isWebGLRenderTarget=!0;class Hr extends Vr{constructor(t,e,n){super(t,e,n),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}Hr.prototype.isWebGLMultisampleRenderTarget=!0;class jr{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,i,o,s){let a=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3];const h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(0===s)return t[e+0]=a,t[e+1]=u,t[e+2]=l,void(t[e+3]=c);if(1===s)return t[e+0]=h,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(c!==f||a!==h||u!==p||l!==d){let t=1-s;const e=a*h+u*p+l*d+c*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,e*n);t=Math.sin(t*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*t+h*i,u=u*t+p*i,l=l*t+d*i,c=c*t+f*i,t===1-s){const t=1/Math.sqrt(a*a+u*u+l*l+c*c);a*=t,u*=t,l*=t,c*=t}}t[e]=a,t[e+1]=u,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,r,i,o){const s=n[r],a=n[r+1],u=n[r+2],l=n[r+3],c=i[o],h=i[o+1],p=i[o+2],d=i[o+3];return t[e]=s*d+l*c+a*p-u*h,t[e+1]=a*d+l*h+u*c-s*p,t[e+2]=u*d+l*p+s*h-a*c,t[e+3]=l*d-s*c-a*h-u*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,i=t._z,o=t._order,s=Math.cos,a=Math.sin,u=s(n/2),l=s(r/2),c=s(i/2),h=a(n/2),p=a(r/2),d=a(i/2);switch(o){case"XYZ":this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d;break;case"YXZ":this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d;break;case"ZXY":this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d;break;case"ZYX":this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d;break;case"YZX":this._x=h*l*c+u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c-h*p*d;break;case"XZY":this._x=h*l*c-u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],s=e[5],a=e[9],u=e[2],l=e[6],c=e[10],h=n+s+c;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(l-a)*t,this._y=(i-u)*t,this._z=(o-r)*t}else if(n>s&&n>c){const t=2*Math.sqrt(1+n-s-c);this._w=(l-a)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(i+u)/t}else if(s>c){const t=2*Math.sqrt(1+s-n-c);this._w=(i-u)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-n-s);this._w=(o-r)/t,this._x=(i+u)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Nr.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,s=e._x,a=e._y,u=e._z,l=e._w;return this._x=n*l+o*s+r*u-i*a,this._y=r*l+o*a+i*s-n*u,this._z=i*l+o*u+n*a-r*s,this._w=o*l-n*s-r*a-i*u,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*t._w+n*t._x+r*t._y+i*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const t=1-e;return this._w=t*o+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(a),l=Math.atan2(u,s),c=Math.sin((1-e)*l)/u,h=Math.sin(e*l)/u;return this._w=o*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}jr.prototype.isQuaternion=!0;class Wr{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Yr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Yr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,s=t.z,a=t.w,u=a*e+o*r-s*n,l=a*n+s*e-i*r,c=a*r+i*n-o*e,h=-i*e-o*n-s*r;return this.x=u*a+h*-i+l*-s-c*-o,this.y=l*a+h*-o+c*-i-u*-s,this.z=c*a+h*-s+u*-o-l*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,s=e.y,a=e.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return qr.copy(this).projectOnVector(t),this.sub(qr)}reflect(t){return this.sub(qr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Nr.clamp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Wr.prototype.isVector3=!0;const qr=new Wr,Yr=new jr;class Xr{constructor(t=new Wr(1/0,1/0,1/0),e=new Wr(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,u=t.length;a<u;a+=3){const u=t[a],l=t[a+1],c=t[a+2];u<e&&(e=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>o&&(o=l),c>s&&(s=c)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,u=t.count;a<u;a++){const u=t.getX(a),l=t.getY(a),c=t.getZ(a);u<e&&(e=u),l<n&&(n=l),c<r&&(r=c),u>i&&(i=u),l>o&&(o=l),c>s&&(s=c)}return this.min.set(e,n,r),this.max.set(i,o,s),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Kr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Wr),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Wr),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Jr.copy(e.boundingBox),Jr.applyMatrix4(t.matrixWorld),this.union(Jr));const n=t.children;for(let r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Wr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Kr),Kr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ii),oi.subVectors(this.max,ii),Qr.subVectors(t.a,ii),$r.subVectors(t.b,ii),ti.subVectors(t.c,ii),ei.subVectors($r,Qr),ni.subVectors(ti,$r),ri.subVectors(Qr,ti);let e=[0,-ei.z,ei.y,0,-ni.z,ni.y,0,-ri.z,ri.y,ei.z,0,-ei.x,ni.z,0,-ni.x,ri.z,0,-ri.x,-ei.y,ei.x,0,-ni.y,ni.x,0,-ri.y,ri.x,0];return!!ui(e,Qr,$r,ti,oi)&&(e=[1,0,0,0,1,0,0,0,1],!!ui(e,Qr,$r,ti,oi)&&(si.crossVectors(ei,ni),e=[si.x,si.y,si.z],ui(e,Qr,$r,ti,oi)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Wr),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){const e=Kr.copy(t).clamp(this.min,this.max);return e.sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Kr).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Zr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Zr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Zr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Zr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Zr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Zr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Zr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Zr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Zr)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Xr.prototype.isBox3=!0;const Zr=[new Wr,new Wr,new Wr,new Wr,new Wr,new Wr,new Wr,new Wr],Kr=new Wr,Jr=new Xr,Qr=new Wr,$r=new Wr,ti=new Wr,ei=new Wr,ni=new Wr,ri=new Wr,ii=new Wr,oi=new Wr,si=new Wr,ai=new Wr;function ui(t,e,n,r,i){for(let o=0,s=t.length-3;o<=s;o+=3){ai.fromArray(t,o);const s=i.x*Math.abs(ai.x)+i.y*Math.abs(ai.y)+i.z*Math.abs(ai.z),a=e.dot(ai),u=n.dot(ai),l=r.dot(ai);if(Math.max(-Math.max(a,u,l),Math.min(a,u,l))>s)return!1}return!0}const li=new Xr,ci=new Wr,hi=new Wr,pi=new Wr;class di{constructor(t=new Wr,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):li.setFromPoints(t).getCenter(n);let r=0;for(let i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Wr),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Xr),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){pi.subVectors(t,this.center);const e=pi.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(pi.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return hi.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ci.copy(t.center).add(hi)),this.expandByPoint(ci.copy(t.center).sub(hi)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const fi=new Wr,gi=new Wr,mi=new Wr,yi=new Wr,vi=new Wr,xi=new Wr,_i=new Wr;class bi{constructor(t=new Wr,e=new Wr(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Wr),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,fi)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Wr),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=fi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(fi.copy(this.direction).multiplyScalar(e).add(this.origin),fi.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){gi.copy(t).add(e).multiplyScalar(.5),mi.copy(e).sub(t).normalize(),yi.copy(this.origin).sub(gi);const i=.5*t.distanceTo(e),o=-this.direction.dot(mi),s=yi.dot(this.direction),a=-yi.dot(mi),u=yi.lengthSq(),l=Math.abs(1-o*o);let c,h,p,d;if(l>0)if(c=o*a-s,h=o*s-a,d=i*l,c>=0)if(h>=-d)if(h<=d){const t=1/l;c*=t,h*=t,p=c*(c+o*h+2*s)+h*(o*c+h+2*a)+u}else h=i,c=Math.max(0,-(o*h+s)),p=-c*c+h*(h+2*a)+u;else h=-i,c=Math.max(0,-(o*h+s)),p=-c*c+h*(h+2*a)+u;else h<=-d?(c=Math.max(0,-(-o*i+s)),h=c>0?-i:Math.min(Math.max(-i,-a),i),p=-c*c+h*(h+2*a)+u):h<=d?(c=0,h=Math.min(Math.max(-i,-a),i),p=h*(h+2*a)+u):(c=Math.max(0,-(o*i+s)),h=c>0?i:Math.min(Math.max(-i,-a),i),p=-c*c+h*(h+2*a)+u);else h=o>0?-i:i,c=Math.max(0,-(o*h+s)),p=-c*c+h*(h+2*a)+u;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),r&&r.copy(mi).multiplyScalar(h).add(gi),p}intersectSphere(t,e){fi.subVectors(t.center,this.origin);const n=fi.dot(this.direction),r=fi.dot(fi)-n*n,i=t.radius*t.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;const n=t.normal.dot(this.direction);return n*e<0}intersectBox(t,e){let n,r,i,o,s,a;const u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(t.min.x-h.x)*u,r=(t.max.x-h.x)*u):(n=(t.max.x-h.x)*u,r=(t.min.x-h.x)*u),l>=0?(i=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),n>o||i>r?null:((i>n||n!==n)&&(n=i),(o<r||r!==r)&&(r=o),c>=0?(s=(t.min.z-h.z)*c,a=(t.max.z-h.z)*c):(s=(t.max.z-h.z)*c,a=(t.min.z-h.z)*c),n>a||s>r?null:((s>n||n!==n)&&(n=s),(a<r||r!==r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,fi)}intersectTriangle(t,e,n,r,i){vi.subVectors(e,t),xi.subVectors(n,t),_i.crossVectors(vi,xi);let o,s=this.direction.dot(_i);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}yi.subVectors(this.origin,t);const a=o*this.direction.dot(xi.crossVectors(yi,xi));if(a<0)return null;const u=o*this.direction.dot(vi.cross(yi));if(u<0)return null;if(a+u>s)return null;const l=-o*yi.dot(_i);return l<0?null:this.at(l/s,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class wi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,o,s,a,u,l,c,h,p,d,f,g){const m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=r,m[1]=i,m[5]=o,m[9]=s,m[13]=a,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=p,m[7]=d,m[11]=f,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new wi).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Mi.setFromMatrixColumn(t,0).length(),i=1/Mi.setFromMatrixColumn(t,1).length(),o=1/Mi.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=o*l,n=o*c,r=s*l,i=s*c;e[0]=a*l,e[4]=-a*c,e[8]=u,e[1]=n+r*u,e[5]=t-i*u,e[9]=-s*a,e[2]=i-t*u,e[6]=r+n*u,e[10]=o*a}else if("YXZ"===t.order){const t=a*l,n=a*c,r=u*l,i=u*c;e[0]=t+i*s,e[4]=r*s-n,e[8]=o*u,e[1]=o*c,e[5]=o*l,e[9]=-s,e[2]=n*s-r,e[6]=i+t*s,e[10]=o*a}else if("ZXY"===t.order){const t=a*l,n=a*c,r=u*l,i=u*c;e[0]=t-i*s,e[4]=-o*c,e[8]=r+n*s,e[1]=n+r*s,e[5]=o*l,e[9]=i-t*s,e[2]=-o*u,e[6]=s,e[10]=o*a}else if("ZYX"===t.order){const t=o*l,n=o*c,r=s*l,i=s*c;e[0]=a*l,e[4]=r*u-n,e[8]=t*u+i,e[1]=a*c,e[5]=i*u+t,e[9]=n*u-r,e[2]=-u,e[6]=s*a,e[10]=o*a}else if("YZX"===t.order){const t=o*a,n=o*u,r=s*a,i=s*u;e[0]=a*l,e[4]=i-t*c,e[8]=r*c+n,e[1]=c,e[5]=o*l,e[9]=-s*l,e[2]=-u*l,e[6]=n*c+r,e[10]=t-i*c}else if("XZY"===t.order){const t=o*a,n=o*u,r=s*a,i=s*u;e[0]=a*l,e[4]=-c,e[8]=u*l,e[1]=t*c+i,e[5]=o*l,e[9]=n*c-r,e[2]=r*c-n,e[6]=s*l,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Si,t,Ti)}lookAt(t,e,n){const r=this.elements;return Pi.subVectors(t,e),0===Pi.lengthSq()&&(Pi.z=1),Pi.normalize(),Ci.crossVectors(n,Pi),0===Ci.lengthSq()&&(1===Math.abs(n.z)?Pi.x+=1e-4:Pi.z+=1e-4,Pi.normalize(),Ci.crossVectors(n,Pi)),Ci.normalize(),Ai.crossVectors(Pi,Ci),r[0]=Ci.x,r[4]=Ai.x,r[8]=Pi.x,r[1]=Ci.y,r[5]=Ai.y,r[9]=Pi.y,r[2]=Ci.z,r[6]=Ai.z,r[10]=Pi.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],s=n[4],a=n[8],u=n[12],l=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],g=n[10],m=n[14],y=n[3],v=n[7],x=n[11],_=n[15],b=r[0],w=r[4],M=r[8],E=r[12],S=r[1],T=r[5],C=r[9],A=r[13],P=r[2],L=r[6],I=r[10],R=r[14],N=r[3],O=r[7],D=r[11],F=r[15];return i[0]=o*b+s*S+a*P+u*N,i[4]=o*w+s*T+a*L+u*O,i[8]=o*M+s*C+a*I+u*D,i[12]=o*E+s*A+a*R+u*F,i[1]=l*b+c*S+h*P+p*N,i[5]=l*w+c*T+h*L+p*O,i[9]=l*M+c*C+h*I+p*D,i[13]=l*E+c*A+h*R+p*F,i[2]=d*b+f*S+g*P+m*N,i[6]=d*w+f*T+g*L+m*O,i[10]=d*M+f*C+g*I+m*D,i[14]=d*E+f*A+g*R+m*F,i[3]=y*b+v*S+x*P+_*N,i[7]=y*w+v*T+x*L+_*O,i[11]=y*M+v*C+x*I+_*D,i[15]=y*E+v*A+x*R+_*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],s=t[5],a=t[9],u=t[13],l=t[2],c=t[6],h=t[10],p=t[14],d=t[3],f=t[7],g=t[11],m=t[15];return d*(+i*a*c-r*u*c-i*s*h+n*u*h+r*s*p-n*a*p)+f*(+e*a*p-e*u*h+i*o*h-r*o*p+r*u*l-i*a*l)+g*(+e*u*c-e*s*p-i*o*c+n*o*p+i*s*l-n*u*l)+m*(-r*s*l-e*a*c+e*s*h+r*o*c-n*o*h+n*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],f=t[13],g=t[14],m=t[15],y=c*g*u-f*h*u+f*a*p-s*g*p-c*a*m+s*h*m,v=d*h*u-l*g*u-d*a*p+o*g*p+l*a*m-o*h*m,x=l*f*u-d*c*u+d*s*p-o*f*p-l*s*m+o*c*m,_=d*c*a-l*f*a-d*s*h+o*f*h+l*s*g-o*c*g,b=e*y+n*v+r*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=y*w,t[1]=(f*h*i-c*g*i-f*r*p+n*g*p+c*r*m-n*h*m)*w,t[2]=(s*g*i-f*a*i+f*r*u-n*g*u-s*r*m+n*a*m)*w,t[3]=(c*a*i-s*h*i-c*r*u+n*h*u+s*r*p-n*a*p)*w,t[4]=v*w,t[5]=(l*g*i-d*h*i+d*r*p-e*g*p-l*r*m+e*h*m)*w,t[6]=(d*a*i-o*g*i-d*r*u+e*g*u+o*r*m-e*a*m)*w,t[7]=(o*h*i-l*a*i+l*r*u-e*h*u-o*r*p+e*a*p)*w,t[8]=x*w,t[9]=(d*c*i-l*f*i-d*n*p+e*f*p+l*n*m-e*c*m)*w,t[10]=(o*f*i-d*s*i+d*n*u-e*f*u-o*n*m+e*s*m)*w,t[11]=(l*s*i-o*c*i-l*n*u+e*c*u+o*n*p-e*s*p)*w,t[12]=_*w,t[13]=(l*f*r-d*c*r+d*n*h-e*f*h-l*n*g+e*c*g)*w,t[14]=(d*s*r-o*f*r-d*n*a+e*f*a+o*n*g-e*s*g)*w,t[15]=(o*c*r-l*s*r+l*n*a-e*c*a-o*n*h+e*s*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,s=t.y,a=t.z,u=i*o,l=i*s;return this.set(u*o+n,u*s-r*a,u*a+r*s,0,u*s+r*a,l*s+n,l*a-r*o,0,u*a-r*s,l*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,s=e._z,a=e._w,u=i+i,l=o+o,c=s+s,h=i*u,p=i*l,d=i*c,f=o*l,g=o*c,m=s*c,y=a*u,v=a*l,x=a*c,_=n.x,b=n.y,w=n.z;return r[0]=(1-(f+m))*_,r[1]=(p+x)*_,r[2]=(d-v)*_,r[3]=0,r[4]=(p-x)*b,r[5]=(1-(h+m))*b,r[6]=(g+y)*b,r[7]=0,r[8]=(d+v)*w,r[9]=(g-y)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Mi.set(r[0],r[1],r[2]).length();const o=Mi.set(r[4],r[5],r[6]).length(),s=Mi.set(r[8],r[9],r[10]).length(),a=this.determinant();a<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Ei.copy(this);const u=1/i,l=1/o,c=1/s;return Ei.elements[0]*=u,Ei.elements[1]*=u,Ei.elements[2]*=u,Ei.elements[4]*=l,Ei.elements[5]*=l,Ei.elements[6]*=l,Ei.elements[8]*=c,Ei.elements[9]*=c,Ei.elements[10]*=c,e.setFromRotationMatrix(Ei),n.x=i,n.y=o,n.z=s,this}makePerspective(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(e-t),u=2*i/(n-r),l=(e+t)/(e-t),c=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=u,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,n,r,i,o){const s=this.elements,a=1/(e-t),u=1/(n-r),l=1/(o-i),c=(e+t)*a,h=(n+r)*u,p=(o+i)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}wi.prototype.isMatrix4=!0;const Mi=new Wr,Ei=new wi,Si=new Wr(0,0,0),Ti=new Wr(1,1,1),Ci=new Wr,Ai=new Wr,Pi=new Wr,Li=new wi,Ii=new jr;class Ri{constructor(t=0,e=0,n=0,r=Ri.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,n){const r=Nr.clamp,i=t.elements,o=i[0],s=i[4],a=i[8],u=i[1],l=i[5],c=i[9],h=i[2],p=i[6],d=i[10];switch(e=e||this._order,e){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Li.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Li,e,n)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return Ii.setFromEuler(this),this.setFromQuaternion(Ii,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Wr(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ri.prototype.isEuler=!0,Ri.DefaultOrder="XYZ",Ri.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ni{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}}let Oi=0;const Di=new Wr,Fi=new jr,ki=new wi,Bi=new Wr,zi=new Wr,Gi=new Wr,Ui=new jr,Vi=new Wr(1,0,0),Hi=new Wr(0,1,0),ji=new Wr(0,0,1),Wi={type:"added"},qi={type:"removed"};function Yi(){Object.defineProperty(this,"id",{value:Oi++}),this.uuid=Nr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yi.DefaultUp.clone();const t=new Wr,e=new Ri,n=new jr,r=new Wr(1,1,1);function i(){n.setFromEuler(e,!1)}function o(){e.setFromQuaternion(n,void 0,!1)}e._onChange(i),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new wi},normalMatrix:{value:new Dr}}),this.matrix=new wi,this.matrixWorld=new wi,this.matrixAutoUpdate=Yi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ni,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Yi.DefaultUp=new Wr(0,1,0),Yi.DefaultMatrixAutoUpdate=!0,Yi.prototype=Object.assign(Object.create(Lr.prototype),{constructor:Yi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Fi.setFromAxisAngle(t,e),this.quaternion.multiply(Fi),this},rotateOnWorldAxis:function(t,e){return Fi.setFromAxisAngle(t,e),this.quaternion.premultiply(Fi),this},rotateX:function(t){return this.rotateOnAxis(Vi,t)},rotateY:function(t){return this.rotateOnAxis(Hi,t)},rotateZ:function(t){return this.rotateOnAxis(ji,t)},translateOnAxis:function(t,e){return Di.copy(t).applyQuaternion(this.quaternion),this.position.add(Di.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Vi,t)},translateY:function(t){return this.translateOnAxis(Hi,t)},translateZ:function(t){return this.translateOnAxis(ji,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(ki.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?Bi.copy(t):Bi.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),zi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ki.lookAt(zi,Bi,this.up):ki.lookAt(Bi,zi,this.up),this.quaternion.setFromRotationMatrix(ki),r&&(ki.extractRotation(r.matrixWorld),Fi.setFromRotationMatrix(ki),this.quaternion.premultiply(Fi.invert()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Wi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(qi)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(qi)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),ki.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ki.multiply(t.parent.matrixWorld)),t.applyMatrix4(ki),this.add(t),t.updateWorldMatrix(!1,!0),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n],i=r.getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new jr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zi,t,Gi),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zi,Ui,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"===typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=o(t.geometries),r=o(t.materials),i=o(t.textures),s=o(t.images),a=o(t.shapes),u=o(t.skeletons),l=o(t.animations);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),u.length>0&&(n.skeletons=u),l.length>0&&(n.animations=l)}return n.object=r,n;function o(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}});const Xi=new Wr,Zi=new Wr,Ki=new Dr;class Ji{constructor(t=new Wr(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Xi.subVectors(n,e).cross(Zi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Wr),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Wr);const n=t.delta(Xi),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Wr),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Ki.getNormalMatrix(t),r=this.coplanarPoint(Xi).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ji.prototype.isPlane=!0;const Qi=new Wr,$i=new Wr,to=new Wr,eo=new Wr,no=new Wr,ro=new Wr,io=new Wr,oo=new Wr,so=new Wr,ao=new Wr;class uo{constructor(t=new Wr,e=new Wr,n=new Wr){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Wr),r.subVectors(n,e),Qi.subVectors(t,e),r.cross(Qi);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Qi.subVectors(r,e),$i.subVectors(n,e),to.subVectors(t,e);const o=Qi.dot(Qi),s=Qi.dot($i),a=Qi.dot(to),u=$i.dot($i),l=$i.dot(to),c=o*u-s*s;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Wr),0===c)return i.set(-2,-1,-1);const h=1/c,p=(u*a-s*l)*h,d=(o*l-s*a)*h;return i.set(1-p-d,d,p)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,eo),eo.x>=0&&eo.y>=0&&eo.x+eo.y<=1}static getUV(t,e,n,r,i,o,s,a){return this.getBarycoord(t,e,n,r,eo),a.set(0,0),a.addScaledVector(i,eo.x),a.addScaledVector(o,eo.y),a.addScaledVector(s,eo.z),a}static isFrontFacing(t,e,n,r){return Qi.subVectors(n,e),$i.subVectors(t,e),Qi.cross($i).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Qi.subVectors(this.c,this.b),$i.subVectors(this.a,this.b),.5*Qi.cross($i).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Wr),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return uo.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ji),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return uo.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,i){return uo.getUV(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return uo.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return uo.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Wr);const n=this.a,r=this.b,i=this.c;let o,s;no.subVectors(r,n),ro.subVectors(i,n),oo.subVectors(t,n);const a=no.dot(oo),u=ro.dot(oo);if(a<=0&&u<=0)return e.copy(n);so.subVectors(t,r);const l=no.dot(so),c=ro.dot(so);if(l>=0&&c<=l)return e.copy(r);const h=a*c-l*u;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),e.copy(n).addScaledVector(no,o);ao.subVectors(t,i);const p=no.dot(ao),d=ro.dot(ao);if(d>=0&&p<=d)return e.copy(i);const f=p*u-a*d;if(f<=0&&u>=0&&d<=0)return s=u/(u-d),e.copy(n).addScaledVector(ro,s);const g=l*d-p*c;if(g<=0&&c-l>=0&&p-d>=0)return io.subVectors(i,r),s=(c-l)/(c-l+(p-d)),e.copy(r).addScaledVector(io,s);const m=1/(g+f+h);return o=f*m,s=h*m,e.copy(n).addScaledVector(no,o).addScaledVector(ro,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let lo=0;function co(){Object.defineProperty(this,"id",{value:lo++}),this.uuid=Nr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=ft,this.side=ut,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=At,this.blendDst=Pt,this.blendEquation=xt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Bt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ir,this.stencilZFail=ir,this.stencilZPass=ir,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}co.prototype=Object.assign(Object.create(Lr.prototype),{constructor:co,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===ht;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ft&&(n.blending=this.blending),this.side!==ut&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(co.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});const ho={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},po={h:0,s:0,l:0},fo={h:0,s:0,l:0};function go(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function mo(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function yo(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class vo{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=Nr.euclideanModulo(t,1),e=Nr.clamp(e,0,1),n=Nr.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=go(i,r,t+1/3),this.g=go(i,r,t),this.b=go(i,r,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,r,i)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=ho[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=mo(t.r),this.g=mo(t.g),this.b=mo(t.b),this}copyLinearToSRGB(t){return this.r=yo(t.r),this.g=yo(t.g),this.b=yo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,n=this.g,r=this.b,i=Math.max(e,n,r),o=Math.min(e,n,r);let s,a;const u=(o+i)/2;if(o===i)s=0,a=0;else{const t=i-o;switch(a=u<=.5?t/(i+o):t/(2-i-o),i){case e:s=(n-r)/t+(n<r?6:0);break;case n:s=(r-e)/t+2;break;case r:s=(e-n)/t+4;break}s/=6}return t.h=s,t.s=a,t.l=u,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(po),po.h+=t,po.s+=e,po.l+=n,this.setHSL(po.h,po.s,po.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(po),t.getHSL(fo);const n=Nr.lerp(po.h,fo.h,e),r=Nr.lerp(po.s,fo.s,e),i=Nr.lerp(po.l,fo.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}vo.NAMES=ho,vo.prototype.isColor=!0,vo.prototype.r=1,vo.prototype.g=1,vo.prototype.b=1;class xo extends co{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new vo(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this}}xo.prototype.isMeshBasicMaterial=!0;const _o=new Wr,bo=new Or;function wo(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=xr,this.updateRange={offset:0,count:-1},this.version=0}function Mo(t,e,n){wo.call(this,new Int8Array(t),e,n)}function Eo(t,e,n){wo.call(this,new Uint8Array(t),e,n)}function So(t,e,n){wo.call(this,new Uint8ClampedArray(t),e,n)}function To(t,e,n){wo.call(this,new Int16Array(t),e,n)}function Co(t,e,n){wo.call(this,new Uint16Array(t),e,n)}function Ao(t,e,n){wo.call(this,new Int32Array(t),e,n)}function Po(t,e,n){wo.call(this,new Uint32Array(t),e,n)}function Lo(t,e,n){wo.call(this,new Uint16Array(t),e,n)}function Io(t,e,n){wo.call(this,new Float32Array(t),e,n)}function Ro(t,e,n){wo.call(this,new Float64Array(t),e,n)}function No(t){if(0===t.length)return-1/0;let e=t[0];for(let n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(wo.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(wo.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new vo),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Or),e[n++]=i.x,e[n++]=i.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Wr),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Ur),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)bo.fromBufferAttribute(this,e),bo.applyMatrix3(t),this.setXY(e,bo.x,bo.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)_o.fromBufferAttribute(this,e),_o.applyMatrix3(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},applyMatrix4:function(t){for(let e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.applyMatrix4(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.applyNormalMatrix(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.transformDirection(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},set:function(t,e=0){return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==xr&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}),Mo.prototype=Object.create(wo.prototype),Mo.prototype.constructor=Mo,Eo.prototype=Object.create(wo.prototype),Eo.prototype.constructor=Eo,So.prototype=Object.create(wo.prototype),So.prototype.constructor=So,To.prototype=Object.create(wo.prototype),To.prototype.constructor=To,Co.prototype=Object.create(wo.prototype),Co.prototype.constructor=Co,Ao.prototype=Object.create(wo.prototype),Ao.prototype.constructor=Ao,Po.prototype=Object.create(wo.prototype),Po.prototype.constructor=Po,Lo.prototype=Object.create(wo.prototype),Lo.prototype.constructor=Lo,Lo.prototype.isFloat16BufferAttribute=!0,Io.prototype=Object.create(wo.prototype),Io.prototype.constructor=Io,Ro.prototype=Object.create(wo.prototype),Ro.prototype.constructor=Ro;const Oo={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Do(t,e){return new Oo[t](e)}let Fo=0;const ko=new wi,Bo=new Yi,zo=new Wr,Go=new Xr,Uo=new Xr,Vo=new Wr;function Ho(){Object.defineProperty(this,"id",{value:Fo++}),this.uuid=Nr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ho.prototype=Object.assign(Object.create(Lr.prototype),{constructor:Ho,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(No(t)>65535?Po:Co)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Dr).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return ko.makeRotationX(t),this.applyMatrix4(ko),this},rotateY:function(t){return ko.makeRotationY(t),this.applyMatrix4(ko),this},rotateZ:function(t){return ko.makeRotationZ(t),this.applyMatrix4(ko),this},translate:function(t,e,n){return ko.makeTranslation(t,e,n),this.applyMatrix4(ko),this},scale:function(t,e,n){return ko.makeScale(t,e,n),this.applyMatrix4(ko),this},lookAt:function(t){return Bo.lookAt(t),Bo.updateMatrix(),this.applyMatrix4(Bo.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(zo).negate(),this.translate(zo.x,zo.y,zo.z),this},setFromPoints:function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Io(e,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Xr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Wr(-1/0,-1/0,-1/0),new Wr(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){const t=e[n];Go.setFromBufferAttribute(t),this.morphTargetsRelative?(Vo.addVectors(this.boundingBox.min,Go.min),this.boundingBox.expandByPoint(Vo),Vo.addVectors(this.boundingBox.max,Go.max),this.boundingBox.expandByPoint(Vo)):(this.boundingBox.expandByPoint(Go.min),this.boundingBox.expandByPoint(Go.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new di);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Wr,1/0);if(t){const n=this.boundingSphere.center;if(Go.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const n=e[t];Uo.setFromBufferAttribute(n),this.morphTargetsRelative?(Vo.addVectors(Go.min,Uo.min),Go.expandByPoint(Vo),Vo.addVectors(Go.max,Uo.max),Go.expandByPoint(Vo)):(Go.expandByPoint(Uo.min),Go.expandByPoint(Uo.max))}Go.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Vo.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Vo));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],s=this.morphTargetsRelative;for(let e=0,i=o.count;e<i;e++)Vo.fromBufferAttribute(o,e),s&&(zo.fromBufferAttribute(t,e),Vo.add(zo)),r=Math.max(r,n.distanceToSquared(Vo))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,r=e.position.array,i=e.normal.array,o=e.uv.array,s=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new wo(new Float32Array(4*s),4));const a=e.tangent.array,u=[],l=[];for(let S=0;S<s;S++)u[S]=new Wr,l[S]=new Wr;const c=new Wr,h=new Wr,p=new Wr,d=new Or,f=new Or,g=new Or,m=new Wr,y=new Wr;function v(t,e,n){c.fromArray(r,3*t),h.fromArray(r,3*e),p.fromArray(r,3*n),d.fromArray(o,2*t),f.fromArray(o,2*e),g.fromArray(o,2*n),h.sub(c),p.sub(c),f.sub(d),g.sub(d);const i=1/(f.x*g.y-g.x*f.y);isFinite(i)&&(m.copy(h).multiplyScalar(g.y).addScaledVector(p,-f.y).multiplyScalar(i),y.copy(p).multiplyScalar(f.x).addScaledVector(h,-g.x).multiplyScalar(i),u[t].add(m),u[e].add(m),u[n].add(m),l[t].add(y),l[e].add(y),l[n].add(y))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let S=0,T=x.length;S<T;++S){const t=x[S],e=t.start,r=t.count;for(let i=e,o=e+r;i<o;i+=3)v(n[i+0],n[i+1],n[i+2])}const _=new Wr,b=new Wr,w=new Wr,M=new Wr;function E(t){w.fromArray(i,3*t),M.copy(w);const e=u[t];_.copy(e),_.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(M,e);const n=b.dot(l[t]),r=n<0?-1:1;a[4*t]=_.x,a[4*t+1]=_.y,a[4*t+2]=_.z,a[4*t+3]=r}for(let S=0,T=x.length;S<T;++S){const t=x[S],e=t.start,r=t.count;for(let i=e,o=e+r;i<o;i+=3)E(n[i+0]),E(n[i+1]),E(n[i+2])}},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new wo(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Wr,i=new Wr,o=new Wr,s=new Wr,a=new Wr,u=new Wr,l=new Wr,c=new Wr;if(t)for(let h=0,p=t.count;h<p;h+=3){const p=t.getX(h+0),d=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,p),i.fromBufferAttribute(e,d),o.fromBufferAttribute(e,f),l.subVectors(o,i),c.subVectors(r,i),l.cross(c),s.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),u.fromBufferAttribute(n,f),s.add(l),a.add(l),u.add(l),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,u.x,u.y,u.z)}else for(let t=0,h=e.count;t<h;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),o.fromBufferAttribute(e,t+2),l.subVectors(o,i),c.subVectors(r,i),l.cross(c),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const i=n[r],o=i.array,s=t.attributes[r],a=s.array,u=s.itemSize*e,l=Math.min(a.length,o.length-u);for(let t=0,e=u;t<l;t++,e++)o[e]=a[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Vo.fromBufferAttribute(t,e),Vo.normalize(),t.setXYZ(e,Vo.x,Vo.y,Vo.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r);let s=0,a=0;for(let u=0,l=e.length;u<l;u++){s=e[u]*r;for(let t=0;t<r;t++)o[a++]=n[s++]}return new wo(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ho,n=this.index.array,r=this.attributes;for(const s in r){const i=r[s],o=t(i,n);e.setAttribute(s,o)}const i=this.morphAttributes;for(const s in i){const r=[],o=i[s];for(let e=0,i=o.length;e<i;e++){const i=o[e],s=t(i,n);r.push(s)}e.morphAttributes[s]=r}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const t=o[s];e.addGroup(t.start,t.count,t.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const a in n){const e=n[a];t.data.attributes[a]=e.toJSON(t.data)}const r={};let i=!1;for(const a in this.morphAttributes){const e=this.morphAttributes[a],n=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];n.push(i.toJSON(t.data))}n.length>0&&(r[a]=n,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new Ho).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const u in r){const t=r[u];this.setAttribute(u,t.clone(e))}const i=t.morphAttributes;for(const u in i){const t=[],n=i[u];for(let r=0,i=n.length;r<i;r++)t.push(n[r].clone(e));this.morphAttributes[u]=t}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let u=0,l=o.length;u<l;u++){const t=o[u];this.addGroup(t.start,t.count,t.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const jo=new wi,Wo=new bi,qo=new di,Yo=new Wr,Xo=new Wr,Zo=new Wr,Ko=new Wr,Jo=new Wr,Qo=new Wr,$o=new Wr,ts=new Wr,es=new Wr,ns=new Or,rs=new Or,is=new Or,os=new Wr,ss=new Wr;function as(t=new Ho,e=new xo){Yi.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function us(t,e,n,r,i,o,s,a){let u;if(u=e.side===lt?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,e.side!==ct,a),null===u)return null;ss.copy(a),ss.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(ss);return l<n.near||l>n.far?null:{distance:l,point:ss.clone(),object:t}}function ls(t,e,n,r,i,o,s,a,u,l,c,h){Yo.fromBufferAttribute(i,l),Xo.fromBufferAttribute(i,c),Zo.fromBufferAttribute(i,h);const p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){$o.set(0,0,0),ts.set(0,0,0),es.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=p[t],n=o[t];0!==e&&(Ko.fromBufferAttribute(n,l),Jo.fromBufferAttribute(n,c),Qo.fromBufferAttribute(n,h),s?($o.addScaledVector(Ko,e),ts.addScaledVector(Jo,e),es.addScaledVector(Qo,e)):($o.addScaledVector(Ko.sub(Yo),e),ts.addScaledVector(Jo.sub(Xo),e),es.addScaledVector(Qo.sub(Zo),e)))}Yo.add($o),Xo.add(ts),Zo.add(es)}t.isSkinnedMesh&&e.skinning&&(t.boneTransform(l,Yo),t.boneTransform(c,Xo),t.boneTransform(h,Zo));const d=us(t,e,n,r,Yo,Xo,Zo,os);if(d){a&&(ns.fromBufferAttribute(a,l),rs.fromBufferAttribute(a,c),is.fromBufferAttribute(a,h),d.uv=uo.getUV(os,Yo,Xo,Zo,ns,rs,is,new Or)),u&&(ns.fromBufferAttribute(u,l),rs.fromBufferAttribute(u,c),is.fromBufferAttribute(u,h),d.uv2=uo.getUV(os,Yo,Xo,Zo,ns,rs,is,new Or));const t={a:l,b:c,c:h,normal:new Wr,materialIndex:0};uo.getNormal(Yo,Xo,Zo,t.normal),d.face=t}return d}as.prototype=Object.assign(Object.create(Yi.prototype),{constructor:as,isMesh:!0,copy:function(t){return Yi.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),qo.copy(n.boundingSphere),qo.applyMatrix4(i),!1===t.ray.intersectsSphere(qo))return;if(jo.copy(i).invert(),Wo.copy(t.ray).applyMatrix4(jo),null!==n.boundingBox&&!1===Wo.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,u=n.morphTargetsRelative,l=n.attributes.uv,c=n.attributes.uv2,h=n.groups,p=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,d=h.length;n<d;n++){const d=h[n],f=r[d.materialIndex],g=Math.max(d.start,p.start),m=Math.min(d.start+d.count,p.start+p.count);for(let n=g,r=m;n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),p=i.getX(n+2);o=ls(this,f,t,Wo,s,a,u,l,c,r,h,p),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,e.push(o))}}else{const n=Math.max(0,p.start),h=Math.min(i.count,p.start+p.count);for(let p=n,d=h;p<d;p+=3){const n=i.getX(p),h=i.getX(p+1),d=i.getX(p+2);o=ls(this,r,t,Wo,s,a,u,l,c,n,h,d),o&&(o.faceIndex=Math.floor(p/3),e.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let n=0,d=h.length;n<d;n++){const i=h[n],d=r[i.materialIndex],f=Math.max(i.start,p.start),g=Math.min(i.start+i.count,p.start+p.count);for(let n=f,r=g;n<r;n+=3){const r=n,h=n+1,p=n+2;o=ls(this,d,t,Wo,s,a,u,l,c,r,h,p),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,e.push(o))}}else{const n=Math.max(0,p.start),i=Math.min(s.count,p.start+p.count);for(let h=n,p=i;h<p;h+=3){const n=h,i=h+1,p=h+2;o=ls(this,r,t,Wo,s,a,u,l,c,n,i,p),o&&(o.faceIndex=Math.floor(h/3),e.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class cs extends Ho{constructor(t=1,e=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],u=[],l=[],c=[];let h=0,p=0;function d(t,e,n,r,i,o,d,f,g,m,y){const v=o/g,x=d/m,_=o/2,b=d/2,w=f/2,M=g+1,E=m+1;let S=0,T=0;const C=new Wr;for(let s=0;s<E;s++){const o=s*x-b;for(let a=0;a<M;a++){const h=a*v-_;C[t]=h*r,C[e]=o*i,C[n]=w,u.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[n]=f>0?1:-1,l.push(C.x,C.y,C.z),c.push(a/g),c.push(1-s/m),S+=1}}for(let s=0;s<m;s++)for(let t=0;t<g;t++){const e=h+t+M*s,n=h+t+M*(s+1),r=h+(t+1)+M*(s+1),i=h+(t+1)+M*s;a.push(e,n,i),a.push(n,r,i),T+=6}s.addGroup(p,T,y),p+=T,h+=S}d("z","y","x",-1,-1,n,e,t,o,i,0),d("z","y","x",1,-1,n,e,-t,o,i,1),d("x","z","y",1,1,t,n,e,r,o,2),d("x","z","y",1,-1,t,n,-e,r,o,3),d("x","y","z",1,-1,t,e,n,r,i,4),d("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Io(u,3)),this.setAttribute("normal",new Io(l,3)),this.setAttribute("uv",new Io(c,2))}}function hs(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function ps(t){const e={};for(let n=0;n<t.length;n++){const r=hs(t[n]);for(const t in r)e[t]=r[t]}return e}const ds={clone:hs,merge:ps};var fs="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",gs="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ms(t){co.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=fs,this.fragmentShader=gs,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function ys(){Yi.call(this),this.type="Camera",this.matrixWorldInverse=new wi,this.projectionMatrix=new wi,this.projectionMatrixInverse=new wi}function vs(t=50,e=1,n=.1,r=2e3){ys.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ms.prototype=Object.create(co.prototype),ms.prototype.constructor=ms,ms.prototype.isShaderMaterial=!0,ms.prototype.copy=function(t){return co.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=hs(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},ms.prototype.toJSON=function(t){const e=co.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r],i=n.value;i&&i.isTexture?e.uniforms[r]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[r]={type:"m4",value:i.toArray()}:e.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(e.extensions=n),e},ys.prototype=Object.assign(Object.create(Yi.prototype),{constructor:ys,isCamera:!0,copy:function(t,e){return Yi.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Yi.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){Yi.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),vs.prototype=Object.assign(Object.create(ys.prototype),{constructor:vs,isPerspectiveCamera:!0,copy:function(t,e){return ys.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Nr.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Nr.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Nr.RAD2DEG*Math.atan(Math.tan(.5*Nr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*Nr.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const t=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/t,e-=o.offsetY*n/s,r*=o.width/t,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){const e=Yi.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const xs=90,_s=1;class bs extends Yi{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new vs(xs,_s,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Wr(1,0,0)),this.add(r);const i=new vs(xs,_s,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Wr(-1,0,0)),this.add(i);const o=new vs(xs,_s,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Wr(0,1,0)),this.add(o);const s=new vs(xs,_s,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Wr(0,-1,0)),this.add(s);const a=new vs(xs,_s,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Wr(0,0,1)),this.add(a);const u=new vs(xs,_s,t,e);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Wr(0,0,-1)),this.add(u)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,s,a,u]=this.children,l=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,u),t.setRenderTarget(c),t.xr.enabled=l}}class ws extends zr{constructor(t,e,n,r,i,o,s,a,u,l){t=void 0!==t?t:[],e=void 0!==e?e:$t,s=void 0!==s?s:Ie,super(t,e,n,r,i,o,s,a,u,l),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}ws.prototype.isCubeTexture=!0;class Ms extends Vr{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new ws(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:de,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Re,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new cs(5,5,5),i=new ms({name:"CubemapFromEquirect",uniforms:hs(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:lt,blending:dt});i.uniforms.tEquirect.value=e;const o=new as(r,i),s=e.minFilter;e.minFilter===me&&(e.minFilter=de);const a=new bs(1,10,this);return a.update(t,o),e.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,r);t.setRenderTarget(i)}}Ms.prototype.isWebGLCubeRenderTarget=!0;class Es extends zr{constructor(t,e,n,r,i,o,s,a,u,l,c,h){super(null,o,s,a,u,l,r,i,c,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==u?u:ue,this.minFilter=void 0!==l?l:ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Es.prototype.isDataTexture=!0;const Ss=new di,Ts=new Wr;class Cs{constructor(t=new Ji,e=new Ji,n=new Ji,r=new Ji,i=new Ji,o=new Ji){this.planes=[t,e,n,r,i,o]}set(t,e,n,r,i,o){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],f=n[11],g=n[12],m=n[13],y=n[14],v=n[15];return e[0].setComponents(s-r,c-a,f-h,v-g).normalize(),e[1].setComponents(s+r,c+a,f+h,v+g).normalize(),e[2].setComponents(s+i,c+u,f+p,v+m).normalize(),e[3].setComponents(s-i,c-u,f-p,v-m).normalize(),e[4].setComponents(s-o,c-l,f-d,v-y).normalize(),e[5].setComponents(s+o,c+l,f+d,v+y).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Ss.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Ss)}intersectsSprite(t){return Ss.center.set(0,0,0),Ss.radius=.7071067811865476,Ss.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ss)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let i=0;i<6;i++){const t=e[i].distanceToPoint(n);if(t<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Ts.x=r.normal.x>0?t.max.x:t.min.x,Ts.y=r.normal.y>0?t.max.y:t.min.y,Ts.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Ts)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function As(){let t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ps(t,e){const n=e.isWebGL2,r=new WeakMap;function i(e,r){const i=e.array,o=e.usage,s=t.createBuffer();t.bindBuffer(r,s),t.bufferData(r,i,o),e.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}function o(e,r,i){const o=r.array,s=r.updateRange;t.bindBuffer(i,e),-1===s.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):t.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}function s(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)}function a(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))}function u(t,e){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);void 0===n?r.set(t,i(t,e)):n.version<t.version&&(o(n.buffer,t,e),n.version=t.version)}return{get:s,remove:a,update:u}}class Ls extends Ho{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,o=e/2,s=Math.floor(n),a=Math.floor(r),u=s+1,l=a+1,c=t/s,h=e/a,p=[],d=[],f=[],g=[];for(let m=0;m<l;m++){const t=m*h-o;for(let e=0;e<u;e++){const n=e*c-i;d.push(n,-t,0),f.push(0,0,1),g.push(e/s),g.push(1-m/a)}}for(let m=0;m<a;m++)for(let t=0;t<s;t++){const e=t+u*m,n=t+u*(m+1),r=t+1+u*(m+1),i=t+1+u*m;p.push(e,n,i),p.push(n,r,i)}this.setIndex(p),this.setAttribute("position",new Io(d,3)),this.setAttribute("normal",new Io(f,3)),this.setAttribute("uv",new Io(g,2))}}var Is="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",Rs="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Ns="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",Os="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",Ds="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Fs="vec3 transformed = vec3( position );",ks="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Bs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",zs="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Gs="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",Us="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Vs="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Hs="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",js="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",Ws="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",qs="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",Ys="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",Xs="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",Zs="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",Ks="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",Js="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",Qs="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",$s="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",ta="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",ea="gl_FragColor = linearToOutputTexel( gl_FragColor );",na="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",ra="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",ia="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",oa="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",sa="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",aa="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",ua="#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",la="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",ca="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",ha="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",pa="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",da="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",fa="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",ga="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",ma="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",ya="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",va="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",xa="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",_a="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",ba="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",wa="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",Ma="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",Ea="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Sa="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",Ta="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",Ca="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Aa="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Pa="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",La="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",Ia="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",Ra="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Na="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Oa="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Da="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Fa="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",ka="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",Ba="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",za="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",Ga="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",Ua="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",Va="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",Ha="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",ja="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",Wa="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",qa="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",Ya="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",Xa="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",Za="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",Ka="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",Ja="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",Qa="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",$a="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",tu="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",eu="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",nu="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",ru="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",iu="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",ou="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",su="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",au="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",uu="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",lu="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",cu="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",hu="#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",pu="#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",du="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",fu="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",gu="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",mu="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",yu="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",vu="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",xu="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",_u="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",bu="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",wu="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Mu="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Eu="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",Su="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Tu="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Cu="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Au="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Pu="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",Lu="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Iu="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Ru="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Nu="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Ou="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Du="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Fu="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ku="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Bu="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",zu="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Gu="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Uu="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Vu="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Hu="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",ju="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",Wu="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",qu="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Yu="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Xu="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Zu="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Ku="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Ju="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";const Qu={alphamap_fragment:Is,alphamap_pars_fragment:Rs,alphatest_fragment:Ns,aomap_fragment:Os,aomap_pars_fragment:Ds,begin_vertex:Fs,beginnormal_vertex:ks,bsdfs:Bs,bumpmap_pars_fragment:zs,clipping_planes_fragment:Gs,clipping_planes_pars_fragment:Us,clipping_planes_pars_vertex:Vs,clipping_planes_vertex:Hs,color_fragment:js,color_pars_fragment:Ws,color_pars_vertex:qs,color_vertex:Ys,common:Xs,cube_uv_reflection_fragment:Zs,defaultnormal_vertex:Ks,displacementmap_pars_vertex:Js,displacementmap_vertex:Qs,emissivemap_fragment:$s,emissivemap_pars_fragment:ta,encodings_fragment:ea,encodings_pars_fragment:na,envmap_fragment:ra,envmap_common_pars_fragment:ia,envmap_pars_fragment:oa,envmap_pars_vertex:sa,envmap_physical_pars_fragment:ya,envmap_vertex:aa,fog_vertex:ua,fog_pars_vertex:la,fog_fragment:ca,fog_pars_fragment:ha,gradientmap_pars_fragment:pa,lightmap_fragment:da,lightmap_pars_fragment:fa,lights_lambert_vertex:ga,lights_pars_begin:ma,lights_toon_fragment:va,lights_toon_pars_fragment:xa,lights_phong_fragment:_a,lights_phong_pars_fragment:ba,lights_physical_fragment:wa,lights_physical_pars_fragment:Ma,lights_fragment_begin:Ea,lights_fragment_maps:Sa,lights_fragment_end:Ta,logdepthbuf_fragment:Ca,logdepthbuf_pars_fragment:Aa,logdepthbuf_pars_vertex:Pa,logdepthbuf_vertex:La,map_fragment:Ia,map_pars_fragment:Ra,map_particle_fragment:Na,map_particle_pars_fragment:Oa,metalnessmap_fragment:Da,metalnessmap_pars_fragment:Fa,morphnormal_vertex:ka,morphtarget_pars_vertex:Ba,morphtarget_vertex:za,normal_fragment_begin:Ga,normal_fragment_maps:Ua,normalmap_pars_fragment:Va,clearcoat_normal_fragment_begin:Ha,clearcoat_normal_fragment_maps:ja,clearcoat_pars_fragment:Wa,packing:qa,premultiplied_alpha_fragment:Ya,project_vertex:Xa,dithering_fragment:Za,dithering_pars_fragment:Ka,roughnessmap_fragment:Ja,roughnessmap_pars_fragment:Qa,shadowmap_pars_fragment:$a,shadowmap_pars_vertex:tu,shadowmap_vertex:eu,shadowmask_pars_fragment:nu,skinbase_vertex:ru,skinning_pars_vertex:iu,skinning_vertex:ou,skinnormal_vertex:su,specularmap_fragment:au,specularmap_pars_fragment:uu,tonemapping_fragment:lu,tonemapping_pars_fragment:cu,transmissionmap_fragment:hu,transmissionmap_pars_fragment:pu,uv_pars_fragment:du,uv_pars_vertex:fu,uv_vertex:gu,uv2_pars_fragment:mu,uv2_pars_vertex:yu,uv2_vertex:vu,worldpos_vertex:xu,background_frag:_u,background_vert:bu,cube_frag:wu,cube_vert:Mu,depth_frag:Eu,depth_vert:Su,distanceRGBA_frag:Tu,distanceRGBA_vert:Cu,equirect_frag:Au,equirect_vert:Pu,linedashed_frag:Lu,linedashed_vert:Iu,meshbasic_frag:Ru,meshbasic_vert:Nu,meshlambert_frag:Ou,meshlambert_vert:Du,meshmatcap_frag:Fu,meshmatcap_vert:ku,meshtoon_frag:Bu,meshtoon_vert:zu,meshphong_frag:Gu,meshphong_vert:Uu,meshphysical_frag:Vu,meshphysical_vert:Hu,normal_frag:ju,normal_vert:Wu,points_frag:qu,points_vert:Yu,shadow_frag:Xu,shadow_vert:Zu,sprite_frag:Ku,sprite_vert:Ju},$u={common:{diffuse:{value:new vo(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dr},uv2Transform:{value:new Dr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Or(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vo(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vo(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dr}},sprite:{diffuse:{value:new vo(15658734)},opacity:{value:1},center:{value:new Or(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dr}}},tl={basic:{uniforms:ps([$u.common,$u.specularmap,$u.envmap,$u.aomap,$u.lightmap,$u.fog]),vertexShader:Qu.meshbasic_vert,fragmentShader:Qu.meshbasic_frag},lambert:{uniforms:ps([$u.common,$u.specularmap,$u.envmap,$u.aomap,$u.lightmap,$u.emissivemap,$u.fog,$u.lights,{emissive:{value:new vo(0)}}]),vertexShader:Qu.meshlambert_vert,fragmentShader:Qu.meshlambert_frag},phong:{uniforms:ps([$u.common,$u.specularmap,$u.envmap,$u.aomap,$u.lightmap,$u.emissivemap,$u.bumpmap,$u.normalmap,$u.displacementmap,$u.fog,$u.lights,{emissive:{value:new vo(0)},specular:{value:new vo(1118481)},shininess:{value:30}}]),vertexShader:Qu.meshphong_vert,fragmentShader:Qu.meshphong_frag},standard:{uniforms:ps([$u.common,$u.envmap,$u.aomap,$u.lightmap,$u.emissivemap,$u.bumpmap,$u.normalmap,$u.displacementmap,$u.roughnessmap,$u.metalnessmap,$u.fog,$u.lights,{emissive:{value:new vo(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qu.meshphysical_vert,fragmentShader:Qu.meshphysical_frag},toon:{uniforms:ps([$u.common,$u.aomap,$u.lightmap,$u.emissivemap,$u.bumpmap,$u.normalmap,$u.displacementmap,$u.gradientmap,$u.fog,$u.lights,{emissive:{value:new vo(0)}}]),vertexShader:Qu.meshtoon_vert,fragmentShader:Qu.meshtoon_frag},matcap:{uniforms:ps([$u.common,$u.bumpmap,$u.normalmap,$u.displacementmap,$u.fog,{matcap:{value:null}}]),vertexShader:Qu.meshmatcap_vert,fragmentShader:Qu.meshmatcap_frag},points:{uniforms:ps([$u.points,$u.fog]),vertexShader:Qu.points_vert,fragmentShader:Qu.points_frag},dashed:{uniforms:ps([$u.common,$u.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qu.linedashed_vert,fragmentShader:Qu.linedashed_frag},depth:{uniforms:ps([$u.common,$u.displacementmap]),vertexShader:Qu.depth_vert,fragmentShader:Qu.depth_frag},normal:{uniforms:ps([$u.common,$u.bumpmap,$u.normalmap,$u.displacementmap,{opacity:{value:1}}]),vertexShader:Qu.normal_vert,fragmentShader:Qu.normal_frag},sprite:{uniforms:ps([$u.sprite,$u.fog]),vertexShader:Qu.sprite_vert,fragmentShader:Qu.sprite_frag},background:{uniforms:{uvTransform:{value:new Dr},t2D:{value:null}},vertexShader:Qu.background_vert,fragmentShader:Qu.background_frag},cube:{uniforms:ps([$u.envmap,{opacity:{value:1}}]),vertexShader:Qu.cube_vert,fragmentShader:Qu.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qu.equirect_vert,fragmentShader:Qu.equirect_frag},distanceRGBA:{uniforms:ps([$u.common,$u.displacementmap,{referencePosition:{value:new Wr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qu.distanceRGBA_vert,fragmentShader:Qu.distanceRGBA_frag},shadow:{uniforms:ps([$u.lights,$u.fog,{color:{value:new vo(0)},opacity:{value:1}}]),vertexShader:Qu.shadow_vert,fragmentShader:Qu.shadow_frag}};function el(t,e,n,r,i){const o=new vo(0);let s,a,u=0,l=null,c=0,h=null;function p(n,i,p,f){let g=!0===i.isScene?i.background:null;g&&g.isTexture&&(g=e.get(g));const m=t.xr,y=m.getSession&&m.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?d(o,u):g&&g.isColor&&(d(g,1),f=!0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.mapping===re)?(void 0===a&&(a=new as(new cs(1,1,1),new ms({name:"BackgroundCubeMaterial",uniforms:hs(tl.cube.uniforms),vertexShader:tl.cube.vertexShader,fragmentShader:tl.cube.fragmentShader,side:lt,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&g._needsFlipEnvMap?-1:1,l===g&&c===g.version&&h===t.toneMapping||(a.material.needsUpdate=!0,l=g,c=g.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===s&&(s=new as(new Ls(2,2),new ms({name:"BackgroundMaterial",uniforms:hs(tl.background.uniforms),vertexShader:tl.background.vertexShader,fragmentShader:tl.background.fragmentShader,side:ut,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),l===g&&c===g.version&&h===t.toneMapping||(s.material.needsUpdate=!0,l=g,c=g.version,h=t.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}function d(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),u=e,d(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,d(o,u)},render:p}}function nl(t,e,n,r){const i=t.getParameter(34921),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},u=g(null);let l=u;function c(e,r,i,o,a){let u=!1;if(s){const t=f(o,i,r);l!==t&&(l=t,p(l.object)),u=m(o,a),u&&y(o,a)}else{const t=!0===r.wireframe;l.geometry===o.id&&l.program===i.id&&l.wireframe===t||(l.geometry=o.id,l.program=i.id,l.wireframe=t,u=!0)}!0===e.isInstancedMesh&&(u=!0),null!==a&&n.update(a,34963),u&&(M(e,r,i,o),null!==a&&t.bindBuffer(34963,n.get(a).buffer))}function h(){return r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()}function p(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function d(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function f(t,e,n){const r=!0===n.wireframe;let i=a[t.id];void 0===i&&(i={},a[t.id]=i);let o=i[e.id];void 0===o&&(o={},i[e.id]=o);let s=o[r];return void 0===s&&(s=g(h()),o[r]=s),s}function g(t){const e=[],n=[],r=[];for(let o=0;o<i;o++)e[o]=0,n[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function m(t,e){const n=l.attributes,r=t.attributes;let i=0;for(const o in r){const t=n[o],e=r[o];if(void 0===t)return!0;if(t.attribute!==e)return!0;if(t.data!==e.data)return!0;i++}return l.attributesNum!==i||l.index!==e}function y(t,e){const n={},r=t.attributes;let i=0;for(const o in r){const t=r[o],e={};e.attribute=t,t.data&&(e.data=t.data),n[o]=e,i++}l.attributes=n,l.attributesNum=i,l.index=e}function v(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function x(t){_(t,0)}function _(n,i){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;if(o[n]=1,0===s[n]&&(t.enableVertexAttribArray(n),s[n]=1),a[n]!==i){const o=r.isWebGL2?t:e.get("ANGLE_instanced_arrays");o[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function b(){const e=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function w(e,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,o,s,a):t.vertexAttribIPointer(e,n,i,s,a)}function M(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;v();const u=a.attributes,l=s.getAttributes(),c=o.defaultAttributeValues;for(const e in l){const r=l[e];if(r>=0){const o=u[e];if(void 0!==o){const e=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const u=s.buffer,l=s.type,c=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(_(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):x(r),t.bindBuffer(34962,u),w(r,i,l,e,s*c,h*c)}else o.isInstancedBufferAttribute?(_(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):x(r),t.bindBuffer(34962,u),w(r,i,l,e,0,0)}else if("instanceMatrix"===e){const e=n.get(i.instanceMatrix);if(void 0===e)continue;const o=e.buffer,s=e.type;_(r+0,1),_(r+1,1),_(r+2,1),_(r+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(r+0,4,s,!1,64,0),t.vertexAttribPointer(r+1,4,s,!1,64,16),t.vertexAttribPointer(r+2,4,s,!1,64,32),t.vertexAttribPointer(r+3,4,s,!1,64,48)}else if("instanceColor"===e){const e=n.get(i.instanceColor);if(void 0===e)continue;const o=e.buffer,s=e.type;_(r,1),t.bindBuffer(34962,o),t.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==c){const n=c[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}b()}function E(){C();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}}function S(t){if(void 0===a[t.id])return;const e=a[t.id];for(const n in e){const t=e[n];for(const e in t)d(t[e].object),delete t[e];delete e[n]}delete a[t.id]}function T(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)d(r[t].object),delete r[t];delete n[t.id]}}function C(){A(),l!==u&&(l=u,p(l.object))}function A(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:c,reset:C,resetDefaultState:A,dispose:E,releaseStatesOfGeometry:S,releaseStatesOfProgram:T,initAttributes:v,enableAttribute:x,disableUnusedAttributes:b}}function rl(t,e,n,r){const i=r.isWebGL2;let o;function s(t){o=t}function a(e,r){t.drawArrays(o,e,r),n.update(r,o,1)}function u(r,s,a){if(0===a)return;let u,l;if(i)u=t,l="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===u)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](o,r,s,a),n.update(s,o,a)}this.setMode=s,this.render=a,this.renderInstances=u}function il(t,e,n){let r;function i(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const u=o(a);u!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",u,"instead."),a=u);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),p=t.getParameter(3379),d=t.getParameter(34076),f=t.getParameter(34921),g=t.getParameter(36347),m=t.getParameter(36348),y=t.getParameter(36349),v=h>0,x=s||e.has("OES_texture_float"),_=v&&x,b=s?t.getParameter(36183):0;return{isWebGL2:s,getMaxAnisotropy:i,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:_,maxSamples:b}}function ol(t){const e=this;let n=null,r=0,i=!1,o=!1;const s=new Ji,a=new Dr,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,n,r,i){const o=null!==t?t.length:0;let l=null;if(0!==o){if(l=u.value,!0!==i||null===l){const e=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<e)&&(l=new Float32Array(e));for(let n=0,u=r;n!==o;++n,u+=4)s.copy(t[n]).applyMatrix4(i,a),s.normal.toArray(l,u),l[u+3]=s.constant}u.value=l,u.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){const s=0!==t.length||e||0!==r||i;return i=e,n=c(t,o,0),r=t.length,s},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,l()},this.setState=function(e,s,a){const h=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||o&&!d)o?c(null):l();else{const t=o?0:r,e=4*t;let i=f.clippingState||null;u.value=i,i=c(h,s,e,a);for(let r=0;r!==e;++r)i[r]=n[r];f.clippingState=i,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function sl(t){let e=new WeakMap;function n(t,e){return e===ee?t.mapping=$t:e===ne&&(t.mapping=te),t}function r(r){if(r&&r.isTexture){const o=r.mapping;if(o===ee||o===ne){if(e.has(r)){const t=e.get(r).texture;return n(t,r.mapping)}{const o=r.image;if(o&&o.height>0){const s=t.getRenderTarget(),a=new Ms(o.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),t.setRenderTarget(s),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}function al(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function ul(t,e,n,r){const i={},o=new WeakMap;function s(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const n in a.attributes)e.remove(a.attributes[n]);a.removeEventListener("dispose",s),delete i[a.id];const u=o.get(a);u&&(e.remove(u),o.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t,e){return!0===i[e.id]||(e.addEventListener("dispose",s),i[e.id]=!0,n.memory.geometries++),e}function u(t){const n=t.attributes;for(const i in n)e.update(n[i],34962);const r=t.morphAttributes;for(const i in r){const t=r[i];for(let n=0,r=t.length;n<r;n++)e.update(t[n],34962)}}function l(t){const n=[],r=t.index,i=t.attributes.position;let s=0;if(null!==r){const t=r.array;s=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],o=t[e+2];n.push(r,i,i,o,o,r)}}else{const t=i.array;s=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}const a=new(No(n)>65535?Po:Co)(n,1);a.version=s;const u=o.get(t);u&&e.remove(u),o.set(t,a)}function c(t){const e=o.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&l(t)}else l(t);return o.get(t)}return{get:a,update:u,getWireframeAttribute:c}}function ll(t,e,n,r){const i=r.isWebGL2;let o,s,a;function u(t){o=t}function l(t){s=t.type,a=t.bytesPerElement}function c(e,r){t.drawElements(o,r,s,e*a),n.update(r,o,1)}function h(r,u,l){if(0===l)return;let c,h;if(i)c=t,h="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](o,u,s,r*a,l),n.update(u,o,l)}this.setMode=u,this.setIndex=l,this.render=c,this.renderInstances=h}function cl(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(t,e,r){switch(n.calls++,e){case 4:n.triangles+=r*(t/3);break;case 1:n.lines+=r*(t/2);break;case 3:n.lines+=r*(t-1);break;case 2:n.lines+=r*t;break;case 0:n.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e);break}}function i(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function hl(t,e){return t[0]-e[0]}function pl(t,e){return Math.abs(e[1])-Math.abs(t[1])}function dl(t){const e={},n=new Float32Array(8),r=[];for(let o=0;o<8;o++)r[o]=[o,0];function i(i,o,s,a){const u=i.morphTargetInfluences,l=void 0===u?0:u.length;let c=e[o.id];if(void 0===c){c=[];for(let t=0;t<l;t++)c[t]=[t,0];e[o.id]=c}for(let t=0;t<l;t++){const e=c[t];e[0]=t,e[1]=u[t]}c.sort(pl);for(let t=0;t<8;t++)t<l&&c[t][1]?(r[t][0]=c[t][0],r[t][1]=c[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(hl);const h=s.morphTargets&&o.morphAttributes.position,p=s.morphNormals&&o.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=r[t],i=e[0],s=e[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+t)!==h[i]&&o.setAttribute("morphTarget"+t,h[i]),p&&o.getAttribute("morphNormal"+t)!==p[i]&&o.setAttribute("morphNormal"+t,p[i]),n[t]=s,d+=s):(h&&!0===o.hasAttribute("morphTarget"+t)&&o.deleteAttribute("morphTarget"+t),p&&!0===o.hasAttribute("morphNormal"+t)&&o.deleteAttribute("morphNormal"+t),n[t]=0)}const f=o.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",f),a.getUniforms().setValue(t,"morphTargetInfluences",n)}return{update:i}}function fl(t,e,n,r){let i=new WeakMap;function o(t){const o=r.render.frame,s=t.geometry,u=e.get(t,s);return i.get(u)!==o&&(e.update(u),i.set(u,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),u}function s(){i=new WeakMap}function a(t){const e=t.target;e.removeEventListener("dispose",a),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:o,dispose:s}}tl.physical={uniforms:ps([tl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Or(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new vo(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Qu.meshphysical_vert,fragmentShader:Qu.meshphysical_frag};class gl extends zr{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=ue,this.minFilter=ue,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}gl.prototype.isDataTexture2DArray=!0;class ml extends zr{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=ue,this.minFilter=ue,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}ml.prototype.isDataTexture3D=!0;const yl=new zr,vl=new gl,xl=new ml,_l=new ws,bl=[],wl=[],Ml=new Float32Array(16),El=new Float32Array(9),Sl=new Float32Array(4);function Tl(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let o=bl[i];if(void 0===o&&(o=new Float32Array(i),bl[i]=o),0!==e){r.toArray(o,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i)}return o}function Cl(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Al(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Pl(t,e){let n=wl[e];void 0===n&&(n=new Int32Array(e),wl[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Ll(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Il(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Cl(n,e))return;t.uniform2fv(this.addr,e),Al(n,e)}}function Rl(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Cl(n,e))return;t.uniform3fv(this.addr,e),Al(n,e)}}function Nl(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Cl(n,e))return;t.uniform4fv(this.addr,e),Al(n,e)}}function Ol(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Cl(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Al(n,e)}else{if(Cl(n,r))return;Sl.set(r),t.uniformMatrix2fv(this.addr,!1,Sl),Al(n,r)}}function Dl(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Cl(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Al(n,e)}else{if(Cl(n,r))return;El.set(r),t.uniformMatrix3fv(this.addr,!1,El),Al(n,r)}}function Fl(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(Cl(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Al(n,e)}else{if(Cl(n,r))return;Ml.set(r),t.uniformMatrix4fv(this.addr,!1,Ml),Al(n,r)}}function kl(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Bl(t,e){const n=this.cache;Cl(n,e)||(t.uniform2iv(this.addr,e),Al(n,e))}function zl(t,e){const n=this.cache;Cl(n,e)||(t.uniform3iv(this.addr,e),Al(n,e))}function Gl(t,e){const n=this.cache;Cl(n,e)||(t.uniform4iv(this.addr,e),Al(n,e))}function Ul(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Vl(t,e){const n=this.cache;Cl(n,e)||(t.uniform2uiv(this.addr,e),Al(n,e))}function Hl(t,e){const n=this.cache;Cl(n,e)||(t.uniform3uiv(this.addr,e),Al(n,e))}function jl(t,e){const n=this.cache;Cl(n,e)||(t.uniform4uiv(this.addr,e),Al(n,e))}function Wl(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||yl,i)}function ql(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||xl,i)}function Yl(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||_l,i)}function Xl(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||vl,i)}function Zl(t){switch(t){case 5126:return Ll;case 35664:return Il;case 35665:return Rl;case 35666:return Nl;case 35674:return Ol;case 35675:return Dl;case 35676:return Fl;case 5124:case 35670:return kl;case 35667:case 35671:return Bl;case 35668:case 35672:return zl;case 35669:case 35673:return Gl;case 5125:return Ul;case 36294:return Vl;case 36295:return Hl;case 36296:return jl;case 35678:case 36198:case 36298:case 36306:case 35682:return Wl;case 35679:case 36299:case 36307:return ql;case 35680:case 36300:case 36308:case 36293:return Yl;case 36289:case 36303:case 36311:case 36292:return Xl}}function Kl(t,e){t.uniform1fv(this.addr,e)}function Jl(t,e){const n=Tl(e,this.size,2);t.uniform2fv(this.addr,n)}function Ql(t,e){const n=Tl(e,this.size,3);t.uniform3fv(this.addr,n)}function $l(t,e){const n=Tl(e,this.size,4);t.uniform4fv(this.addr,n)}function tc(t,e){const n=Tl(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function ec(t,e){const n=Tl(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function nc(t,e){const n=Tl(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function rc(t,e){t.uniform1iv(this.addr,e)}function ic(t,e){t.uniform2iv(this.addr,e)}function oc(t,e){t.uniform3iv(this.addr,e)}function sc(t,e){t.uniform4iv(this.addr,e)}function ac(t,e){t.uniform1uiv(this.addr,e)}function uc(t,e){t.uniform2uiv(this.addr,e)}function lc(t,e){t.uniform3uiv(this.addr,e)}function cc(t,e){t.uniform4uiv(this.addr,e)}function hc(t,e,n){const r=e.length,i=Pl(n,r);t.uniform1iv(this.addr,i);for(let o=0;o!==r;++o)n.safeSetTexture2D(e[o]||yl,i[o])}function pc(t,e,n){const r=e.length,i=Pl(n,r);t.uniform1iv(this.addr,i);for(let o=0;o!==r;++o)n.safeSetTextureCube(e[o]||_l,i[o])}function dc(t){switch(t){case 5126:return Kl;case 35664:return Jl;case 35665:return Ql;case 35666:return $l;case 35674:return tc;case 35675:return ec;case 35676:return nc;case 5124:case 35670:return rc;case 35667:case 35671:return ic;case 35668:case 35672:return oc;case 35669:case 35673:return sc;case 5125:return ac;case 36294:return uc;case 36295:return lc;case 36296:return cc;case 35678:case 36198:case 36298:case 36306:case 35682:return hc;case 35680:case 36300:case 36308:case 36293:return pc}}function fc(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=Zl(e.type)}function gc(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=dc(e.type)}function mc(t){this.id=t,this.seq=[],this.map={}}gc.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Al(e,t)},mc.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(t,e[o.id],n)}};const yc=/(\w+)(\])?(\[|\.)?/g;function vc(t,e){t.seq.push(e),t.map[e.id]=e}function xc(t,e,n){const r=t.name,i=r.length;yc.lastIndex=0;while(1){const o=yc.exec(r),s=yc.lastIndex;let a=o[1];const u="]"===o[2],l=o[3];if(u&&(a|=0),void 0===l||"["===l&&s+2===i){vc(n,void 0===l?new fc(a,t,e):new gc(a,t,e));break}{const t=n.map;let e=t[a];void 0===e&&(e=new mc(a),vc(n,e)),n=e}}}function _c(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r),i=t.getUniformLocation(e,n.name);xc(n,i,this)}}function bc(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}_c.prototype.setValue=function(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)},_c.prototype.setOptional=function(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)},_c.upload=function(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const o=e[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,r)}},_c.seqWithValue=function(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n};let wc=0;function Mc(t){const e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}function Ec(t){switch(t){case Wn:return["Linear","( value )"];case qn:return["sRGB","( value )"];case Xn:return["RGBE","( value )"];case Kn:return["RGBM","( value, 7.0 )"];case Jn:return["RGBM","( value, 16.0 )"];case Qn:return["RGBD","( value, 256.0 )"];case Yn:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Zn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Sc(t,e,n){const r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const o=t.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+Mc(o)}function Tc(t,e){const n=Ec(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Cc(t,e){const n=Ec(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ac(t,e){let n;switch(e){case Yt:n="Linear";break;case Xt:n="Reinhard";break;case Zt:n="OptimizedCineon";break;case Kt:n="ACESFilmic";break;case Jt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Pc(t){const e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(Rc).join("\n")}function Lc(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}function Ic(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),o=r.name;n[o]=t.getAttribLocation(e,o)}return n}function Rc(t){return""!==t}function Nc(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Oc(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Dc=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fc(t){return t.replace(Dc,kc)}function kc(t,e){const n=Qu[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Fc(n)}const Bc=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,zc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gc(t){return t.replace(zc,Vc).replace(Bc,Uc)}function Uc(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Vc(t,e,n,r)}function Vc(t,e,n,r){let i="";for(let o=parseInt(e);o<parseInt(n);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Hc(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function jc(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===ot?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===st?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===at&&(e="SHADOWMAP_TYPE_VSM"),e}function Wc(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case $t:case te:e="ENVMAP_TYPE_CUBE";break;case re:case ie:e="ENVMAP_TYPE_CUBE_UV";break}return e}function qc(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case te:case ie:e="ENVMAP_MODE_REFRACTION";break}return e}function Yc(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Ht:e="ENVMAP_BLENDING_MULTIPLY";break;case jt:e="ENVMAP_BLENDING_MIX";break;case Wt:e="ENVMAP_BLENDING_ADD";break}return e}function Xc(t,e,n,r){const i=t.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const u=jc(n),l=Wc(n),c=qc(n),h=Yc(n),p=t.gammaFactor>0?t.gammaFactor:1,d=n.isWebGL2?"":Pc(n),f=Lc(o),g=i.createProgram();let m,y,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(m=[f].filter(Rc).join("\n"),m.length>0&&(m+="\n"),y=[d,f].filter(Rc).join("\n"),y.length>0&&(y+="\n")):(m=[Hc(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Rc).join("\n"),y=[d,Hc(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==qt?"#define TONE_MAPPING":"",n.toneMapping!==qt?Qu["tonemapping_pars_fragment"]:"",n.toneMapping!==qt?Ac("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Qu["encodings_pars_fragment"],n.map?Tc("mapTexelToLinear",n.mapEncoding):"",n.matcap?Tc("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Tc("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Tc("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Tc("lightMapTexelToLinear",n.lightMapEncoding):"",Cc("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Rc).join("\n")),s=Fc(s),s=Nc(s,n),s=Oc(s,n),a=Fc(a),a=Nc(a,n),a=Oc(a,n),s=Gc(s),a=Gc(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",m=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,y=["#define varying in",n.glslVersion===Pr?"":"out highp vec4 pc_fragColor;",n.glslVersion===Pr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const x=v+m+s,_=v+y+a,b=bc(i,35633,x),w=bc(i,35632,_);if(i.attachShader(g,b),i.attachShader(g,w),void 0!==n.index0AttributeName?i.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g),t.debug.checkShaderErrors){const t=i.getProgramInfoLog(g).trim(),e=i.getShaderInfoLog(b).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(g,35714)){r=!1;const e=Sc(i,b,"vertex"),n=Sc(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(g,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:m},fragmentShader:{log:n,prefix:y}})}let M,E;return i.deleteShader(b),i.deleteShader(w),this.getUniforms=function(){return void 0===M&&(M=new _c(i,g)),M},this.getAttributes=function(){return void 0===E&&(E=Ic(i,g)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=wc++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=w,this}function Zc(t,e,n,r,i,o){const s=[],a=r.isWebGL2,u=r.logarithmicDepthBuffer,l=r.floatVertexTextures,c=r.maxVertexUniforms,h=r.vertexTextures;let p=r.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function g(t){const e=t.skeleton,n=e.bones;if(l)return 1024;{const t=c,e=Math.floor((t-20)/4),r=Math.min(e,n.length);return r<n.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+n.length+" bones. This GPU supports "+r+"."),0):r}}function m(t){let e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Wn,e}function y(i,s,c,f,y){const v=f.fog,x=i.isMeshStandardMaterial?f.environment:null,_=e.get(i.envMap||x),b=d[i.type],w=y.isSkinnedMesh?g(y):0;let M,E;if(null!==i.precision&&(p=r.getMaxPrecision(i.precision),p!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",p,"instead.")),b){const t=tl[b];M=t.vertexShader,E=t.fragmentShader}else M=i.vertexShader,E=i.fragmentShader;const S=t.getRenderTarget(),T={isWebGL2:a,shaderID:b,shaderName:i.type,vertexShader:M,fragmentShader:E,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:p,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:m(_),envMapCubeUV:!!_&&(_.mapping===re||_.mapping===ie),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===nr,tangentSpaceNormalMap:i.normalMapType===er,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap||!!i.transmissionMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap)&&!!i.displacementMap,fog:!!v,useFog:i.fog,fogExp2:v&&v.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:u,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:i.morphTargets,morphNormals:i.morphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:qt,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===ct,flipSided:i.side===lt,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()};return T}function v(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<f.length;t++)n.push(e[f[t]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()}function x(t){const e=d[t.type];let n;if(e){const t=tl[e];n=ds.clone(t.uniforms)}else n=t.uniforms;return n}function _(e,n){let r;for(let t=0,i=s.length;t<i;t++){const e=s[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new Xc(t,n,e,i),s.push(r)),r}function b(t){if(0===--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}}return{getParameters:y,getProgramCacheKey:v,getUniforms:x,acquireProgram:_,releaseProgram:b,programs:s}}function Kc(){let t=new WeakMap;function e(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n}function n(e){t.delete(e)}function r(e,n,r){t.get(e)[n]=r}function i(){t=new WeakMap}return{get:e,remove:n,update:r,dispose:i}}function Jc(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Qc(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function $c(t){const e=[];let n=0;const r=[],i=[],o={id:-1};function s(){n=0,r.length=0,i.length=0}function a(r,i,s,a,u,l){let c=e[n];const h=t.get(s);return void 0===c?(c={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:u,group:l},e[n]=c):(c.id=r.id,c.object=r,c.geometry=i,c.material=s,c.program=h.program||o,c.groupOrder=a,c.renderOrder=r.renderOrder,c.z=u,c.group=l),n++,c}function u(t,e,n,o,s,u){const l=a(t,e,n,o,s,u);(!0===n.transparent?i:r).push(l)}function l(t,e,n,o,s,u){const l=a(t,e,n,o,s,u);(!0===n.transparent?i:r).unshift(l)}function c(t,e){r.length>1&&r.sort(t||Jc),i.length>1&&i.sort(e||Qc)}function h(){for(let t=n,r=e.length;t<r;t++){const n=e[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}}return{opaque:r,transparent:i,init:s,push:u,unshift:l,finish:h,sort:c}}function th(t){let e=new WeakMap;function n(n,r){let i;return!1===e.has(n)?(i=new $c(t),e.set(n,[i])):r>=e.get(n).length?(i=new $c(t),e.get(n).push(i)):i=e.get(n)[r],i}function r(){e=new WeakMap}return{get:n,dispose:r}}function eh(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Wr,color:new vo};break;case"SpotLight":n={position:new Wr,direction:new Wr,color:new vo,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Wr,color:new vo,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Wr,skyColor:new vo,groundColor:new vo};break;case"RectAreaLight":n={color:new vo,position:new Wr,halfWidth:new Wr,halfHeight:new Wr};break}return t[e.id]=n,n}}}function nh(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Or};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Or};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Or,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let rh=0;function ih(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function oh(t,e){const n=new eh,r=nh(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let c=0;c<9;c++)i.probe.push(new Wr);const o=new Wr,s=new wi,a=new wi;function u(o){let s=0,a=0,u=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,c=0,h=0,p=0,d=0,f=0,g=0,m=0;o.sort(ih);for(let t=0,e=o.length;t<e;t++){const e=o[t],y=e.color,v=e.intensity,x=e.distance,_=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)s+=y.r*v,a+=y.g*v,u+=y.b*v;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=_,i.directionalShadowMatrix[l]=e.shadow.matrix,f++}i.directional[l]=t,l++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(y).multiplyScalar(v),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=_,i.spotShadowMatrix[h]=e.shadow.matrix,m++}i.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(y).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[c]=n,i.pointShadowMap[c]=_,i.pointShadowMatrix[c]=e.shadow.matrix,g++}i.point[c]=t,c++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(v),t.groundColor.copy(e.groundColor).multiplyScalar(v),i.hemi[d]=t,d++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=$u.LTC_FLOAT_1,i.rectAreaLTC2=$u.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=$u.LTC_HALF_1,i.rectAreaLTC2=$u.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=u;const y=i.hash;y.directionalLength===l&&y.pointLength===c&&y.spotLength===h&&y.rectAreaLength===p&&y.hemiLength===d&&y.numDirectionalShadows===f&&y.numPointShadows===g&&y.numSpotShadows===m||(i.directional.length=l,i.spot.length=h,i.rectArea.length=p,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=m,y.directionalLength=l,y.pointLength=c,y.spotLength=h,y.rectAreaLength=p,y.hemiLength=d,y.numDirectionalShadows=f,y.numPointShadows=g,y.numSpotShadows=m,i.version=rh++)}function l(t,e){let n=0,r=0,u=0,l=0,c=0;const h=e.matrixWorldInverse;for(let p=0,d=t.length;p<d;p++){const e=t[p];if(e.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),o.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),n++}else if(e.isSpotLight){const t=i.spot[u];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),o.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(o),t.direction.transformDirection(h),u++}else if(e.isRectAreaLight){const t=i.rectArea[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),a.identity(),s.copy(e.matrixWorld),s.premultiply(h),a.extractRotation(s),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(e.isPointLight){const t=i.point[r];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),r++}else if(e.isHemisphereLight){const t=i.hemi[c];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),c++}}}return{setup:u,setupView:l,state:i}}function sh(t,e){const n=new oh(t,e),r=[],i=[];function o(){r.length=0,i.length=0}function s(t){r.push(t)}function a(t){i.push(t)}function u(){n.setup(r)}function l(t){n.setupView(r,t)}const c={lightsArray:r,shadowsArray:i,lights:n};return{init:o,state:c,setupLights:u,setupLightsView:l,pushLight:s,pushShadow:a}}function ah(t,e){let n=new WeakMap;function r(r,i=0){let o;return!1===n.has(r)?(o=new sh(t,e),n.set(r,[o])):i>=n.get(r).length?(o=new sh(t,e),n.get(r).push(o)):o=n.get(r)[i],o}function i(){n=new WeakMap}return{get:r,dispose:i}}class uh extends co{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=$n,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}uh.prototype.isMeshDepthMaterial=!0;class lh extends co{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Wr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}lh.prototype.isMeshDistanceMaterial=!0;var ch="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",hh="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ph(t,e,n){let r=new Cs;const i=new Or,o=new Or,s=new Ur,a=[],u=[],l={},c=n.maxTextureSize,h={0:lt,1:ut,2:ct},p=new ms({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Or},radius:{value:4}},vertexShader:hh,fragmentShader:ch}),d=p.clone();d.defines.HORIZONTAL_PASS=1;const f=new Ho;f.setAttribute("position",new wo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new as(f,p),m=this;function y(n,r){const i=e.update(g);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,p,g,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,g,null)}function v(t,e,n){const r=t<<0|e<<1|n<<2;let i=a[r];return void 0===i&&(i=new uh({depthPacking:tr,morphTargets:t,skinning:e}),a[r]=i),i}function x(t,e,n){const r=t<<0|e<<1|n<<2;let i=u[r];return void 0===i&&(i=new lh({morphTargets:t,skinning:e}),u[r]=i),i}function _(e,n,r,i,o,s,a){let u=null,c=v,p=e.customDepthMaterial;if(!0===i.isPointLight&&(c=x,p=e.customDistanceMaterial),void 0===p){let t=!1;!0===r.morphTargets&&(t=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e));const o=!0===e.isInstancedMesh;u=c(t,i,o)}else u=p;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const t=u.uuid,e=r.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let i=n[e];void 0===i&&(i=u.clone(),n[e]=i),u=i}return u.visible=r.visible,u.wireframe=r.wireframe,u.side=a===at?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],u.clipShadows=r.clipShadows,u.clippingPlanes=r.clippingPlanes,u.clipIntersection=r.clipIntersection,u.wireframeLinewidth=r.wireframeLinewidth,u.linewidth=r.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=o,u.farDistance=s),u}function b(n,i,o,s,a){if(!1===n.visible)return;const u=n.layers.test(i.layers);if(u&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===at)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=e.update(n),i=n.material;if(Array.isArray(i)){const e=r.groups;for(let u=0,l=e.length;u<l;u++){const l=e[u],c=i[l.materialIndex];if(c&&c.visible){const e=_(n,r,c,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,l)}}}else if(i.visible){const e=_(n,r,i,s,o.near,o.far,a);t.renderBufferDirect(o,null,r,e,n,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ot,this.render=function(e,n,a){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===e.length)return;const u=t.getRenderTarget(),l=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(dt),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let d=0,f=e.length;d<f;d++){const u=e[d],l=u.shadow;if(void 0===l){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===l.autoUpdate&&!1===l.needsUpdate)continue;i.copy(l.mapSize);const h=l.getFrameExtents();if(i.multiply(h),o.copy(l.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(o.x=Math.floor(c/h.x),i.x=o.x*h.x,l.mapSize.x=o.x),i.y>c&&(o.y=Math.floor(c/h.y),i.y=o.y*h.y,l.mapSize.y=o.y)),null===l.map&&!l.isPointLightShadow&&this.type===at){const t={minFilter:de,magFilter:de,format:Re};l.map=new Vr(i.x,i.y,t),l.map.texture.name=u.name+".shadowMap",l.mapPass=new Vr(i.x,i.y,t),l.camera.updateProjectionMatrix()}if(null===l.map){const t={minFilter:ue,magFilter:ue,format:Re};l.map=new Vr(i.x,i.y,t),l.map.texture.name=u.name+".shadowMap",l.camera.updateProjectionMatrix()}t.setRenderTarget(l.map),t.clear();const f=l.getViewportCount();for(let t=0;t<f;t++){const e=l.getViewport(t);s.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),p.viewport(s),l.updateMatrices(u,t),r=l.getFrustum(),b(n,a,l.camera,u,this.type)}l.isPointLightShadow||this.type!==at||y(l,a),l.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(u,l,h)}}function dh(t,e,n){const r=n.isWebGL2;function i(){let e=!1;const n=new Ur;let r=null;const i=new Ur(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,s,a){!0===a&&(e*=s,r*=s,o*=s),n.set(e,r,o,s),!1===i.equals(n)&&(t.clearColor(e,r,o,s),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}}function o(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?B(2929):z(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case Dt:t.depthFunc(512);break;case Ft:t.depthFunc(519);break;case kt:t.depthFunc(513);break;case Bt:t.depthFunc(515);break;case zt:t.depthFunc(514);break;case Gt:t.depthFunc(518);break;case Ut:t.depthFunc(516);break;case Vt:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}}function s(){let e=!1,n=null,r=null,i=null,o=null,s=null,a=null,u=null,l=null;return{setTest:function(t){e||(t?B(2960):z(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,s){r===e&&i===n&&o===s||(t.stencilFunc(e,n,s),r=e,i=n,o=s)},setOp:function(e,n,r){s===e&&a===n&&u===r||(t.stencilOp(e,n,r),s=e,a=n,u=r)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,s=null,a=null,u=null,l=null}}}const a=new i,u=new o,l=new s;let c={},h=null,p={},d=null,f=!1,g=null,m=null,y=null,v=null,x=null,_=null,b=null,w=!1,M=null,E=null,S=null,T=null,C=null;const A=t.getParameter(35661);let P=!1,L=0;const I=t.getParameter(7938);-1!==I.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(I)[1]),P=L>=1):-1!==I.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),P=L>=2);let R=null,N={};const O=new Ur(0,0,t.canvas.width,t.canvas.height),D=new Ur(0,0,t.canvas.width,t.canvas.height);function F(e,n,r){const i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let s=0;s<r;s++)t.texImage2D(n+s,0,6408,1,1,0,6408,5121,i);return o}const k={};function B(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function z(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}function G(e){e!==h&&(t.bindFramebuffer(36160,e),h=e)}function U(e,n){null===n&&null!==h&&(n=h),p[e]!==n&&(t.bindFramebuffer(e,n),p[e]=n)}function V(e){return d!==e&&(t.useProgram(e),d=e,!0)}k[3553]=F(3553,3553,1),k[34067]=F(34067,34069,6),a.setClear(0,0,0,1),u.setClear(1),l.setClear(0),B(2929),u.setFunc(Bt),Y(!1),X(et),B(2884),W(dt);const H={[xt]:32774,[_t]:32778,[bt]:32779};if(r)H[wt]=32775,H[Mt]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(H[wt]=t.MIN_EXT,H[Mt]=t.MAX_EXT)}const j={[Et]:0,[St]:1,[Tt]:768,[At]:770,[Ot]:776,[Rt]:774,[Lt]:772,[Ct]:769,[Pt]:771,[Nt]:775,[It]:773};function W(e,n,r,i,o,s,a,u){if(e!==dt){if(!1===f&&(B(3042),f=!0),e===vt)o=o||n,s=s||r,a=a||i,n===m&&o===x||(t.blendEquationSeparate(H[n],H[o]),m=n,x=o),r===y&&i===v&&s===_&&a===b||(t.blendFuncSeparate(j[r],j[i],j[s],j[a]),y=r,v=i,_=s,b=a),g=e,w=null;else if(e!==g||u!==w){if(m===xt&&x===xt||(t.blendEquation(32774),m=xt,x=xt),u)switch(e){case ft:t.blendFuncSeparate(1,771,1,771);break;case gt:t.blendFunc(1,1);break;case mt:t.blendFuncSeparate(0,0,769,771);break;case yt:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case ft:t.blendFuncSeparate(770,771,1,771);break;case gt:t.blendFunc(770,1);break;case mt:t.blendFunc(0,769);break;case yt:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}y=null,v=null,_=null,b=null,g=e,w=u}}else!0===f&&(z(3042),f=!1)}function q(t,e){t.side===ct?z(2884):B(2884);let n=t.side===lt;e&&(n=!n),Y(n),t.blending===ft&&!1===t.transparent?W(dt):W(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),u.setFunc(t.depthFunc),u.setTest(t.depthTest),u.setMask(t.depthWrite),a.setMask(t.colorWrite);const r=t.stencilWrite;l.setTest(r),r&&(l.setMask(t.stencilWriteMask),l.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),l.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),K(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(32926):z(32926)}function Y(e){M!==e&&(e?t.frontFace(2304):t.frontFace(2305),M=e)}function X(e){e!==tt?(B(2884),e!==E&&(e===et?t.cullFace(1029):e===nt?t.cullFace(1028):t.cullFace(1032))):z(2884),E=e}function Z(e){e!==S&&(P&&t.lineWidth(e),S=e)}function K(e,n,r){e?(B(32823),T===n&&C===r||(t.polygonOffset(n,r),T=n,C=r)):z(32823)}function J(t){t?B(3089):z(3089)}function Q(e){void 0===e&&(e=33984+A-1),R!==e&&(t.activeTexture(e),R=e)}function $(e,n){null===R&&Q();let r=N[R];void 0===r&&(r={type:void 0,texture:void 0},N[R]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||k[e]),r.type=e,r.texture=n)}function rt(){const e=N[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)}function it(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function ot(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function st(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}}function at(e){!1===O.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),O.copy(e))}function ut(e){!1===D.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),D.copy(e))}function ht(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},R=null,N={},h=null,p={},d=null,f=!1,g=null,m=null,y=null,v=null,x=null,_=null,b=null,w=!1,M=null,E=null,S=null,T=null,C=null,O.set(0,0,t.canvas.width,t.canvas.height),D.set(0,0,t.canvas.width,t.canvas.height),a.reset(),u.reset(),l.reset()}return{buffers:{color:a,depth:u,stencil:l},enable:B,disable:z,bindFramebuffer:U,bindXRFramebuffer:G,useProgram:V,setBlending:W,setMaterial:q,setFlipSided:Y,setCullFace:X,setLineWidth:Z,setPolygonOffset:K,setScissorTest:J,activeTexture:Q,bindTexture:$,unbindTexture:rt,compressedTexImage2D:it,texImage2D:ot,texImage3D:st,scissor:at,viewport:ut,reset:ht}}function fh(t,e,n,r,i,o,s){const a=i.isWebGL2,u=i.maxTextures,l=i.maxCubemapSize,c=i.maxTextureSize,h=i.maxSamples,p=new WeakMap;let d,f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch($){}function g(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function m(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?Nr.floorPowerOfTwo:Math.floor,o=r(i*t.width),s=r(i*t.height);void 0===d&&(d=g(o,s));const a=n?g(o,s):d;a.width=o,a.height=s;const u=a.getContext("2d");return u.drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function y(t){return Nr.isPowerOfTwo(t.width)&&Nr.isPowerOfTwo(t.height)}function v(t){return!a&&(t.wrapS!==se||t.wrapT!==se||t.minFilter!==ue&&t.minFilter!==de)}function x(t,e){return t.generateMipmaps&&e&&t.minFilter!==ue&&t.minFilter!==de}function _(e,n,i,o){t.generateMipmap(e);const s=r.get(n);s.__maxMipLevel=Math.log2(Math.max(i,o))}function b(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function w(t){return t===ue||t===le||t===he?9728:9729}function M(t){const e=t.target;e.removeEventListener("dispose",M),S(e),e.isVideoTexture&&p.delete(e),s.memory.textures--}function E(t){const e=t.target;e.removeEventListener("dispose",E),T(e),s.memory.textures--}function S(e){const n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e))}function T(e){const n=e.texture,i=r.get(e),o=r.get(n);if(e){if(void 0!==o.__webglTexture&&t.deleteTexture(o.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);r.remove(n),r.remove(e)}}let C=0;function A(){C=0}function P(){const t=C;return t>=u&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+u),C+=1,t}function L(t,e){const i=r.get(t);if(t.isVideoTexture&&X(t),t.version>0&&i.__version!==t.version){const n=t.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void B(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function I(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?B(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))}function R(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?B(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))}function N(t,e){const i=r.get(t);t.version>0&&i.__version!==t.version?z(i,t,e):(n.activeTexture(33984+e),n.bindTexture(34067,i.__webglTexture))}const O={[oe]:10497,[se]:33071,[ae]:33648},D={[ue]:9728,[le]:9984,[he]:9986,[de]:9729,[fe]:9985,[me]:9987};function F(n,o,s){if(s?(t.texParameteri(n,10242,O[o.wrapS]),t.texParameteri(n,10243,O[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,O[o.wrapR]),t.texParameteri(n,10240,D[o.magFilter]),t.texParameteri(n,10241,D[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===se&&o.wrapT===se||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,w(o.magFilter)),t.texParameteri(n,10241,w(o.minFilter)),o.minFilter!==ue&&o.minFilter!==de&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const s=e.get("EXT_texture_filter_anisotropic");if(o.type===Ee&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&o.type===Se&&!1===e.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function k(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",M),e.__webglTexture=t.createTexture(),s.memory.textures++)}function B(e,r,i){let s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),k(e,r),n.activeTexture(33984+i),n.bindTexture(s,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const u=v(r)&&!1===y(r.image),l=m(r.image,u,!1,c),h=y(l)||a,p=o.convert(r.format);let d,f=o.convert(r.type),g=b(r.internalFormat,p,f);F(s,r,h);const w=r.mipmaps;if(r.isDepthTexture)g=6402,a?g=r.type===Ee?36012:r.type===Me?33190:r.type===Pe?35056:33189:r.type===Ee&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Fe&&6402===g&&r.type!==be&&r.type!==Me&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=be,f=o.convert(r.type)),r.format===ke&&6402===g&&(g=34041,r.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Pe,f=o.convert(r.type))),n.texImage2D(3553,0,g,l.width,l.height,0,p,f,null);else if(r.isDataTexture)if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)d=w[t],n.texImage2D(3553,t,g,d.width,d.height,0,p,f,d.data);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,g,l.width,l.height,0,p,f,l.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,e=w.length;t<e;t++)d=w[t],r.format!==Re&&r.format!==Ie?null!==p?n.compressedTexImage2D(3553,t,g,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,t,g,d.width,d.height,0,p,f,d.data);e.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,g,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,g,l.width,l.height,l.depth,0,p,f,l.data),e.__maxMipLevel=0;else if(w.length>0&&h){for(let t=0,e=w.length;t<e;t++)d=w[t],n.texImage2D(3553,t,g,p,f,d);r.generateMipmaps=!1,e.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,g,p,f,l),e.__maxMipLevel=0;x(r,h)&&_(s,r,l.width,l.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function z(e,r,i){if(6!==r.image.length)return;k(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),u=r.image[0]&&r.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=s||u?u?r.image[t].image:r.image[t]:m(r.image[t],!1,!0,l);const h=c[0],p=y(h)||a,d=o.convert(r.format),f=o.convert(r.type),g=b(r.internalFormat,d,f);let v;if(F(34067,r,p),s){for(let t=0;t<6;t++){v=c[t].mipmaps;for(let e=0;e<v.length;e++){const i=v[e];r.format!==Re&&r.format!==Ie?null!==d?n.compressedTexImage2D(34069+t,e,g,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+t,e,g,i.width,i.height,0,d,f,i.data)}}e.__maxMipLevel=v.length-1}else{v=r.mipmaps;for(let t=0;t<6;t++)if(u){n.texImage2D(34069+t,0,g,c[t].width,c[t].height,0,d,f,c[t].data);for(let e=0;e<v.length;e++){const r=v[e],i=r.image[t].image;n.texImage2D(34069+t,e+1,g,i.width,i.height,0,d,f,i.data)}}else{n.texImage2D(34069+t,0,g,d,f,c[t]);for(let e=0;e<v.length;e++){const r=v[e];n.texImage2D(34069+t,e+1,g,d,f,r.image[t])}}e.__maxMipLevel=v.length}x(r,p)&&_(34067,r,h.width,h.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function G(e,i,s,a){const u=i.texture,l=o.convert(u.format),c=o.convert(u.type),h=b(u.internalFormat,l,c);32879===a||35866===a?n.texImage3D(a,0,h,i.width,i.height,i.depth,0,l,c,null):n.texImage2D(a,0,h,i.width,i.height,0,l,c,null),n.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,a,r.get(u).__webglTexture,0),n.bindFramebuffer(36160,null)}function U(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===Ee?i=36012:e.type===Me&&(i=33190));const r=Y(n);t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=Y(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=n.texture,i=o.convert(e.format),s=o.convert(e.type),a=b(e.internalFormat,i,s);if(r){const e=Y(n);t.renderbufferStorageMultisample(36161,e,a,n.width,n.height)}else t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function V(e,i){const o=i&&i.isWebGLCubeRenderTarget;if(o)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),L(i.depthTexture,0);const s=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Fe)t.framebufferTexture2D(36160,36096,3553,s,0);else{if(i.depthTexture.format!==ke)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,s,0)}}function H(e){const i=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");V(i.__webglFramebuffer,e)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=t.createRenderbuffer(),U(i.__webglDepthbuffer[r],e,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),U(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function j(e){const i=e.texture,u=r.get(e),l=r.get(i);e.addEventListener("dispose",E),l.__webglTexture=t.createTexture(),l.__version=i.version,s.memory.textures++;const c=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultisampleRenderTarget,p=i.isDataTexture3D||i.isDataTexture2DArray,d=y(e)||a;if(!a||i.format!==Ie||i.type!==Ee&&i.type!==Se||(i.format=Re,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){u.__webglFramebuffer=[];for(let e=0;e<6;e++)u.__webglFramebuffer[e]=t.createFramebuffer()}else if(u.__webglFramebuffer=t.createFramebuffer(),h)if(a){u.__webglMultisampledFramebuffer=t.createFramebuffer(),u.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,u.__webglColorRenderbuffer);const r=o.convert(i.format),s=o.convert(i.type),a=b(i.internalFormat,r,s),l=Y(e);t.renderbufferStorageMultisample(36161,l,a,e.width,e.height),n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(u.__webglDepthRenderbuffer=t.createRenderbuffer(),U(u.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),F(34067,i,d);for(let t=0;t<6;t++)G(u.__webglFramebuffer[t],e,36064,34069+t);x(i,d)&&_(34067,i,e.width,e.height),n.bindTexture(34067,null)}else{let t=3553;if(p)if(a){const e=i.isDataTexture3D;t=e?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(t,l.__webglTexture),F(t,i,d),G(u.__webglFramebuffer,e,36064,t),x(i,d)&&_(3553,i,e.width,e.height),n.bindTexture(3553,null)}e.depthBuffer&&H(e)}function W(t){const e=t.texture,i=y(t)||a;if(x(e,i)){const i=t.isWebGLCubeRenderTarget?34067:3553,o=r.get(e).__webglTexture;n.bindTexture(i,o),_(i,e,t.width,t.height),n.bindTexture(i,null)}}function q(e){if(e.isWebGLMultisampleRenderTarget)if(a){const i=r.get(e);n.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,i.__webglFramebuffer);const o=e.width,s=e.height;let a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,o,s,0,0,o,s,a,9728),n.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Y(t){return a&&t.isWebGLMultisampleRenderTarget?Math.min(h,t.samples):0}function X(t){const e=s.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}let Z=!1,K=!1;function J(t,e){t&&t.isWebGLRenderTarget&&(!1===Z&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Z=!0),t=t.texture),L(t,e)}function Q(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===K&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),K=!0),t=t.texture),N(t,e)}this.allocateTextureUnit=P,this.resetTextureUnits=A,this.setTexture2D=L,this.setTexture2DArray=I,this.setTexture3D=R,this.setTextureCube=N,this.setupRenderTarget=j,this.updateRenderTargetMipmap=W,this.updateMultisampleRenderTarget=q,this.safeSetTexture2D=J,this.safeSetTextureCube=Q}function gh(t,e,n){const r=n.isWebGL2;function i(t){let n;if(t===ve)return 5121;if(t===Te)return 32819;if(t===Ce)return 32820;if(t===Ae)return 33635;if(t===xe)return 5120;if(t===_e)return 5122;if(t===be)return 5123;if(t===we)return 5124;if(t===Me)return 5125;if(t===Ee)return 5126;if(t===Se)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(t===Le)return 6406;if(t===Ie)return 6407;if(t===Re)return 6408;if(t===Ne)return 6409;if(t===Oe)return 6410;if(t===Fe)return 6402;if(t===ke)return 34041;if(t===Be)return 6403;if(t===ze)return 36244;if(t===Ge)return 33319;if(t===Ue)return 33320;if(t===Ve)return 36248;if(t===He)return 36249;if(t===je||t===We||t===qe||t===Ye){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===je)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===We)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===qe)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Ye)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Xe||t===Ze||t===Ke||t===Je){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(t===Xe)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Ze)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Ke)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Je)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Qe)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===$e||t===tn)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(t===$e)return n.COMPRESSED_RGB8_ETC2;if(t===tn)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===en||t===nn||t===rn||t===on||t===sn||t===an||t===un||t===ln||t===cn||t===hn||t===pn||t===dn||t===fn||t===gn||t===yn||t===vn||t===xn||t===_n||t===bn||t===wn||t===Mn||t===En||t===Sn||t===Tn||t===Cn||t===An||t===Pn||t===Ln?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):t===mn?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):t===Pe?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}return{convert:i}}class mh extends vs{constructor(t=[]){super(),this.cameras=t}}mh.prototype.isArrayCamera=!0;class yh extends Yi{constructor(){super(),this.type="Group"}}function vh(){this._targetRay=null,this._grip=null,this._hand=null}function xh(t,e){const n=this,r=t.state;let i=null,o=1,s=null,a="local-floor",u=null;const l=[],c=new Map,h=new vs;h.layers.enable(1),h.viewport=new Ur;const p=new vs;p.layers.enable(2),p.viewport=new Ur;const d=[h,p],f=new mh;f.layers.enable(1),f.layers.enable(2);let g=null,m=null;function y(t){const e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function v(){c.forEach((function(t,e){t.disconnect(e)})),c.clear(),g=null,m=null,r.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),T.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function x(t){const e=i.inputSources;for(let n=0;n<l.length;n++)c.set(e[n],l[n]);for(let n=0;n<t.removed.length;n++){const e=t.removed[n],r=c.get(e);r&&(r.dispatchEvent({type:"disconnected",data:e}),c.delete(e))}for(let n=0;n<t.added.length;n++){const e=t.added[n],r=c.get(e);r&&r.dispatchEvent({type:"connected",data:e})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=l[t];return void 0===e&&(e=new vh,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=l[t];return void 0===e&&(e=new vh,l[t]=e),e.getGripSpace()},this.getHand=function(t){let e=l[t];return void 0===e&&(e=new vh,l[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return i},this.setSession=async function(t){if(i=t,null!==i){i.addEventListener("select",y),i.addEventListener("selectstart",y),i.addEventListener("selectend",y),i.addEventListener("squeeze",y),i.addEventListener("squeezestart",y),i.addEventListener("squeezeend",y),i.addEventListener("end",v),i.addEventListener("inputsourceschange",x);const t=e.getContextAttributes();!0!==t.xrCompatible&&await e.makeXRCompatible();const r={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:o},u=new XRWebGLLayer(i,e,r);i.updateRenderState({baseLayer:u}),s=await i.requestReferenceSpace(a),T.setContext(i),T.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const _=new Wr,b=new Wr;function w(t,e,n){_.setFromMatrixPosition(e.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);const r=_.distanceTo(b),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=s*c,d=s*h,f=r/(-c+h),g=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(g),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const m=s+f,y=a+f,v=p-g,x=d+(r-g),w=u*a/y*m,M=l*a/y*m;t.projectionMatrix.makePerspective(v,x,w,M,m,y)}function M(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){f.near=p.near=h.near=t.near,f.far=p.far=h.far=t.far,g===f.near&&m===f.far||(i.updateRenderState({depthNear:f.near,depthFar:f.far}),g=f.near,m=f.far);const e=t.parent,n=f.cameras;M(f,e);for(let i=0;i<n.length;i++)M(n[i],e);t.matrixWorld.copy(f.matrixWorld),t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const r=t.children;for(let i=0,o=r.length;i<o;i++)r[i].updateMatrixWorld(!0);return 2===n.length?w(f,h,p):f.projectionMatrix.copy(h.projectionMatrix),f};let E=null;function S(t,e){if(u=e.getViewerPose(s),null!==u){const t=u.views,e=i.renderState.baseLayer;r.bindXRFramebuffer(e.framebuffer);let n=!1;t.length!==f.cameras.length&&(f.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r],o=e.getViewport(i),s=d[r];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&f.matrix.copy(s.matrix),!0===n&&f.cameras.push(s)}}const n=i.inputSources;for(let r=0;r<l.length;r++){const t=l[r],i=n[r];t.update(i,e,s)}E&&E(t,e)}const T=new As;T.setAnimationLoop(S),this.setAnimationLoop=function(t){E=t},this.dispose=function(){}}function _h(t){function e(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}function n(t,e,n,y){e.isMeshBasicMaterial?r(t,e):e.isMeshLambertMaterial?(r(t,e),u(t,e)):e.isMeshToonMaterial?(r(t,e),c(t,e)):e.isMeshPhongMaterial?(r(t,e),l(t,e)):e.isMeshStandardMaterial?(r(t,e),e.isMeshPhysicalMaterial?p(t,e):h(t,e)):e.isMeshMatcapMaterial?(r(t,e),d(t,e)):e.isMeshDepthMaterial?(r(t,e),f(t,e)):e.isMeshDistanceMaterial?(r(t,e),g(t,e)):e.isMeshNormalMaterial?(r(t,e),m(t,e)):e.isLineBasicMaterial?(i(t,e),e.isLineDashedMaterial&&o(t,e)):e.isPointsMaterial?s(t,e,n,y):e.isSpriteMaterial?a(t,e):e.isShadowMaterial?(t.color.value.copy(e.color),t.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}function r(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const r=t.get(n).envMap;if(r){e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;const i=t.get(r).__maxMipLevel;void 0!==i&&(e.maxMipLevel.value=i)}let i,o;n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function i(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}function o(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function s(t,e,n,r){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}function a(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}function u(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}function l(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===lt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===lt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function c(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===lt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===lt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function h(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,n.side===lt&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),n.side===lt&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);const r=t.get(n).envMap;r&&(e.envMapIntensity.value=n.envMapIntensity)}function p(t,e){h(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===lt&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}function d(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===lt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===lt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function f(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function g(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}function m(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===lt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===lt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:n}}function bh(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}function wh(t){t=t||{};const e=void 0!==t.canvas?t.canvas:bh(),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h=null,p=null;const d=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Wn,this.physicallyCorrectLights=!1,this.toneMapping=qt,this.toneMappingExposure=1;const g=this;let m=!1,y=0,v=0,x=null,_=-1,b=null;const w=new Ur,M=new Ur;let E=null,S=e.width,T=e.height,C=1,A=null,P=null;const L=new Ur(0,0,S,T),I=new Ur(0,0,S,T);let R=!1;const N=new Cs;let O=!1,D=!1;const F=new wi,k=new Wr,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===x?C:1}let G,U,V,H,j,W,q,Y,X,Z,K,J,Q,$,tt,et,nt,rt,it,ot,st,at,ut=n;function lt(t,n){for(let r=0;r<t.length;r++){const i=t[r],o=e.getContext(i,n);if(null!==o)return o}return null}try{const t={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",dt,!1),null===ut){const e=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&e.shift(),ut=lt(e,t),null===ut)throw lt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ut.getShaderPrecisionFormat&&(ut.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(It){throw console.error("THREE.WebGLRenderer: "+It.message),It}function ct(){G=new al(ut),U=new il(ut,G,t),G.init(U),st=new gh(ut,G,U),V=new dh(ut,G,U),H=new cl(ut),j=new Kc,W=new fh(ut,G,V,j,U,st,H),q=new sl(g),Y=new Ps(ut,U),at=new nl(ut,G,Y,U),X=new ul(ut,Y,H,at),Z=new fl(ut,X,Y,H),rt=new dl(ut),tt=new ol(j),K=new Zc(g,q,G,U,at,tt),J=new _h(j),Q=new th(j),$=new ah(G,U),nt=new el(g,q,V,Z,a),et=new ph(g,Z,U),it=new rl(ut,G,H,U),ot=new ll(ut,G,H,U),H.programs=K.programs,g.capabilities=U,g.extensions=G,g.properties=j,g.renderLists=Q,g.shadowMap=et,g.state=V,g.info=H}ct();const ht=new xh(g,ut);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function dt(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;const t=H.autoReset,e=et.enabled,n=et.autoUpdate,r=et.needsUpdate,i=et.type;ct(),H.autoReset=t,et.enabled=e,et.autoUpdate=n,et.needsUpdate=r,et.type=i}function ft(t){const e=t.target;e.removeEventListener("dispose",ft),gt(e)}function gt(t){mt(t),j.remove(t)}function mt(t){const e=j.get(t).programs;void 0!==e&&e.forEach((function(t){K.releaseProgram(t)}))}function yt(t,e){t.render((function(t){g.renderBufferImmediate(t,e)}))}this.xr=ht,this.getContext=function(){return ut},this.getContextAttributes=function(){return ut.getContextAttributes()},this.forceContextLoss=function(){const t=G.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=G.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(S,T,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Or),t.set(S,T)},this.setSize=function(t,n,r){ht.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=t,T=n,e.width=Math.floor(t*C),e.height=Math.floor(n*C),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Or),t.set(S*C,T*C).floor()},this.setDrawingBufferSize=function(t,n,r){S=t,T=n,C=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Ur),t.copy(w)},this.getViewport=function(t){return t.copy(L)},this.setViewport=function(t,e,n,r){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,r),V.viewport(w.copy(L).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy(I)},this.setScissor=function(t,e,n,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,n,r),V.scissor(M.copy(I).multiplyScalar(C).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(t){V.setScissorTest(R=t)},this.setOpaqueSort=function(t){A=t},this.setTransparentSort=function(t){P=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new vo),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),ut.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",dt,!1),Q.dispose(),$.dispose(),j.dispose(),q.dispose(),Z.dispose(),at.dispose(),ht.dispose(),ht.removeEventListener("sessionstart",_t),ht.removeEventListener("sessionend",bt),wt.stop()},this.renderBufferImmediate=function(t,e){at.initAttributes();const n=j.get(t);t.hasPositions&&!n.position&&(n.position=ut.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ut.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ut.createBuffer()),t.hasColors&&!n.color&&(n.color=ut.createBuffer());const r=e.getAttributes();t.hasPositions&&(ut.bindBuffer(34962,n.position),ut.bufferData(34962,t.positionArray,35048),at.enableAttribute(r.position),ut.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(ut.bindBuffer(34962,n.normal),ut.bufferData(34962,t.normalArray,35048),at.enableAttribute(r.normal),ut.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(ut.bindBuffer(34962,n.uv),ut.bufferData(34962,t.uvArray,35048),at.enableAttribute(r.uv),ut.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(ut.bindBuffer(34962,n.color),ut.bufferData(34962,t.colorArray,35048),at.enableAttribute(r.color),ut.vertexAttribPointer(r.color,3,5126,!1,0,0)),at.disableUnusedAttributes(),ut.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=B);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=At(t,e,r,i);V.setMaterial(r,s);let u=n.index;const l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;let c,h=1;!0===r.wireframe&&(u=X.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&rt.update(i,n,r,a),at.setup(i,r,a,n,u);let p=it;null!==u&&(c=Y.get(u),p=ot,p.setIndex(c));const d=null!==u?u.count:l.count,f=n.drawRange.start*h,g=n.drawRange.count*h,m=null!==o?o.start*h:0,y=null!==o?o.count*h:1/0,v=Math.max(f,m),x=Math.min(d,f+g,m+y)-1,_=Math.max(0,x-v+1);if(0!==_){if(i.isMesh)!0===r.wireframe?(V.setLineWidth(r.wireframeLinewidth*z()),p.setMode(1)):p.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),V.setLineWidth(t*z()),i.isLineSegments?p.setMode(1):i.isLineLoop?p.setMode(2):p.setMode(3)}else i.isPoints?p.setMode(0):i.isSprite&&p.setMode(4);if(i.isInstancedMesh)p.renderInstances(v,_,i.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(v,_,t)}else p.render(v,_)}},this.compile=function(t,e){p=$.get(t),p.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];Tt(i,t,e)}else Tt(n,t,e)}))};let vt=null;function xt(t){vt&&vt(t)}function _t(){wt.stop()}function bt(){wt.start()}const wt=new As;function Mt(t,e,n,r){if(!1===t.visible)return;const i=t.layers.test(e.layers);if(i)if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||N.intersectsSprite(t)){r&&k.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=Z.update(t),i=t.material;i.visible&&h.push(t,e,i,n,k.z,null)}}else if(t.isImmediateRenderObject)r&&k.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F),h.push(t,null,t.material,n,k.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==H.render.frame&&(t.skeleton.update(),t.skeleton.frame=H.render.frame),!t.frustumCulled||N.intersectsObject(t))){r&&k.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);const e=Z.update(t),i=t.material;if(Array.isArray(i)){const r=e.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&h.push(t,e,a,n,k.z,s)}}else i.visible&&h.push(t,e,i,n,k.z,null)}const o=t.children;for(let s=0,a=o.length;s<a;s++)Mt(o[s],e,n,r)}function Et(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],s=o.object,a=o.geometry,u=null===r?o.material:r,l=o.group;if(n.isArrayCamera){const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];s.layers.test(r.layers)&&(V.viewport(w.copy(r.viewport)),p.setupLightsView(r),St(s,e,r,a,u,l))}}else St(s,e,n,a,u,l)}}function St(t,e,n,r,i,o){if(t.onBeforeRender(g,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const r=At(n,e,i,t);V.setMaterial(i),at.reset(),yt(t,r)}else g.renderBufferDirect(n,e,r,i,t,o);t.onAfterRender(g,e,n,r,i,o)}function Tt(t,e,n){!0!==e.isScene&&(e=B);const r=j.get(t),i=p.state.lights,o=p.state.shadowsArray,s=i.state.version,a=K.getParameters(t,i.state,o,e,n),u=K.getProgramCacheKey(a);let l=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=q.get(t.envMap||r.environment),void 0===l&&(t.addEventListener("dispose",ft),l=new Map,r.programs=l);let c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===s)return Ct(t,a),c}else a.uniforms=K.getUniforms(t),t.onBeforeCompile(a,g),c=K.acquireProgram(a,u),l.set(u,c),r.uniforms=a.uniforms;const h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=tt.uniform),Ct(t,a),r.needsLights=Lt(t),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=c.getUniforms(),f=_c.seqWithValue(d.seq,h);return r.currentProgram=c,r.uniformsList=f,c}function Ct(t,e){const n=j.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas}function At(t,e,n,r){!0!==e.isScene&&(e=B),W.resetTextureUnits();const i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,s=null===x?g.outputEncoding:x.texture.encoding,a=q.get(n.envMap||o),u=!0===n.vertexColors&&r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,l=j.get(n),c=p.state.lights;if(!0===O&&(!0===D||t!==b)){const e=t===b&&n.id===_;tt.setState(n,t,e)}let h=!1;n.version===l.__version?l.needsLights&&l.lightsStateVersion!==c.state.version||l.outputEncoding!==s||r.isInstancedMesh&&!1===l.instancing?h=!0:r.isInstancedMesh||!0!==l.instancing?l.envMap!==a||n.fog&&l.fog!==i?h=!0:void 0===l.numClippingPlanes||l.numClippingPlanes===tt.numPlanes&&l.numIntersection===tt.numIntersection?l.vertexAlphas!==u&&(h=!0):h=!0:h=!0:(h=!0,l.__version=n.version);let d=l.currentProgram;!0===h&&(d=Tt(n,e,r));let f=!1,m=!1,y=!1;const v=d.getUniforms(),w=l.uniforms;if(V.useProgram(d.program)&&(f=!0,m=!0,y=!0),n.id!==_&&(_=n.id,m=!0),f||b!==t){if(v.setValue(ut,"projectionMatrix",t.projectionMatrix),U.logarithmicDepthBuffer&&v.setValue(ut,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),b!==t&&(b=t,m=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=v.map.cameraPosition;void 0!==e&&e.setValue(ut,k.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&v.setValue(ut,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&v.setValue(ut,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){v.setOptional(ut,r,"bindMatrix"),v.setOptional(ut,r,"bindMatrixInverse");const t=r.skeleton;if(t){const e=t.bones;if(U.floatVertexTextures){if(null===t.boneTexture){let n=Math.sqrt(4*e.length);n=Nr.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const i=new Es(r,n,n,Re,Ee);t.boneMatrices=r,t.boneTexture=i,t.boneTextureSize=n}v.setValue(ut,"boneTexture",t.boneTexture,W),v.setValue(ut,"boneTextureSize",t.boneTextureSize)}else v.setOptional(ut,t,"boneMatrices")}}return(m||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,v.setValue(ut,"receiveShadow",r.receiveShadow)),m&&(v.setValue(ut,"toneMappingExposure",g.toneMappingExposure),l.needsLights&&Pt(w,y),i&&n.fog&&J.refreshFogUniforms(w,i),J.refreshMaterialUniforms(w,n,C,T),_c.upload(ut,l.uniformsList,w,W)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(_c.upload(ut,l.uniformsList,w,W),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&v.setValue(ut,"center",r.center),v.setValue(ut,"modelViewMatrix",r.modelViewMatrix),v.setValue(ut,"normalMatrix",r.normalMatrix),v.setValue(ut,"modelMatrix",r.matrixWorld),d}function Pt(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function Lt(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}wt.setAnimationLoop(xt),"undefined"!==typeof window&&wt.setContext(window),this.setAnimationLoop=function(t){vt=t,ht.setAnimationLoop(t),null===t?wt.stop():wt.start()},ht.addEventListener("sessionstart",_t),ht.addEventListener("sessionend",bt),this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ht.enabled&&!0===ht.isPresenting&&(e=ht.getCamera(e)),!0===t.isScene&&t.onBeforeRender(g,t,e,n||x),p=$.get(t,f.length),p.init(),f.push(p),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),N.setFromProjectionMatrix(F),D=this.localClippingEnabled,O=tt.init(this.clippingPlanes,D,e),h=Q.get(t,d.length),h.init(),d.push(h),Mt(t,e,0,g.sortObjects),h.finish(),!0===g.sortObjects&&h.sort(A,P),!0===O&&tt.beginShadows();const i=p.state.shadowsArray;et.render(i,t,e),p.setupLights(),p.setupLightsView(e),!0===O&&tt.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,r);const o=h.opaque,s=h.transparent;o.length>0&&Et(o,t,e),s.length>0&&Et(s,t,e),null!==x&&(W.updateRenderTargetMipmap(x),W.updateMultisampleRenderTarget(x)),!0===t.isScene&&t.onAfterRender(g,t,e),V.buffers.depth.setTest(!0),V.buffers.depth.setMask(!0),V.buffers.color.setMask(!0),V.setPolygonOffset(!1),at.resetDefaultState(),_=-1,b=null,f.pop(),p=f.length>0?f[f.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return x},this.setRenderTarget=function(t,e=0,n=0){x=t,y=e,v=n,t&&void 0===j.get(t).__webglFramebuffer&&W.setupRenderTarget(t);let r=null,i=!1,o=!1;if(t){const n=t.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const s=j.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=s[e],i=!0):r=t.isWebGLMultisampleRenderTarget?j.get(t).__webglMultisampledFramebuffer:s,w.copy(t.viewport),M.copy(t.scissor),E=t.scissorTest}else w.copy(L).multiplyScalar(C).floor(),M.copy(I).multiplyScalar(C).floor(),E=R;if(V.bindFramebuffer(36160,r),V.viewport(w),V.scissor(M),V.setScissorTest(E),i){const r=j.get(t.texture);ut.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}else if(o){const r=j.get(t.texture),i=e||0;ut.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}},this.readRenderTargetPixels=function(t,e,n,r,i,o,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=j.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){V.bindFramebuffer(36160,a);try{const s=t.texture,a=s.format,u=s.type;if(a!==Re&&st.convert(a)!==ut.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=u===Se&&(G.has("EXT_color_buffer_half_float")||U.isWebGL2&&G.has("EXT_color_buffer_float"));if(u!==ve&&st.convert(u)!==ut.getParameter(35738)&&(u!==Ee||!(U.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float")))&&!l)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ut.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&ut.readPixels(e,n,r,i,st.convert(a),st.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==x?j.get(x).__webglFramebuffer:null;V.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),s=st.convert(e.format);W.setTexture2D(e,0),ut.copyTexImage2D(3553,n,s,t.x,t.y,i,o,0),V.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r=0){const i=e.image.width,o=e.image.height,s=st.convert(n.format),a=st.convert(n.type);W.setTexture2D(n,0),ut.pixelStorei(37440,n.flipY),ut.pixelStorei(37441,n.premultiplyAlpha),ut.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ut.texSubImage2D(3553,r,t.x,t.y,i,o,s,a,e.image.data):e.isCompressedTexture?ut.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ut.texSubImage2D(3553,r,t.x,t.y,s,a,e.image),0===r&&n.generateMipmaps&&ut.generateMipmap(3553),V.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i=0){if(g.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:o,height:s,data:a}=n.image,u=st.convert(r.format),l=st.convert(r.type);let c;if(r.isDataTexture3D)W.setTexture3D(r,0),c=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");W.setTexture2DArray(r,0),c=35866}ut.pixelStorei(37440,r.flipY),ut.pixelStorei(37441,r.premultiplyAlpha),ut.pixelStorei(3317,r.unpackAlignment);const h=ut.getParameter(3314),p=ut.getParameter(32878),d=ut.getParameter(3316),f=ut.getParameter(3315),m=ut.getParameter(32877);ut.pixelStorei(3314,o),ut.pixelStorei(32878,s),ut.pixelStorei(3316,t.min.x),ut.pixelStorei(3315,t.min.y),ut.pixelStorei(32877,t.min.z),ut.texSubImage3D(c,i,e.x,e.y,e.z,t.max.x-t.min.x+1,t.max.y-t.min.y+1,t.max.z-t.min.z+1,u,l,a),ut.pixelStorei(3314,h),ut.pixelStorei(32878,p),ut.pixelStorei(3316,d),ut.pixelStorei(3315,f),ut.pixelStorei(32877,m),0===i&&r.generateMipmaps&&ut.generateMipmap(c),V.unbindTexture()},this.initTexture=function(t){W.setTexture2D(t,0),V.unbindTexture()},this.resetState=function(){y=0,v=0,x=null,V.reset(),at.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}yh.prototype.isGroup=!0,Object.assign(vh.prototype,{constructor:vh,getHandSpace:function(){return null===this._hand&&(this._hand=new yh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new yh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new yh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,u=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==s&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),u&&t.hand){o=!0;for(const o of t.hand.values()){const t=e.getJointPose(o,n);if(void 0===u.joints[o.jointName]){const t=new yh;t.matrixAutoUpdate=!1,t.visible=!1,u.joints[o.jointName]=t,u.add(t)}const r=u.joints[o.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const r=u.joints["index-finger-tip"],i=u.joints["thumb-tip"],s=r.position.distanceTo(i.position),a=.02,l=.005;u.inputState.pinching&&s>a+l?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&s<=a-l&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==u&&(u.visible=null!==o),this}}),Object.assign(xh.prototype,Lr.prototype);class Mh extends wh{}Mh.prototype.isWebGL1Renderer=!0;class Eh{constructor(t,e=25e-5){this.name="",this.color=new vo(t),this.density=e}clone(){return new Eh(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Eh.prototype.isFogExp2=!0;class Sh{constructor(t,e=1,n=1e3){this.name="",this.color=new vo(t),this.near=e,this.far=n}clone(){return new Sh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Sh.prototype.isFog=!0;class Th extends Yi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function Ch(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=xr,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Nr.generateUUID()}Th.prototype.isScene=!0,Object.defineProperty(Ch.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ch.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e=0){return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nr.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new Ch(e,this.stride);return n.setUsage(this.usage),n},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Nr.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Ah=new Wr;function Ph(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}Object.defineProperties(Ph.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(Ph.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,n=this.data.count;e<n;e++)Ah.x=this.getX(e),Ah.y=this.getY(e),Ah.z=this.getZ(e),Ah.applyMatrix4(t),this.setXYZ(e,Ah.x,Ah.y,Ah.z);return this},applyNormalMatrix:function(t){for(let e=0,n=this.count;e<n;e++)Ah.x=this.getX(e),Ah.y=this.getY(e),Ah.z=this.getZ(e),Ah.applyNormalMatrix(t),this.setXYZ(e,Ah.x,Ah.y,Ah.z);return this},transformDirection:function(t){for(let e=0,n=this.count;e<n;e++)Ah.x=this.getX(e),Ah.y=this.getY(e),Ah.z=this.getZ(e),Ah.transformDirection(t),this.setXYZ(e,Ah.x,Ah.y,Ah.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new wo(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ph(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});class Lh extends co{constructor(t){super(),this.type="SpriteMaterial",this.color=new vo(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let Ih;Lh.prototype.isSpriteMaterial=!0;const Rh=new Wr,Nh=new Wr,Oh=new Wr,Dh=new Or,Fh=new Or,kh=new wi,Bh=new Wr,zh=new Wr,Gh=new Wr,Uh=new Or,Vh=new Or,Hh=new Or;class jh extends Yi{constructor(t){if(super(),this.type="Sprite",void 0===Ih){Ih=new Ho;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Ch(t,5);Ih.setIndex([0,1,2,0,2,3]),Ih.setAttribute("position",new Ph(e,3,0,!1)),Ih.setAttribute("uv",new Ph(e,2,3,!1))}this.geometry=Ih,this.material=void 0!==t?t:new Lh,this.center=new Or(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Nh.setFromMatrixScale(this.matrixWorld),kh.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Oh.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Nh.multiplyScalar(-Oh.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Wh(Bh.set(-.5,-.5,0),Oh,o,Nh,r,i),Wh(zh.set(.5,-.5,0),Oh,o,Nh,r,i),Wh(Gh.set(.5,.5,0),Oh,o,Nh,r,i),Uh.set(0,0),Vh.set(1,0),Hh.set(1,1);let s=t.ray.intersectTriangle(Bh,zh,Gh,!1,Rh);if(null===s&&(Wh(zh.set(-.5,.5,0),Oh,o,Nh,r,i),Vh.set(0,1),s=t.ray.intersectTriangle(Bh,Gh,zh,!1,Rh),null===s))return;const a=t.ray.origin.distanceTo(Rh);a<t.near||a>t.far||e.push({distance:a,point:Rh.clone(),uv:uo.getUV(Rh,Bh,zh,Gh,Uh,Vh,Hh,new Or),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Wh(t,e,n,r,i,o){Dh.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Fh.x=o*Dh.x-i*Dh.y,Fh.y=i*Dh.x+o*Dh.y):Fh.copy(Dh),t.copy(e),t.x+=Fh.x,t.y+=Fh.y,t.applyMatrix4(kh)}jh.prototype.isSprite=!0;const qh=new Wr,Yh=new Wr;class Xh extends Yi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,r=e.length;n<r;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const n=this.levels;let r;for(r=0;r<n.length;r++)if(e<n[r].distance)break;return n.splice(r,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,r;for(n=1,r=e.length;n<r;n++)if(t<e[n].distance)break;return e[n-1].object}return null}raycast(t,e){const n=this.levels;if(n.length>0){qh.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(qh);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){qh.setFromMatrixPosition(t.matrixWorld),Yh.setFromMatrixPosition(this.matrixWorld);const n=qh.distanceTo(Yh)/t.zoom;let r,i;for(e[0].object.visible=!0,r=1,i=e.length;r<i;r++){if(!(n>=e[r].distance))break;e[r-1].object.visible=!1,e[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)e[r].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let r=0,i=n.length;r<i;r++){const t=n[r];e.object.levels.push({object:t.object.uuid,distance:t.distance})}return e}}const Zh=new Wr,Kh=new Ur,Jh=new Ur,Qh=new Wr,$h=new wi;function tp(t,e){as.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new wi,this.bindMatrixInverse=new wi}function ep(){Yi.call(this),this.type="Bone"}tp.prototype=Object.assign(Object.create(as.prototype),{constructor:tp,isSkinnedMesh:!0,copy:function(t){return as.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Ur,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){as.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){const n=this.skeleton,r=this.geometry;Kh.fromBufferAttribute(r.attributes.skinIndex,t),Jh.fromBufferAttribute(r.attributes.skinWeight,t),Zh.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let i=0;i<4;i++){const t=Jh.getComponent(i);if(0!==t){const r=Kh.getComponent(i);$h.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Qh.copy(Zh).applyMatrix4($h),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}),ep.prototype=Object.assign(Object.create(Yi.prototype),{constructor:ep,isBone:!0});const np=new wi,rp=new wi;class ip{constructor(t=[],e=[]){this.uuid=Nr.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new wi)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new wi;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,o=t.length;i<o;i++){const r=t[i]?t[i].matrixWorld:rp;np.multiplyMatrices(r,e[i]),np.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}clone(){return new ip(this.bones,this.boneInverses)}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new ep),this.bones.push(i),this.boneInverses.push((new wi).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const o=n[r];t.boneInverses.push(o.toArray())}return t}}const op=new wi,sp=new wi,ap=[],up=new as;function lp(t,e,n){as.call(this,t,e),this.instanceMatrix=new wo(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}lp.prototype=Object.assign(Object.create(as.prototype),{constructor:lp,isInstancedMesh:!0,copy:function(t){return as.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(up.geometry=this.geometry,up.material=this.material,void 0!==up.material)for(let i=0;i<r;i++){this.getMatrixAt(i,op),sp.multiplyMatrices(n,op),up.matrixWorld=sp,up.raycast(t,ap);for(let t=0,n=ap.length;t<n;t++){const n=ap[t];n.instanceId=i,n.object=this,e.push(n)}ap.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new wo(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});class cp extends co{constructor(t){super(),this.type="LineBasicMaterial",this.color=new vo(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this}}cp.prototype.isLineBasicMaterial=!0;const hp=new Wr,pp=new Wr,dp=new wi,fp=new bi,gp=new di;function mp(t=new Ho,e=new cp){Yi.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}mp.prototype=Object.assign(Object.create(Yi.prototype),{constructor:mp,isLine:!0,copy:function(t){return Yi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)hp.fromBufferAttribute(e,t-1),pp.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=hp.distanceTo(pp);t.setAttribute("lineDistance",new Io(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),gp.copy(n.boundingSphere),gp.applyMatrix4(r),gp.radius+=i,!1===t.ray.intersectsSphere(gp))return;dp.copy(r).invert(),fp.copy(t.ray).applyMatrix4(dp);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,u=new Wr,l=new Wr,c=new Wr,h=new Wr,p=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes,s=i.position;if(null!==r){const n=Math.max(0,o.start),i=Math.min(r.count,o.start+o.count);for(let o=n,d=i-1;o<d;o+=p){const n=r.getX(o),i=r.getX(o+1);u.fromBufferAttribute(s,n),l.fromBufferAttribute(s,i);const p=fp.distanceSqToSegment(u,l,h,c);if(p>a)continue;h.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(h);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this})}}else{const n=Math.max(0,o.start),r=Math.min(s.count,o.start+o.count);for(let i=n,o=r-1;i<o;i+=p){u.fromBufferAttribute(s,i),l.fromBufferAttribute(s,i+1);const n=fp.distanceSqToSegment(u,l,h,c);if(n>a)continue;h.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const yp=new Wr,vp=new Wr;function xp(t,e){mp.call(this,t,e),this.type="LineSegments"}xp.prototype=Object.assign(Object.create(mp.prototype),{constructor:xp,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)yp.fromBufferAttribute(e,t),vp.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+yp.distanceTo(vp);t.setAttribute("lineDistance",new Io(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});class _p extends mp{constructor(t,e){super(t,e),this.type="LineLoop"}}_p.prototype.isLineLoop=!0;class bp extends co{constructor(t){super(),this.type="PointsMaterial",this.color=new vo(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this}}bp.prototype.isPointsMaterial=!0;const wp=new wi,Mp=new bi,Ep=new di,Sp=new Wr;function Tp(t=new Ho,e=new bp){Yi.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function Cp(t,e,n,r,i,o,s){const a=Mp.distanceSqToPoint(t);if(a<n){const n=new Wr;Mp.closestPointToPoint(t,n),n.applyMatrix4(r);const u=i.ray.origin.distanceTo(n);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:s})}}Tp.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Tp,isPoints:!0,copy:function(t){return Yi.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ep.copy(n.boundingSphere),Ep.applyMatrix4(r),Ep.radius+=i,!1===t.ray.intersectsSphere(Ep))return;wp.copy(r).invert(),Mp.copy(t.ray).applyMatrix4(wp);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes,u=s.position;if(null!==i){const n=Math.max(0,o.start),s=Math.min(i.count,o.start+o.count);for(let o=n,l=s;o<l;o++){const n=i.getX(o);Sp.fromBufferAttribute(u,n),Cp(Sp,n,a,r,t,e,this)}}else{const n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);for(let o=n,s=i;o<s;o++)Sp.fromBufferAttribute(u,o),Cp(Sp,o,a,r,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});class Ap extends zr{constructor(t,e,n,r,i,o,s,a,u){super(t,e,n,r,i,o,s,a,u),this.format=void 0!==s?s:Ie,this.minFilter=void 0!==o?o:de,this.magFilter=void 0!==i?i:de,this.generateMipmaps=!1;const l=this;function c(){l.needsUpdate=!0,t.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(c)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image,e="requestVideoFrameCallback"in t;!1===e&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Ap.prototype.isVideoTexture=!0;class Pp extends zr{constructor(t,e,n,r,i,o,s,a,u,l,c,h){super(null,o,s,a,u,l,r,i,c,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}Pp.prototype.isCompressedTexture=!0;class Lp extends zr{constructor(t,e,n,r,i,o,s,a,u){super(t,e,n,r,i,o,s,a,u),this.needsUpdate=!0}}Lp.prototype.isCanvasTexture=!0;class Ip extends zr{constructor(t,e,n,r,i,o,s,a,u,l){if(l=void 0!==l?l:Fe,l!==Fe&&l!==ke)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Fe&&(n=be),void 0===n&&l===ke&&(n=Pe),super(null,r,i,o,s,a,l,n,u),this.image={width:t,height:e},this.magFilter=void 0!==s?s:ue,this.minFilter=void 0!==a?a:ue,this.flipY=!1,this.generateMipmaps=!1}}Ip.prototype.isDepthTexture=!0;class Rp extends Ho{constructor(t=1,e=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},e=Math.max(3,e);const i=[],o=[],s=[],a=[],u=new Wr,l=new Or;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let c=0,h=3;c<=e;c++,h+=3){const i=n+c/e*r;u.x=t*Math.cos(i),u.y=t*Math.sin(i),o.push(u.x,u.y,u.z),s.push(0,0,1),l.x=(o[h]/t+1)/2,l.y=(o[h+1]/t+1)/2,a.push(l.x,l.y)}for(let c=1;c<=e;c++)i.push(c,c+1,0);this.setIndex(i),this.setAttribute("position",new Io(o,3)),this.setAttribute("normal",new Io(s,3)),this.setAttribute("uv",new Io(a,2))}}class Np extends Ho{constructor(t=1,e=1,n=1,r=8,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const u=this;r=Math.floor(r),i=Math.floor(i);const l=[],c=[],h=[],p=[];let d=0;const f=[],g=n/2;let m=0;function y(){const o=new Wr,y=new Wr;let v=0;const x=(e-t)/n;for(let u=0;u<=i;u++){const l=[],m=u/i,v=m*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+s,u=Math.sin(i),f=Math.cos(i);y.x=v*u,y.y=-m*n+g,y.z=v*f,c.push(y.x,y.y,y.z),o.set(u,x,f).normalize(),h.push(o.x,o.y,o.z),p.push(e,1-m),l.push(d++)}f.push(l)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],o=f[e][t+1];l.push(n,r,o),l.push(r,i,o),v+=6}u.addGroup(m,v,0),m+=v}function v(n){const i=d,o=new Or,f=new Wr;let y=0;const v=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=r;t++)c.push(0,g*x,0),h.push(0,x,0),p.push(.5,.5),d++;const _=d;for(let t=0;t<=r;t++){const e=t/r,n=e*a+s,i=Math.cos(n),u=Math.sin(n);f.x=v*u,f.y=g*x,f.z=v*i,c.push(f.x,f.y,f.z),h.push(0,x,0),o.x=.5*i+.5,o.y=.5*u*x+.5,p.push(o.x,o.y),d++}for(let t=0;t<r;t++){const e=i+t,r=_+t;!0===n?l.push(r,r+1,e):l.push(r+1,r,e),y+=3}u.addGroup(m,y,!0===n?1:2),m+=y}y(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Io(c,3)),this.setAttribute("normal",new Io(h,3)),this.setAttribute("uv",new Io(p,2))}}class Op extends Np{constructor(t=1,e=1,n=8,r=1,i=!1,o=0,s=2*Math.PI){super(0,t,e,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class Dp extends Ho{constructor(t,e,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r};const i=[],o=[];function s(t){const n=new Wr,r=new Wr,i=new Wr;for(let o=0;o<e.length;o+=3)p(e[o+0],n),p(e[o+1],r),p(e[o+2],i),a(n,r,i,t)}function a(t,e,n,r){const i=r+1,o=[];for(let s=0;s<=i;s++){o[s]=[];const r=t.clone().lerp(n,s/i),a=e.clone().lerp(n,s/i),u=i-s;for(let t=0;t<=u;t++)o[s][t]=0===t&&s===i?r:r.clone().lerp(a,t/u)}for(let s=0;s<i;s++)for(let t=0;t<2*(i-s)-1;t++){const e=Math.floor(t/2);t%2===0?(h(o[s][e+1]),h(o[s+1][e]),h(o[s][e])):(h(o[s][e+1]),h(o[s+1][e+1]),h(o[s+1][e]))}}function u(t){const e=new Wr;for(let n=0;n<i.length;n+=3)e.x=i[n+0],e.y=i[n+1],e.z=i[n+2],e.normalize().multiplyScalar(t),i[n+0]=e.x,i[n+1]=e.y,i[n+2]=e.z}function l(){const t=new Wr;for(let e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];const n=g(t)/2/Math.PI+.5,r=m(t)/Math.PI+.5;o.push(n,1-r)}d(),c()}function c(){for(let t=0;t<o.length;t+=6){const e=o[t+0],n=o[t+2],r=o[t+4],i=Math.max(e,n,r),s=Math.min(e,n,r);i>.9&&s<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),r<.2&&(o[t+4]+=1))}}function h(t){i.push(t.x,t.y,t.z)}function p(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function d(){const t=new Wr,e=new Wr,n=new Wr,r=new Wr,s=new Or,a=new Or,u=new Or;for(let l=0,c=0;l<i.length;l+=9,c+=6){t.set(i[l+0],i[l+1],i[l+2]),e.set(i[l+3],i[l+4],i[l+5]),n.set(i[l+6],i[l+7],i[l+8]),s.set(o[c+0],o[c+1]),a.set(o[c+2],o[c+3]),u.set(o[c+4],o[c+5]),r.copy(t).add(e).add(n).divideScalar(3);const h=g(r);f(s,c+0,t,h),f(a,c+2,e,h),f(u,c+4,n,h)}}function f(t,e,n,r){r<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=r/2/Math.PI+.5)}function g(t){return Math.atan2(t.z,-t.x)}function m(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}s(r),u(n),l(),this.setAttribute("position",new Io(i,3)),this.setAttribute("normal",new Io(i.slice(),3)),this.setAttribute("uv",new Io(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class Fp extends Dp{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(i,o,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}}const kp=new Wr,Bp=new Wr,zp=new Wr,Gp=new uo;class Up extends Ho{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0===t.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=4,r=Math.pow(10,n),i=Math.cos(Nr.DEG2RAD*e),o=t.getIndex(),s=t.getAttribute("position"),a=o?o.count:s.count,u=[0,0,0],l=["a","b","c"],c=new Array(3),h={},p=[];for(let d=0;d<a;d+=3){o?(u[0]=o.getX(d),u[1]=o.getX(d+1),u[2]=o.getX(d+2)):(u[0]=d,u[1]=d+1,u[2]=d+2);const{a:t,b:e,c:n}=Gp;if(t.fromBufferAttribute(s,u[0]),e.fromBufferAttribute(s,u[1]),n.fromBufferAttribute(s,u[2]),Gp.getNormal(zp),c[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,c[1]=`${Math.round(e.x*r)},${Math.round(e.y*r)},${Math.round(e.z*r)}`,c[2]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let r=0;r<3;r++){const t=(r+1)%3,e=c[r],n=c[t],o=Gp[l[r]],s=Gp[l[t]],a=`${e}_${n}`,d=`${n}_${e}`;d in h&&h[d]?(zp.dot(h[d].normal)<=i&&(p.push(o.x,o.y,o.z),p.push(s.x,s.y,s.z)),h[d]=null):a in h||(h[a]={index0:u[r],index1:u[t],normal:zp.clone()})}}for(const d in h)if(h[d]){const{index0:t,index1:e}=h[d];kp.fromBufferAttribute(s,t),Bp.fromBufferAttribute(s,e),p.push(kp.x,kp.y,kp.z),p.push(Bp.x,Bp.y,Bp.z)}this.setAttribute("position",new Io(p,3))}}const Vp={triangulate:function(t,e,n){n=n||2;const r=e&&e.length,i=r?e[0]*n:t.length;let o=Hp(t,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,u,l,c,h,p,d;if(r&&(o=Kp(t,e,o,n)),t.length>80*n){a=l=t[0],u=c=t[1];for(let e=n;e<i;e+=n)h=t[e],p=t[e+1],h<a&&(a=h),p<u&&(u=p),h>l&&(l=h),p>c&&(c=p);d=Math.max(l-a,c-u),d=0!==d?1/d:0}return Wp(o,s,n,a,u,d),s}};function Hp(t,e,n,r,i){let o,s;if(i===xd(t,e,n,r)>0)for(o=e;o<n;o+=r)s=md(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=md(o,t[o],t[o+1],s);return s&&ud(s,s.next)&&(yd(s),s=s.next),s}function jp(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!ud(r,r.next)&&0!==ad(r.prev,r,r.next))r=r.next;else{if(yd(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function Wp(t,e,n,r,i,o,s){if(!t)return;!s&&o&&ed(t,r,i,o);let a,u,l=t;while(t.prev!==t.next)if(a=t.prev,u=t.next,o?Yp(t,r,i,o):qp(t))e.push(a.i/n),e.push(t.i/n),e.push(u.i/n),yd(t),t=u.next,l=u.next;else if(t=u,t===l){s?1===s?(t=Xp(jp(t),e,n),Wp(t,e,n,r,i,o,2)):2===s&&Zp(t,e,n,r,i,o):Wp(jp(t),e,n,r,i,o,1);break}}function qp(t){const e=t.prev,n=t,r=t.next;if(ad(e,n,r)>=0)return!1;let i=t.next.next;while(i!==t.prev){if(od(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&ad(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Yp(t,e,n,r){const i=t.prev,o=t,s=t.next;if(ad(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,u=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=rd(a,u,e,n,r),p=rd(l,c,e,n,r);let d=t.prevZ,f=t.nextZ;while(d&&d.z>=h&&f&&f.z<=p){if(d!==t.prev&&d!==t.next&&od(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ad(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&od(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&ad(f.prev,f,f.next)>=0)return!1;f=f.nextZ}while(d&&d.z>=h){if(d!==t.prev&&d!==t.next&&od(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ad(d.prev,d,d.next)>=0)return!1;d=d.prevZ}while(f&&f.z<=p){if(f!==t.prev&&f!==t.next&&od(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&ad(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Xp(t,e,n){let r=t;do{const i=r.prev,o=r.next.next;!ud(i,o)&&ld(i,r,r.next,o)&&dd(i,o)&&dd(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),yd(r),yd(r.next),r=t=o),r=r.next}while(r!==t);return jp(r)}function Zp(t,e,n,r,i,o){let s=t;do{let t=s.next.next;while(t!==s.prev){if(s.i!==t.i&&sd(s,t)){let a=gd(s,t);return s=jp(s,s.next),a=jp(a,a.next),Wp(s,e,n,r,i,o),void Wp(a,e,n,r,i,o)}t=t.next}s=s.next}while(s!==t)}function Kp(t,e,n,r){const i=[];let o,s,a,u,l;for(o=0,s=e.length;o<s;o++)a=e[o]*r,u=o<s-1?e[o+1]*r:t.length,l=Hp(t,a,u,r,!1),l===l.next&&(l.steiner=!0),i.push(id(l));for(i.sort(Jp),o=0;o<i.length;o++)Qp(i[o],n),n=jp(n,n.next);return n}function Jp(t,e){return t.x-e.x}function Qp(t,e){if(e=$p(t,e),e){const n=gd(e,t);jp(e,e.next),jp(n,n.next)}}function $p(t,e){let n=e;const r=t.x,i=t.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const t=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>s){if(s=t,t===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(r===s)return o;const a=o,u=o.x,l=o.y;let c,h=1/0;n=o;do{r>=n.x&&n.x>=u&&r!==n.x&&od(i<l?r:s,i,u,l,i<l?s:r,i,n.x,n.y)&&(c=Math.abs(i-n.y)/(r-n.x),dd(n,t)&&(c<h||c===h&&(n.x>o.x||n.x===o.x&&td(o,n)))&&(o=n,h=c)),n=n.next}while(n!==a);return o}function td(t,e){return ad(t.prev,t,e.prev)<0&&ad(e.next,t,t.next)<0}function ed(t,e,n,r){let i=t;do{null===i.z&&(i.z=rd(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,nd(i)}function nd(t){let e,n,r,i,o,s,a,u,l=1;do{n=t,t=null,o=null,s=0;while(n){for(s++,r=n,a=0,e=0;e<l;e++)if(a++,r=r.nextZ,!r)break;u=l;while(a>0||u>0&&r)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1);return t}function rd(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function id(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function od(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function sd(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!pd(t,e)&&(dd(t,e)&&dd(e,t)&&fd(t,e)&&(ad(t.prev,t,e.prev)||ad(t,e.prev,e))||ud(t,e)&&ad(t.prev,t,t.next)>0&&ad(e.prev,e,e.next)>0)}function ad(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ud(t,e){return t.x===e.x&&t.y===e.y}function ld(t,e,n,r){const i=hd(ad(t,e,n)),o=hd(ad(t,e,r)),s=hd(ad(n,r,t)),a=hd(ad(n,r,e));return i!==o&&s!==a||(!(0!==i||!cd(t,n,e))||(!(0!==o||!cd(t,r,e))||(!(0!==s||!cd(n,t,r))||!(0!==a||!cd(n,e,r)))))}function cd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function hd(t){return t>0?1:t<0?-1:0}function pd(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&ld(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function dd(t,e){return ad(t.prev,t,t.next)<0?ad(t,e,t.next)>=0&&ad(t,t.prev,e)>=0:ad(t,e,t.prev)<0||ad(t,t.next,e)<0}function fd(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function gd(t,e){const n=new vd(t.i,t.x,t.y),r=new vd(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function md(t,e,n,r){const i=new vd(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function yd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function vd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xd(t,e,n,r){let i=0;for(let o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}const _d={area:function(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return _d.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],i=[];bd(t),wd(n,t);let o=t.length;e.forEach(bd);for(let a=0;a<e.length;a++)r.push(o),o+=e[a].length,wd(n,e[a]);const s=Vp.triangulate(n,r);for(let a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function bd(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function wd(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class Md extends Ho{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],i=[];for(let s=0,a=t.length;s<a;s++){const e=t[s];o(e)}function o(t){const o=[],s=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let u=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:c-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,g=void 0!==e.UVGenerator?e.UVGenerator:Ed;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=e.amount);let m,y,v,x,_,b=!1;f&&(m=f.getSpacedPoints(a),b=!0,l=!1,y=f.computeFrenetFrames(a,!1),v=new Wr,x=new Wr,_=new Wr),l||(d=0,c=0,h=0,p=0);const w=t.extractPoints(s);let M=w.shape;const E=w.holes,S=!_d.isClockWise(M);if(S){M=M.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];_d.isClockWise(e)&&(E[t]=e.reverse())}}const T=_d.triangulateShape(M,E),C=M;for(let e=0,n=E.length;e<n;e++){const t=E[e];M=M.concat(t)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const P=M.length,L=T.length;function I(t,e,n){let r,i,o;const s=t.x-e.x,a=t.y-e.y,u=n.x-t.x,l=n.y-t.y,c=s*s+a*a,h=s*l-a*u;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(c),p=Math.sqrt(u*u+l*l),d=e.x-a/h,f=e.y+s/h,g=n.x-l/p,m=n.y+u/p,y=((g-d)*l-(m-f)*u)/(s*l-a*u);r=d+s*y-t.x,i=f+a*y-t.y;const v=r*r+i*i;if(v<=2)return new Or(r,i);o=Math.sqrt(v/2)}else{let t=!1;s>Number.EPSILON?u>Number.EPSILON&&(t=!0):s<-Number.EPSILON?u<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(r=-a,i=s,o=Math.sqrt(c)):(r=s,i=a,o=Math.sqrt(c/2))}return new Or(r/o,i/o)}const R=[];for(let e=0,n=C.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),R[e]=I(C[e],C[r],C[i]);const N=[];let O,D=R.concat();for(let e=0,n=E.length;e<n;e++){const t=E[e];O=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),O[e]=I(t[e],t[r],t[i]);N.push(O),D=D.concat(O)}for(let e=0;e<d;e++){const t=e/d,n=c*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+p;for(let e=0,i=C.length;e<i;e++){const t=A(C[e],R[e],r);G(t.x,t.y,-n)}for(let e=0,i=E.length;e<i;e++){const t=E[e];O=N[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],O[e],r);G(i.x,i.y,-n)}}}const F=h+p;for(let e=0;e<P;e++){const t=l?A(M[e],D[e],F):M[e];b?(x.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),_.copy(m[0]).add(x).add(v),G(_.x,_.y,_.z)):G(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<P;t++){const n=l?A(M[t],D[t],F):M[t];b?(x.copy(y.normals[e]).multiplyScalar(n.x),v.copy(y.binormals[e]).multiplyScalar(n.y),_.copy(m[e]).add(x).add(v),G(_.x,_.y,_.z)):G(n.x,n.y,u/a*e)}for(let e=d-1;e>=0;e--){const t=e/d,n=c*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+p;for(let e=0,i=C.length;e<i;e++){const t=A(C[e],R[e],r);G(t.x,t.y,u+n)}for(let e=0,i=E.length;e<i;e++){const t=E[e];O=N[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],O[e],r);b?G(i.x,i.y+m[a-1].y,m[a-1].x+n):G(i.x,i.y,u+n)}}}function k(){const t=r.length/3;if(l){let t=0,e=P*t;for(let n=0;n<L;n++){const t=T[n];U(t[2]+e,t[1]+e,t[0]+e)}t=a+2*d,e=P*t;for(let n=0;n<L;n++){const t=T[n];U(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<L;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=T[t];U(e[0]+P*a,e[1]+P*a,e[2]+P*a)}}n.addGroup(t,r.length/3-t,0)}function B(){const t=r.length/3;let e=0;z(C,e),e+=C.length;for(let n=0,r=E.length;n<r;n++){const t=E[n];z(t,e),e+=t.length}n.addGroup(t,r.length/3-t,1)}function z(t,e){let n=t.length;while(--n>=0){const r=n;let i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*d;t<n;t++){const n=P*t,o=P*(t+1),s=e+r+n,a=e+i+n,u=e+i+o,l=e+r+o;V(s,a,u,l)}}}function G(t,e,n){o.push(t),o.push(e),o.push(n)}function U(t,e,i){H(t),H(e),H(i);const o=r.length/3,s=g.generateTopUV(n,r,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[2])}function V(t,e,i,o){H(t),H(e),H(o),H(e),H(i),H(o);const s=r.length/3,a=g.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function H(t){r.push(o[3*t+0]),r.push(o[3*t+1]),r.push(o[3*t+2])}function j(t){i.push(t.x),i.push(t.y)}k(),B()}this.setAttribute("position",new Io(r,3)),this.setAttribute("uv",new Io(i,2)),this.computeVertexNormals()}toJSON(){const t=Ho.prototype.toJSON.call(this),e=this.parameters.shapes,n=this.parameters.options;return Sd(e,n,t)}}const Ed={generateTopUV:function(t,e,n,r,i){const o=e[3*n],s=e[3*n+1],a=e[3*r],u=e[3*r+1],l=e[3*i],c=e[3*i+1];return[new Or(o,s),new Or(a,u),new Or(l,c)]},generateSideWallUV:function(t,e,n,r,i,o){const s=e[3*n],a=e[3*n+1],u=e[3*n+2],l=e[3*r],c=e[3*r+1],h=e[3*r+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],g=e[3*o],m=e[3*o+1],y=e[3*o+2];return Math.abs(a-c)<.01?[new Or(s,1-u),new Or(l,1-h),new Or(p,1-f),new Or(g,1-y)]:[new Or(a,1-u),new Or(c,1-h),new Or(d,1-f),new Or(m,1-y)]}};function Sd(t,e,n){if(n.shapes=[],Array.isArray(t))for(let r=0,i=t.length;r<i;r++){const e=t[r];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class Td extends Dp{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,i,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}}class Cd extends Ho{constructor(t,e=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e),r=Nr.clamp(r,0,2*Math.PI);const i=[],o=[],s=[],a=1/e,u=new Wr,l=new Or;for(let c=0;c<=e;c++){const i=n+c*a*r,h=Math.sin(i),p=Math.cos(i);for(let n=0;n<=t.length-1;n++)u.x=t[n].x*h,u.y=t[n].y,u.z=t[n].x*p,o.push(u.x,u.y,u.z),l.x=c/e,l.y=n/(t.length-1),s.push(l.x,l.y)}for(let c=0;c<e;c++)for(let e=0;e<t.length-1;e++){const n=e+c*t.length,r=n,o=n+t.length,s=n+t.length+1,a=n+1;i.push(r,o,a),i.push(o,s,a)}if(this.setIndex(i),this.setAttribute("position",new Io(o,3)),this.setAttribute("uv",new Io(s,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new Wr,i=new Wr,o=new Wr,s=e*t.length*3;for(let e=0,a=0;e<t.length;e++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[s+a+0],i.y=n[s+a+1],i.z=n[s+a+2],o.addVectors(r,i).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}}class Ad extends Dp{constructor(t=1,e=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}}function Pd(t,e,n){Ho.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,u=new Wr,l=new Wr,c=new Wr,h=new Wr,p=new Wr;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const d=e+1;for(let f=0;f<=n;f++){const r=f/n;for(let n=0;n<=e;n++){const d=n/e;t(d,r,l),i.push(l.x,l.y,l.z),d-a>=0?(t(d-a,r,c),h.subVectors(l,c)):(t(d+a,r,c),h.subVectors(c,l)),r-a>=0?(t(d,r-a,c),p.subVectors(l,c)):(t(d,r+a,c),p.subVectors(c,l)),u.crossVectors(h,p).normalize(),o.push(u.x,u.y,u.z),s.push(d,r)}}for(let f=0;f<n;f++)for(let t=0;t<e;t++){const e=f*d+t,n=f*d+t+1,i=(f+1)*d+t+1,o=(f+1)*d+t;r.push(e,n,o),r.push(n,i,o)}this.setIndex(r),this.setAttribute("position",new Io(i,3)),this.setAttribute("normal",new Io(o,3)),this.setAttribute("uv",new Io(s,2))}Pd.prototype=Object.create(Ho.prototype),Pd.prototype.constructor=Pd;class Ld extends Ho{constructor(t=.5,e=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const s=[],a=[],u=[],l=[];let c=t;const h=(e-t)/r,p=new Wr,d=new Or;for(let f=0;f<=r;f++){for(let t=0;t<=n;t++){const r=i+t/n*o;p.x=c*Math.cos(r),p.y=c*Math.sin(r),a.push(p.x,p.y,p.z),u.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,l.push(d.x,d.y)}c+=h}for(let f=0;f<r;f++){const t=f*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,a=r+n+2,u=r+1;s.push(i,o,u),s.push(o,a,u)}}this.setIndex(s),this.setAttribute("position",new Io(a,3)),this.setAttribute("normal",new Io(u,3)),this.setAttribute("uv",new Io(l,2))}}class Id extends Ho{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(t))u(t);else for(let l=0;l<t.length;l++)u(t[l]),this.addGroup(s,a,l),s+=a,a=0;function u(t){const s=r.length/3,u=t.extractPoints(e);let l=u.shape;const c=u.holes;!1===_d.isClockWise(l)&&(l=l.reverse());for(let e=0,n=c.length;e<n;e++){const t=c[e];!0===_d.isClockWise(t)&&(c[e]=t.reverse())}const h=_d.triangulateShape(l,c);for(let e=0,n=c.length;e<n;e++){const t=c[e];l=l.concat(t)}for(let e=0,n=l.length;e<n;e++){const t=l[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,r=h.length;e<r;e++){const t=h[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Io(r,3)),this.setAttribute("normal",new Io(i,3)),this.setAttribute("uv",new Io(o,2))}toJSON(){const t=Ho.prototype.toJSON.call(this),e=this.parameters.shapes;return Rd(e,t)}}function Rd(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}class Nd extends Ho{constructor(t=1,e=8,n=6,r=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let u=0;const l=[],c=new Wr,h=new Wr,p=[],d=[],f=[],g=[];for(let m=0;m<=n;m++){const p=[],y=m/n;let v=0;0==m&&0==o?v=.5/e:m==n&&a==Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const a=n/e;c.x=-t*Math.cos(r+a*i)*Math.sin(o+y*s),c.y=t*Math.cos(o+y*s),c.z=t*Math.sin(r+a*i)*Math.sin(o+y*s),d.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),g.push(a+v,1-y),p.push(u++)}l.push(p)}for(let m=0;m<n;m++)for(let t=0;t<e;t++){const e=l[m][t+1],r=l[m][t],i=l[m+1][t],s=l[m+1][t+1];(0!==m||o>0)&&p.push(e,r,s),(m!==n-1||a<Math.PI)&&p.push(r,i,s)}this.setIndex(p),this.setAttribute("position",new Io(d,3)),this.setAttribute("normal",new Io(f,3)),this.setAttribute("uv",new Io(g,2))}}class Od extends Dp{constructor(t=1,e=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}}class Dd extends Md{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ho;const r=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(r,e),this.type="TextGeometry"}}class Fd extends Ho{constructor(t=1,e=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],u=[],l=new Wr,c=new Wr,h=new Wr;for(let p=0;p<=n;p++)for(let o=0;o<=r;o++){const d=o/r*i,f=p/n*Math.PI*2;c.x=(t+e*Math.cos(f))*Math.cos(d),c.y=(t+e*Math.cos(f))*Math.sin(d),c.z=e*Math.sin(f),s.push(c.x,c.y,c.z),l.x=t*Math.cos(d),l.y=t*Math.sin(d),h.subVectors(c,l).normalize(),a.push(h.x,h.y,h.z),u.push(o/r),u.push(p/n)}for(let p=1;p<=n;p++)for(let t=1;t<=r;t++){const e=(r+1)*p+t-1,n=(r+1)*(p-1)+t-1,i=(r+1)*(p-1)+t,s=(r+1)*p+t;o.push(e,n,s),o.push(n,i,s)}this.setIndex(o),this.setAttribute("position",new Io(s,3)),this.setAttribute("normal",new Io(a,3)),this.setAttribute("uv",new Io(u,2))}}class kd extends Ho{constructor(t=1,e=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],u=[],l=[],c=new Wr,h=new Wr,p=new Wr,d=new Wr,f=new Wr,g=new Wr,m=new Wr;for(let v=0;v<=n;++v){const s=v/n*i*Math.PI*2;y(s,i,o,t,p),y(s+.01,i,o,t,d),g.subVectors(d,p),m.addVectors(d,p),f.crossVectors(g,m),m.crossVectors(f,g),f.normalize(),m.normalize();for(let t=0;t<=r;++t){const i=t/r*Math.PI*2,o=-e*Math.cos(i),s=e*Math.sin(i);c.x=p.x+(o*m.x+s*f.x),c.y=p.y+(o*m.y+s*f.y),c.z=p.z+(o*m.z+s*f.z),a.push(c.x,c.y,c.z),h.subVectors(c,p).normalize(),u.push(h.x,h.y,h.z),l.push(v/n),l.push(t/r)}}for(let v=1;v<=n;v++)for(let t=1;t<=r;t++){const e=(r+1)*(v-1)+(t-1),n=(r+1)*v+(t-1),i=(r+1)*v+t,o=(r+1)*(v-1)+t;s.push(e,n,o),s.push(n,i,o)}function y(t,e,n,r,i){const o=Math.cos(t),s=Math.sin(t),a=n/e*t,u=Math.cos(a);i.x=r*(2+u)*.5*o,i.y=r*(2+u)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Io(a,3)),this.setAttribute("normal",new Io(u,3)),this.setAttribute("uv",new Io(l,2))}}class Bd extends Ho{constructor(t,e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Wr,a=new Wr,u=new Or;let l=new Wr;const c=[],h=[],p=[],d=[];function f(){for(let t=0;t<e;t++)g(t);g(!1===i?e:0),y(),m()}function g(i){l=t.getPointAt(i/e,l);const u=o.normals[i],p=o.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),o=-Math.cos(e);a.x=o*u.x+i*p.x,a.y=o*u.y+i*p.y,a.z=o*u.z+i*p.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,c.push(s.x,s.y,s.z)}}function m(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),o=(r+1)*t+e,s=(r+1)*(t-1)+e;d.push(n,i,s),d.push(i,o,s)}}function y(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)u.x=t/e,u.y=n/r,p.push(u.x,u.y)}f(),this.setIndex(d),this.setAttribute("position",new Io(c,3)),this.setAttribute("normal",new Io(h,3)),this.setAttribute("uv",new Io(p,2))}toJSON(){const t=Ho.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class zd extends Ho{constructor(t){if(super(),this.type="WireframeGeometry",!0===t.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const e=[],n=[0,0],r={},i=new Wr;if(null!==t.index){const o=t.attributes.position,s=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let t=0,e=a.length;t<e;++t){const e=a[t],i=e.start,o=e.count;for(let t=i,a=i+o;t<a;t+=3)for(let e=0;e<3;e++){const i=s.getX(t+e),o=s.getX(t+(e+1)%3);n[0]=Math.min(i,o),n[1]=Math.max(i,o);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];i.fromBufferAttribute(o,n.index1),e.push(i.x,i.y,i.z),i.fromBufferAttribute(o,n.index2),e.push(i.x,i.y,i.z)}}else{const n=t.attributes.position;for(let t=0,r=n.count/3;t<r;t++)for(let o=0;o<3;o++){const r=3*t+o;i.fromBufferAttribute(n,r),e.push(i.x,i.y,i.z);const s=3*t+(o+1)%3;i.fromBufferAttribute(n,s),e.push(i.x,i.y,i.z)}}this.setAttribute("position",new Io(e,3))}}var Gd=Object.freeze({__proto__:null,BoxGeometry:cs,BoxBufferGeometry:cs,CircleGeometry:Rp,CircleBufferGeometry:Rp,ConeGeometry:Op,ConeBufferGeometry:Op,CylinderGeometry:Np,CylinderBufferGeometry:Np,DodecahedronGeometry:Fp,DodecahedronBufferGeometry:Fp,EdgesGeometry:Up,ExtrudeGeometry:Md,ExtrudeBufferGeometry:Md,IcosahedronGeometry:Td,IcosahedronBufferGeometry:Td,LatheGeometry:Cd,LatheBufferGeometry:Cd,OctahedronGeometry:Ad,OctahedronBufferGeometry:Ad,ParametricGeometry:Pd,ParametricBufferGeometry:Pd,PlaneGeometry:Ls,PlaneBufferGeometry:Ls,PolyhedronGeometry:Dp,PolyhedronBufferGeometry:Dp,RingGeometry:Ld,RingBufferGeometry:Ld,ShapeGeometry:Id,ShapeBufferGeometry:Id,SphereGeometry:Nd,SphereBufferGeometry:Nd,TetrahedronGeometry:Od,TetrahedronBufferGeometry:Od,TextGeometry:Dd,TextBufferGeometry:Dd,TorusGeometry:Fd,TorusBufferGeometry:Fd,TorusKnotGeometry:kd,TorusKnotBufferGeometry:kd,TubeGeometry:Bd,TubeBufferGeometry:Bd,WireframeGeometry:zd});class Ud extends co{constructor(t){super(),this.type="ShadowMaterial",this.color=new vo(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Ud.prototype.isShadowMaterial=!0;class Vd extends ms{constructor(t){super(t),this.type="RawShaderMaterial"}}function Hd(t){co.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new vo(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=er,this.normalScale=new Or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(t)}function jd(t){Hd.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Or(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Nr.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}Vd.prototype.isRawShaderMaterial=!0,Hd.prototype=Object.create(co.prototype),Hd.prototype.constructor=Hd,Hd.prototype.isMeshStandardMaterial=!0,Hd.prototype.copy=function(t){return co.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this},jd.prototype=Object.create(Hd.prototype),jd.prototype.constructor=jd,jd.prototype.isMeshPhysicalMaterial=!0,jd.prototype.copy=function(t){return Hd.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new vo).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this};class Wd extends co{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new vo(16777215),this.specular=new vo(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=er,this.normalScale=new Or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}Wd.prototype.isMeshPhongMaterial=!0;class qd extends co{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new vo(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=er,this.normalScale=new Or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}qd.prototype.isMeshToonMaterial=!0;class Yd extends co{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=er,this.normalScale=new Or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}Yd.prototype.isMeshNormalMaterial=!0;class Xd extends co{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new vo(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this}}Xd.prototype.isMeshLambertMaterial=!0;class Zd extends co{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new vo(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=er,this.normalScale=new Or(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.flatShading=t.flatShading,this}}Zd.prototype.isMeshMatcapMaterial=!0;class Kd extends cp{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Kd.prototype.isLineDashedMaterial=!0;var Jd=Object.freeze({__proto__:null,ShadowMaterial:Ud,SpriteMaterial:Lh,RawShaderMaterial:Vd,ShaderMaterial:ms,PointsMaterial:bp,MeshPhysicalMaterial:jd,MeshStandardMaterial:Hd,MeshPhongMaterial:Wd,MeshToonMaterial:qd,MeshNormalMaterial:Yd,MeshLambertMaterial:Xd,MeshDepthMaterial:uh,MeshDistanceMaterial:lh,MeshBasicMaterial:xo,MeshMatcapMaterial:Zd,LineDashedMaterial:Kd,LineBasicMaterial:cp,Material:co});const Qd={arraySlice:function(t,e,n){return Qd.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(e,n){return t[e]-t[n]}const n=t.length,r=new Array(n);for(let i=0;i!==n;++i)r[i]=i;return r.sort(e),r},sortedArray:function(t,e,n){const r=t.length,i=new t.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*e;for(let n=0;n!==e;++n)i[s++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,o=t[0];while(void 0!==o&&void 0===o[r])o=t[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(e.push(o.time),n.push.apply(n,s)),o=t[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(e.push(o.time),s.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(e.push(o.time),n.push(s)),o=t[i++]}while(void 0!==o)},subclip:function(t,e,n,r,i=30){const o=t.clone();o.name=e;const s=[];for(let u=0;u<o.tracks.length;++u){const t=o.tracks[u],e=t.getValueSize(),a=[],l=[];for(let o=0;o<t.times.length;++o){const s=t.times[o]*i;if(!(s<n||s>=r)){a.push(t.times[o]);for(let n=0;n<e;++n)l.push(t.values[o*e+n])}}0!==a.length&&(t.times=Qd.convertArray(a,t.times.constructor),t.values=Qd.convertArray(l,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let u=0;u<o.tracks.length;++u)a>o.tracks[u].times[0]&&(a=o.tracks[u].times[0]);for(let u=0;u<o.tracks.length;++u)o.tracks[u].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,o=e/r;for(let s=0;s<i;++s){const e=n.tracks[s],r=e.ValueTypeName;if("bool"===r||"string"===r)continue;const i=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===r}));if(void 0===i)continue;let a=0;const u=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=u/3);let l=0;const c=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const h=e.times.length-1;let p;if(o<=e.times[0]){const t=a,n=u-a;p=Qd.arraySlice(e.values,t,n)}else if(o>=e.times[h]){const t=h*u+a,n=t+u-a;p=Qd.arraySlice(e.values,t,n)}else{const t=e.createInterpolant(),n=a,r=u-a;t.evaluate(o),p=Qd.arraySlice(t.resultBuffer,n,r)}if("quaternion"===r){const t=(new jr).fromArray(p).normalize().conjugate();t.toArray(p)}const d=i.times.length;for(let t=0;t<d;++t){const e=t*c+l;if("quaternion"===r)jr.multiplyQuaternionsFlat(i.values,e,p,0,i.values,e);else{const t=c-2*l;for(let n=0;n<t;++n)i.values[e+n]-=p[n]}}}return t.blendMode=Un,t}};function $d(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function tf(t,e,n,r){$d.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ef(t,e,n,r){$d.call(this,t,e,n,r)}function nf(t,e,n,r){$d.call(this,t,e,n,r)}Object.assign($d.prototype,{evaluate:function(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let o;n:{r:if(!(t<r)){for(let o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}o=e.length;break n}if(t>=i)break t;{const s=e[1];t<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}o=n,n=0}}while(n<o){const r=n+o>>>1;t<e[r]?o=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let o=0;o!==r;++o)e[o]=n[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign($d.prototype,{beforeStart_:$d.prototype.copySampleValue_,afterEnd_:$d.prototype.copySampleValue_}),tf.prototype=Object.assign(Object.create($d.prototype),{constructor:tf,DefaultSettings_:{endingStart:kn,endingEnd:kn},intervalChanged_:function(t,e,n){const r=this.parameterPositions;let i=t-2,o=t+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case Bn:i=t,s=2*e-n;break;case zn:i=r.length-2,s=e+r[i]-r[i+1];break;default:i=t,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Bn:o=t,a=2*n-e;break;case zn:o=1,a=n+r[1]-r[0];break;default:o=t-1,a=e}const u=.5*(n-e),l=this.valueSize;this._weightPrev=u/(e-s),this._weightNext=u/(a-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,u=a-s,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-e)/(r-e),f=d*d,g=f*d,m=-h*g+2*h*f-h*d,y=(1+h)*g+(-1.5-2*h)*f+(-.5+h)*d+1,v=(-1-p)*g+(1.5+p)*f+.5*d,x=p*g-p*f;for(let _=0;_!==s;++_)i[_]=m*o[l+_]+y*o[u+_]+v*o[a+_]+x*o[c+_];return i}}),ef.prototype=Object.assign(Object.create($d.prototype),{constructor:ef,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,u=a-s,l=(n-e)/(r-e),c=1-l;for(let h=0;h!==s;++h)i[h]=o[u+h]*c+o[a+h]*l;return i}}),nf.prototype=Object.assign(Object.create($d.prototype),{constructor:nf,interpolate_:function(t){return this.copySampleValue_(t-1)}});class rf{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Qd.convertArray(e,this.TimeBufferType),this.values=Qd.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Qd.convertArray(t.times,Array),values:Qd.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new nf(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new ef(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new tf(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case On:e=this.InterpolantFactoryMethodDiscrete;break;case Dn:e=this.InterpolantFactoryMethodLinear;break;case Fn:e=this.InterpolantFactoryMethodSmooth;break}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return On;case this.InterpolantFactoryMethodLinear:return Dn;case this.InterpolantFactoryMethodSmooth:return Fn}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,o=r-1;while(i!==r&&n[i]<t)++i;while(-1!==o&&n[o]>e)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const t=this.getValueSize();this.times=Qd.arraySlice(n,i,o),this.values=Qd.arraySlice(this.values,i*t,o*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let s=0;s!==i;s++){const e=n[s];if("number"===typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,e),t=!1;break}if(null!==o&&o>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,e,o),t=!1;break}o=e}if(void 0!==r&&Qd.isTypedArray(r))for(let s=0,a=r.length;s!==a;++s){const e=r[s];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,e),t=!1;break}}return t}optimize(){const t=Qd.arraySlice(this.times),e=Qd.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Fn,i=t.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=t[s],u=t[s+1];if(a!==u&&(1!==s||a!==t[0]))if(r)i=!0;else{const t=s*n,r=t-n,o=t+n;for(let s=0;s!==n;++s){const n=e[t+s];if(n!==e[r+s]||n!==e[o+s]){i=!0;break}}}if(i){if(s!==o){t[o]=t[s];const r=s*n,i=o*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++o}}if(i>0){t[o]=t[i];for(let t=i*n,r=o*n,s=0;s!==n;++s)e[r+s]=e[t+s];++o}return o!==t.length?(this.times=Qd.arraySlice(t,0,o),this.values=Qd.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this}clone(){const t=Qd.arraySlice(this.times,0),e=Qd.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}rf.prototype.TimeBufferType=Float32Array,rf.prototype.ValueBufferType=Float32Array,rf.prototype.DefaultInterpolation=Dn;class of extends rf{}of.prototype.ValueTypeName="bool",of.prototype.ValueBufferType=Array,of.prototype.DefaultInterpolation=On,of.prototype.InterpolantFactoryMethodLinear=void 0,of.prototype.InterpolantFactoryMethodSmooth=void 0;class sf extends rf{}sf.prototype.ValueTypeName="color";class af extends rf{}function uf(t,e,n,r){$d.call(this,t,e,n,r)}af.prototype.ValueTypeName="number",uf.prototype=Object.assign(Object.create($d.prototype),{constructor:uf,interpolate_:function(t,e,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-e)/(r-e);let u=t*s;for(let l=u+s;u!==l;u+=4)jr.slerpFlat(i,0,o,u-s,o,u,a);return i}});class lf extends rf{InterpolantFactoryMethodLinear(t){return new uf(this.times,this.values,this.getValueSize(),t)}}lf.prototype.ValueTypeName="quaternion",lf.prototype.DefaultInterpolation=Dn,lf.prototype.InterpolantFactoryMethodSmooth=void 0;class cf extends rf{}cf.prototype.ValueTypeName="string",cf.prototype.ValueBufferType=Array,cf.prototype.DefaultInterpolation=On,cf.prototype.InterpolantFactoryMethodLinear=void 0,cf.prototype.InterpolantFactoryMethodSmooth=void 0;class hf extends rf{}hf.prototype.ValueTypeName="vector";class pf{constructor(t,e=-1,n,r=Gn){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Nr.generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let o=0,s=n.length;o!==s;++o)e.push(ff(n[o]).scale(r));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let i=0,o=n.length;i!==o;++i)e.push(rf.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const i=e.length,o=[];for(let s=0;s<i;s++){let t=[],a=[];t.push((s+i-1)%i,s,(s+1)%i),a.push(0,1,0);const u=Qd.getKeyframeOrder(t);t=Qd.sortedArray(t,1,u),a=Qd.sortedArray(a,1,u),r||0!==t[0]||(t.push(i),a.push(a[0])),o.push(new af(".morphTargetInfluences["+e[s].name+"]",t,a).scale(1/n))}return new this(t,-1,o)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let s=0,a=t.length;s<a;s++){const e=t[s],n=e.name.match(i);if(n&&n.length>1){const t=n[1];let i=r[t];i||(r[t]=i=[]),i.push(e)}}const o=[];for(const s in r)o.push(this.CreateFromMorphTargetSequence(s,r[s],e,n));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const o=[],s=[];Qd.flattenJSON(n,o,s,r),0!==o.length&&i.push(new t(e,o,s))}},r=[],i=t.name||"default",o=t.fps||30,s=t.blendMode;let a=t.length||-1;const u=t.hierarchy||[];for(let c=0;c<u.length;c++){const t=u[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let r=0;r<t[n].morphTargets.length;r++)e[t[n].morphTargets[r]]=-1;for(const i in e){const e=[],o=[];for(let r=0;r!==t[n].morphTargets.length;++r){const r=t[n];e.push(r.time),o.push(r.morphTarget===i?1:0)}r.push(new af(".morphTargetInfluence["+i+"]",e,o))}a=e.length*(o||1)}else{const i=".bones["+e[c].name+"]";n(hf,i+".position",t,"pos",r),n(lf,i+".quaternion",t,"rot",r),n(hf,i+".scale",t,"scl",r)}}if(0===r.length)return null;const l=new this(i,a,r,s);return l}resetDuration(){const t=this.tracks;let e=0;for(let n=0,r=t.length;n!==r;++n){const t=this.tracks[n];e=Math.max(e,t.times[t.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function df(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return af;case"vector":case"vector2":case"vector3":case"vector4":return hf;case"color":return sf;case"quaternion":return lf;case"bool":case"boolean":return of;case"string":return cf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function ff(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=df(t.type);if(void 0===t.times){const e=[],n=[];Qd.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const gf={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function mf(t,e,n){const r=this;let i=!1,o=0,s=0,a=void 0;const u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,s),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){const e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=u.length;e<n;e+=2){const n=u[e],r=u[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}const yf=new mf;function vf(t){this.manager=void 0!==t?t:yf,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(vf.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const xf={};function _f(t){vf.call(this,t)}_f.prototype=Object.assign(Object.create(vf.prototype),{constructor:_f,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=gf.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0!==xf[t])return void xf[t].push({onLoad:e,onProgress:n,onError:r});const s=/^data:(.*?)(;base64)?,(.*)$/,a=t.match(s);let u;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const t=new Uint8Array(s.length);for(let n=0;n<s.length;n++)t[n]=s.charCodeAt(n);r="blob"===o?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;r=e.parseFromString(s,n);break;case"json":r=JSON.parse(s);break;default:r=s;break}setTimeout((function(){e&&e(r),i.manager.itemEnd(t)}),0)}catch(l){setTimeout((function(){r&&r(l),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{xf[t]=[],xf[t].push({onLoad:e,onProgress:n,onError:r}),u=new XMLHttpRequest,u.open("GET",t,!0),u.addEventListener("load",(function(e){const n=this.response,r=xf[t];if(delete xf[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),gf.add(t,n);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.onLoad&&e.onLoad(n)}i.manager.itemEnd(t)}else{for(let t=0,n=r.length;t<n;t++){const n=r[t];n.onError&&n.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),u.addEventListener("progress",(function(e){const n=xf[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onProgress&&r.onProgress(e)}}),!1),u.addEventListener("error",(function(e){const n=xf[t];delete xf[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),u.addEventListener("abort",(function(e){const n=xf[t];delete xf[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(u.responseType=this.responseType),void 0!==this.withCredentials&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)u.setRequestHeader(t,this.requestHeader[t]);u.send(null)}return i.manager.itemStart(t),u},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}});class bf extends vf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new _f(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)}parse(t){const e=[];for(let n=0;n<t.length;n++){const r=pf.parse(t[n]);e.push(r)}return e}}function wf(t){vf.call(this,t)}wf.prototype=Object.assign(Object.create(vf.prototype),{constructor:wf,load:function(t,e,n,r){const i=this,o=[],s=new Pp,a=new _f(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let u=0;function l(l){a.load(t[l],(function(t){const n=i.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},u+=1,6===u&&(1===n.mipmapCount&&(s.minFilter=de),s.image=o,s.format=n.format,s.needsUpdate=!0,e&&e(s))}),n,r)}if(Array.isArray(t))for(let c=0,h=t.length;c<h;++c)l(c);else a.load(t,(function(t){const n=i.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){o[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)o[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),o[e].format=n.format,o[e].width=n.width,o[e].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=de),s.format=n.format,s.needsUpdate=!0,e&&e(s)}),n,r);return s}});class Mf extends vf{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=gf.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",u,!1),gf.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){s.removeEventListener("load",a,!1),s.removeEventListener("error",u,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return s.addEventListener("load",a,!1),s.addEventListener("error",u,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(t),s.src=t,s}}class Ef extends vf{constructor(t){super(t)}load(t,e,n,r){const i=new ws,o=new Mf(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(t[n],(function(t){i.images[n]=t,s++,6===s&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let u=0;u<t.length;++u)a(u);return i}}function Sf(t){vf.call(this,t)}function Tf(t){vf.call(this,t)}function Cf(){this.type="Curve",this.arcLengthDivisions=200}Sf.prototype=Object.assign(Object.create(vf.prototype),{constructor:Sf,load:function(t,e,n,r){const i=this,o=new Es,s=new _f(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(t,(function(t){const n=i.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:se,o.wrapT=void 0!==n.wrapT?n.wrapT:se,o.magFilter=void 0!==n.magFilter?n.magFilter:de,o.minFilter=void 0!==n.minFilter?n.minFilter:de,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=me),1===n.mipmapCount&&(o.minFilter=de),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n))}),n,r),o}}),Tf.prototype=Object.assign(Object.create(vf.prototype),{constructor:Tf,load:function(t,e,n,r){const i=new zr,o=new Mf(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){i.image=n;const r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?Ie:Re,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}}),Object.assign(Cf.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const n=this.getLengths();let r=0;const i=n.length;let o;o=e||t*n[i-1];let s,a=0,u=i-1;while(a<=u)if(r=Math.floor(a+(u-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){u=r;break}u=r-1}if(r=u,n[r]===o)return r/(i-1);const l=n[r],c=n[r+1],h=c-l,p=(o-l)/h,d=(r+p)/(i-1);return d},getTangent:function(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=e||(o.isVector2?new Or:new Wr);return a.copy(s).sub(o).normalize(),a},getTangentAt:function(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){const n=new Wr,r=[],i=[],o=[],s=new Wr,a=new wi;for(let p=0;p<=t;p++){const e=p/t;r[p]=this.getTangentAt(e,new Wr),r[p].normalize()}i[0]=new Wr,o[0]=new Wr;let u=Number.MAX_VALUE;const l=Math.abs(r[0].x),c=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=u&&(u=l,n.set(1,0,0)),c<=u&&(u=c,n.set(0,1,0)),h<=u&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let p=1;p<=t;p++){if(i[p]=i[p-1].clone(),o[p]=o[p-1].clone(),s.crossVectors(r[p-1],r[p]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(Nr.clamp(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(a.makeRotationAxis(s,t))}o[p].crossVectors(r[p],i[p])}if(!0===e){let e=Math.acos(Nr.clamp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(s.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}});class Af extends Cf{constructor(t=0,e=0,n=1,r=1,i=0,o=2*Math.PI,s=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(t,e){const n=e||new Or,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;while(i<0)i+=r;while(i>r)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(s),u=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=u-this.aY;a=n*t-r*e+this.aX,u=n*e+r*t+this.aY}return n.set(a,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Af.prototype.isEllipseCurve=!0;class Pf extends Af{constructor(t,e,n,r,i,o){super(t,e,n,n,r,i,o),this.type="ArcCurve"}}function Lf(){let t=0,e=0,n=0,r=0;function i(i,o,s,a){t=i,e=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,s,a){let u=(e-t)/o-(n-t)/(o+s)+(n-e)/s,l=(n-e)/s-(r-e)/(s+a)+(r-n)/a;u*=s,l*=s,i(e,n,u,l)},calc:function(i){const o=i*i,s=o*i;return t+e*i+n*o+r*s}}}Pf.prototype.isArcCurve=!0;const If=new Wr,Rf=new Lf,Nf=new Lf,Of=new Lf;class Df extends Cf{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new Wr){const n=e,r=this.points,i=r.length,o=(i-(this.closed?0:1))*t;let s,a,u=Math.floor(o),l=o-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/i)+1)*i:0===l&&u===i-1&&(u=i-2,l=1),this.closed||u>0?s=r[(u-1)%i]:(If.subVectors(r[0],r[1]).add(r[0]),s=If);const c=r[u%i],h=r[(u+1)%i];if(this.closed||u+2<i?a=r[(u+2)%i]:(If.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=If),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),Rf.initNonuniformCatmullRom(s.x,c.x,h.x,a.x,e,n,r),Nf.initNonuniformCatmullRom(s.y,c.y,h.y,a.y,e,n,r),Of.initNonuniformCatmullRom(s.z,c.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(Rf.initCatmullRom(s.x,c.x,h.x,a.x,this.tension),Nf.initCatmullRom(s.y,c.y,h.y,a.y,this.tension),Of.initCatmullRom(s.z,c.z,h.z,a.z,this.tension));return n.set(Rf.calc(l),Nf.calc(l),Of.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Wr).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ff(t,e,n,r,i){const o=.5*(r-e),s=.5*(i-n),a=t*t,u=t*a;return(2*n-2*r+o+s)*u+(-3*n+3*r-2*o-s)*a+o*t+n}function kf(t,e){const n=1-t;return n*n*e}function Bf(t,e){return 2*(1-t)*t*e}function zf(t,e){return t*t*e}function Gf(t,e,n,r){return kf(t,e)+Bf(t,n)+zf(t,r)}function Uf(t,e){const n=1-t;return n*n*n*e}function Vf(t,e){const n=1-t;return 3*n*n*t*e}function Hf(t,e){return 3*(1-t)*t*t*e}function jf(t,e){return t*t*t*e}function Wf(t,e,n,r,i){return Uf(t,e)+Vf(t,n)+Hf(t,r)+jf(t,i)}Df.prototype.isCatmullRomCurve3=!0;class qf extends Cf{constructor(t=new Or,e=new Or,n=new Or,r=new Or){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Or){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Wf(t,r.x,i.x,o.x,s.x),Wf(t,r.y,i.y,o.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}qf.prototype.isCubicBezierCurve=!0;class Yf extends Cf{constructor(t=new Wr,e=new Wr,n=new Wr,r=new Wr){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Wr){const n=e,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Wf(t,r.x,i.x,o.x,s.x),Wf(t,r.y,i.y,o.y,s.y),Wf(t,r.z,i.z,o.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Yf.prototype.isCubicBezierCurve3=!0;class Xf extends Cf{constructor(t=new Or,e=new Or){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Or){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Or;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Xf.prototype.isLineCurve=!0;class Zf extends Cf{constructor(t=new Wr,e=new Wr){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Wr){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Kf extends Cf{constructor(t=new Or,e=new Or,n=new Or){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Or){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Gf(t,r.x,i.x,o.x),Gf(t,r.y,i.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Kf.prototype.isQuadraticBezierCurve=!0;class Jf extends Cf{constructor(t=new Wr,e=new Wr,n=new Wr){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Wr){const n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Gf(t,r.x,i.x,o.x),Gf(t,r.y,i.y,o.y),Gf(t,r.z,i.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Jf.prototype.isQuadraticBezierCurve3=!0;class Qf extends Cf{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Or){const n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],u=r[o],l=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return n.set(Ff(s,a.x,u.x,l.x,c.x),Ff(s,a.y,u.y,l.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Or).fromArray(n))}return this}}Qf.prototype.isSplineCurve=!0;var $f=Object.freeze({__proto__:null,ArcCurve:Pf,CatmullRomCurve3:Df,CubicBezierCurve:qf,CubicBezierCurve3:Yf,EllipseCurve:Af,LineCurve:Xf,LineCurve3:Zf,QuadraticBezierCurve:Kf,QuadraticBezierCurve3:Jf,SplineCurve:Qf});class tg extends Cf{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Xf(e,t))}getPoint(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;while(r<n.length){if(n[r]>=e){const t=n[r]-e,i=this.curves[r],o=i.getLength(),s=0===o?0:1-t/o;return i.getPointAt(s)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s);for(let t=0;t<a.length;t++){const r=a[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new $f[n.type]).fromJSON(n))}return this}}class eg extends tg{constructor(t){super(),this.type="Path",this.currentPoint=new Or,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Xf(this.currentPoint.clone(),new Or(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){const i=new Kf(this.currentPoint.clone(),new Or(t,e),new Or(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,i,o){const s=new qf(this.currentPoint.clone(),new Or(t,e),new Or(n,r),new Or(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Qf(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,e+a,n,r,i,o),this}absarc(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this}ellipse(t,e,n,r,i,o,s,a){const u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+u,e+l,n,r,i,o,s,a),this}absellipse(t,e,n,r,i,o,s,a){const u=new Af(t,e,n,r,i,o,s,a);if(this.curves.length>0){const t=u.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(u);const l=u.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class ng extends eg{constructor(t){super(t),this.uuid=Nr.generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new eg).fromJSON(n))}return this}}class rg extends Yi{constructor(t,e=1){super(),this.type="Light",this.color=new vo(t),this.intensity=e}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}rg.prototype.isLight=!0;class ig extends rg{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.groundColor=new vo(e)}copy(t){return rg.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}ig.prototype.isHemisphereLight=!0;const og=new wi,sg=new Wr,ag=new Wr;class ug{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Or(512,512),this.map=null,this.mapPass=null,this.matrix=new wi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Cs,this._frameExtents=new Or(1,1),this._viewportCount=1,this._viewports=[new Ur(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;sg.setFromMatrixPosition(t.matrixWorld),e.position.copy(sg),ag.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ag),e.updateMatrixWorld(),og.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(og),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class lg extends ug{constructor(){super(new vs(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*Nr.RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}lg.prototype.isSpotLightShadow=!0;class cg extends rg{constructor(t,e,n=0,r=Math.PI/3,i=0,o=1){super(t,e),this.type="SpotLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.target=new Yi,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new lg}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}cg.prototype.isSpotLight=!0;const hg=new wi,pg=new Wr,dg=new Wr;class fg extends ug{constructor(){super(new vs(90,1,.5,500)),this._frameExtents=new Or(4,2),this._viewportCount=6,this._viewports=[new Ur(2,1,1,1),new Ur(0,1,1,1),new Ur(3,1,1,1),new Ur(1,1,1,1),new Ur(3,0,1,1),new Ur(1,0,1,1)],this._cubeDirections=[new Wr(1,0,0),new Wr(-1,0,0),new Wr(0,0,1),new Wr(0,0,-1),new Wr(0,1,0),new Wr(0,-1,0)],this._cubeUps=[new Wr(0,1,0),new Wr(0,1,0),new Wr(0,1,0),new Wr(0,1,0),new Wr(0,0,1),new Wr(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),pg.setFromMatrixPosition(t.matrixWorld),n.position.copy(pg),dg.copy(n.position),dg.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(dg),n.updateMatrixWorld(),r.makeTranslation(-pg.x,-pg.y,-pg.z),hg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hg)}}fg.prototype.isPointLightShadow=!0;class gg extends rg{constructor(t,e,n=0,r=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new fg}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}gg.prototype.isPointLight=!0;class mg extends ys{constructor(t=-1,e=1,n=1,r=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,o=n+t,s=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,o=i+t*this.view.width,s-=e*this.view.offsetY,a=s-e*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=Yi.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}mg.prototype.isOrthographicCamera=!0;class yg extends ug{constructor(){super(new mg(-5,5,5,-5,.5,500))}}yg.prototype.isDirectionalLightShadow=!0;class vg extends rg{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.target=new Yi,this.shadow=new yg}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}vg.prototype.isDirectionalLight=!0;class xg extends rg{constructor(t,e){super(t,e),this.type="AmbientLight"}}xg.prototype.isAmbientLight=!0;class _g extends rg{constructor(t,e,n=10,r=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=r}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}_g.prototype.isRectAreaLight=!0;class bg{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Wr)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}bg.prototype.isSphericalHarmonics3=!0;class wg extends rg{constructor(t=new bg,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}wg.prototype.isLightProbe=!0;class Mg extends vf{constructor(t){super(t),this.textures={}}load(t,e,n,r){const i=this,o=new _f(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new Jd[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new vo).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"===typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const i in t.uniforms){const e=t.uniforms[i];switch(r.uniforms[i]={},e.type){case"t":r.uniforms[i].value=n(e.value);break;case"c":r.uniforms[i].value=(new vo).setHex(e.value);break;case"v2":r.uniforms[i].value=(new Or).fromArray(e.value);break;case"v3":r.uniforms[i].value=(new Wr).fromArray(e.value);break;case"v4":r.uniforms[i].value=(new Ur).fromArray(e.value);break;case"m3":r.uniforms[i].value=(new Dr).fromArray(e.value);break;case"m4":r.uniforms[i].value=(new wi).fromArray(e.value);break;default:r.uniforms[i].value=e.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const i in t.extensions)r.extensions[i]=t.extensions[i];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Or).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Or).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r}setTextures(t){return this.textures=t,this}}const Eg={decodeText:function(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let r=0,i=t.length;r<i;r++)e+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(e))}catch(n){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Sg(){Ho.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Tg(t,e,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),wo.call(this,t,e,n),this.meshPerAttribute=r||1}Sg.prototype=Object.assign(Object.create(Ho.prototype),{constructor:Sg,isInstancedBufferGeometry:!0,copy:function(t){return Ho.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=Ho.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Tg.prototype=Object.assign(Object.create(wo.prototype),{constructor:Tg,isInstancedBufferAttribute:!0,copy:function(t){return wo.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=wo.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}});class Cg extends vf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new _f(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)}parse(t){const e={},n={};function r(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers,o=r[n],s=i(t,o.buffer),a=Do(o.type,s),u=new Ch(a,o.stride);return u.uuid=o.uuid,e[n]=u,u}function i(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers,i=r[e],o=new Uint32Array(i).buffer;return n[e]=o,o}const o=t.isInstancedBufferGeometry?new Sg:new Ho,s=t.data.index;if(void 0!==s){const t=Do(s.type,s.array);o.setIndex(new wo(t,1))}const a=t.data.attributes;for(const p in a){const e=a[p];let n;if(e.isInterleavedBufferAttribute){const i=r(t.data,e.data);n=new Ph(i,e.itemSize,e.offset,e.normalized)}else{const t=Do(e.type,e.array),r=e.isInstancedBufferAttribute?Tg:wo;n=new r(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),void 0!==e.usage&&n.setUsage(e.usage),void 0!==e.updateRange&&(n.updateRange.offset=e.updateRange.offset,n.updateRange.count=e.updateRange.count),o.setAttribute(p,n)}const u=t.data.morphAttributes;if(u)for(const p in u){const e=u[p],n=[];for(let i=0,o=e.length;i<o;i++){const o=e[i];let s;if(o.isInterleavedBufferAttribute){const e=r(t.data,o.data);s=new Ph(e,o.itemSize,o.offset,o.normalized)}else{const t=Do(o.type,o.array);s=new wo(t,o.itemSize,o.normalized)}void 0!==o.name&&(s.name=o.name),n.push(s)}o.morphAttributes[p]=n}const l=t.data.morphTargetsRelative;l&&(o.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let p=0,d=c.length;p!==d;++p){const t=c[p];o.addGroup(t.start,t.count,t.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new Wr;void 0!==h.center&&t.fromArray(h.center),o.boundingSphere=new di(t,h.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}}class Ag extends vf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=""===this.path?Eg.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const s=new _f(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){let o=null;try{o=JSON.parse(n)}catch(a){return void 0!==r&&r(a),void console.error("THREE:ObjectLoader: Can't parse "+t+".",a.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)}parse(t,e){const n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(u)})),s=this.parseTextures(t.textures,o),a=this.parseMaterials(t.materials,s),u=this.parseObject(t.object,i,a,n),l=this.parseSkeletons(t.skeletons,u);if(this.bindSkeletons(u,l),void 0!==e){let t=!1;for(const e in o)if(o[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(u)}return u}parseShapes(t){const e={};if(void 0!==t)for(let n=0,r=t.length;n<r;n++){const r=(new ng).fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let i=0,o=t.length;i<o;i++){const e=(new ip).fromJSON(t[i],r);n[e.uuid]=e}return n}parseGeometries(t,e){const n={};let r;if(void 0!==t){const i=new Cg;for(let o=0,s=t.length;o<s;o++){let s;const a=t[o];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Gd[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":s=new Gd[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Gd[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Gd[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Gd[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Gd[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Gd[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Gd[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Gd[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Gd[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Gd[a.type]((new $f[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Gd[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Gd[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let n=0,i=a.shapes.length;n<i;n++){const t=e[a.shapes[n]];r.push(t)}s=new Gd[a.type](r,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let n=0,i=a.shapes.length;n<i;n++){const t=e[a.shapes[n]];r.push(t)}const t=a.options.extrudePath;void 0!==t&&(a.options.extrudePath=(new $f[t.type]).fromJSON(t)),s=new Gd[a.type](r,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(t,e){const n={},r={};if(void 0!==t){const i=new Mg;i.setTextures(e);for(let e=0,o=t.length;e<o;e++){const o=t[e];if("MultiMaterial"===o.type){const t=[];for(let e=0;e<o.materials.length;e++){const r=o.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),t.push(n[r.uuid])}r[o.uuid]=t}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const r=t[n],i=pf.parse(r);e[i.uuid]=i}return e}parseImages(t,e){const n=this,r={};let i;function o(t){return n.manager.itemStart(t),i.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}function s(t){if("string"===typeof t){const e=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return o(r)}return t.data?{data:Do(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new mf(e);i=new Mf(n),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const n=t[e],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],o=s(e);null!==o&&(o instanceof HTMLImageElement?r[n.uuid].push(o):r[n.uuid].push(new Es(o.data,o.width,o.height)))}}else{const t=s(n.url);null!==t&&(r[n.uuid]=t)}}}return r}parseTextures(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const o=t[i];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=e[o.image];Array.isArray(a)?(s=new ws(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new Es(a.data,a.width,a.height):new zr(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Pg)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Lg),s.wrapT=n(o.wrap[1],Lg)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,Ig)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,Ig)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}parseObject(t,e,n,r){let i,o,s;function a(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function u(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(n[i])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new Th,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new vo(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new Sh(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new Eh(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new vs(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new mg(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new xg(t.color,t.intensity);break;case"DirectionalLight":i=new vg(t.color,t.intensity);break;case"PointLight":i=new gg(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new _g(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new cg(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new ig(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new wg).fromJSON(t);break;case"SkinnedMesh":o=a(t.geometry),s=u(t.material),i=new tp(o,s),void 0!==t.bindMode&&(i.bindMode=t.bindMode),void 0!==t.bindMatrix&&i.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"Mesh":o=a(t.geometry),s=u(t.material),i=new as(o,s);break;case"InstancedMesh":o=a(t.geometry),s=u(t.material);const e=t.count,n=t.instanceMatrix,r=t.instanceColor;i=new lp(o,s,e),i.instanceMatrix=new wo(new Float32Array(n.array),16),void 0!==r&&(i.instanceColor=new wo(new Float32Array(r.array),r.itemSize));break;case"LOD":i=new Xh;break;case"Line":i=new mp(a(t.geometry),u(t.material));break;case"LineLoop":i=new _p(a(t.geometry),u(t.material));break;case"LineSegments":i=new xp(a(t.geometry),u(t.material));break;case"PointCloud":case"Points":i=new Tp(a(t.geometry),u(t.material));break;case"Sprite":i=new jh(u(t.material));break;case"Group":i=new yh;break;case"Bone":i=new ep;break;default:i=new Yi}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)i.add(this.parseObject(o[t],e,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];i.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const Pg={UVMapping:Qt,CubeReflectionMapping:$t,CubeRefractionMapping:te,EquirectangularReflectionMapping:ee,EquirectangularRefractionMapping:ne,CubeUVReflectionMapping:re,CubeUVRefractionMapping:ie},Lg={RepeatWrapping:oe,ClampToEdgeWrapping:se,MirroredRepeatWrapping:ae},Ig={NearestFilter:ue,NearestMipmapNearestFilter:le,NearestMipmapLinearFilter:he,LinearFilter:de,LinearMipmapNearestFilter:fe,LinearMipmapLinearFilter:me};function Rg(t){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),vf.call(this,t),this.options={premultiplyAlpha:"none"}}Rg.prototype=Object.assign(Object.create(vf.prototype),{constructor:Rg,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=gf.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(t,s).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){gf.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}});class Ng{constructor(){this.type="ShapePath",this.color=new vo,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new eg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this}bezierCurveTo(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function n(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],i=new ng;i.curves=r.curves,e.push(i)}return e}function r(t,e){const n=e.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=e[i],s=e[o],a=s.x-n.x,u=s.y-n.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(n=e[o],a=-a,s=e[i],u=-u),t.y<n.y||t.y>s.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=u*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x)return!0}}return r}const i=_d.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);let s,a,u;const l=[];if(1===o.length)return a=o[0],u=new ng,u.curves=a.curves,l.push(u),l;let c=!i(o[0].getPoints());c=t?!c:c;const h=[],p=[];let d,f,g=[],m=0;p[m]=void 0,g[m]=[];for(let y=0,v=o.length;y<v;y++)a=o[y],d=a.getPoints(),s=i(d),s=t?!s:s,s?(!c&&p[m]&&m++,p[m]={s:new ng,p:d},p[m].s.curves=a.curves,c&&m++,g[m]=[]):g[m].push({h:a,p:d[0]});if(!p[0])return n(o);if(p.length>1){let t=!1;const e=[];for(let n=0,r=p.length;n<r;n++)h[n]=[];for(let n=0,i=p.length;n<i;n++){const i=g[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<p.length;i++)r(s.p,p[i].p)&&(n!==i&&e.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):t=!0);a&&h[n].push(s)}}e.length>0&&(t||(g=h))}for(let y=0,v=p.length;y<v;y++){u=p[y].s,l.push(u),f=g[y];for(let t=0,e=f.length;t<e;t++)u.holes.push(f[t].h)}return l}}class Og{constructor(t){this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],r=Dg(t,e,this.data);for(let i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}function Dg(t,e,n){const r=Array.from(t),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,u=0;for(let l=0;l<r.length;l++){const t=r[l];if("\n"===t)a=0,u-=o;else{const e=Fg(t,i,a,u,n);a+=e.offsetX,s.push(e.path)}}return s}function Fg(t,e,n,r,i){const o=i.glyphs[t]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");const s=new Ng;let a,u,l,c,h,p,d,f;if(o.o){const t=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=t.length;i<o;){const o=t[i++];switch(o){case"m":a=t[i++]*e+n,u=t[i++]*e+r,s.moveTo(a,u);break;case"l":a=t[i++]*e+n,u=t[i++]*e+r,s.lineTo(a,u);break;case"q":l=t[i++]*e+n,c=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,s.quadraticCurveTo(h,p,l,c);break;case"b":l=t[i++]*e+n,c=t[i++]*e+r,h=t[i++]*e+n,p=t[i++]*e+r,d=t[i++]*e+n,f=t[i++]*e+r,s.bezierCurveTo(h,p,d,f,l,c);break}}}return{offsetX:o.ha*e,path:s}}Og.prototype.isFont=!0;class kg extends vf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new _f(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){let n;try{n=JSON.parse(t)}catch(o){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}const r=i.parse(n);e&&e(r)}),n,r)}parse(t){return new Og(t)}}let Bg;const zg={getContext:function(){return void 0===Bg&&(Bg=new(window.AudioContext||window.webkitAudioContext)),Bg},setContext:function(t){Bg=t}};class Gg extends vf{constructor(t){super(t)}load(t,e,n,r){const i=this,o=new _f(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{const t=n.slice(0),r=zg.getContext();r.decodeAudioData(t,(function(t){e(t)}))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)}}class Ug extends wg{constructor(t,e,n=1){super(void 0,n);const r=(new vo).set(t),i=(new vo).set(e),o=new Wr(r.r,r.g,r.b),s=new Wr(i.r,i.g,i.b),a=Math.sqrt(Math.PI),u=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(u)}}Ug.prototype.isHemisphereLightProbe=!0;class Vg extends wg{constructor(t,e=1){super(void 0,e);const n=(new vo).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Vg.prototype.isAmbientLightProbe=!0;const Hg=new wi,jg=new wi;class Wg{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new vs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new vs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache,n=e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep;if(n){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,o=e.near*Math.tan(Nr.DEG2RAD*e.fov*.5)/e.zoom;let s,a;jg.elements[12]=-r,Hg.elements[12]=r,s=-o*e.aspect+i,a=o*e.aspect+i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*e.aspect-i,a=o*e.aspect-i,n.elements[0]=2*e.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(jg),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Hg)}}class qg{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Yg(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Yg();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Yg(){return("undefined"===typeof performance?Date:performance).now()}const Xg=new Wr,Zg=new jr,Kg=new Wr,Jg=new Wr;class Qg extends Yi{constructor(){super(),this.type="AudioListener",this.context=zg.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qg}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xg,Zg,Kg),Jg.set(0,0,-1).applyQuaternion(Zg),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Xg.x,t),e.positionY.linearRampToValueAtTime(Xg.y,t),e.positionZ.linearRampToValueAtTime(Xg.z,t),e.forwardX.linearRampToValueAtTime(Jg.x,t),e.forwardY.linearRampToValueAtTime(Jg.y,t),e.forwardZ.linearRampToValueAtTime(Jg.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Xg.x,Xg.y,Xg.z),e.setOrientation(Jg.x,Jg.y,Jg.z,n.x,n.y,n.z)}}class $g extends Yi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const tm=new Wr,em=new jr,nm=new Wr,rm=new Wr;class im extends $g{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(tm,em,nm),rm.set(0,0,1).applyQuaternion(em);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(tm.x,t),e.positionY.linearRampToValueAtTime(tm.y,t),e.positionZ.linearRampToValueAtTime(tm.z,t),e.orientationX.linearRampToValueAtTime(rm.x,t),e.orientationY.linearRampToValueAtTime(rm.y,t),e.orientationZ.linearRampToValueAtTime(rm.z,t)}else e.setPosition(tm.x,tm.y,tm.z),e.setOrientation(rm.x,rm.y,rm.z)}}class om{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class sm{constructor(t,e,n){let r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,r=this.valueSize,i=t*r+r;let o=this.cumulativeWeight;if(0===o){for(let t=0;t!==r;++t)n[i+t]=n[t];o=e}else{o+=e;const t=e/o;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let a=e,u=e+e;a!==u;++a)if(n[a]!==n[a+e]){s.setValue(n,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let i=n,o=r;i!==o;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let o=0;o!==i;++o)t[e+o]=t[n+o]}_slerp(t,e,n,r){jr.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){const o=this._workIndex*i;jr.multiplyQuaternionsFlat(t,o,t,e,t,n),jr.slerpFlat(t,e,t,e,t,o,r)}_lerp(t,e,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=e+s;t[i]=t[i]*o+t[n+s]*r}}_lerpAdditive(t,e,n,r,i){for(let o=0;o!==i;++o){const i=e+o;t[i]=t[i]+t[n+o]*r}}}const am="\\[\\]\\.:\\/",um=new RegExp("["+am+"]","g"),lm="[^"+am+"]",cm="[^"+am.replace("\\.","")+"]",hm=/((?:WC+[\/:])*)/.source.replace("WC",lm),pm=/(WCOD+)?/.source.replace("WCOD",cm),dm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lm),fm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lm),gm=new RegExp("^"+hm+pm+dm+fm+"$"),mm=["material","materials","bones"];function ym(t,e,n){const r=n||vm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function vm(t,e,n){this.path=e,this.parsedPath=n||vm.parseTrackName(e),this.node=vm.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(ym.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(vm,{Composite:ym,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new vm.Composite(t,e,n):new vm(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(um,"")},parseTrackName:function(t){const e=gm.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==mm.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const o=n(i.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(vm.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=vm.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const o=t[r];if(void 0===o){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(vm.prototype,{_getValue_unbound:vm.prototype.getValue,_setValue_unbound:vm.prototype.setValue});class xm{constructor(){this.uuid=Nr.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,r=arguments.length;n!==r;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s=void 0,a=t.length,u=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const c=arguments[l],h=c.uuid;let p=e[h];if(void 0===p){p=a++,e[h]=p,t.push(c);for(let t=0,e=o;t!==e;++t)i[t].push(new vm(c,n[t],r[t]))}else if(p<u){s=t[p];const a=--u,l=t[a];e[l.uuid]=p,t[p]=l,e[h]=a,t[a]=c;for(let t=0,e=o;t!==e;++t){const e=i[t],o=e[a];let s=e[p];e[p]=o,void 0===s&&(s=new vm(c,n[t],r[t])),e[a]=s}}else t[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,u=e[a];if(void 0!==u&&u>=i){const o=i++,l=t[o];e[l.uuid]=u,t[u]=l,e[a]=o,t[o]=s;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[o],i=e[u];e[u]=r,e[o]=i}}}this.nCachedObjects_=i}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=t.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],u=a.uuid,l=e[u];if(void 0!==l)if(delete e[u],l<i){const s=--i,a=t[s],u=--o,c=t[u];e[a.uuid]=l,t[l]=a,e[c.uuid]=s,t[s]=c,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[s],i=e[u];e[l]=r,e[s]=i,e.pop()}}else{const i=--o,s=t[i];i>0&&(e[s.uuid]=l),t[l]=s,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[l]=e[i],e.pop()}}}this.nCachedObjects_=i}subscribe_(t,e){const n=this._bindingsIndicesByPath;let r=n[t];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,u=a.length,l=this.nCachedObjects_,c=new Array(u);r=i.length,n[t]=r,o.push(t),s.push(e),i.push(c);for(let h=l,p=a.length;h!==p;++h){const n=a[h];c[h]=new vm(n,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s],u=t[s];e[u]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}xm.prototype.isAnimationObjectGroup=!0;class _m{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const i=e.tracks,o=i.length,s=new Array(o),a={endingStart:kn,endingEnd:kn};for(let u=0;u!==o;++u){const t=i[u].createInterpolant(null);s[u]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Rn,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,i=r/n,o=n/r;t.warp(1,i,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,u=s.sampleValues;return a[0]=i,a[1]=i+n,u[0]=t/o,u[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);const i=this._startTime;if(null!==i){const r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);const o=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case Un:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(s);break;case Gn:default:for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(o),e[n].accumulate(r,s)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,i=this._loopCount;const o=n===Nn;if(0===t)return-1===i?r:o&&1===(1&i)?e-r:r;if(n===In){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){const n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1===(1&i))return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=Bn,r.endingEnd=Bn):(r.endingStart=t?this.zeroSlopeAtStart?Bn:kn:zn,r.endingEnd=e?this.zeroSlopeAtEnd?Bn:kn:zn)}_scheduleFading(t,e,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=e,s[1]=i+t,a[1]=n,this}}class bm extends Lr{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,s=t._interpolants,a=n.uuid,u=this._bindingsByRootAndName;let l=u[a];void 0===l&&(l={},u[a]=l);for(let c=0;c!==i;++c){const t=r[c],i=t.name;let u=l[i];if(void 0!==u)o[c]=u;else{if(u=o[c],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,i));continue}const r=e&&e._propertyBindings[c].binding.parsedPath;u=new sm(vm.create(n,i,r),t.ValueTypeName,t.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,i),o[c]=u}s[c].resultBuffer=u.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const r=this._actions,i=this._actionsByClip;let o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{const e=o.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const i=t._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,u=a[a.length-1],l=t._byClipCacheIndex;u._byClipCacheIndex=l,a[l]=u,a.pop(),t._byClipCacheIndex=null;const c=s.actionByRoot,h=(t._localRoot||this._root).uuid;delete c[h],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){const t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=e[e.length-1],u=t._cacheIndex;a._cacheIndex=u,e[u]=a,e.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new ef(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){const r=e||this._root,i=r.uuid;let o="string"===typeof t?pf.findByName(r,t):t;const s=null!==o?o.uuid:t,a=this._actionsByClip[s];let u=null;if(void 0===n&&(n=null!==o?o.blendMode:Gn),void 0!==a){const t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;u=a.knownActions[0],null===o&&(o=u._clip)}if(null===o)return null;const l=new _m(this,o,e,n);return this._bindAction(l,u),this._addInactiveAction(l,s,i),l}existingAction(t,e){const n=e||this._root,r=n.uuid,i="string"===typeof t?pf.findByName(n,t):t,o=i?i.uuid:t,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1;for(let u=0;u!==n;++u){const n=e[u];n._update(r,t,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let u=0;u!==a;++u)s[u].apply(o);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){const r=t[n];this._deactivateAction(r);const i=r._cacheIndex,o=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,e[i]=o,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const o in n){const t=n[o].actionByRoot,r=t[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName,i=r[e];if(void 0!==i)for(const o in i){const t=i[o];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}bm.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class wm{constructor(t){"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new wm(void 0===this.value.clone?this.value:this.value.clone())}}function Mm(t,e,n){Ch.call(this,t,e),this.meshPerAttribute=n||1}function Em(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function Sm(t,e,n=0,r=1/0){this.ray=new bi(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new Ni,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Tm(t,e){return t.distance-e.distance}function Cm(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)Cm(r[t],e,n,!0)}}Mm.prototype=Object.assign(Object.create(Ch.prototype),{constructor:Mm,isInstancedInterleavedBuffer:!0,copy:function(t){return Ch.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=Ch.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=Ch.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(Em.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Em.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Sm.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e=!1,n=[]){return Cm(t,this,n,e),n.sort(Tm),n},intersectObjects:function(t,e=!1,n=[]){for(let r=0,i=t.length;r<i;r++)Cm(t[r],this,n,e);return n.sort(Tm),n}});class Am{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Nr.clamp(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Pm{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}}const Lm=new Or;class Im{constructor(t=new Or(1/0,1/0),e=new Or(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Lm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Or),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Or),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Or),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Or),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){const e=Lm.copy(t).clamp(this.min,this.max);return e.sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Im.prototype.isBox2=!0;const Rm=new Wr,Nm=new Wr;class Om{constructor(t=new Wr,e=new Wr){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Wr),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Wr),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Wr),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Rm.subVectors(t,this.start),Nm.subVectors(this.end,this.start);const n=Nm.dot(Nm),r=Nm.dot(Rm);let i=r/n;return e&&(i=Nr.clamp(i,0,1)),i}closestPointToPoint(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Wr),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}function Dm(t){Yi.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Dm.prototype=Object.create(Yi.prototype),Dm.prototype.constructor=Dm,Dm.prototype.isImmediateRenderObject=!0;const Fm=new Wr;class km extends Yi{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Ho,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const t=o/a*Math.PI*2,e=s/a*Math.PI*2;r.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new Io(r,3));const i=new cp({fog:!1,toneMapped:!1});this.cone=new xp(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Fm.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Fm),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Bm=new Wr,zm=new wi,Gm=new wi;class Um extends xp{constructor(t){const e=Vm(t),n=new Ho,r=[],i=[],o=new vo(0,0,1),s=new vo(0,1,0);for(let u=0;u<e.length;u++){const t=e[u];t.parent&&t.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new Io(r,3)),n.setAttribute("color",new Io(i,3));const a=new cp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");Gm.copy(this.root.matrixWorld).invert();for(let i=0,o=0;i<e.length;i++){const t=e[i];t.parent&&t.parent.isBone&&(zm.multiplyMatrices(Gm,t.matrixWorld),Bm.setFromMatrixPosition(zm),r.setXYZ(o,Bm.x,Bm.y,Bm.z),zm.multiplyMatrices(Gm,t.parent.matrixWorld),Bm.setFromMatrixPosition(zm),r.setXYZ(o+1,Bm.x,Bm.y,Bm.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Vm(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Vm(t.children[n]));return e}class Hm extends as{constructor(t,e,n){const r=new Nd(e,4,2),i=new xo({wireframe:!0,fog:!1,toneMapped:!1});super(r,i),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const jm=new Wr,Wm=new vo,qm=new vo;class Ym extends Yi{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Ad(e);r.rotateY(.5*Math.PI),this.material=new xo({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new wo(o,3)),this.add(new as(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Wm.copy(this.light.color),qm.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const r=t<n/2?Wm:qm;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(jm.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Xm extends xp{constructor(t=10,e=10,n=4473924,r=8947848){n=new vo(n),r=new vo(r);const i=e/2,o=t/e,s=t/2,a=[],u=[];for(let h=0,p=0,d=-s;h<=e;h++,d+=o){a.push(-s,0,d,s,0,d),a.push(d,0,-s,d,0,s);const t=h===i?n:r;t.toArray(u,p),p+=3,t.toArray(u,p),p+=3,t.toArray(u,p),p+=3,t.toArray(u,p),p+=3}const l=new Ho;l.setAttribute("position",new Io(a,3)),l.setAttribute("color",new Io(u,3));const c=new cp({vertexColors:!0,toneMapped:!1});super(l,c),this.type="GridHelper"}}class Zm extends xp{constructor(t=10,e=16,n=8,r=64,i=4473924,o=8947848){i=new vo(i),o=new vo(o);const s=[],a=[];for(let c=0;c<=e;c++){const n=c/e*(2*Math.PI),r=Math.sin(n)*t,u=Math.cos(n)*t;s.push(0,0,0),s.push(r,0,u);const l=1&c?i:o;a.push(l.r,l.g,l.b),a.push(l.r,l.g,l.b)}for(let c=0;c<=n;c++){const e=1&c?i:o,u=t-t/n*c;for(let t=0;t<r;t++){let n=t/r*(2*Math.PI),i=Math.sin(n)*u,o=Math.cos(n)*u;s.push(i,0,o),a.push(e.r,e.g,e.b),n=(t+1)/r*(2*Math.PI),i=Math.sin(n)*u,o=Math.cos(n)*u,s.push(i,0,o),a.push(e.r,e.g,e.b)}}const u=new Ho;u.setAttribute("position",new Io(s,3)),u.setAttribute("color",new Io(a,3));const l=new cp({vertexColors:!0,toneMapped:!1});super(u,l),this.type="PolarGridHelper"}}const Km=new Wr,Jm=new Wr,Qm=new Wr;class $m extends Yi{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new Ho;r.setAttribute("position",new Io([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const i=new cp({fog:!1,toneMapped:!1});this.lightPlane=new mp(r,i),this.add(this.lightPlane),r=new Ho,r.setAttribute("position",new Io([0,0,0,0,0,1],3)),this.targetLine=new mp(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Km.setFromMatrixPosition(this.light.matrixWorld),Jm.setFromMatrixPosition(this.light.target.matrixWorld),Qm.subVectors(Jm,Km),this.lightPlane.lookAt(Jm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Jm),this.targetLine.scale.z=Qm.length()}}const ty=new Wr,ey=new ys;class ny extends xp{constructor(t){const e=new Ho,n=new cp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new vo(16755200),a=new vo(16711680),u=new vo(43775),l=new vo(16777215),c=new vo(3355443);function h(t,e,n){p(t,n),p(e,n)}function p(t,e){r.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(r.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",u),h("u2","u3",u),h("u3","u1",u),h("c","t",l),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.setAttribute("position",new Io(r,3)),e.setAttribute("color",new Io(i,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const t=this.geometry,e=this.pointMap,n=1,r=1;ey.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ry("c",e,t,ey,0,0,-1),ry("t",e,t,ey,0,0,1),ry("n1",e,t,ey,-n,-r,-1),ry("n2",e,t,ey,n,-r,-1),ry("n3",e,t,ey,-n,r,-1),ry("n4",e,t,ey,n,r,-1),ry("f1",e,t,ey,-n,-r,1),ry("f2",e,t,ey,n,-r,1),ry("f3",e,t,ey,-n,r,1),ry("f4",e,t,ey,n,r,1),ry("u1",e,t,ey,.7*n,1.1*r,-1),ry("u2",e,t,ey,.7*-n,1.1*r,-1),ry("u3",e,t,ey,0,2*r,-1),ry("cf1",e,t,ey,-n,0,1),ry("cf2",e,t,ey,n,0,1),ry("cf3",e,t,ey,0,-r,1),ry("cf4",e,t,ey,0,r,1),ry("cn1",e,t,ey,-n,0,-1),ry("cn2",e,t,ey,n,0,-1),ry("cn3",e,t,ey,0,-r,-1),ry("cn4",e,t,ey,0,r,-1),t.getAttribute("position").needsUpdate=!0}}function ry(t,e,n,r,i,o,s){ty.set(i,o,s).unproject(r);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],ty.x,ty.y,ty.z)}}const iy=new Xr;class oy extends xp{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Ho;i.setIndex(new wo(n,1)),i.setAttribute("position",new wo(r,3)),super(i,new cp({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&iy.setFromObject(this.object),iy.isEmpty())return;const e=iy.min,n=iy.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return xp.prototype.copy.call(this,t),this.object=t.object,this}}class sy extends xp{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],i=new Ho;i.setIndex(new wo(n,1)),i.setAttribute("position",new Io(r,3)),super(i,new cp({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class ay extends mp{constructor(t,e=1,n=16776960){const r=n,i=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new Ho;o.setAttribute("position",new Io(i,3)),o.computeBoundingSphere(),super(o,new cp({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new Ho;a.setAttribute("position",new Io(s,3)),a.computeBoundingSphere(),this.add(new as(a,new xo({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?lt:ut,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const uy=new Wr;let ly,cy;class hy extends Yi{constructor(t=new Wr(0,0,1),e=new Wr(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type="ArrowHelper",void 0===ly&&(ly=new Ho,ly.setAttribute("position",new Io([0,0,0,0,1,0],3)),cy=new Np(0,.5,1,5,1),cy.translate(0,-.5,0)),this.position.copy(e),this.line=new mp(ly,new cp({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new as(cy,new xo({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{uy.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(uy,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class py extends xp{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Ho;r.setAttribute("position",new Io(e,3)),r.setAttribute("color",new Io(n,3));const i=new cp({vertexColors:!0,toneMapped:!1});super(r,i),this.type="AxesHelper"}}const dy=new Float32Array(1),fy=new Int32Array(dy.buffer),gy={toHalfFloat:function(t){dy[0]=t;const e=fy[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},my=4,yy=8,vy=Math.pow(2,yy),xy=[.125,.215,.35,.446,.526,.582],_y=yy-my+1+xy.length,by=20,wy={[Wn]:0,[qn]:1,[Xn]:2,[Kn]:3,[Jn]:4,[Qn]:5,[Yn]:6},My=new xo({side:lt,depthWrite:!1,depthTest:!1}),Ey=new as(new cs,My),Sy=new mg,{_lodPlanes:Ty,_sizeLods:Cy,_sigmas:Ay}=ky(),Py=new vo;let Ly=null;const Iy=(1+Math.sqrt(5))/2,Ry=1/Iy,Ny=[new Wr(1,1,1),new Wr(-1,1,1),new Wr(1,1,-1),new Wr(-1,1,-1),new Wr(0,Iy,Ry),new Wr(0,Iy,-Ry),new Wr(Ry,0,Iy),new Wr(-Ry,0,Iy),new Wr(Iy,Ry,0),new Wr(-Iy,Ry,0)];function Oy(t){const e=Math.max(t.r,t.g,t.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);t.multiplyScalar(Math.pow(2,-n));const r=(n+128)/255;return r}class Dy{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=Gy(by),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){Ly=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Vy(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Uy(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Ty.length;t++)Ty[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ly),t.scissorTest=!1,zy(t,0,0,t.width,t.height)}_fromTexture(t){Ly=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:ue,minFilter:ue,generateMipmaps:!1,type:ve,format:De,encoding:Fy(t)?t.encoding:Xn,depthBuffer:!1},n=By(e);return n.depthBuffer=!t,this._pingPongRenderTarget=By(e),n}_compileMaterial(t){const e=new as(Ty[0],t);this._renderer.compile(e,Sy)}_sceneToCubeUV(t,e,n,r){const i=90,o=1,s=new vs(i,o,e,n),a=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.outputEncoding,p=l.toneMapping;l.getClearColor(Py),l.toneMapping=qt,l.outputEncoding=Wn,l.autoClear=!1;let d=!1;const f=t.background;if(f){if(f.isColor){My.color.copy(f).convertSRGBToLinear(),t.background=null;const e=Oy(My.color);My.opacity=e,d=!0}}else{My.color.copy(Py).convertSRGBToLinear();const t=Oy(My.color);My.opacity=t,d=!0}for(let g=0;g<6;g++){const e=g%3;0==e?(s.up.set(0,a[g],0),s.lookAt(u[g],0,0)):1==e?(s.up.set(0,0,a[g]),s.lookAt(0,u[g],0)):(s.up.set(0,a[g],0),s.lookAt(0,0,u[g])),zy(r,e*vy,g>2?vy:0,vy,vy),l.setRenderTarget(r),d&&l.render(Ey,s),l.render(t,s)}l.toneMapping=p,l.outputEncoding=h,l.autoClear=c}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Vy()):null==this._equirectShader&&(this._equirectShader=Uy());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new as(Ty[0],r),o=r.uniforms;o["envMap"].value=t,t.isCubeTexture||o["texelSize"].value.set(1/t.image.width,1/t.image.height),o["inputEncoding"].value=wy[t.encoding],o["outputEncoding"].value=wy[e.texture.encoding],zy(e,0,0,3*vy,2*vy),n.setRenderTarget(e),n.render(i,Sy)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let r=1;r<_y;r++){const e=Math.sqrt(Ay[r]*Ay[r]-Ay[r-1]*Ay[r-1]),n=Ny[(r-1)%Ny.length];this._blur(t,r-1,r,e,n)}e.autoClear=n}_blur(t,e,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,o,s){const a=this._renderer,u=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=3,c=new as(Ty[r],u),h=u.uniforms,p=Cy[n]-1,d=isFinite(i)?Math.PI/(2*p):2*Math.PI/(2*by-1),f=i/d,g=isFinite(i)?1+Math.floor(l*f):by;g>by&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${by}`);const m=[];let y=0;for(let b=0;b<by;++b){const t=b/f,e=Math.exp(-t*t/2);m.push(e),0==b?y+=e:b<g&&(y+=2*e)}for(let b=0;b<m.length;b++)m[b]=m[b]/y;h["envMap"].value=t.texture,h["samples"].value=g,h["weights"].value=m,h["latitudinal"].value="latitudinal"===o,s&&(h["poleAxis"].value=s),h["dTheta"].value=d,h["mipInt"].value=yy-n,h["inputEncoding"].value=wy[t.texture.encoding],h["outputEncoding"].value=wy[t.texture.encoding];const v=Cy[r],x=3*Math.max(0,vy-2*v),_=(0===r?0:2*vy)+2*v*(r>yy-my?r-yy+my:0);zy(e,x,_,3*v,2*v),a.setRenderTarget(e),a.render(c,Sy)}}function Fy(t){return void 0!==t&&t.type===ve&&(t.encoding===Wn||t.encoding===qn||t.encoding===Yn)}function ky(){const t=[],e=[],n=[];let r=yy;for(let i=0;i<_y;i++){const o=Math.pow(2,r);e.push(o);let s=1/o;i>yy-my?s=xy[i-yy+my-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),u=-a/2,l=1+a/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],h=6,p=6,d=3,f=2,g=1,m=new Float32Array(d*p*h),y=new Float32Array(f*p*h),v=new Float32Array(g*p*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];m.set(r,d*p*t),y.set(c,f*p*t);const i=[t,t,t,t,t,t];v.set(i,g*p*t)}const x=new Ho;x.setAttribute("position",new wo(m,d)),x.setAttribute("uv",new wo(y,f)),x.setAttribute("faceIndex",new wo(v,g)),t.push(x),r>my&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function By(t){const e=new Vr(3*vy,3*vy,t);return e.texture.mapping=re,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function zy(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Gy(t){const e=new Float32Array(t),n=new Wr(0,1,0),r=new Vd({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:wy[Wn]},outputEncoding:{value:wy[Wn]}},vertexShader:Hy(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${jy()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:dt,depthTest:!1,depthWrite:!1});return r}function Uy(){const t=new Or(1,1),e=new Vd({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:wy[Wn]},outputEncoding:{value:wy[Wn]}},vertexShader:Hy(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${jy()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:dt,depthTest:!1,depthWrite:!1});return e}function Vy(){const t=new Vd({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:wy[Wn]},outputEncoding:{value:wy[Wn]}},vertexShader:Hy(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${jy()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:dt,depthTest:!1,depthWrite:!1});return t}function Hy(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function jy(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const Wy=0,qy=1,Yy=0,Xy=1,Zy=2;function Ky(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Jy(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Qy(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Tp(t,e)}function $y(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new jh(t)}function tv(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Tp(t,e)}function ev(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new bp(t)}function nv(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new bp(t)}function rv(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new bp(t)}function iv(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Wr(t,e,n)}function ov(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new wo(t,e).setUsage(_r)}function sv(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Mo(t,e)}function av(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Eo(t,e)}function uv(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new So(t,e)}function lv(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new To(t,e)}function cv(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Co(t,e)}function hv(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ao(t,e)}function pv(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Po(t,e)}function dv(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Io(t,e)}function fv(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ro(t,e)}function gv(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new py(t)}function mv(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new oy(t,e)}function yv(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new xp(new Up(t.geometry),new cp({color:void 0!==e?e:16777215}))}function vv(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new xp(new zd(t.geometry),new cp({color:void 0!==e?e:16777215}))}function xv(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new _f(t)}function _v(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Sf(t)}function bv(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ms(t,n)}function wv(){console.error("THREE.CanvasRenderer has been removed")}function Mv(){console.error("THREE.JSONLoader has been removed.")}Cf.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Cf.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},eg.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Xm.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Um.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},vf.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Eg.extractUrlBase(t)},vf.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Im.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Im.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Im.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Im.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Xr.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Xr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Xr.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Xr.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Xr.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},di.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Cs.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Om.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Nr.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},Nr.nearestPowerOfTwo=function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Nr.floorPowerOfTwo(t)},Nr.nextPowerOfTwo=function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Nr.ceilPowerOfTwo(t)},Dr.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Dr.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Dr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Dr.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Dr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Dr.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},wi.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},wi.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},wi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Wr).setFromMatrixColumn(this,3)},wi.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},wi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},wi.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},wi.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},wi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},wi.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},wi.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},wi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},wi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},wi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},wi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},wi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},wi.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},wi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},wi.prototype.makeFrustum=function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)},wi.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ji.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},jr.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},jr.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},bi.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},bi.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},bi.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},uo.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},uo.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},uo.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},uo.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},uo.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},uo.barycoordFromPoint=function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),uo.getBarycoord(t,e,n,r,i)},uo.normal=function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),uo.getNormal(t,e,n,r)},ng.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},ng.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Md(this,t)},ng.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Id(this,t)},Or.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Or.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Or.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Wr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Wr.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Wr.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Wr.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Wr.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Wr.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Wr.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Wr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ur.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ur.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Yi.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Yi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Yi.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Yi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Yi.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Yi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),as.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(as.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Vn},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),tp.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Cf.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),vs.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(rg.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(wo.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===_r},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(_r)}}}),wo.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?_r:xr),this},wo.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},wo.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ho.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Ho.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new wo(arguments[1],arguments[2])))},Ho.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Ho.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Ho.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Ho.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Ho.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Ho.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Sg.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Sm.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ch.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===_r},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Ch.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?_r:xr),this},Ch.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Md.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Md.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Md.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Th.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},wm.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(co.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new vo}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===ht}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(jd.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(ms.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),wh.prototype.clearTarget=function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},wh.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},wh.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},wh.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},wh.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},wh.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},wh.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},wh.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},wh.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},wh.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},wh.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},wh.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},wh.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},wh.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},wh.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},wh.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},wh.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},wh.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},wh.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},wh.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},wh.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},wh.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},wh.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},wh.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},wh.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(wh.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?qn:Wn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(ph.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Vr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),$g.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this,n=new Gg;return n.load(t,(function(t){e.setBuffer(t)})),this},om.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},bs.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},bs.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)},kr.crossOrigin=void 0,kr.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Tf;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},kr.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Ef;i.setCrossOrigin(this.crossOrigin);const o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},kr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},kr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Ev={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Sv(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:J}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=J);n("78a2");var Tv=1e-6,Cv="undefined"!==typeof Float32Array?Float32Array:Array,Av=Math.random;Math.PI;function Pv(){var t=new Cv(16);return Cv!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Lv(t){var e=new Cv(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Rv(t,e,n,r,i,o,s,a,u,l,c,h,p,d,f,g){var m=new Cv(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=s,m[7]=a,m[8]=u,m[9]=l,m[10]=c,m[11]=h,m[12]=p,m[13]=d,m[14]=f,m[15]=g,m}function Nv(t,e,n,r,i,o,s,a,u,l,c,h,p,d,f,g,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=p,t[12]=d,t[13]=f,t[14]=g,t[15]=m,t}function Ov(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dv(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fv(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],g=e[13],m=e[14],y=e[15],v=n*a-r*s,x=n*u-i*s,_=n*l-o*s,b=r*u-i*a,w=r*l-o*a,M=i*l-o*u,E=c*g-h*f,S=c*m-p*f,T=c*y-d*f,C=h*m-p*g,A=h*y-d*g,P=p*y-d*m,L=v*P-x*A+_*C+b*T-w*S+M*E;return L?(L=1/L,t[0]=(a*P-u*A+l*C)*L,t[1]=(i*A-r*P-o*C)*L,t[2]=(g*M-m*w+y*b)*L,t[3]=(p*w-h*M-d*b)*L,t[4]=(u*T-s*P-l*S)*L,t[5]=(n*P-i*T+o*S)*L,t[6]=(m*_-f*M-y*x)*L,t[7]=(c*M-p*_+d*x)*L,t[8]=(s*A-a*T+l*E)*L,t[9]=(r*T-n*A-o*E)*L,t[10]=(f*w-g*_+y*v)*L,t[11]=(h*_-c*w-d*v)*L,t[12]=(a*S-s*C-u*E)*L,t[13]=(n*C-r*S+i*E)*L,t[14]=(g*x-f*b-m*v)*L,t[15]=(c*b-h*x+p*v)*L,t):null}function kv(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],g=e[13],m=e[14],y=e[15];return t[0]=a*(p*y-d*m)-h*(u*y-l*m)+g*(u*d-l*p),t[1]=-(r*(p*y-d*m)-h*(i*y-o*m)+g*(i*d-o*p)),t[2]=r*(u*y-l*m)-a*(i*y-o*m)+g*(i*l-o*u),t[3]=-(r*(u*d-l*p)-a*(i*d-o*p)+h*(i*l-o*u)),t[4]=-(s*(p*y-d*m)-c*(u*y-l*m)+f*(u*d-l*p)),t[5]=n*(p*y-d*m)-c*(i*y-o*m)+f*(i*d-o*p),t[6]=-(n*(u*y-l*m)-s*(i*y-o*m)+f*(i*l-o*u)),t[7]=n*(u*d-l*p)-s*(i*d-o*p)+c*(i*l-o*u),t[8]=s*(h*y-d*g)-c*(a*y-l*g)+f*(a*d-l*h),t[9]=-(n*(h*y-d*g)-c*(r*y-o*g)+f*(r*d-o*h)),t[10]=n*(a*y-l*g)-s*(r*y-o*g)+f*(r*l-o*a),t[11]=-(n*(a*d-l*h)-s*(r*d-o*h)+c*(r*l-o*a)),t[12]=-(s*(h*m-p*g)-c*(a*m-u*g)+f*(a*p-u*h)),t[13]=n*(h*m-p*g)-c*(r*m-i*g)+f*(r*p-i*h),t[14]=-(n*(a*m-u*g)-s*(r*m-i*g)+f*(r*u-i*a)),t[15]=n*(a*p-u*h)-s*(r*p-i*h)+c*(r*u-i*a),t}function Bv(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],f=t[13],g=t[14],m=t[15],y=e*s-n*o,v=e*a-r*o,x=e*u-i*o,_=n*a-r*s,b=n*u-i*s,w=r*u-i*a,M=l*f-c*d,E=l*g-h*d,S=l*m-p*d,T=c*g-h*f,C=c*m-p*f,A=h*m-p*g;return y*A-v*C+x*T+_*S-b*E+w*M}function zv(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],g=e[12],m=e[13],y=e[14],v=e[15],x=n[0],_=n[1],b=n[2],w=n[3];return t[0]=x*r+_*a+b*h+w*g,t[1]=x*i+_*u+b*p+w*m,t[2]=x*o+_*l+b*d+w*y,t[3]=x*s+_*c+b*f+w*v,x=n[4],_=n[5],b=n[6],w=n[7],t[4]=x*r+_*a+b*h+w*g,t[5]=x*i+_*u+b*p+w*m,t[6]=x*o+_*l+b*d+w*y,t[7]=x*s+_*c+b*f+w*v,x=n[8],_=n[9],b=n[10],w=n[11],t[8]=x*r+_*a+b*h+w*g,t[9]=x*i+_*u+b*p+w*m,t[10]=x*o+_*l+b*d+w*y,t[11]=x*s+_*c+b*f+w*v,x=n[12],_=n[13],b=n[14],w=n[15],t[12]=x*r+_*a+b*h+w*g,t[13]=x*i+_*u+b*p+w*m,t[14]=x*o+_*l+b*d+w*y,t[15]=x*s+_*c+b*f+w*v,t}function Gv(t,e,n){var r,i,o,s,a,u,l,c,h,p,d,f,g=n[0],m=n[1],y=n[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*y+e[12],t[13]=e[1]*g+e[5]*m+e[9]*y+e[13],t[14]=e[2]*g+e[6]*m+e[10]*y+e[14],t[15]=e[3]*g+e[7]*m+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*g+a*m+h*y+e[12],t[13]=i*g+u*m+p*y+e[13],t[14]=o*g+l*m+d*y+e[14],t[15]=s*g+c*m+f*y+e[15]),t}function Uv(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Vv(t,e,n,r){var i,o,s,a,u,l,c,h,p,d,f,g,m,y,v,x,_,b,w,M,E,S,T,C,A=r[0],P=r[1],L=r[2],I=Math.hypot(A,P,L);return I<Tv?null:(I=1/I,A*=I,P*=I,L*=I,i=Math.sin(n),o=Math.cos(n),s=1-o,a=e[0],u=e[1],l=e[2],c=e[3],h=e[4],p=e[5],d=e[6],f=e[7],g=e[8],m=e[9],y=e[10],v=e[11],x=A*A*s+o,_=P*A*s+L*i,b=L*A*s-P*i,w=A*P*s-L*i,M=P*P*s+o,E=L*P*s+A*i,S=A*L*s+P*i,T=P*L*s-A*i,C=L*L*s+o,t[0]=a*x+h*_+g*b,t[1]=u*x+p*_+m*b,t[2]=l*x+d*_+y*b,t[3]=c*x+f*_+v*b,t[4]=a*w+h*M+g*E,t[5]=u*w+p*M+m*E,t[6]=l*w+d*M+y*E,t[7]=c*w+f*M+v*E,t[8]=a*S+h*T+g*C,t[9]=u*S+p*T+m*C,t[10]=l*S+d*T+y*C,t[11]=c*S+f*T+v*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Hv(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],s=e[5],a=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=s*i+c*r,t[6]=a*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-s*r,t[10]=h*i-a*r,t[11]=p*i-u*r,t}function jv(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=s*i-c*r,t[2]=a*i-h*r,t[3]=u*i-p*r,t[8]=o*r+l*i,t[9]=s*r+c*i,t[10]=a*r+h*i,t[11]=u*r+p*i,t}function Wv(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=s*i+c*r,t[2]=a*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-s*r,t[6]=h*i-a*r,t[7]=p*i-u*r,t}function qv(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Yv(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xv(t,e,n){var r,i,o,s=n[0],a=n[1],u=n[2],l=Math.hypot(s,a,u);return l<Tv?null:(l=1/l,s*=l,a*=l,u*=l,r=Math.sin(e),i=Math.cos(e),o=1-i,t[0]=s*s*o+i,t[1]=a*s*o+u*r,t[2]=u*s*o-a*r,t[3]=0,t[4]=s*a*o-u*r,t[5]=a*a*o+i,t[6]=u*a*o+s*r,t[7]=0,t[8]=s*u*o+a*r,t[9]=a*u*o-s*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Zv(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kv(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jv(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qv(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,u=i+i,l=o+o,c=r*a,h=r*u,p=r*l,d=i*u,f=i*l,g=o*l,m=s*a,y=s*u,v=s*l;return t[0]=1-(d+g),t[1]=h+v,t[2]=p-y,t[3]=0,t[4]=h-v,t[5]=1-(c+g),t[6]=f+m,t[7]=0,t[8]=p+y,t[9]=f-m,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function $v(t,e){var n=new Cv(3),r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=r*r+i*i+o*o+s*s;return h>0?(n[0]=2*(a*s+c*r+u*o-l*i)/h,n[1]=2*(u*s+c*i+l*r-a*o)/h,n[2]=2*(l*s+c*o+a*i-u*r)/h):(n[0]=2*(a*s+c*r+u*o-l*i),n[1]=2*(u*s+c*i+l*r-a*o),n[2]=2*(l*s+c*o+a*i-u*r)),Qv(t,e,n),t}function tx(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ex(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],s=e[5],a=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,s,a),t[2]=Math.hypot(u,l,c),t}function nx(t,e){var n=new Cv(3);ex(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],s=e[0]*r,a=e[1]*i,u=e[2]*o,l=e[4]*r,c=e[5]*i,h=e[6]*o,p=e[8]*r,d=e[9]*i,f=e[10]*o,g=s+c+f,m=0;return g>0?(m=2*Math.sqrt(g+1),t[3]=.25*m,t[0]=(h-d)/m,t[1]=(p-u)/m,t[2]=(a-l)/m):s>c&&s>f?(m=2*Math.sqrt(1+s-c-f),t[3]=(h-d)/m,t[0]=.25*m,t[1]=(a+l)/m,t[2]=(p+u)/m):c>f?(m=2*Math.sqrt(1+c-s-f),t[3]=(p-u)/m,t[0]=(a+l)/m,t[1]=.25*m,t[2]=(h+d)/m):(m=2*Math.sqrt(1+f-s-c),t[3]=(a-l)/m,t[0]=(p+u)/m,t[1]=(h+d)/m,t[2]=.25*m),t}function rx(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3],u=i+i,l=o+o,c=s+s,h=i*u,p=i*l,d=i*c,f=o*l,g=o*c,m=s*c,y=a*u,v=a*l,x=a*c,_=r[0],b=r[1],w=r[2];return t[0]=(1-(f+m))*_,t[1]=(p+x)*_,t[2]=(d-v)*_,t[3]=0,t[4]=(p-x)*b,t[5]=(1-(h+m))*b,t[6]=(g+y)*b,t[7]=0,t[8]=(d+v)*w,t[9]=(g-y)*w,t[10]=(1-(h+f))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ix(t,e,n,r,i){var o=e[0],s=e[1],a=e[2],u=e[3],l=o+o,c=s+s,h=a+a,p=o*l,d=o*c,f=o*h,g=s*c,m=s*h,y=a*h,v=u*l,x=u*c,_=u*h,b=r[0],w=r[1],M=r[2],E=i[0],S=i[1],T=i[2],C=(1-(g+y))*b,A=(d+_)*b,P=(f-x)*b,L=(d-_)*w,I=(1-(p+y))*w,R=(m+v)*w,N=(f+x)*M,O=(m-v)*M,D=(1-(p+g))*M;return t[0]=C,t[1]=A,t[2]=P,t[3]=0,t[4]=L,t[5]=I,t[6]=R,t[7]=0,t[8]=N,t[9]=O,t[10]=D,t[11]=0,t[12]=n[0]+E-(C*E+L*S+N*T),t[13]=n[1]+S-(A*E+I*S+O*T),t[14]=n[2]+T-(P*E+R*S+D*T),t[15]=1,t}function ox(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,u=i+i,l=n*s,c=r*s,h=r*a,p=i*s,d=i*a,f=i*u,g=o*s,m=o*a,y=o*u;return t[0]=1-h-f,t[1]=c+y,t[2]=p-m,t[3]=0,t[4]=c-y,t[5]=1-l-f,t[6]=d+g,t[7]=0,t[8]=p+m,t[9]=d-g,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sx(t,e,n,r,i,o,s){var a=1/(n-e),u=1/(i-r),l=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(s+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*l,t[15]=0,t}function ax(t,e,n,r,i){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}Math.hypot||(Math.hypot=function(){var t=0,e=arguments.length;while(e--)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ux=ax;function lx(t,e,n,r,i){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function cx(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+a),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(s-a)*u*.5,t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function hx(t,e,n,r,i,o,s){var a=1/(e-n),u=1/(r-i),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(s+o)*l,t[15]=1,t}var px=hx;function dx(t,e,n,r,i,o,s){var a=1/(e-n),u=1/(r-i),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=o*l,t[15]=1,t}function fx(t,e,n,r){var i,o,s,a,u,l,c,h,p,d,f=e[0],g=e[1],m=e[2],y=r[0],v=r[1],x=r[2],_=n[0],b=n[1],w=n[2];return Math.abs(f-_)<Tv&&Math.abs(g-b)<Tv&&Math.abs(m-w)<Tv?Ov(t):(c=f-_,h=g-b,p=m-w,d=1/Math.hypot(c,h,p),c*=d,h*=d,p*=d,i=v*p-x*h,o=x*c-y*p,s=y*h-v*c,d=Math.hypot(i,o,s),d?(d=1/d,i*=d,o*=d,s*=d):(i=0,o=0,s=0),a=h*s-p*o,u=p*i-c*s,l=c*o-h*i,d=Math.hypot(a,u,l),d?(d=1/d,a*=d,u*=d,l*=d):(a=0,u=0,l=0),t[0]=i,t[1]=a,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=h,t[7]=0,t[8]=s,t[9]=l,t[10]=p,t[11]=0,t[12]=-(i*f+o*g+s*m),t[13]=-(a*f+u*g+l*m),t[14]=-(c*f+h*g+p*m),t[15]=1,t)}function gx(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],p=s-n[2],d=c*c+h*h+p*p;d>0&&(d=1/Math.sqrt(d),c*=d,h*=d,p*=d);var f=u*p-l*h,g=l*c-a*p,m=a*h-u*c;return d=f*f+g*g+m*m,d>0&&(d=1/Math.sqrt(d),f*=d,g*=d,m*=d),t[0]=f,t[1]=g,t[2]=m,t[3]=0,t[4]=h*m-p*g,t[5]=p*f-c*m,t[6]=c*g-h*f,t[7]=0,t[8]=c,t[9]=h,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=s,t[15]=1,t}function mx(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function yx(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function vx(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function xx(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function _x(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function bx(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function wx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Mx(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],f=t[12],g=t[13],m=t[14],y=t[15],v=e[0],x=e[1],_=e[2],b=e[3],w=e[4],M=e[5],E=e[6],S=e[7],T=e[8],C=e[9],A=e[10],P=e[11],L=e[12],I=e[13],R=e[14],N=e[15];return Math.abs(n-v)<=Tv*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-x)<=Tv*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-_)<=Tv*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-b)<=Tv*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Tv*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-M)<=Tv*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(u-E)<=Tv*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-S)<=Tv*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=Tv*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-C)<=Tv*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-A)<=Tv*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(d-P)<=Tv*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-L)<=Tv*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(g-I)<=Tv*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(m-R)<=Tv*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-N)<=Tv*Math.max(1,Math.abs(y),Math.abs(N))}var Ex=zv,Sx=xx;function Tx(){var t=new Cv(2);return Cv!=Float32Array&&(t[0]=0,t[1]=0),t}function Cx(t){var e=new Cv(2);return e[0]=t[0],e[1]=t[1],e}function Ax(t,e){var n=new Cv(2);return n[0]=t,n[1]=e,n}function Px(t,e){return t[0]=e[0],t[1]=e[1],t}function Lx(t,e,n){return t[0]=e,t[1]=n,t}function Ix(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Rx(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Nx(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Ox(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Dx(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Fx(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function kx(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Bx(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function zx(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Gx(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Ux(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function Vx(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Hx(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function jx(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Wx(t){var e=t[0],n=t[1];return e*e+n*n}function qx(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Yx(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Xx(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Zx(t,e){return t[0]*e[0]+t[1]*e[1]}function Kx(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Jx(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function Qx(t,e){e=e||1;var n=2*Av()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function $x(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function t_(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function e_(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function n_(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function r_(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],s=Math.sin(r),a=Math.cos(r);return t[0]=i*a-o*s+n[0],t[1]=i*s+o*a+n[1],t}function i_(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),a=s&&(n*i+r*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function o_(t){return t[0]=0,t[1]=0,t}function s_(t){return"vec2("+t[0]+", "+t[1]+")"}function a_(t,e){return t[0]===e[0]&&t[1]===e[1]}function u_(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=Tv*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=Tv*Math.max(1,Math.abs(r),Math.abs(o))}var l_=jx,c_=Rx,h_=Nx,p_=Ox,d_=Vx,f_=Hx,g_=Wx,m_=function(){var t=Tx();return function(e,n,r,i,o,s){var a,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}();function y_(){var t=new Cv(3);return Cv!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v_(t){var e=new Cv(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function x_(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function __(t,e,n){var r=new Cv(3);return r[0]=t,r[1]=e,r[2]=n,r}function b_(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function w_(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function M_(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function E_(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function S_(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function T_(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function C_(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function A_(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function P_(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function L_(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function I_(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function R_(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function N_(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function O_(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function D_(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function F_(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function k_(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function B_(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function z_(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function G_(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function U_(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2];return t[0]=i*u-o*a,t[1]=o*s-r*u,t[2]=r*a-i*s,t}function V_(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t}function H_(t,e,n,r,i,o){var s=o*o,a=s*(2*o-3)+1,u=s*(o-2)+o,l=s*(o-1),c=s*(3-2*o);return t[0]=e[0]*a+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*a+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*a+n[2]*u+r[2]*l+i[2]*c,t}function j_(t,e,n,r,i,o){var s=1-o,a=s*s,u=o*o,l=a*s,c=3*o*a,h=3*u*s,p=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*p,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*p,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*p,t}function W_(t,e){e=e||1;var n=2*Av()*Math.PI,r=2*Av()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function q_(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}function Y_(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function X_(t,e,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=e[0],u=e[1],l=e[2],c=i*l-o*u,h=o*a-r*l,p=r*u-i*a,d=i*p-o*h,f=o*c-r*p,g=r*h-i*c,m=2*s;return c*=m,h*=m,p*=m,d*=2,f*=2,g*=2,t[0]=a+c+d,t[1]=u+h+f,t[2]=l+p+g,t}function Z_(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function K_(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function J_(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Q_(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2],u=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(o*o+s*s+a*a),c=u*l,h=c&&G_(t,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}function $_(t){return t[0]=0,t[1]=0,t[2]=0,t}function tb(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function eb(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function nb(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(n-o)<=Tv*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=Tv*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=Tv*Math.max(1,Math.abs(i),Math.abs(a))}var rb=E_,ib=S_,ob=T_,sb=O_,ab=D_,ub=x_,lb=F_,cb=function(){var t=y_();return function(e,n,r,i,o,s){var a,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}();function hb(){var t=new Cv(4);return Cv!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function pb(t){var e=new Cv(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function db(t,e,n,r){var i=new Cv(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function fb(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function gb(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function mb(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function yb(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function vb(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function xb(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function _b(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function bb(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function wb(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Mb(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function Eb(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Sb(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Tb(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function Cb(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function Ab(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function Pb(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Lb(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Ib(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Rb(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Nb(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=o*s,t}function Ob(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Db(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],s=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],l=n[2]*r[3]-n[3]*r[2],c=e[0],h=e[1],p=e[2],d=e[3];return t[0]=h*l-p*u+d*a,t[1]=-c*l+p*s-d*o,t[2]=c*u-h*s+d*i,t[3]=-c*a+h*o-p*i,t}function Fb(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t[3]=a+r*(n[3]-a),t}function kb(t,e){var n,r,i,o,s,a;e=e||1;do{n=2*Av()-1,r=2*Av()-1,s=n*n+r*r}while(s>=1);do{i=2*Av()-1,o=2*Av()-1,a=i*i+o*o}while(a>=1);var u=Math.sqrt((1-s)/a);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t}function Bb(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,t}function zb(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2],l=n[3],c=l*r+a*o-u*i,h=l*i+u*r-s*o,p=l*o+s*i-a*r,d=-s*r-a*i-u*o;return t[0]=c*l+d*-s+h*-u-p*-a,t[1]=h*l+d*-a+p*-s-c*-u,t[2]=p*l+d*-u+c*-a-h*-s,t[3]=e[3],t}function Gb(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Ub(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Vb(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Hb(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],u=e[2],l=e[3];return Math.abs(n-s)<=Tv*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=Tv*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=Tv*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=Tv*Math.max(1,Math.abs(o),Math.abs(l))}var jb,Wb=yb,qb=vb,Yb=xb,Xb=Cb,Zb=Ab,Kb=Pb,Jb=Lb,Qb=function(){var t=hb();return function(e,n,r,i,o,s){var a,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),$b=(n("1780"),n("441e"),n("b4ad"),n("5664")),tw=n.n($b),ew=n("dc17"),nw=n.n(ew);class rw{static RingPolygonArea(t,e){const n=t.length;let r=0;const i=e||!1;function o(t){return Array.isArray(t)?{x:t[0],y:t[1]}:t}let s=t.map(o);s[0]!==s[s.length-1]&&(s=s.concat(s[0]));for(let a=0;a<n;a++)r+=s[a].x*s[a+1].y-s[a].y*s[a+1].x;return i?r/2:Math.abs(r)/2}static Centroid(t){let e=0,n=0,r=0;for(let i=0;i<t.length;i+=1){const o=t[i],s=i===t.length-1?t[0]:t[i+1],a=.5*(o[0]*s[1]-s[0]*o[1]),u=(o[0]+s[0])/3,l=(o[1]+s[1])/3;e+=a,n+=a*u,r+=a*l}return[n/e,r/e]}static PointToSegmentDistance(t,e,n){const r=[n[0]-e[0],n[1]-e[1]],i=[t[0]-e[0],t[1]-e[1]],o=r[0]*i[0]+r[1]*i[1],s=r[0]*r[0]+r[1]*r[1];let a=[e[0],e[1]];if(0!==s){const t=o/s;a=t>1?[n[0],n[1]]:t>0?[e[0]+r[0]*t,e[1]+r[1]*t]:[e[0],e[1]]}const u=[t[0]-a[0],t[1]-a[1]];return Math.sqrt(u[0]*u[0]+u[1]*u[1])}static PointInPolygon(t,e){let n=0;for(let r=0;r<e.length;r+=1){const i=e[r];for(let e=0;e<i.length;e+=1){const r=i[e],o=e===i.length-1?i[0]:i[e+1];r[1]>t[1]!==o[1]>t[1]&&t[0]<(o[0]-r[0])*(t[1]-r[1])/(o[1]-r[1])+r[0]&&(n+=1)}}return n%2!==0}static MinDistanceFromPointToPolygon(t,e){let n=1/0;for(let r=0;r<e.length;r+=1){const i=e[r];for(let e=0;e<i.length;e+=1){const r=i[e],o=e===i.length-1?i[0]:i[e+1];n=Math.min(n,this.PointToSegmentDistance(t,r,o))}}return n}static PointDistanceToPolygon(t,e){const n=this.MinDistanceFromPointToPolygon(t,e);return this.PointInPolygon(t,e)?n:-n}static CellOfPolygon(t,e,n,r){const i=this.PointDistanceToPolygon([t,e],r),o=i+n*Math.SQRT2,s={x:t,y:e,h:n,d:i,max:o};return s}static CentroidForPOI(t){if(!t||0===t.length||0===t[0].length)return[0,0];const e=t[0];let n=e[0][0],r=e[0][1],i=e[0][0],o=e[0][1];for(let g=1;g<e.length;g+=1){const[t,s]=e[g];t<n&&(n=t),s<r&&(r=s),t>i&&(i=t),s>o&&(o=s)}const s=i-n,a=o-r,u=Math.min(s,a);let l=u/2,c=[];for(let g=n;g<i;g+=u)for(let e=r;e<o;e+=u){const n=this.CellOfPolygon(g+l,e+l,l,t);c.push(n)}const[h,p]=this.Centroid(e);let d=this.CellOfPolygon(h,p,l,t);c.push(d);const f=u/1024;while(c.length>1&&c[0].h>=f){c=c.sort((t,e)=>e.max-t.max);for(let t=0;t<c.length;t+=1){const e=c[t];e.d>d.d&&(d=e)}for(let t=0;t<c.length;t+=1){const e=c[t];if(e.max-d.d<=this.Epsilon){c=c.slice(0,t);break}}const e=[];l=c[0].h/2;for(let n=0;n<c.length;n+=1){const r=c[n];e.push(this.CellOfPolygon(r.x-l,r.y-l,l,t)),e.push(this.CellOfPolygon(r.x+l,r.y-l,l,t)),e.push(this.CellOfPolygon(r.x-l,r.y+l,l,t)),e.push(this.CellOfPolygon(r.x+l,r.y+l,l,t))}c=e}return[d.x,d.y]}static LinePlaneIntersection(t,e,n,r){const{x:i,y:o,z:s}=t,{x:a,y:u,z:l}=e,c=a-i,h=u-o,p=l-s,{x:d,y:f,z:g}=r,{x:m,y:y,z:v}=n,x=d*c+f*h+g*p,_=d*(m-i)+f*(y-o)+g*(v-s),b=_/x,w=new Wr(i+b*c,o+b*h,s+b*p);return w}static SegmentPlaneIntersection(t,e,n,r){const i=this.LinePlaneIntersection(t,e,n,r);if(Number.isNaN(i.x)||!Number.isFinite(i.x))return;if(Number.isNaN(i.y)||!Number.isFinite(i.y))return;if(Number.isNaN(i.z)||!Number.isFinite(i.z))return;const o=i.clone().sub(t).dot(i.clone().sub(e));return o<=0?i:void 0}static MapPointOnPlane(t,e,n){let r=new Wr(0,1,0);r.angleTo(n)<this.Epsilon&&(r=new Wr(0,0,1));const i=(new wi).lookAt(e,e.clone().add(n),r);return t.clone().applyMatrix4(i)}static ParameterToPlane(t,e,n,r){const i=Math.abs(r)/Math.sqrt(t*t+e*e+n*n);return{normal:new Wr(t,e,n),constant:i}}static PlaneCutMeshPolygon(t,e,n,r){const i=[],o=[];for(let p=0;p<r.length;p+=3){const s=n[r[p]],a=n[r[p+1]],u=n[r[p+2]],l=[],c=[];c.push(this.SegmentPlaneIntersection(s,a,t,e)),c.push(this.SegmentPlaneIntersection(s,u,t,e)),c.push(this.SegmentPlaneIntersection(u,a,t,e)),c.forEach(t=>{if(!t)return;let e=!1;for(let n=0;n<l.length;n+=1)if(t.distanceTo(l[n])<=this.Epsilon){e=!0;break}e||l.push(t)}),1===l.length&&l.push(l[0]),l.length>0&&(o.push([i.length,i.length+1]),i.push(l[0],l[1]))}const s=[],a=[];while(o.length>0){let n=o.pop();const r=[n[0],n[1]];let u;do{const t=i[n[1]];u=void 0;for(let e=0;e<o.length;e+=1){const n=o[e],r=i[n[0]],s=i[n[1]];if(r.distanceTo(t)<=this.Epsilon){u=[n[0],n[1]],o.splice(e,1);break}if(s.distanceTo(t)<=this.Epsilon){u=[n[1],n[0]],o.splice(e,1);break}}u&&(r.push(u[1]),n=u)}while(u);s.push({loop:r.map(t=>i[t]),index:a.length});const l=r.map(n=>this.MapPointOnPlane(i[n],t,e));a.push(l.map(t=>[t.x,t.y]))}s.sort((t,e)=>{const n=a[t.index],r=a[e.index];return 0===r.length?-1:0===n.length?1:this.PointInPolygon(r[0],[n])?-1:this.PointInPolygon(n[0],[r])?1:0});const u=[],l=[],c=[];if(s.length>1)for(let p=0;p<s.length;p+=1)u.push(...s[p].loop),l.push(...a[s[p].index]),c.push(u.length);else for(let p=0;p<s.length;p+=1)u.push(...s[p].loop),l.push(...a[s[p].index]);const h={vertices:u,holeIndices:c,vertices2D:l};return h}static TriangulatePolygon2D(t,e){const n=[];t.forEach(t=>{n.push(...t)});const r=tw()(n,e,2);return r}static TriangulatePolygonLoops2D(t){const e=[],n=[];t.forEach(t=>{e.push(...t),n.push(e.length)}),n.length>0&&n.splice(n.length-1,1);const r=rw.TriangulatePolygon2D(e,n);return{vertices:e,triangles:r}}static LookAtMatrix(t,e,n){const r=e.clone().sub(t),i=r.clone().cross(n),o=i.clone().cross(r);r.normalize(),i.normalize(),o.normalize();const s=-i.dot(t),a=-o.dot(t),u=r.dot(t),l=new wi;return l.set(i.x,i.y,i.z,s,o.x,o.y,o.z,a,-r.x,-r.y,-r.z,u,0,0,0,1),l}static FrustumMesh(t,e,n,r,i,o,s){const a=[0,1,3,3,1,2,0,4,1,1,4,5,1,5,6,1,6,2,2,6,7,2,7,3,3,7,4,3,4,0,4,5,7,7,5,6],u=Math.tan(Math.PI*r/360),l=o*u,c=o*i*u,h=s*u,p=s*i*u,d=[];d.push(new Wr(-c,-l,-o)),d.push(new Wr(-c,l,-o)),d.push(new Wr(c,l,-o)),d.push(new Wr(c,-l,-o)),d.push(new Wr(-p,-h,-s)),d.push(new Wr(-p,h,-s)),d.push(new Wr(p,h,-s)),d.push(new Wr(p,-h,-s));const f=this.LookAtMatrix(t,e,n),g=(new wi).copy(f).invert();return{vertices:d.map(t=>t.applyMatrix4(g)),triangles:a}}static PolygonIntersection(t,...e){return nw.a.intersection(t,...e)}static PolygonDiff(t,...e){return nw.a.difference(t,...e)}static PolygonUnion(t,...e){return nw.a.union(t,...e)}static PolygonXOR(t,...e){return nw.a.xor(t,...e)}static GetPathDistances(t){if(!t.length)return[];const e=[0];if(2===t[0].length)for(let n=1,r=t.length,i=o.set(o.create(),t[0][0],t[0][1]),s=o.create();n<r;n+=1)o.set(s,t[n][0],t[n][1]),e.push(e[n-1]+o.dist(i,s)),o.copy(i,s);else for(let n=1,r=t.length,i=s.set(s.create(),t[0][0],t[0][1],t[0][2]),o=s.create();n<r;n+=1)s.set(o,t[n][0],t[n][1],t[n][2]),e.push(e[n-1]+s.dist(i,o)),s.copy(i,o);return e}static GetPointOnDistance(t,e,n){let r=0,i=t.length-1,a=-1;while(r<i-1)if(a=Math.floor((r+i)/2),e[a]>n)i=a;else{if(!(e[a]<n)){r=a;break}r=a}if(a=r,a>-1){if(2===t[0].length){const r=o.set(o.create(),t[a][0],t[a][1]);if(a===t.length-1||n<=0)return[r[0],r[1]];const i=e[a],s=o.set(o.create(),t[a+1][0],t[a+1][1]),u=e[a+1],l=u-i,c=o.sub(o.create(),s,r),h=o.add(o.create(),r,o.scale(o.create(),c,(n-i)/l));return[h[0],h[1]]}if(3===t[0].length){const r=s.set(s.create(),t[a][0],t[a][1],t[a][2]);if(a===t.length-1||n<=0)return[r[0],r[1],r[2]];const i=e[a],o=s.set(s.create(),t[a+1][0],t[a+1][1],t[a+1][2]),u=e[a+1],l=u-i,c=s.sub(s.create(),o,r),h=s.add(s.create(),r,s.scale(s.create(),c,(n-i)/l));return[h[0],h[1],h[2]]}}throw new Error("Cannot find point on distance "+n)}static GetNearestPoint(t,e,n,r=.1,i=8){const a=n[n.length-1];let u,l,c,h,p,d,f=i,g=2===t.length?[0,0]:[0,0,0],m=0,y=1/0;for(let v,x,_=0;_<=a;_+=f)v=this.GetPointOnDistance(e,n,_),x=2===t.length?o.dist(o.set(o.create(),t[0],t[1]),o.set(o.create(),v[0],v[1])):s.dist(s.set(s.create(),t[0],t[1],t[2]),s.set(s.create(),v[0],v[1],v[2])),x<y&&(g=v,m=_,y=x);f/=2;while(f>r)c=m-f,u=this.GetPointOnDistance(e,n,c),p=2===t.length?o.dist(o.set(o.create(),t[0],t[1]),o.set(o.create(),u[0],u[1])):s.dist(s.set(s.create(),t[0],t[1],t[2]),s.set(s.create(),u[0],u[1],u[2])),h=m+f,l=this.GetPointOnDistance(e,n,h),d=2===t.length?o.dist(o.set(o.create(),t[0],t[1]),o.set(o.create(),l[0],l[1])):s.dist(s.set(s.create(),t[0],t[1],t[2]),s.set(s.create(),l[0],l[1],l[2])),c>=0&&p<y?(g=u,m=c,y=p):h<=a&&d<y?(g=l,m=h,y=d):f/=2;return{point:g,distance:m}}}rw.Epsilon=1e-6,function(t){t["MOVE"]="m",t["LINE"]="l",t["CURVE"]="c"}(jb||(jb={}));class iw{}iw.Ground="ground",iw.Area="area",iw.Store="store",iw.Impassable="impassable",iw.ParkingSpace="parking-space";class ow{constructor(){this.eventMap=new Map}on(t,e){this.eventMap.has(t)||this.eventMap.set(t,new Set);const n=this.eventMap.get(t);n&&(n.add(e),this.eventMap.set(t,n))}emit(t,...e){const n=this.eventMap.get(t);n&&n.forEach(t=>{t(...e)})}off(t,e){const n=this.eventMap.get(t);n&&n.delete(e)}static on(t,e){ow.hub||(ow.hub=new ow),ow.hub.on(t,e)}static emit(t,...e){ow.hub||(ow.hub=new ow),ow.hub.emit(t,...e)}static off(t,e){ow.hub||(ow.hub=new ow),ow.hub.off(t,e)}static remove(t,e){console.warn("EventHub.remove() will be removed in future releases. Use EventHub.off() instead."),ow.off(t,e)}}class sw{constructor(){this.eventMap=new Map}on(t,e){this.eventMap.has(t)||this.eventMap.set(t,new Set);const n=this.eventMap.get(t);n&&(n.add(e),this.eventMap.set(t,n))}emit(t,...e){const n=this.eventMap.get(t);n&&n.forEach(t=>{t(...e)}),ow.emit(t,...e)}off(t,e){const n=this.eventMap.get(t);n&&n.delete(e)}}class aw{}aw.ELEMENT_SELECTED="element-selected",aw.ELEMENT_POSITION_UPDATED="element-position-updated",aw.ELEMENT_POSE_UPDATED="element-pose-updated",aw.CAMERA_CHANGED="panorama-camera-changed",aw.PANORAMA_CAMERA_CHANGED="panorama-camera-changed",aw.ORBIT_CAMERA_CHANGED="orbit-camera-changed",aw.PANORAMA_PRESENTED="panorama-presented",aw.PANORAMA_SELECTED="panorama-selected",aw.PANORAMA_HOVER="panorama-hover",aw.ELEMENT_LOADED="element-loaded",aw.ELEMENT_LOADED_ERROR="o/element-loaded-error",aw.CLICK_PANORAMA="click-panorama",aw.MOVE_TO_PANORAMA="move-to-panorama",aw.WILL_MOVE_TO_PANORAMA="will-move-to-panorama",aw.PATH_MOVEMENT_START="path-movement-start",aw.PATH_MOVEMENT_COMPLETED="path-movement-completed",aw.WILL_LOAD_PANORAMA="will-load-panorama",aw.DID_LOAD_PANORAMA="did-load-panorama",aw.TRANSFORM_ACTIVATED="transform-activated",aw.TRANSFORM_DEACTIVATED="transform-deactivated",aw.FPS_UPDATED="fps-updated",aw.GET_PLANE_INTERSECT="get-plane-intersect",aw.POI_CLICKED="poi-clicked",aw.POI_DOWN="poi-down",aw.POI_UP="poi-up",aw.CANVAS_VERTEX_CLICKED="canvas-vertex-clicked",aw.CANVAS_VERTEX_DOWN="canvas-vertex-down",aw.CANVAS_VERTEX_UP="canvas-vertex-up",aw.LABEL_ICONS_POSITION_UPDATED="label-icons-position-updated",aw.LABEL_DOWN="label-down",aw.TICK="tick";class uw{}uw.ELEMENT_SELECTED="o/element-selected",uw.RENDERING_VIEW_CHANGED="o/rendering-view-changed",uw.DISPOSE_ELEMENT="o/dispose-element",uw.ELEMENT_LOADED="o/element-loaded",uw.ELEMENT_POSITION_UPDATED="o/element-position-updated";class lw{constructor(t,e,n,r,i){this.extentsMin=t,this.extentsMax=e,this.startIndex=n,this.endIndex=r,this.level=i,this.node0=null,this.node1=null}elementCount(){return this.endIndex-this.startIndex}centerX(){return.5*(this.extentsMin.x+this.extentsMax.x)}centerY(){return.5*(this.extentsMin.y+this.extentsMax.y)}centerZ(){return.5*(this.extentsMin.z+this.extentsMax.z)}clearShapes(){this.startIndex=-1,this.endIndex=-1}calcBoundingSphereRadius(t,e){const n=.5*(t.x+e.x),r=.5*(t.y+e.y),i=.5*(t.z+e.z),o=(n-t.x)*(n-t.x)+(r-t.y)*(r-t.y)+(i-t.z)*(i-t.z),s=(n-e.x)*(n-e.x)+(r-e.y)*(r-e.y)+(i-e.z)*(i-e.z);return Math.sqrt(Math.max(o,s))}}class cw{constructor(t,e){const n=[];n.length=9*t.length;for(let o=0;o<t.length;o+=1){const e=t[o][0],r=t[o][1],i=t[o][2];n[9*o]=e.x,n[9*o+1]=e.y,n[9*o+2]=e.z,n[9*o+3]=r.x,n[9*o+4]=r.y,n[9*o+5]=r.z,n[9*o+6]=i.x,n[9*o+7]=i.y,n[9*o+8]=i.z}this.trianglesArray=n,this.maxTrianglesPerNode=e||10,this.bboxArray=this.calcBoundingBoxes(n),this.bboxHelper=new Float32Array(this.bboxArray.length),this.bboxHelper.set(this.bboxArray);const r=n.length/9,i=this.calcExtents(0,r,cw.EPSILON);this.rootNode=new lw(i[0],i[1],0,r,0),this.nodesToSplit=[this.rootNode];while(this.nodesToSplit.length>0){const t=this.nodesToSplit.pop();t&&this.splitNode(t)}}vector3SetFromArray(t,e,n){t.set(e[n],e[n+1],e[n+2])}intersectRay(t,e,n){const r=[this.rootNode],i=[],o=[];let s;const a=new Wr(1/e.x,1/e.y,1/e.z);while(r.length>0){const e=r.pop();if(e&&this.intersectNodeBox(t,a,e))for(e.node0&&r.push(e.node0),e.node1&&r.push(e.node1),s=e.startIndex;s<e.endIndex;s+=1)i.push(this.bboxArray[7*s])}const u=new Wr,l=new Wr,c=new Wr,h=new Wr(t.x,t.y,t.z),p=new Wr(e.x,e.y,e.z);for(s=0;s<i.length;s+=1){const t=i[s];this.vector3SetFromArray(u,this.trianglesArray,9*t),this.vector3SetFromArray(l,this.trianglesArray,9*t+3),this.vector3SetFromArray(c,this.trianglesArray,9*t+6);const e=this.intersectRayTriangle(u,l,c,h,p,n||!1);e&&o.push({triangle:[u.clone(),l.clone(),c.clone()],triangleIndex:t,intersectionPoint:e})}return o}nearestIntersection(t,e,n){const r=e.clone().normalize(),i=this.intersectRay(t,r,n);if(0===i.length)return null;let o=null,s=Number.MAX_VALUE;for(let a=0;a<i.length;a+=1){const e=i[a],n=e.intersectionPoint.clone().sub(t).dot(r);n>=0&&n<s&&(o=e,s=n)}return o}calcBoundingBoxes(t){let e,n,r,i,o,s,a,u,l,c,h,p,d,f,g;const m=t.length/9,y=new Float32Array(7*m);for(let v=0;v<m;v+=1)e=t[9*v],n=t[9*v+1],r=t[9*v+2],i=t[9*v+3],o=t[9*v+4],s=t[9*v+5],a=t[9*v+6],u=t[9*v+7],l=t[9*v+8],c=Math.min(Math.min(e,i),a),h=Math.min(Math.min(n,o),u),p=Math.min(Math.min(r,s),l),d=Math.max(Math.max(e,i),a),f=Math.max(Math.max(n,o),u),g=Math.max(Math.max(r,s),l),this.setBox(y,v,v,c,h,p,d,f,g);return y}setBox(t,e,n,r,i,o,s,a,u){t[7*e]=n,t[7*e+1]=r,t[7*e+2]=i,t[7*e+3]=o,t[7*e+4]=s,t[7*e+5]=a,t[7*e+6]=u}copyBox(t,e,n,r){n[7*r]=t[7*e],n[7*r+1]=t[7*e+1],n[7*r+2]=t[7*e+2],n[7*r+3]=t[7*e+3],n[7*r+4]=t[7*e+4],n[7*r+5]=t[7*e+5],n[7*r+6]=t[7*e+6]}calcExtents(t,e,n){const r=n||0;if(t>=e)return[new Wr(0,0,0),new Wr(0,0,0)];let i=Number.MAX_VALUE,o=Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,u=-Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let c=t;c<e;c+=1)i=Math.min(this.bboxArray[7*c+1],i),o=Math.min(this.bboxArray[7*c+2],o),s=Math.min(this.bboxArray[7*c+3],s),a=Math.max(this.bboxArray[7*c+4],a),u=Math.max(this.bboxArray[7*c+5],u),l=Math.max(this.bboxArray[7*c+6],l);return[new Wr(i-r,o-r,s-r),new Wr(a+r,u+r,l+r)]}splitNode(t){if(t.elementCount()<=this.maxTrianglesPerNode||0===t.elementCount())return;const{startIndex:e,endIndex:n}=t,r=[new Array,new Array,new Array],i=[new Array,new Array,new Array],o=[t.centerX(),t.centerY(),t.centerZ()],s=[t.extentsMax.x-t.extentsMin.x,t.extentsMax.y-t.extentsMin.y,t.extentsMax.z-t.extentsMin.z],a=[];a.length=3;for(let E=e;E<n;E+=1){a[0]=.5*(this.bboxArray[7*E+1]+this.bboxArray[7*E+4]),a[1]=.5*(this.bboxArray[7*E+2]+this.bboxArray[7*E+5]),a[2]=.5*(this.bboxArray[7*E+3]+this.bboxArray[7*E+6]);for(let t=0;t<3;t+=1)a[t]<o[t]?r[t].push(E):i[t].push(E)}const u=[];if(u.length=3,u[0]=0===r[0].length||0===i[0].length,u[1]=0===r[1].length||0===i[1].length,u[2]=0===r[2].length||0===i[2].length,u[0]&&u[1]&&u[2])return;const l=[0,1,2];let c,h;l.sort((t,e)=>s[e]-s[t]);for(let E=0;E<3;E+=1){const t=l[E];if(!u[t]){c=r[t],h=i[t];break}}const p=e,d=p+(void 0!==c?c.length:0),f=d,g=n;let m,y=t.startIndex,v=[];c&&(v=c),h&&(v=v.concat(h));for(let E=0;E<v.length;E+=1)m=v[E],this.copyBox(this.bboxArray,m,this.bboxHelper,y),y+=1;const x=this.bboxHelper.subarray(7*t.startIndex,7*t.endIndex);this.bboxArray.set(x,7*t.startIndex);const _=this.calcExtents(p,d,cw.EPSILON),b=this.calcExtents(f,g,cw.EPSILON),w=new lw(_[0],_[1],p,d,t.level+1),M=new lw(b[0],b[1],f,g,t.level+1);t.node0=w,t.node1=M,t.clearShapes(),this.nodesToSplit.push(w),this.nodesToSplit.push(M)}calcTValues(t,e,n,r){const i={min:0,max:0};return r>=0?(i.min=(t-n)*r,i.max=(e-n)*r):(i.min=(e-n)*r,i.max=(t-n)*r),i}intersectNodeBox(t,e,n){const r=this.calcTValues(n.extentsMin.x,n.extentsMax.x,t.x,e.x),i=this.calcTValues(n.extentsMin.y,n.extentsMax.y,t.y,e.y);if(r.min>i.max||i.min>r.max)return!1;(i.min>r.min||Number.isNaN(r.min))&&(r.min=i.min),(i.max<r.max||Number.isNaN(r.max))&&(r.max=i.max);const o=this.calcTValues(n.extentsMin.z,n.extentsMax.z,t.z,e.z);return!(r.min>o.max||o.min>r.max)&&((o.min>r.min||Number.isNaN(r.min))&&(r.min=o.min),(o.max<r.max||Number.isNaN(r.max))&&(r.max=o.max),!(r.max<0))}intersectRayTriangle(t,e,n,r,i,o){const s=new Wr,a=new Wr,u=new Wr,l=new Wr;a.subVectors(e,t),u.subVectors(n,t),l.crossVectors(a,u);let c,h=i.dot(l);if(h>0){if(o)return null;c=1}else{if(!(h<0))return null;c=-1,h=-h}s.subVectors(r,t);const p=c*i.dot(u.crossVectors(s,u));if(p<0)return null;const d=c*i.dot(a.cross(s));if(d<0)return null;if(p+d>h)return null;const f=-c*s.dot(l);if(f<0)return null;const g=f/h,m=new Wr;return m.copy(i).multiplyScalar(g).add(r)}static addTriangles(t,e){if(!(e instanceof as))return;const n=e,r=n.geometry,i=r.attributes.position.array,o=r.index?r.index.array:null;let s=0;if(o){s=o.length/3;for(let e=0;e<s;e+=1)t.push([new Wr(i[3*o[3*e]],i[3*o[3*e]+1],i[3*o[3*e]+2]),new Wr(i[3*o[3*e+1]],i[3*o[3*e+1]+1],i[3*o[3*e+1]+2]),new Wr(i[3*o[3*e+2]],i[3*o[3*e+2]+1],i[3*o[3*e+2]+2])])}else{s=i.length/9;for(let e=0;e<s;e+=1)t.push([new Wr(i[9*e],i[9*e+1],i[9*e+2]),new Wr(i[9*e+3],i[9*e+4],i[9*e+5]),new Wr(i[9*e+6],i[9*e+7],i[9*e+8])])}}static createBVHTree(t){const e=[];t.traverse(t=>{this.addTriangles(e,t)});const n=new cw(e,7);return n}}cw.EPSILON=1e-6;class hw{static GetVersion(t,e){let n=window.navigator.userAgent.match(t);return n=n?n[1].split(e):[],{major:parseInt(n[0],10)||0,minor:parseInt(n[1],10)||0,patch:parseInt(n[2],10)||0}}static DetectWeChat(){const t=window.navigator.userAgent.toLowerCase();return!!t&&"micromessenger"===t.toString()}static DetectIOS(){return this.DetectIPhone()||this.DetectIPad()||this.DetectIPod()}static DetectIPad(){const{userAgent:t}=window.navigator;return/iPad/.test(t)}static DetectIPod(){const{userAgent:t}=window.navigator;return/iPod/.test(t)}static DetectIPhone(){const{userAgent:t}=window.navigator;return/iPhone/.test(t)}static DetectAndroid(){return-1!==window.navigator.userAgent.indexOf("Android")}static DetectAndroidMobile(){const{userAgent:t}=window.navigator;return this.DetectAndroid()&&-1!==t.indexOf("Mobile")}}class pw{constructor(t,e=!1){this.element=t,this.needUpdate=e,this.shouldPlaceElement=!1}}class dw extends Yi{constructor(){super(),this.invisibleViewSettingsEnabled=!1,this.invisibleViews=new Set,this.elementListeners={onElementSelected:t=>{t===this&&ow.emit(aw.ELEMENT_SELECTED,t)}},this.eventMap=new Map,ow.on(uw.ELEMENT_SELECTED,this.elementListeners.onElementSelected)}getUUID(){return this.universalId}setUUID(t){this.universalId=t}select(){ow.emit(uw.ELEMENT_SELECTED,this)}dispose(){ow.off(uw.ELEMENT_SELECTED,this.elementListeners.onElementSelected)}setInvisibleInView(t){this.invisibleViews.add(t),this.invisibleViewSettingsEnabled=!0}setVisibleInView(t){this.invisibleViews.delete(t)}renderingViewChanged(t){this.currentView=t,this.invisibleViewSettingsEnabled&&(this.visible=!this.invisibleViews.has(t))}on(t,e){this.eventMap.has(t)||this.eventMap.set(t,new Set);const n=this.eventMap.get(t);n&&(n.add(e),this.eventMap.set(t,n))}emit(t,...e){const n=this.eventMap.get(t);n&&n.forEach(t=>{t(...e)}),ow.emit(t,...e)}off(t,e){const n=this.eventMap.get(t);if(!n)throw Error(`Target event '${t}' not found`);n.delete(e)}}class fw{static dispose(t,e){if(e&&t.children&&t.children.length&&t.children.forEach(t=>{fw.dispose(t,e)}),t.isMesh){const e=t;e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.dispose()}):e.material.dispose())}}static getMouseIntersection(t,{x:e,y:n},r,i,o=-1){const s=o<0?Number.MAX_SAFE_INTEGER:Math.pow(o,2),a=new Sm;a.setFromCamera({x:e,y:n},r);const u=r.position.clone(),l=t.filter(t=>t.visible&&u.distanceToSquared(t.getWorldPosition(new Wr))<s),c=a.intersectObjects(l,!0).filter(t=>!!t.face),h=new Set(i);for(let p=0;p<c.length;p++){let t=c[p].object;const e=[];while(!(t instanceof dw)&&t.parent)t=t.parent;while(t){if(t instanceof dw&&e.push(t),!t.parent)break;t=t.parent}for(let n=0;n<e.length;n++)if(e[n]instanceof dw){if(!i){const t=c[p];return t.object=e[n],t}if(h.has(e[n])){const t=c[p];return t.object=e[n],t}}}return null}static getMouseIntersectionOnScreen(t,{x:e,y:n},{screenWidth:r,screenHeight:i},o,s,a,u=13,l){const c=[],h=new Or(e,n),p=new Cs;p.setFromProjectionMatrix((new wi).multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse));const d=s.position.clone(),f=u<0?Number.MAX_SAFE_INTEGER:Math.pow(u,2);t.forEach(t=>{const e=t.position.clone().project(s),n=new Or((e.x+1)/2*r,(1-e.y)/2*i).distanceTo(h),a=this.getMesh(t);if(!a)return;let u=!1,g=!1;if(l){const n=l.get(t);if(n){u=!0;const t=new Or((e.x+1)/2*r,(1-e.y)/2*i),o=t.x-n[0]/2,s=t.x+n[0]/2,a=t.y-n[1]/2,l=t.y+n[1]/2;Math.abs(e.z)<=1&&h.x<=s&&h.x>=o&&h.y>=a&&h.y<=l&&(g=!0)}}(u?g:n<=o)&&d.distanceToSquared(a.getWorldPosition(new Wr))<f&&p.intersectsObject(a)&&(a.visible&&t.visible||a.userData.enableDetected)&&c.push({e:t,d:n})}),c.sort((t,e)=>t.d-e.d);const g=new Set(a);for(let m=0;m<c.length;m++){const t=c[m].e;if(!a)return t;if(g.has(t))return t}return null}static getHorizontalPlaneCoordinate({x:t,y:e},n,r){if(!r)return null;const{clientWidth:i,clientHeight:o}=n.renderer.domElement;if(i<=0||o<=0)return null;const s=t/i*2-1,a=1-e/o*2,u=new Wr(s,a,0),l=u.unproject(r);return new Or(l.x,l.y)}static projectToScreenCoordinate(t,e,n){if(!n)return null;const{clientWidth:r,clientHeight:i}=e.renderer.domElement;if(r<=0||i<=0)return null;const o=t.clone().project(n),s=.5*(o.x+1)*r,a=.5*(1-o.y)*i;return{x:s,y:a}}static getMesh(t){const e=t instanceof as?t:null;if(!e&&t.children.length)for(let n=0;n<t.children.length;n+=1){const e=this.getMesh(t.children[n]);if(e)return e}return e}}var gw=n("89dd"),mw=n.n(gw),yw=function(){function t(t){vf.call(this,t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new o(t)})),this.register((function(t){return new a(t)})),this.register((function(t){return new u(t)})),this.register((function(t){return new s(t)})),this.register((function(t){return new r(t)})),this.register((function(t){return new l(t)}))}function e(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(vf.prototype),{constructor:t,load:function(t,e,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Eg.extractUrlBase(t),this.manager.itemStart(t);var s=function(e){r?r(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},a=new _f(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{o.parse(n,i,(function(n){e(n),o.manager.itemEnd(t)}),s)}catch(r){s(r)}}),n,s)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(t){return this.ktx2Loader=t,this},setMeshoptDecoder:function(t){return this.meshoptDecoder=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(t,e,r,o){var s,a={},u={};if("string"===typeof t)s=t;else{var l=Eg.decodeText(new Uint8Array(t,0,4));if(l===c){try{a[n.KHR_BINARY_GLTF]=new d(t)}catch(w){return void(o&&o(w))}s=a[n.KHR_BINARY_GLTF].content}else s=Eg.decodeText(new Uint8Array(t))}var h=JSON.parse(s);if(void 0===h.asset||h.asset.version[0]<2)o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var p=new k(h,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(var m=0;m<this.pluginCallbacks.length;m++){var x=this.pluginCallbacks[m](p);u[x.name]=x,a[x.name]=!0}if(h.extensionsUsed)for(m=0;m<h.extensionsUsed.length;++m){var _=h.extensionsUsed[m],b=h.extensionsRequired||[];switch(_){case n.KHR_MATERIALS_UNLIT:a[_]=new i;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[_]=new y;break;case n.KHR_DRACO_MESH_COMPRESSION:a[_]=new f(h,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:a[_]=new g;break;case n.KHR_MESH_QUANTIZATION:a[_]=new v;break;default:b.indexOf(_)>=0&&void 0===u[_]&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}p.setExtensions(a),p.setPlugins(u),p.parse(r,o)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function r(t){this.parser=t,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function i(){this.name=n.KHR_MATERIALS_UNLIT}function o(t){this.parser=t,this.name=n.KHR_MATERIALS_CLEARCOAT}function s(t){this.parser=t,this.name=n.KHR_MATERIALS_TRANSMISSION}function a(t){this.parser=t,this.name=n.KHR_TEXTURE_BASISU}function u(t){this.parser=t,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function l(t){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=t}r.prototype._markDefs=function(){for(var t=this.parser,e=this.parser.json.nodes||[],n=0,r=e.length;n<r;n++){var i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}},r.prototype._loadLight=function(t){var e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;var i,o=e.json,s=o.extensions&&o.extensions[this.name]||{},a=s.lights||[],u=a[t],l=new vo(16777215);void 0!==u.color&&l.fromArray(u.color);var c=void 0!==u.range?u.range:0;switch(u.type){case"directional":i=new vg(l),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new gg(l),i.distance=c;break;case"spot":i=new cg(l),i.distance=c,u.spot=u.spot||{},u.spot.innerConeAngle=void 0!==u.spot.innerConeAngle?u.spot.innerConeAngle:0,u.spot.outerConeAngle=void 0!==u.spot.outerConeAngle?u.spot.outerConeAngle:Math.PI/4,i.angle=u.spot.outerConeAngle,i.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return i.position.set(0,0,0),i.decay=2,void 0!==u.intensity&&(i.intensity=u.intensity),i.name=e.createUniqueName(u.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r},r.prototype.createNodeAttachment=function(t){var e=this,n=this.parser,r=n.json,i=r.nodes[t],o=i.extensions&&i.extensions[this.name]||{},s=o.light;return void 0===s?null:this._loadLight(s).then((function(t){return n._getNodeRef(e.cache,s,t)}))},i.prototype.getMaterialType=function(){return xo},i.prototype.extendParams=function(t,e,n){var r=[];t.color=new vo(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(r)},o.prototype.getMaterialType=function(t){var e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?jd:null},o.prototype.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Or(s,-s)}return Promise.all(i)},s.prototype.getMaterialType=function(t){var e=this.parser,n=e.json.materials[t];return n.extensions&&n.extensions[this.name]?jd:null},s.prototype.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(e.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(i)},a.prototype.loadTexture=function(t){var e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o,s)},u.prototype.loadTexture=function(t){var e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;var o=i.extensions[e],s=r.images[o.source],a=n.textureLoader;if(s.uri){var u=n.options.manager.getHandler(s.uri);null!==u&&(a=u)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))},u.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported},l.prototype.loadBufferView=function(t){var e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(t){var e=r.byteOffset||0,n=r.byteLength||0,i=r.count,s=r.byteStride,a=new ArrayBuffer(i*s),u=new Uint8Array(t[0],e,n);return o.decodeGltfBuffer(new Uint8Array(a),i,s,u,r.mode,r.filter),a}))}return null};var c="glTF",h=12,p={JSON:1313821514,BIN:5130562};function d(t){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,h);if(this.header={magic:Eg.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==c)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var r=this.header.length-h,i=new DataView(t,h),o=0;while(o<r){var s=i.getUint32(o,!0);o+=4;var a=i.getUint32(o,!0);if(o+=4,a===p.JSON){var u=new Uint8Array(t,h+o,s);this.content=Eg.decodeText(u)}else if(a===p.BIN){var l=h+o;this.body=t.slice(l,l+s)}o+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function f(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function g(){this.name=n.KHR_TEXTURE_TRANSFORM}function m(t){Hd.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new vo).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(t){for(var a in s)t.uniforms[a]=s[a];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){s.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function y(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return m},extendParams:function(t,e,n){var r=e.extensions[this.name];t.color=new vo(1,1,1),t.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new vo(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new vo(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var s=r.specularGlossinessTexture;i.push(n.assignTexture(t,"glossinessMap",s)),i.push(n.assignTexture(t,"specularMap",s))}return Promise.all(i)},createMaterial:function(t){var e=new m(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=er,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function v(){this.name=n.KHR_MESH_QUANTIZATION}function x(t,e,n,r){$d.call(this,t,e,n,r)}f.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,s={},a={},u={};for(var l in o){var c=S[l]||l.toLowerCase();s[c]=o[l]}for(l in t.attributes){c=S[l]||l.toLowerCase();if(void 0!==o[l]){var h=n.accessors[t.attributes[l]],p=b[h.componentType];u[c]=p,a[c]=!0===h.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=a[n];void 0!==i&&(r.normalized=i)}e(t)}),s,u)}))}))},g.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},m.prototype=Object.create(Hd.prototype),m.prototype.constructor=m,m.prototype.copy=function(t){return Hd.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},x.prototype=Object.create($d.prototype),x.prototype.constructor=x,x.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,o=0;o!==r;o++)e[o]=n[i+o];return e},x.prototype.beforeStart_=x.prototype.copySampleValue_,x.prototype.afterEnd_=x.prototype.copySampleValue_,x.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,u=3*s,l=r-e,c=(n-e)/l,h=c*c,p=h*c,d=t*u,f=d-u,g=-2*p+3*h,m=p-h,y=1-g,v=m-h+c,x=0;x!==s;x++){var _=o[f+x+s],b=o[f+x+a]*l,w=o[d+x+s],M=o[d+x]*l;i[x]=y*_+v*b+g*w+m*M}return i};var _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:ue,9729:de,9984:le,9985:fe,9986:he,9987:me},M={33071:se,33648:ae,10497:oe},E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},T={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:void 0,LINEAR:Dn,STEP:On},A={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function P(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function L(t){return void 0===t["DefaultMaterial"]&&(t["DefaultMaterial"]=new Hd({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ut})),t["DefaultMaterial"]}function I(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function R(t,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function N(t,e,n){for(var r=!1,i=!1,o=0,s=e.length;o<s;o++){var a=e[o];if(void 0!==a.POSITION&&(r=!0),void 0!==a.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);var u=[],l=[];for(o=0,s=e.length;o<s;o++){a=e[o];if(r){var c=void 0!==a.POSITION?n.getDependency("accessor",a.POSITION):t.attributes.position;u.push(c)}if(i){c=void 0!==a.NORMAL?n.getDependency("accessor",a.NORMAL):t.attributes.normal;l.push(c)}}return Promise.all([Promise.all(u),Promise.all(l)]).then((function(e){var n=e[0],o=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}function O(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)t.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D(t){var e,r=t.extensions&&t.extensions[n.KHR_DRACO_MESH_COMPRESSION];return e=r?"draco:"+r.bufferView+":"+r.indices+":"+F(r.attributes):t.indices+":"+F(t.attributes)+":"+t.mode,e}function F(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function k(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new Rg(this.options.manager):this.textureLoader=new Tf(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new _f(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function B(t,e,n){var r=e.attributes,i=new Xr;if(void 0!==r.POSITION){var o=n.json.accessors[r.POSITION],s=o.min,a=o.max;if(void 0!==s&&void 0!==a){i.set(new Wr(s[0],s[1],s[2]),new Wr(a[0],a[1],a[2]));var u=e.targets;if(void 0!==u){for(var l=new Wr,c=new Wr,h=0,p=u.length;h<p;h++){var d=u[h];if(void 0!==d.POSITION){o=n.json.accessors[d.POSITION],s=o.min,a=o.max;void 0!==s&&void 0!==a?(c.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),c.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),c.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}t.boundingBox=i;var f=new di;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function z(t,e,n){var r=e.attributes,i=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var s in r){var a=S[s]||s.toLowerCase();a in t.attributes||i.push(o(r[s],a))}if(void 0!==e.indices&&!t.index){var u=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(u)}return R(t,e),B(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?N(t,e.targets,n):t}))}function G(t,e){var n=t.getIndex();if(null===n){var r=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<i.count;o++)r.push(o);t.setIndex(r),n=t.getIndex()}var s=n.count-2,a=[];if(e===jn)for(o=1;o<=s;o++)a.push(n.getX(0)),a.push(n.getX(o)),a.push(n.getX(o+1));else for(o=0;o<s;o++)o%2===0?(a.push(n.getX(o)),a.push(n.getX(o+1)),a.push(n.getX(o+2))):(a.push(n.getX(o+2)),a.push(n.getX(o+1)),a.push(n.getX(o)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=t.clone();return u.setIndex(a),u}return k.prototype.setExtensions=function(t){this.extensions=t},k.prototype.setPlugins=function(t){this.plugins=t},k.prototype.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){var o={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};I(i,o,r),R(o,r),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(o)}))).then((function(){t(o)}))})).catch(e)},k.prototype._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r=0,i=e.length;r<i;r++)for(var o=e[r].joints,s=0,a=o.length;s<a;s++)t[o[s]].isBone=!0;for(var u=0,l=t.length;u<l;u++){var c=t[u];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},k.prototype._addNodeRef=function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)},k.prototype._getNodeRef=function(t,e,n){if(t.refs[e]<=1)return n;var r=n.clone();return r.name+="_instance_"+t.uses[e]++,r},k.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}},k.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++){var i=t(e[r]);i&&n.push(i)}return n},k.prototype.getDependency=function(t,e){var n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r},k.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},k.prototype.loadBuffer=function(t){var e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(t,n){r.load(P(e.uri,i.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},k.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},k.prototype.loadAccessor=function(t){var e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){var i,o,s=t[0],a=E[r.type],u=b[r.componentType],l=u.BYTES_PER_ELEMENT,c=l*a,h=r.byteOffset||0,p=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(p&&p!==c){var f=Math.floor(h/p),g="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+f+":"+r.count,m=e.cache.get(g);m||(i=new u(s,f*p,r.count*p/l),m=new Ch(i,p/l),e.cache.add(g,m)),o=new Ph(m,a,h%p/l,d)}else i=null===s?new u(r.count*a):new u(s,h,r.count*a),o=new wo(i,a,d);if(void 0!==r.sparse){var y=E.SCALAR,v=b[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,_=r.sparse.values.byteOffset||0,w=new v(t[1],x,r.sparse.count*y),M=new u(t[2],_,r.sparse.count*a);null!==s&&(o=new wo(o.array.slice(),o.itemSize,o.normalized));for(var S=0,T=w.length;S<T;S++){var C=w[S];if(o.setX(C,M[S*a]),a>=2&&o.setY(C,M[S*a+1]),a>=3&&o.setZ(C,M[S*a+2]),a>=4&&o.setW(C,M[S*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},k.prototype.loadTexture=function(t){var e=this.json,n=this.options,r=e.textures[t],i=e.images[r.source],o=this.textureLoader;if(i.uri){var s=n.manager.getHandler(i.uri);null!==s&&(o=s)}return this.loadTextureImage(t,i,o)},k.prototype.loadTextureImage=function(t,e,n){var r=this,i=this.json,o=this.options,s=i.textures[t],a=self.URL||self.webkitURL,u=e.uri,l=!1,c=!0;if("image/jpeg"===e.mimeType&&(c=!1),void 0!==e.bufferView)u=r.getDependency("bufferView",e.bufferView).then((function(t){if("image/png"===e.mimeType){var n=new DataView(t,25,1).getUint8(0,!1);c=6===n||4===n||3===n}l=!0;var r=new Blob([t],{type:e.mimeType});return u=a.createObjectURL(r),u}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");return Promise.resolve(u).then((function(t){return new Promise((function(e,r){var i=e;!0===n.isImageBitmapLoader&&(i=function(t){e(new Lp(t))}),n.load(P(t,o.path),i,void 0,r)}))})).then((function(e){!0===l&&a.revokeObjectURL(u),e.flipY=!1,s.name&&(e.name=s.name),c||(e.format=Ie);var n=i.samplers||{},o=n[s.sampler]||{};return e.magFilter=w[o.magFilter]||de,e.minFilter=w[o.minFilter]||me,e.wrapS=M[o.wrapS]||oe,e.wrapT=M[o.wrapT]||oe,r.associations.set(e,{type:"textures",index:t}),e}))},k.prototype.assignTexture=function(t,e,r){var i=this;return this.getDependency("texture",r.index).then((function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===e&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var a=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}t[e]=o}))},k.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,r=void 0!==e.attributes.tangent,i=void 0!==e.attributes.color,o=void 0===e.attributes.normal,s=!0===t.isSkinnedMesh,a=Object.keys(e.morphAttributes).length>0,u=a&&void 0!==e.morphAttributes.normal;if(t.isPoints){var l="PointsMaterial:"+n.uuid,c=this.cache.get(l);c||(c=new bp,co.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(l,c)),n=c}else if(t.isLine){l="LineBasicMaterial:"+n.uuid;var h=this.cache.get(l);h||(h=new cp,co.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(r||i||o||s||a){l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),s&&(l+="skinning:"),r&&(l+="vertex-tangents:"),i&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),a&&(l+="morph-targets:"),u&&(l+="morph-normals:");var p=this.cache.get(l);p||(p=n.clone(),s&&(p.skinning=!0),i&&(p.vertexColors=!0),o&&(p.flatShading=!0),a&&(p.morphTargets=!0),u&&(p.morphNormals=!0),r&&(p.vertexTangents=!0,p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(l,p),this.associations.set(p,this.associations.get(n))),n=p}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n},k.prototype.getMaterialType=function(){return Hd},k.prototype.loadMaterial=function(t){var e,r=this,i=this.json,o=this.extensions,s=i.materials[t],a={},u=s.extensions||{},l=[];if(u[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=c.getMaterialType(),l.push(c.extendParams(a,s,r))}else if(u[n.KHR_MATERIALS_UNLIT]){var h=o[n.KHR_MATERIALS_UNLIT];e=h.getMaterialType(),l.push(h.extendParams(a,s,r))}else{var p=s.pbrMetallicRoughness||{};if(a.color=new vo(1,1,1),a.opacity=1,Array.isArray(p.baseColorFactor)){var d=p.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}void 0!==p.baseColorTexture&&l.push(r.assignTexture(a,"map",p.baseColorTexture)),a.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,a.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(l.push(r.assignTexture(a,"metalnessMap",p.metallicRoughnessTexture)),l.push(r.assignTexture(a,"roughnessMap",p.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===s.doubleSided&&(a.side=ct);var f=s.alphaMode||A.OPAQUE;return f===A.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===A.MASK&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==xo&&(l.push(r.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Or(1,-1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&e!==xo&&(l.push(r.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==xo&&(a.emissive=(new vo).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==xo&&l.push(r.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){var i;return i=e===m?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new e(a),s.name&&(i.name=s.name),i.map&&(i.map.encoding=qn),i.emissiveMap&&(i.emissiveMap.encoding=qn),R(i,s),r.associations.set(i,{type:"materials",index:t}),s.extensions&&I(o,i,s),i}))},k.prototype.createUniqueName=function(t){for(var e=vm.sanitizeNodeName(t||""),n=e,r=1;this.nodeNamesUsed[n];++r)n=e+"_"+r;return this.nodeNamesUsed[n]=!0,n},k.prototype.loadGeometries=function(t){var e=this,r=this.extensions,i=this.primitiveCache;function o(t){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return z(n,t,e)}))}for(var s=[],a=0,u=t.length;a<u;a++){var l,c=t[a],h=D(c),p=i[h];if(p)s.push(p.promise);else l=c.extensions&&c.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(c):z(new Ho,c,e),i[h]={primitive:c,promise:l},s.push(l)}return Promise.all(s)},k.prototype.loadMesh=function(t){for(var e=this,n=this.json,r=this.extensions,i=n.meshes[t],o=i.primitives,s=[],a=0,u=o.length;a<u;a++){var l=void 0===o[a].material?L(this.cache):this.getDependency("material",o[a].material);s.push(l)}return s.push(e.loadGeometries(o)),Promise.all(s).then((function(n){for(var s=n.slice(0,n.length-1),a=n[n.length-1],u=[],l=0,c=a.length;l<c;l++){var h,p=a[l],d=o[l],f=s[l];if(d.mode===_.TRIANGLES||d.mode===_.TRIANGLE_STRIP||d.mode===_.TRIANGLE_FAN||void 0===d.mode)h=!0===i.isSkinnedMesh?new tp(p,f):new as(p,f),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===_.TRIANGLE_STRIP?h.geometry=G(h.geometry,Hn):d.mode===_.TRIANGLE_FAN&&(h.geometry=G(h.geometry,jn));else if(d.mode===_.LINES)h=new xp(p,f);else if(d.mode===_.LINE_STRIP)h=new mp(p,f);else if(d.mode===_.LINE_LOOP)h=new _p(p,f);else{if(d.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new Tp(p,f)}Object.keys(h.geometry.morphAttributes).length>0&&O(h,i),h.name=e.createUniqueName(i.name||"mesh_"+t),R(h,i),d.extensions&&I(r,h,d),e.assignFinalMaterial(h),u.push(h)}if(1===u.length)return u[0];var g=new yh;for(l=0,c=u.length;l<c;l++)g.add(u[l]);return g}))},k.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new vs(Nr.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new mg(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),R(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},k.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},k.prototype.loadAnimation=function(t){for(var e=this.json,n=e.animations[t],r=[],i=[],o=[],s=[],a=[],u=0,l=n.channels.length;u<l;u++){var c=n.channels[u],h=n.samplers[c.sampler],p=c.target,d=void 0!==p.node?p.node:p.id,f=void 0!==n.parameters?n.parameters[h.input]:h.input,g=void 0!==n.parameters?n.parameters[h.output]:h.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",f)),o.push(this.getDependency("accessor",g)),s.push(h),a.push(p)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(a)]).then((function(e){for(var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=[],l=0,c=r.length;l<c;l++){var h=r[l],p=i[l],d=o[l],f=s[l],g=a[l];if(void 0!==h){var m;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,T[g.path]){case T.weights:m=af;break;case T.rotation:m=lf;break;case T.position:case T.scale:default:m=hf;break}var y=h.name?h.name:h.uuid,v=void 0!==f.interpolation?C[f.interpolation]:Dn,_=[];T[g.path]===T.weights?h.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&_.push(t.name?t.name:t.uuid)})):_.push(y);var b=d.array;if(d.normalized){var w;if(b.constructor===Int8Array)w=1/127;else if(b.constructor===Uint8Array)w=1/255;else if(b.constructor==Int16Array)w=1/32767;else{if(b.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var M=new Float32Array(b.length),E=0,S=b.length;E<S;E++)M[E]=b[E]*w;b=M}for(E=0,S=_.length;E<S;E++){var A=new m(_[E]+"."+T[g.path],p.array,b,v);"CUBICSPLINE"===f.interpolation&&(A.createInterpolant=function(t){return new x(this.times,this.values,this.getValueSize()/3,t)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(A)}}}var P=n.name?n.name:"animation_"+t;return new pf(P,void 0,u)}))},k.prototype.loadNode=function(t){var e=this.json,n=this.extensions,r=this,i=e.nodes[t],o=i.name?r.createUniqueName(i.name):"";return function(){var e=[];return void 0!==i.mesh&&e.push(r.getDependency("mesh",i.mesh).then((function(t){var e=r._getNodeRef(r.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))),void 0!==i.camera&&e.push(r.getDependency("camera",i.camera).then((function(t){return r._getNodeRef(r.cameraCache,i.camera,t)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){var s;if(s=!0===i.isBone?new ep:e.length>1?new yh:1===e.length?e[0]:new Yi,s!==e[0])for(var a=0,u=e.length;a<u;a++)s.add(e[a]);if(i.name&&(s.userData.name=i.name,s.name=o),R(s,i),i.extensions&&I(n,s,i),void 0!==i.matrix){var l=new wi;l.fromArray(i.matrix),s.applyMatrix4(l)}else void 0!==i.translation&&s.position.fromArray(i.translation),void 0!==i.rotation&&s.quaternion.fromArray(i.rotation),void 0!==i.scale&&s.scale.fromArray(i.scale);return r.associations.set(s,{type:"nodes",index:t}),s}))},k.prototype.loadScene=function(){function t(e,n,r,i){var o=r.nodes[e];return i.getDependency("node",e).then((function(t){return void 0===o.skin?t:i.getDependency("skin",o.skin).then((function(t){e=t;for(var n=[],r=0,o=e.joints.length;r<o;r++)n.push(i.getDependency("node",e.joints[r]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var r=[],i=[],o=0,s=n.length;o<s;o++){var a=n[o];if(a){r.push(a);var u=new wi;void 0!==e.inverseBindMatrices&&u.fromArray(e.inverseBindMatrices.array,16*o),i.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}t.bind(new ip(r,i),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var s=[];if(o.children)for(var a=o.children,u=0,l=a.length;u<l;u++){var c=a[u];s.push(t(c,e,r,i))}return Promise.all(s)}))}return function(e){var n=this.json,r=this.extensions,i=this.json.scenes[e],o=this,s=new yh;i.name&&(s.name=o.createUniqueName(i.name)),R(s,i),i.extensions&&I(r,s,i);for(var a=i.nodes||[],u=[],l=0,c=a.length;l<c;l++)u.push(t(a[l],s,n,o));return Promise.all(u).then((function(){return s}))}}(),t}();class vw extends dw{constructor(t,e=!0,n=1){super(),this.reloadTimes=3,this.modelInitialized=!1,this.modelLoaded=!1,this.globalScale=n,this.renderWithTexture=!0,this.setGroundParameters({downDirection:new Wr(0,0,-1)}),this.viewConfigurations=new Map,this.boundingBoxMesh=new as,this.boundingBoxMesh.visible=!1,this.add(this.boundingBoxMesh),t&&this.load(t,e)}setGroundParameters(t){this.groundParams=t}loadBox(t,e,n){this.boxMesh&&(this.remove(this.boxMesh),fw.dispose(this.boxMesh)),this.modelInitialized=!1,this.modelLoaded=!0;const r=new cs(t,e,n),i=new Hd({color:0,side:ct});this.meshMaterial=i;const o=new as(r,i);this.add(o),this.boxMesh=o;const s=!0;s?this.bvh=cw.createBVHTree(o):this.raycaster=new Sm;const a=(new Xr).setFromObject(o),{max:u,min:l}=a;this.boundingBoxMesh.geometry=new cs(u.x-l.x,u.y-l.y,u.z-l.z),this.boundingBoxMesh.position.copy(u.clone().add(l.clone()).multiplyScalar(.5)),this.emit(uw.ELEMENT_LOADED,this)}load(t,e=!0,n=0){this.modelInitialized=!1,this.modelLoaded=!1;const r=new yw;r.load(t,t=>{this.add(t.scene),this.modelLoaded=!0,t.scene.traverse(t=>{t instanceof as&&(this.mesh=t,this.meshMaterial=t.material,t.geometry.scale(this.globalScale,this.globalScale,this.globalScale))}),e?this.bvh=cw.createBVHTree(t.scene):this.raycaster=new Sm;const n=(new Xr).setFromObject(t.scene),{max:r,min:i}=n;this.boundingBoxMesh.geometry=new cs(r.x-i.x,r.y-i.y,r.z-i.z),this.boundingBoxMesh.position.copy(r.clone().add(i.clone()).multiplyScalar(.5)),this.emit(uw.ELEMENT_LOADED,this)},void 0,r=>{const i=n+1;i>this.reloadTimes?this.emit(aw.ELEMENT_LOADED_ERROR,this,r):this.load(t,e,i)})}isModelLoaded(){return this.modelLoaded}setIfRenderWithTexture(t){this.renderWithTexture=t}update(){const t=new pw(this);return!this.modelInitialized&&this.modelLoaded&&(this.modelInitialized=!0,t.needUpdate=!0),this.modelInitialized&&!this.parent&&(t.shouldPlaceElement=!0),t}renderingViewChanged(t){let e={visible:!0};this.viewConfigurations.has(t)&&(e=this.viewConfigurations.get(t)),this.visible=e.visible,this.mesh&&(this.renderWithTexture?this.mesh.material=e.meshMaterial||this.meshMaterial:this.mesh.material=this.meshMaterial)}addViewConfiguration(t){const e=this.viewConfigurations.get(t.targetView);!t.meshMaterial&&e&&(t.meshMaterial=e.meshMaterial),this.viewConfigurations.set(t.targetView,t)}dispose(){super.dispose(),fw.dispose(this,!0)}getBVHTree(){return this.bvh}intersectRay(t,e,n){if(!this.bvh)return null;const r=this.bvh.intersectRay(t,e,n);return r}static intersectWithGroundPlane(t,e){const n=e.downDirection;if(e.groundPlane){const{a:r,b:i,c:o,d:s}=e.groundPlane,a=r*n.x+i*n.y+o*n.z,u=-r*t.x-i*t.y-o*t.z-s,l=u/a;if(!Number.isNaN(l)&&Number.isFinite(l)){const e=new Wr(t.x+l*n.x,t.y+l*n.y,t.z+l*n.z);if(e.clone().sub(t).dot(n)>=0)return e}}return null}nearestIntersectionWithRaycaster(t,e){this.raycaster.set(t,e);const n=this.raycaster.intersectObject(this.children[0],!0);if(0===n.length)return null;let r=null,i=Number.MAX_VALUE;for(let o=0;o<n.length;o+=1){const t=n[o],e=t.distance;e>=0&&e<i&&(r=t.point.clone(),i=e)}return r}intersectGround(t){let e=vw.intersectWithGroundPlane(t,this.groundParams);if(e)return e;if(this.bvh){const n=this.bvh.nearestIntersection(t,this.groundParams.downDirection);n&&(e=n.intersectionPoint)}else this.raycaster&&(e=this.nearestIntersectionWithRaycaster(t,this.groundParams.downDirection));return e}getMeshMaterial(){return this.mesh.material}}class xw{static getAngle(t,e){const n=t.clone().normalize(),r=e.clone().normalize();return Math.acos(n.dot(r))}static simplify(t,e=!1,n=!0,r=5,i=150,o=3){const s=[];let a=!e;if(s.push(t[0]),t.length<2)return s;for(let l=0;l<t.length-2;l+=1){const e=t[l],n=t[l+1],o=t[l+2],u=new Or(e.x-n.x,e.y-n.y),c=new Or(o.x-n.x,o.y-n.y),h=xw.getAngle(u,c)/Math.PI*180,p=u.length()+c.length();(!a||h<i&&p>.01||p>r)&&(s.push(t[l+1]),a=!0)}if(s.push(t[t.length-1]),!n)return s;const u=[];u.push(s[0]);for(let l=0;l<s.length-2;l+=1){const t=new Or(s[l].x,s[l].y),e=new Or(s[l+1].x,s[l+1].y),n=new Or(s[l+2].x,s[l+2].y),r=t.distanceTo(e)/2,i=n.distanceTo(e)/2,a=e.clone(),c=e.clone();a.add(t.clone().sub(e).normalize().multiplyScalar(r>o?o/2:r)),c.add(n.clone().sub(e).normalize().multiplyScalar(i>o?o/2:i));const h=[[a.x,a.y],[e.x,e.y],[c.x,c.y]];u.push(...xw.smoothPath(h,o/25).map(t=>({x:t[0],y:t[1]})))}return u.push(s[s.length-1]),u}static averageStepLength(t){let e=0;return t.reduce(([t,n],[r,i])=>(e+=Math.sqrt(Math.pow(r-t,2)+Math.pow(i-n,2)),[r,i])),e/t.length}static smoothPath(t,e=.25){if(xw.averageStepLength(t)<e)return t;const n=mw()(t);return xw.smoothPath(n,e)}static getRenderHeight(t,e,n){const[r,i,o,s]=t,a=-(r*e+i*n+s)/o+.2;return a}static getPointHash(t,e,n,r,i=1){const o=t-n,s=e-r;return[(o-o%i)/i,(s-s%i)/i]}static generatePathMesh(t,e){const{viewDistance:n=10,gradientDistance:r=2,arrowImageRatio:i=1,arrowImageURL:o,floorModel:s,groundParams:a,color:u,dynamicPathEnabled:l,width:c=.3}=e||{},h=xw.simplify(t,!0),p=h.map(t=>[t.x,t.y]),d=[],f=[0],g=[0];p.reduce(([t,e],[n,r],i)=>{d.push(new Or(e-r,n-t).normalize());const o=Math.sqrt(Math.pow(t-n,2)+Math.pow(e-r,2));return f.push(f[i-1]+o),[n,r]});for(let W=0,q=f.length;W<q;W+=1)g[W]=f[W]/f[q-1];const m=[],y=[],v=c;d.forEach((t,e)=>{if(0===e){const[e,n]=p[0];m.push([e+t.x*v,n+t.y*v]),y.push([e-t.x*v,n-t.y*v])}const[n,r]=p[e+1];m.push([n+t.x*v,r+t.y*v]),y.push([n-t.x*v,r-t.y*v])}),y.reverse();const x=new ng;x.moveTo(...m[0]),m.forEach((t,e)=>{0!==e&&x.lineTo(...t)}),y.forEach(t=>{x.lineTo(...t)}),x.lineTo(...m[0]);const _=new Id(x),b=i/v*.5;let w=!1;l&&(w=!0);const M={arrowTexcoordScaleT:{value:b},current:{value:0},dynamic:{value:w},full_length:{value:f[f.length-1]},view_distance:{value:n},gradient_distance:{value:r}};o&&(new Tf).load(o,t=>{t.wrapS=oe,t.wrapT=oe,t.generateMipmaps=!0,t.minFilter=ye,t.magFilter=ye,t.image&&t.image.width&&t.image.height&&(M.arrowTexcoordScaleT.value=t.image.width/t.image.height/v*.5)});const E=new ms({vertexShader:"\n        attribute vec3 a_color;\n        attribute vec2 a_texcoord;\n        attribute float progress;\n        varying float vProgress;\n        varying vec3 vColor;\n        varying vec2 vTexcoord;\n        void main() {\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            vProgress = progress;\n            vColor = a_color;\n            vTexcoord = a_texcoord;\n        }\n        ",fragmentShader:"\n        precision mediump float;\n        varying float vProgress;\n        varying vec3 vColor;\n        varying vec2 vTexcoord;\n        uniform float current;\n        uniform bool dynamic;\n        uniform float full_length;\n        uniform float view_distance;\n        uniform float gradient_distance;\n        // uniform sampler2D arrowTexture;\n        uniform float arrowTexcoordScaleT;\n        float alpha;\n        float cur;\n        bool dy;\n        void main() {\n            alpha = 0.8;\n            cur = current;\n            dy = dynamic;\n            if (vProgress < cur) {\n            alpha = 0.0;\n            } else {\n            if (vProgress > cur + view_distance) {\n                alpha = 0.0;\n            } else {\n                if (vProgress > cur + gradient_distance) {\n                  alpha = 0.8;\n                  if (cur > full_length - view_distance) {\n                      cur = full_length - view_distance;\n                  }\n                  if (vProgress > cur + view_distance - gradient_distance) {\n                      alpha = abs(cur + view_distance - vProgress) / gradient_distance * 0.8;\n                  }\n                } else {\n                  alpha = abs(vProgress - cur) / gradient_distance * 0.8;\n                }\n            }\n            }\n\n            // vec4 textureColor = texture2D(arrowTexture, vec2(vTexcoord.s, vTexcoord.t * arrowTexcoordScaleT));\n            // gl_FragColor = vec4((1.0 - textureColor.a) * vColor + textureColor.a * textureColor.rgb, 0.8);\n            if(dy) {\n              gl_FragColor = vec4(vColor,alpha);\n            } else {\n              gl_FragColor = vec4(vColor,0.8);\n            }\n\n        }\n        ",uniforms:M,side:ct,depthTest:!w});let S=Number.MAX_SAFE_INTEGER,T=Number.MAX_SAFE_INTEGER;const{array:C,count:A}=_.attributes.position;for(let W=0,q=0;W<A;W+=1,q+=3){const t=C[q],e=C[q+1];C[q]<S&&(S=t),C[q+1]<T&&(T=e)}if(a&&a.groundPlane)for(let W=0,q=0;W<A;W+=1,q+=3){const t=C[q],e=C[q+1];let n=.5;const r=vw.intersectWithGroundPlane(new Wr(t,e,n),a);r&&(n=r.z+xw.PathMeshOffsetZ),C[q+2]=n}else{const t=()=>{if(s&&s.isModelLoaded()){for(let t=0,e=0;t<A;t+=1,e+=3){const t=C[e],n=C[e+1];let r=.5;const i=s.intersectGround(new Wr(t,n,r));i&&(r=i.z+xw.PathMeshOffsetZ),C[e+2]=r}_.attributes.position.needsUpdate=!0}};s&&s.isModelLoaded()&&t(),ow.on(uw.ELEMENT_LOADED,e=>{e instanceof vw&&e===s&&t()})}_.attributes.position.needsUpdate=!0;const P=[];if(o){const t=new Ls(.5*v/.3,.5*v/.3),e=new xo({color:16777215,transparent:!0,opacity:.8,blending:ft,side:ct,depthTest:!w}),n=(new Tf).load(o);n.needsUpdate=!0,e.needsUpdate=!0,e.map=n;const r=new as(t,e);for(let i=0,o=.8,u=p.length;i<u;i+=1)if(f[i]>o){o+=.8;const[t,n]=p[i],{x:l,y:c}=d[i===u-1?i-1:i],h=r.clone();if(h.position.set(t,n,-.5),a){const e=vw.intersectWithGroundPlane(new Wr(t,n,2),a);e&&(e.z+=xw.ArrowMeshOffsetZ,h.position.copy(e))}else if(s){const e=s.intersectGround(new Wr(t,n,2));e&&(e.z+=xw.ArrowMeshOffsetZ,h.position.copy(e))}h.material=e.clone(),h.rotateZ(new Or(c,-l).angle()-.5*Math.PI),P.push({arrowMesh:h,index:i})}}const L=Math.floor(S),I=Math.floor(T),R=new Map;p.forEach(([t,e],n)=>{const[r,i]=xw.getPointHash(t,e,L,I,25);R.has(""+r)||R.set(""+r,new Map);const o=R.get(""+r);o.has(""+i)||o.set(""+i,[]),o.get(""+i).push([n,t,e])});const N=new Float32Array(A),O=new Float32Array(3*A);let D=1,F=140/255,k=0,B=240/255,z=68/255,G=55/255;if(u){const t=[];for(let e=2;e<8;e+=2)t.push(parseInt("0x"+u.slice(e,e+2)));D=t[0]/255,F=t[1]/255,k=t[2]/255,B=t[0]/255,z=t[1]/255,G=t[2]/255}const U=B-D,V=z-F,H=G-k;for(let W=0,q=0;W<A;W+=1,q+=3){const t=C[q],e=C[q+1],[n,r]=xw.getPointHash(t,e,L,I,25);let i=Number.MAX_SAFE_INTEGER;R.has(""+n)&&R.get(""+n).has(""+r)&&R.get(""+n).get(""+r).forEach(([n,r,o])=>{const s=Math.pow(t-r,2)+Math.pow(e-o,2);if(s>i)return;i=s;const a=f[n],u=g[n];N[W]=a,O[3*W]=D+u*U,O[3*W+1]=F+u*V,O[3*W+2]=k+u*H})}_.addAttribute("progress",new wo(N,1)),_.addAttribute("a_color",new wo(O,3)),E.transparent=!0;const j=new as(_,E);return{mesh:j,arrowMeshes:P,newPath:p,pointMap:R,pathMinX:L,pathMinY:I,progressBuffer:N,pathDistance:f}}}xw.PathMeshOffsetZ=.1,xw.ArrowMeshOffsetZ=.2;class _w{static getLineCross(t,e,n,r){const i=Math.min(n.x,r.x)>Math.max(t.x,e.x),o=Math.min(n.y,r.y)>Math.max(t.y,e.y),s=Math.min(t.x,e.x)>Math.max(n.x,r.x),a=Math.min(t.y,e.y)>Math.max(n.y,r.y);if(i||o||s||a)return!1;const u=(t,e)=>t.x*e.y-t.y*e.x,l=(t,e,n,r)=>{let i={x:t.x-n.x,y:n.y-t.y},o={x:e.x-n.x,y:e.y-n.y},s={x:r.x-n.x,y:r.y-n.y};const a=u(i,s)*u(o,s);return i={x:n.x-t.x,y:n.y-t.y},o={x:r.x-t.x,y:r.y-t.y},s={x:e.x-t.x,y:e.y-t.y},!!(a<=0&&u(i,s)*u(o,s)<=0)},c=l(t,e,n,r);return c}static calcTurning(t,e=[2,20]){const n=t.length;if(n<2)return[];const r=[],i=(t,e)=>{const{x:n,y:r}=t,{x:i,y:o}=e,s=n*i+r*o,a=n*o-r*i,u=Math.atan2(a,s)/Math.PI*180;return Math.round(u+360)%360};let o=!1,s=0,a=[0,0],u=[0,0],l=[0,0],c=0,h=0;for(let p=1;p<n-1;p++){const n=t[p-1],d=t[p],f=t[p+1],g=i({x:f[0]-d[0],y:f[1]-d[1]},{x:d[0]-n[0],y:d[1]-n[1]}),m=g>=e[0]&&g<=e[1]||g>=360-e[1]&&g<=360-e[0];!o&&m?(o=!0,u=d,s+=g,c=p):o&&m?s+=g:o&&!m?(s+=g,h=p,l=d,a=[(u[0]+l[0])/2,(u[1]+l[1])/2],r.push({point:a,angle:s%360,startTPoint:u,endTPoint:l,startIndex:c,endIndex:h}),o=!1):o||m||(c=h=0,s=0,a=[0,0],u=[0,0],l=[0,0])}return o&&(l=t[n-1],h=n-1,a=[(u[0]+l[0])/2,(u[1]+l[1])/2],r.push({point:a,angle:s%360,startTPoint:u,endTPoint:l,startIndex:c,endIndex:h}),o=!1),r}static chunk(t,e){if(t.length<=0||e<=0)return t;const n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}}var bw=n("22b5");n("3191");n("362d");var ww={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};function Mw(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Mw.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Mw.FullScreenQuad=function(){var t=new mg(-1,1,1,-1,0,1),e=new Ho;e.setAttribute("position",new Io([-1,3,0,-1,-1,0,3,-1,0],3)),e.setAttribute("uv",new Io([0,2,0,0,2,0],2));var n=function(t){this._mesh=new as(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}();var Ew=function(t,e){Mw.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof ms?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=ds.clone(t.uniforms),this.material=new ms({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Mw.FullScreenQuad(this.material)};Ew.prototype=Object.assign(Object.create(Mw.prototype),{constructor:Ew,render:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var Sw=function(t,e){Mw.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};Sw.prototype=Object.assign(Object.create(Mw.prototype),{constructor:Sw,render:function(t,e,n){var r,i,o=t.getContext(),s=t.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.buffers.stencil.setFunc(o.ALWAYS,r,4294967295),s.buffers.stencil.setClear(i),s.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(o.EQUAL,1,4294967295),s.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),s.buffers.stencil.setLocked(!0)}});var Tw=function(){Mw.call(this),this.needsSwap=!1};Tw.prototype=Object.create(Mw.prototype),Object.assign(Tw.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var Cw=function(t,e){if(this.renderer=t,void 0===e){var n={minFilter:de,magFilter:de,format:Re},r=t.getSize(new Or);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,e=new Vr(this._width*this._pixelRatio,this._height*this._pixelRatio,n),e.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===ww&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Ew&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Ew(ww),this.clock=new qg};Object.assign(Cw.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)},isLastEnabledPass:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var e,n,r=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(n=0;n<o;n++)if(e=this.passes[n],!1!==e.enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var s=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),a.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Sw&&(e instanceof Sw?i=!0:e instanceof Tw&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(t){if(void 0===t){var e=this.renderer.getSize(new Or);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,t=this.renderTarget1.clone(),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this._width=t,this._height=e;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var Aw=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Aw.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Aw.FullScreenQuad=function(){var t=new mg(-1,1,1,-1,0,1),e=new Ho;e.setAttribute("position",new Io([-1,3,0,-1,-1,0,3,-1,0],3)),e.setAttribute("uv",new Io([0,2,0,0,2,0],2));var n=function(t){this._mesh=new as(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}();var Pw=function(t,e,n,r){Mw.call(this),this.scene=t,this.camera=e,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==r?r:0,this._oldClearColor=new vo,void 0===ww&&console.error("THREE.SSAARenderPass relies on CopyShader");var i=ww;this.copyUniforms=ds.clone(i.uniforms),this.copyMaterial=new ms({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:gt,depthTest:!1,depthWrite:!1}),this.fsQuad=new Mw.FullScreenQuad(this.copyMaterial)};Pw.prototype=Object.assign(Object.create(Mw.prototype),{constructor:Pw,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,e){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,e)},render:function(t,e,n){this.sampleRenderTarget||(this.sampleRenderTarget=new Vr(n.width,n.height,{minFilter:de,magFilter:de,format:Re}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var r=Pw.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=t.autoClear;t.autoClear=!1,t.getClearColor(this._oldClearColor);var o=t.getClearAlpha(),s=1/r.length,a=1/32;this.copyUniforms["tDiffuse"].value=this.sampleRenderTarget.texture;for(var u=n.width,l=n.height,c=0;c<r.length;c++){var h=r[c];this.camera.setViewOffset&&this.camera.setViewOffset(u,l,.0625*h[0],.0625*h[1],u,l);var p=s;if(this.unbiased){var d=(c+.5)/r.length-.5;p+=a*d}this.copyUniforms["opacity"].value=p,t.setClearColor(this.clearColor,this.clearAlpha),t.setRenderTarget(this.sampleRenderTarget),t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(this.renderToScreen?null:e),0===c&&(t.setClearColor(0,0),t.clear()),this.fsQuad.render(t)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=i,t.setClearColor(this._oldClearColor,o)}}),Pw.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Lw=function(t){Yi.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))};Lw.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Lw,copy:function(t,e){return Yi.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}});var Iw=function(t){Yi.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))};Iw.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Iw,copy:function(t,e){return Yi.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}});var Rw=function(t){Iw.call(this,t)};Rw.prototype=Object.create(Iw.prototype),Rw.prototype.constructor=Rw;var Nw,Ow;(function(t){t[t["IDLE"]=0]="IDLE",t[t["DOWN"]=1]="DOWN",t[t["MOVE"]=2]="MOVE"})(Nw||(Nw={}));(function(t){t[t["IDLE"]=0]="IDLE",t[t["DOWN"]=1]="DOWN",t[t["MOVE"]=2]="MOVE"})(Ow||(Ow={}));var Dw=n("6929"),Fw=n.n(Dw);var kw=function(){Sg.call(this),this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new Io(t,3)),this.setAttribute("uv",new Io(e,2))};kw.prototype=Object.assign(Object.create(Sg.prototype),{constructor:kw,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new Mm(e,6,1);return this.setAttribute("instanceStart",new Ph(n,3,0)),this.setAttribute("instanceEnd",new Ph(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new Mm(e,6,1);return this.setAttribute("instanceColorStart",new Ph(n,3,0)),this.setAttribute("instanceColorEnd",new Ph(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new zd(t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;if(!e.isGeometry)return e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")},computeBoundingBox:function(){var t=new Xr;return function(){null===this.boundingBox&&(this.boundingBox=new Xr);var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==e&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(n),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new Wr;return function(){null===this.boundingSphere&&(this.boundingSphere=new di),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var i=0,o=0,s=e.count;o<s;o++)t.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(t)),t.fromBufferAttribute(n,o),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}),$u.line={linewidth:{value:1},resolution:{value:new Or(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},tl["line"]={uniforms:ds.merge([$u.common,$u.fog,$u.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef ALPHA_TO_COVERAGE\n\n\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\tfloat a = vUv.x;\n\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\tfloat len2 = a * a + b * b;\n\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t}\n\n\t\t\t#else\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var Bw=function(t){ms.call(this,{type:"LineMaterial",uniforms:ds.clone(tl["line"].uniforms),vertexShader:tl["line"].vertexShader,fragmentShader:tl["line"].fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),t?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)};Bw.prototype=Object.create(ms.prototype),Bw.prototype.constructor=Bw,Bw.prototype.isLineMaterial=!0;var zw=function(t,e){void 0===t&&(t=new kw),void 0===e&&(e=new Bw({color:16777215*Math.random()})),as.call(this,t,e),this.type="LineSegments2"};zw.prototype=Object.assign(Object.create(as.prototype),{constructor:zw,isLineSegments2:!0,computeLineDistances:function(){var t=new Wr,e=new Wr;return function(){for(var n=this.geometry,r=n.attributes.instanceStart,i=n.attributes.instanceEnd,o=new Float32Array(2*r.count),s=0,a=0,u=r.count;s<u;s++,a+=2)t.fromBufferAttribute(r,s),e.fromBufferAttribute(i,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+t.distanceTo(e);var l=new Mm(o,2,1);return n.setAttribute("instanceDistanceStart",new Ph(l,1,0)),n.setAttribute("instanceDistanceEnd",new Ph(l,1,1)),this}}(),raycast:function(){var t=new Ur,e=new Ur,n=new Ur,r=new Wr,i=new wi,o=new Om,s=new Wr,a=new Xr,u=new di,l=new Ur;return function(c,h){null===c.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var p=void 0!==c.params.Line2&&c.params.Line2.threshold||0,d=c.ray,f=c.camera,g=f.projectionMatrix,m=this.matrixWorld,y=this.geometry,v=this.material,x=v.resolution,_=v.linewidth+p,b=y.attributes.instanceStart,w=y.attributes.instanceEnd,M=-f.near,E=2*Math.max(_/x.width,_/x.height);null===y.boundingSphere&&y.computeBoundingSphere(),u.copy(y.boundingSphere).applyMatrix4(m);var S=Math.max(f.near,u.distanceToPoint(d.origin));l.set(0,0,-S,1).applyMatrix4(f.projectionMatrix),l.multiplyScalar(1/l.w),l.applyMatrix4(f.projectionMatrixInverse);var T=.5*Math.abs(E/l.w);if(u.radius+=T,!1!==c.ray.intersectsSphere(u)){null===y.boundingBox&&y.computeBoundingBox(),a.copy(y.boundingBox).applyMatrix4(m);var C=Math.max(f.near,a.distanceToPoint(d.origin));l.set(0,0,-C,1).applyMatrix4(f.projectionMatrix),l.multiplyScalar(1/l.w),l.applyMatrix4(f.projectionMatrixInverse);var A=.5*Math.abs(E/l.w);if(a.max.x+=A,a.max.y+=A,a.max.z+=A,a.min.x-=A,a.min.y-=A,a.min.z-=A,!1!==c.ray.intersectsBox(a)){d.at(1,n),n.w=1,n.applyMatrix4(f.matrixWorldInverse),n.applyMatrix4(g),n.multiplyScalar(1/n.w),n.x*=x.x/2,n.y*=x.y/2,n.z=0,r.copy(n),i.multiplyMatrices(f.matrixWorldInverse,m);for(var P=0,L=b.count;P<L;P++){t.fromBufferAttribute(b,P),e.fromBufferAttribute(w,P),t.w=1,e.w=1,t.applyMatrix4(i),e.applyMatrix4(i);var I=t.z>M&&e.z>M;if(!I){if(t.z>M){const n=t.z-e.z,r=(t.z-M)/n;t.lerp(e,r)}else if(e.z>M){const n=e.z-t.z,r=(e.z-M)/n;e.lerp(t,r)}t.applyMatrix4(g),e.applyMatrix4(g),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w),t.x*=x.x/2,t.y*=x.y/2,e.x*=x.x/2,e.y*=x.y/2,o.start.copy(t),o.start.z=0,o.end.copy(e),o.end.z=0;var R=o.closestPointToPointParameter(r,!0);o.at(R,s);var N=Nr.lerp(t.z,e.z,R),O=N>=-1&&N<=1,D=r.distanceTo(s)<.5*_;if(O&&D){o.start.fromBufferAttribute(b,P),o.end.fromBufferAttribute(w,P),o.start.applyMatrix4(m),o.end.applyMatrix4(m);var F=new Wr,k=new Wr;d.distanceSqToSegment(o.start,o.end,k,F),h.push({point:k,pointOnLine:F,distance:d.origin.distanceTo(k),object:this,face:null,faceIndex:P,uv:null,uv2:null})}}}}}}}()});class Gw{constructor(t,e){this.values=new Map,this.capacity=t,this.totalCost=0,this.costCallback=e}get(t,e){const n=this.values.has(t);let r;return n?(r=this.values.get(t),r&&(this.values.delete(t),this.values.set(t,r))):e&&(r=e(t),r&&this.put(t,r)),r}put(t,e,n,r=!1){let i=!1;if(this.totalCost>=this.capacity){if(r)return i;const t=this.values.keys().next().value,e=this.values.get(t);if(e){const r=void 0===this.costCallback?1:this.costCallback(e);this.totalCost-=r,n&&n(t,e),this.values.delete(t)}i=!0}if(this.values.has(t)){let n=1;const r=this.values.get(t);r&&this.costCallback&&(n=this.costCallback(r));const i=void 0===this.costCallback?1:this.costCallback(e);this.values.set(t,e),this.totalCost+=i-n}else{this.values.set(t,e);const n=void 0===this.costCallback?1:this.costCallback(e);this.totalCost+=n}return i}recycle(t,e){let n=!1;const r=this.values.get(t);if(r){n=!0;const i=void 0===this.costCallback?1:this.costCallback(r);this.totalCost-=i,e&&e(t,r),this.values.delete(t)}return n}clear(t){this.values.forEach((e,n)=>{e&&t(n,e)}),this.totalCost=0,this.values.clear()}getCapacity(){return this.capacity}getTotalCost(){return this.totalCost}}var Uw=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};class Vw{constructor(t){this.textureLoader=new Tf,this.textureCache=new Gw(t),this.workingTasks=new Map}static disposeAll(){this.hdFaceTexturesCache.dispose(),this.ldFaceTexturesCache.dispose()}static get hdFaceTexturesCache(){return Vw.sharedHdFaceTextureCache||(Vw.sharedHdFaceTextureCache=new Vw(32)),Vw.sharedHdFaceTextureCache}static get ldFaceTexturesCache(){return Vw.sharedLdFaceTextureCache||(Vw.sharedLdFaceTextureCache=new Vw(32)),Vw.sharedLdFaceTextureCache}dispose(){this.textureCache.clear((t,e)=>{e.dispose()})}loadTexture(t,e=!0){return Uw(this,void 0,void 0,(function*(){const n=this.textureCache.get(t);if(n)return n;let r=this.workingTasks.get(t);return r||(r=new Promise((n,r)=>{this.textureLoader.load(t,r=>{this.textureCache.put(t,r,(t,e)=>{e.dispose()},!e),this.workingTasks.delete(t),n(r)},()=>{},e=>{ow.emit("error",`Loading '${t}' failed.`),this.workingTasks.delete(t),r(e)})}),this.workingTasks.set(t,r)),r}))}preloadTextures(t,e){return Uw(this,void 0,void 0,(function*(){const n=e>t.length?t.length:e,r=t.map((t,n)=>{if(t)return this.loadTexture(t,n<e)}),i=[];for(let t=0;t<n;t+=1){const e=r[t];e&&i.push(e)}return Promise.all(i)}))}recycleTexture(t){return this.textureCache.recycle(t,(t,e)=>{e.dispose()})}getCapacity(){return this.textureCache.getCapacity()}getTotalCost(){return this.textureCache.getTotalCost()}}var Hw=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};class jw{constructor(t){this.cubeTextureCache=new Gw(t),this.workingTasks=new Map}static disposeAll(){this.sharedInstance.dispose()}dispose(){this.cubeTextureCache.clear((t,e)=>{e.dispose()})}loadCubeTexture(t,e,n){return Hw(this,void 0,void 0,(function*(){const r=this.cubeTextureCache.get(t[0]);if(r)return r;let i=this.workingTasks.get(t[0]);return i||(i=new Promise(r=>Hw(this,void 0,void 0,(function*(){const i=yield Vw.ldFaceTexturesCache.preloadTextures(t,t.length),o=i.map(t=>t.image),s=new ws(o);s.needsUpdate=!0,!0===n&&t.forEach(t=>{Vw.ldFaceTexturesCache.recycleTexture(t)}),this.cubeTextureCache.put(t[0],s,(t,e)=>{e.dispose()},!e),this.workingTasks.delete(t[0]),r(s)}))),this.workingTasks.set(t[0],i)),i}))}preloadCubeTextures(t,e,n){return Hw(this,void 0,void 0,(function*(){const r=e>t.length?t.length:e,i=t.map((t,e)=>{if(t)return n?this.loadCubeTexture(t,e<r,n[e]):this.loadCubeTexture(t,e<r)}),o=[];for(let t=0;t<r;t+=1){const e=i[t];e&&o.push(e)}return Promise.all(o)}))}recycleCubeTexture(t){this.cubeTextureCache.recycle(t[0],(t,e)=>{e.dispose()})}getCapacity(){return this.cubeTextureCache.getCapacity()}}jw.sharedInstance=new jw(3);var Ww=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};class qw extends dw{constructor(t,e,n,r,i=[],o,s,a,u,l,c=!1){super(),this.pid=t,this.seqID=e,this.highTextureURLs=o||[],this.textureURLs=n,this.useLowTextureURLsOnly=!!s,this.tiledTextureURLRoot=a,this.neighborPanoramaIDs=i,this.viewConfigurations=new Map,this.panoViews=new Set,this.ifRenderSkyBox=!0,this.initialized=!1,this.needsUpdate=!1,this.legacyMode=c;const h=new cs(2,2,2);this.wireFrame=new xp(new Up(h),new cp({color:16711680})),this.wireFrame.material.visible=!1,this.wireFrame.renderOrder=100,this.add(this.wireFrame);const p=new Nd(1,60,40);if(p.scale(1,-1,1),p.rotateY(-90*Math.PI/180),this.sphereMesh=new as(p),this.sphereMesh.visible=!1,this.sphereMesh.renderOrder=150,this.add(this.sphereMesh),this.isPlayingVideo=!1,this.videoCanvas=null,this.videoContentType="mp4",this.legacyMode){const t="\n        varying vec3 v_position;\n        void main(){\n            v_position = position;\n            v_position.y = v_position.y * -1.0;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",e="\n        uniform samplerCube tCube;\n        varying vec3 v_position;\n        void main(){\n            gl_FragColor = textureCube(tCube, v_position);\n        }",n={tCube:{type:"t",value:null}};this.uniforms=n,this.material=new ms({fragmentShader:e,vertexShader:t,uniforms:n,depthTest:!1,side:lt}),this.skyBox=new as(new Nd(2,32,32)),this.skyBox.frustumCulled=!1,this.skyBox.material=this.material,this.skyBox.renderOrder=100,this.add(this.skyBox),this.updateTexture()}else{const t="\n        varying vec2 vUv;\n        void main(){\n           vUv = uv;\n           gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",e="\n          uniform sampler2D tFaceTexture;\n          uniform vec2 uvScalar;\n          uniform vec2 uvOffset;\n          uniform vec4 blendColor;\n          varying vec2 vUv;\n          void main(){\n            vec2 UV = vUv * uvScalar + uvOffset;\n             vec4 texColor = texture2D(tFaceTexture, vec2(UV.s, 1.0 - UV.t));\n             gl_FragColor = (1.0 - blendColor.a) * texColor + blendColor.a * blendColor;\n            //  gl_FragColor = vec4(vUv, 0.0, 1.0);\n          }";[this.faceGridRows,this.faceGridCols]=r;const n=2/r[1],i=2/r[0];this.faceGridsStates=[],this.faceGridTextureCacheKeys=[],this.panoViews=new Set,this.faceGridsMaterials=[],this.faceGridsUniformses=[],this.skyBoxFaceGrids=[],this.gridCenters=[];for(let a=0;a<6;a++){const o=[],s=[],u=[],l=[],c=[],h=[];for(let a=0;a<r[0];a++){const p=[];for(let h=0;h<r[1];h++){const d=a*r[1]+h;o[d]=0,s[d]="",u[d]={tFaceTexture:{type:"t",value:null},uvScalar:{type:"v2",value:new Or(1,1)},uvOffset:{type:"v2",value:new Or(0,0)},blendColor:{type:"v4",value:new Ur(0,0,0,0)}},l[d]=new ms({fragmentShader:e,vertexShader:t,uniforms:u[d],depthTest:!1,side:lt});const f=new Ls(n,i),g=new as(f,l[d]);c[d]=g,g.visible=!0,g.frustumCulled=!1,g.material=l[d],g.renderOrder=100,this.add(g),p[h]=new Ur(0,0,0,1)}h[a]=p}this.faceGridsStates[a]=o,this.faceGridTextureCacheKeys[a]=s,this.faceGridsUniformses[a]=u,this.faceGridsMaterials[a]=l,this.skyBoxFaceGrids[a]=c,this.gridCenters[a]=h}const o=new wi,s=new wi;for(let a=0;a<r[0];a++)for(let t=0;t<r[1];t++){const e=a*r[1]+t;for(let r=0;r<6;r++)o.makeTranslation(n/2-1+n*t,i/2-1+i*a,0),this.skyBoxFaceGrids[r][e].applyMatrix4(o),this.gridCenters[r][a][t].applyMatrix4(o)}for(let a=0;a<r[0];a++)for(let t=0;t<r[1];t++){const e=a*r[1]+t;o.makeTranslation(1,0,0),s.makeRotationY(Math.PI/2),this.skyBoxFaceGrids[0][e].applyMatrix4(s),this.skyBoxFaceGrids[0][e].applyMatrix4(o),this.gridCenters[0][a][t].applyMatrix4(s).applyMatrix4(o),o.makeTranslation(-1,0,0),s.makeRotationY(-Math.PI/2),this.skyBoxFaceGrids[1][e].applyMatrix4(s),this.skyBoxFaceGrids[1][e].applyMatrix4(o),this.gridCenters[1][a][t].applyMatrix4(s).applyMatrix4(o),o.makeTranslation(0,-1,0),s.makeRotationX(Math.PI/2),this.skyBoxFaceGrids[2][e].applyMatrix4(s),this.skyBoxFaceGrids[2][e].applyMatrix4(o),this.gridCenters[2][a][t].applyMatrix4(s).applyMatrix4(o),o.makeTranslation(0,1,0),s.makeRotationX(-Math.PI/2),this.skyBoxFaceGrids[3][e].applyMatrix4(s),this.skyBoxFaceGrids[3][e].applyMatrix4(o),this.gridCenters[3][a][t].applyMatrix4(s).applyMatrix4(o),o.makeTranslation(0,0,1),s.makeTranslation(0,0,0),this.skyBoxFaceGrids[4][e].applyMatrix4(s),this.skyBoxFaceGrids[4][e].applyMatrix4(o),this.gridCenters[4][a][t].applyMatrix4(s).applyMatrix4(o),o.makeTranslation(0,0,-1),s.makeRotationY(Math.PI),this.skyBoxFaceGrids[5][e].applyMatrix4(s),this.skyBoxFaceGrids[5][e].applyMatrix4(o),this.gridCenters[5][a][t].applyMatrix4(s).applyMatrix4(o)}}u&&this.position.copy(u),l&&this.quaternion.copy(l),this.baseQuaternion=(new jr).copy(this.quaternion),this.additionalQuaternion=new jr;const d=this.quaternion._onChangeCallback;this.quaternion._onChange(()=>{d();const t=(new jr).multiplyQuaternions(this.baseQuaternion,this.additionalQuaternion);if(t.equals(this.quaternion))return;this.baseQuaternion=this.quaternion.clone();const{x:e,y:n,z:r,w:i}=(new jr).multiplyQuaternions(this.baseQuaternion,this.additionalQuaternion);this.quaternion.set(e,n,r,i),this.needsUpdate=!0});const f=this.rotation._onChangeCallback;this.rotation._onChange(()=>{f();const t=this.additionalQuaternion.clone().invert();this.baseQuaternion=this.quaternion.clone().multiply(t)}),this.eventListeners={onPanoramaSelected:t=>{this.isSelected=t===this,this.isSelected&&this.emit(aw.PANORAMA_SELECTED,this.pid)},onEnded:()=>{}},ow.on(uw.ELEMENT_SELECTED,this.eventListeners.onPanoramaSelected)}setTexture(t){this.uniforms.tCube.value=t,this.needsUpdate=!0,this.panoramaLoaded||this.emit(aw.DID_LOAD_PANORAMA,this.pid),this.panoramaLoaded=!0}pauseVideo(){if("ts"===this.videoContentType)this.mpegVideoPlayer&&this.mpegVideoPlayer.pause();else{const t="pano_vid_"+this.pid;if(this.video=this.video||document.getElementById(t),!this.video)return;this.video.pause()}}resumeVideo(){return Ww(this,void 0,void 0,(function*(){if("ts"===this.videoContentType)this.mpegVideoPlayer&&this.mpegVideoPlayer.play();else{const t="pano_vid_"+this.pid;if(this.video=this.video||document.getElementById(t),!this.video)return;yield this.video.play()}}))}stopVideo(){if(this.sphereMesh.visible=!1,"ts"===this.videoContentType){this.mpegVideoPlayer&&(this.mpegVideoPlayer.stop(),this.mpegVideoPlayer.destroy(),this.mpegVideoPlayer=null);const t=this.sphereMesh.material.map;t&&t.dispose(),this.sphereMesh.material.dispose(),this.videoCanvas=null}else{const t="pano_vid_"+this.pid;this.video=this.video||document.getElementById(t);const e=this.sphereMesh.material.map;e&&e.dispose(),this.sphereMesh.material.dispose(),this.video&&(this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=null)}this.eventListeners.onEnded&&this.eventListeners.onEnded(),this.isPlayingVideo=!1,this.needsUpdate=!0}playVideo(t,e,n,r="mp4",i=[2048,2048]){const{onReadyToPlay:o,onEnded:s,onPrepareToPlay:a}=n||{};if(this.videoContentType=r,this.eventListeners.onEnded=s||(()=>{}),"ts"!==this.videoContentType){const n="pano_vid_"+this.pid;this.video=document.getElementById(n),this.video||(this.video=document.createElement("video"),this.video.id=n,this.video.setAttribute("webkit-playsinline","true"),this.video.setAttribute("x5-playsinline","true"),this.video.setAttribute("playsinline","true"),this.video.setAttribute("crossorigin","anonymous")),this.video.src=t,this.video.loop=!!e,this.video.addEventListener("playing",()=>{this.sphereMesh.visible=!0,this.needsUpdate=!0,o&&o(this.video),this.isPlayingVideo=!0}),this.video.addEventListener("ended",()=>{this.stopVideo()}),this.video.addEventListener("play",()=>{this.needsUpdate=!0,a&&a(this.video)}),this.video.play();const r=new Ap(this.video);return r.needsUpdate=!0,this.sphereMesh.material=new xo({map:r,transparent:!1,depthTest:!1,depthWrite:!1}),this.video}{if(!JSMpeg||!JSMpeg.Player)throw new Error("JSMpeg is needed. Please get JSMpeg from https://github.com/phoboslab/jsmpeg");this.videoCanvas||(this.videoCanvas=document.createElement("canvas"),[this.videoCanvas.width,this.videoCanvas.height]=i),this.mpegVideoPlayer=new JSMpeg.Player(t,{canvas:this.videoCanvas,loop:e,autoplay:!1,disableGl:!1,onSourceEstablished:()=>{this.needsUpdate=!0,a&&a()},onPlay:()=>{this.sphereMesh.visible=!0,this.needsUpdate=!0,o&&o(),this.isPlayingVideo=!0},onPause:()=>{},onStalled:()=>{},onEnded:()=>{this.stopVideo()},chunkSize:8388608,videoBufferSize:4194304,decodeFirstFrame:!1,preserveDrawingBuffer:!1});const n=new Lp(this.videoCanvas);n.needsUpdate=!0,hw.DetectIOS()&&(n.flipY=!1),this.sphereMesh.material=new xo({map:n,transparent:!1,depthTest:!1,depthWrite:!1}),this.mpegVideoPlayer.source.established=!1,this.mpegVideoPlayer.source.loadedSize=0,this.mpegVideoPlayer.demuxer.startTime=0,this.mpegVideoPlayer.demuxer.currentTime=0,this.mpegVideoPlayer.demuxer.bits=null,this.mpegVideoPlayer.demuxer.leftoverBytes=null,this.mpegVideoPlayer.audioOut.resetEnqueuedTime(),this.mpegVideoPlayer.audioOut.unlock(),this.mpegVideoPlayer.seek(0),this.mpegVideoPlayer.play()}return null}getIntersectedTiles(t){if(!t)return{hdTiles:[],ldTiles:[]};this.updateMatrixWorld(),t.updateMatrixWorld();const e=t.position.clone(),n=this.gridCenters.map(t=>{const n=t.map(t=>{const n=t.map(t=>{const n=t.clone().applyMatrix4(this.matrixWorld);return new Wr(n.x,n.y,n.z).sub(e).normalize()});return n});return n}),r=new Wr(0,0,-1).applyQuaternion(t.quaternion),i=[],o=[],s=Math.SQRT1_2;for(let a=0;a<6;a++)for(let t=0;t<this.faceGridRows;t++)for(let e=0;e<this.faceGridCols;e++){const u=n[a][t][e].dot(r);u>=s?i.push([a,t,e,u]):o.push([a,t,e,u])}return this.isPlayingVideo?{hdTiles:[],ldTiles:o}:{hdTiles:i,ldTiles:o}}setFaceTexture(t,e,n,r){const i=t[0],o=t[1],s=t[2],a=o*this.faceGridCols+s;this.faceGridsUniformses[i][a].tFaceTexture.value=e;const{uvScalar:u,uvOffset:l,blendColor:c}=n||{};this.faceGridsUniformses[i][a].uvScalar.value=u||new Or(1,1),this.faceGridsUniformses[i][a].uvOffset.value=l||new Or(0,0),this.faceGridsUniformses[i][a].blendColor.value=c||new Ur(0,0,0,0),r&&(this.faceGridTextureCacheKeys[i][a]=r),this.needsUpdate=!0}updateTexture(t){return Ww(this,void 0,void 0,(function*(){if(this.legacyMode){t&&(this.textureURLs=t);const e=yield jw.sharedInstance.loadCubeTexture(this.textureURLs);this.setTexture(e)}else{for(let t=0;t<6;t++)for(let e=this.faceGridCols*this.faceGridRows-1;e>=0;e--)this.faceGridsStates[t][e]=0;t&&(this.highTextureURLs=t,this.textureURLs=t)}this.needsUpdate=!0}))}updateHDGridTextures(t){return Ww(this,void 0,void 0,(function*(){if(this.useLowTextureURLsOnly)return[];if(this.tiledTextureURLRoot){const e=["r","l","t","d","f","b"],n=t.map(t=>`${this.tiledTextureURLRoot}${this.seqID}_${e[t[0]]}_${t[1]}-${t[2]}`),r=yield Vw.hdFaceTexturesCache.preloadTextures(n,t.length);for(let i=t.length-1;i>=0;i--)this.setFaceTexture(t[i],r[i],void 0,n[i]);return r}if(!this.highTextureURLs.length)return[];const e=t.map(t=>""+this.highTextureURLs[t[0]]),n=yield Vw.hdFaceTexturesCache.preloadTextures(e,t.length),r=new Or(1/this.faceGridCols,1/this.faceGridRows);for(let i=t.length-1;i>=0;i--){const o=new Or(r.x*t[i][2],r.y*t[i][1]);this.setFaceTexture(t[i],n[i],{uvScalar:r,uvOffset:o},e[i])}return n}))}updateLDGridTextures(t){return Ww(this,void 0,void 0,(function*(){const e=t.map(t=>""+this.textureURLs[t[0]]),n=yield Vw.ldFaceTexturesCache.preloadTextures(e,t.length),r=new Or(1/this.faceGridCols,1/this.faceGridRows);for(let i=t.length-1;i>=0;i--){const o=new Or(r.x*t[i][2],r.y*t[i][1]);this.setFaceTexture(t[i],n[i],{uvScalar:r,uvOffset:o},e[i])}return n}))}updateFaceGridsTextures(t,e){return Ww(this,void 0,void 0,(function*(){this.panoramaLoaded||this.emit(aw.WILL_LOAD_PANORAMA,this.pid);const n=[];t.forEach(t=>{2!==this.faceGridsStates[t[0]][this.faceGridCols*t[1]+t[2]]&&n.push(t)}),yield this.updateLDGridTextures(n);const r=[];e.forEach(t=>{1!==this.faceGridsStates[t[0]][this.faceGridCols*t[1]+t[2]]&&r.push(t)}),yield this.updateLDGridTextures(r);for(let t=0;t<6;t++)for(let e=this.faceGridRows*this.faceGridCols-1;e>=0;e--)this.faceGridsStates[t][e]=0;t.forEach(t=>{this.faceGridsStates[t[0]][this.faceGridCols*t[1]+t[2]]=2}),e.forEach(t=>{this.faceGridsStates[t[0]][this.faceGridCols*t[1]+t[2]]=1}),this.updateHDGridTextures(n),this.panoramaLoaded||this.emit(aw.DID_LOAD_PANORAMA,this.pid),this.panoramaLoaded=!0}))}setUseLowTexturesOnly(t){this.useLowTextureURLsOnly=t}isUseLowTexturesOnly(){return this.useLowTextureURLsOnly}dispose(){super.dispose(),this.faceGridsMaterials&&this.faceGridsMaterials.forEach(t=>{t.forEach(t=>{t.dispose()})}),this.skyBoxFaceGrids&&this.skyBoxFaceGrids.forEach(t=>{t.forEach(t=>{t.geometry&&t.geometry.dispose()})}),this.stopVideo(),this.eventListeners.onEnded&&(this.eventListeners.onEnded=null),this.sphereMesh&&this.sphereMesh.material&&this.sphereMesh.material.dispose(),this.initialized=!1,ow.off(uw.ELEMENT_SELECTED,this.eventListeners.onPanoramaSelected)}setSkyBoxVisible(t){this.ifRenderSkyBox=t,this.needsUpdate=!0}update(){const t=new pw(this);return this.initialized?(this.needsUpdate||this.isPlayingVideo)&&(t.needUpdate=!0,this.isPlayingVideo&&this.videoCanvas&&this.sphereMesh.material.map&&(this.sphereMesh.material.map.needsUpdate=!0),this.needsUpdate=!1):(this.initialized=!0,t.needUpdate=!0),this.initialized&&!this.parent&&(t.shouldPlaceElement=!0),t}setAdditionalRotationInEuler(t,e,n){this.additionalQuaternion.setFromEuler(new Ri(t,e,n));const{x:r,y:i,z:o,w:s}=this.baseQuaternion.clone().multiply(this.additionalQuaternion);return this.quaternion.set(r,i,o,s),this.needsUpdate=!0,this.additionalQuaternion.clone()}setAdditionalRotationInQuaternion(t,e,n,r){this.additionalQuaternion.set(t,e,n,r);const{x:i,y:o,z:s,w:a}=this.baseQuaternion.clone().multiply(this.additionalQuaternion);return this.quaternion.set(i,o,s,a),this.needsUpdate=!0,(new Ri).setFromQuaternion(this.additionalQuaternion)}addViewConfiguration(t,e){const n=this.viewConfigurations.get(t.targetView),r=Object.assign(Object.assign({},n),t);this.viewConfigurations.set(t.targetView,r),this.needsUpdate=!0,!0===e&&this.renderingViewChanged(t.targetView)}renderingViewChanged(t){if(!t.camera)return;super.renderingViewChanged(t);const e={showBorder:!1,showSkyBox:!1},n=this.viewConfigurations.get(t);n&&(void 0!==n.showBorder&&(e.showBorder=n.showBorder),void 0!==n.showSkyBox&&(e.showSkyBox=n.showSkyBox)),this.wireFrame.material.visible=e.showBorder,this.legacyMode||this.skyBoxFaceGrids.forEach(t=>{t.forEach(t=>{t.material.visible=!this.isPlayingVideo&&(e.showSkyBox&&this.ifRenderSkyBox)})});const r=this.position.distanceTo(t.camera.position)<.1,i=this.panoViews.has(t);if(r){if(!i&&!this.legacyMode){this.panoViews.add(t);for(let t=0;t<6;t++)for(let e=this.faceGridCols*this.faceGridRows-1;e>=0;e--)this.faceGridsStates[t][e]=0}}else if(i&&(this.panoViews.delete(t),this.isPlayingVideo&&this.stopVideo(),!this.legacyMode))for(let o=0;o<6;o++)for(let t=this.faceGridCols*this.faceGridRows-1;t>=0;t--){const e=this.faceGridTextureCacheKeys[o][t];Vw.hdFaceTexturesCache.recycleTexture(e),Vw.ldFaceTexturesCache.recycleTexture(e)}if(e.showSkyBox&&r&&i&&!this.legacyMode){const e=this.getIntersectedTiles(t.camera);this.updateFaceGridsTextures(e.hdTiles,e.ldTiles)}this.wireFrame.material.visible=e.showBorder,this.legacyMode||this.skyBoxFaceGrids.forEach(t=>{t.forEach(t=>{t.material.visible=!this.isPlayingVideo&&(e.showSkyBox&&i&&this.ifRenderSkyBox)})}),this.visible=!0===e.showSkyBox||!0===e.showBorder}}class Yw{static GetFaces(){const t={};return this.ROTATIONS.forEach(({direction:e,euler:n,suffix:r,index:i})=>{const o=this.X_POS_FACE.map(t=>t.clone().applyEuler(n).round()),s=[{a:o[0].clone(),b:o[1].clone()},{a:o[1].clone(),b:o[2].clone()},{a:o[2].clone(),b:o[3].clone()},{a:o[3].clone(),b:o[0].clone()},{a:o[0].clone(),b:o[2].clone()},{a:o[1].clone(),b:o[3].clone()},{a:o[0].clone().add(o[1].clone()).multiplyScalar(.5),b:o[2].clone().add(o[3].clone()).multiplyScalar(.5)},{a:o[0].clone().add(o[3].clone()).multiplyScalar(.5),b:o[1].clone().add(o[2].clone()).multiplyScalar(.5)}];t[e]={faceLines:s,suffix:r,index:i}}),t}static GetCameraFrustum(t){const e=new Cs;return e.setFromProjectionMatrix((new wi).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),e}static CheckFaceVisibility(t,e,n){for(let r=0;r<e.length;r++){const{a:i,b:o}=e[r],s=i.clone(),a=o.clone();t.updateMatrixWorld(),s.applyMatrix4(t.matrixWorld),a.applyMatrix4(t.matrixWorld);const u=n.containsPoint(s),l=n.containsPoint(a),c=u&&l;if(c)return!0;const h=new Om(s,a),p=n.planes.map(t=>{const e=t.intersectLine(h,new Wr);if(!e)return null;const r=!n.planes.some(n=>n!==t&&n.distanceToPoint(e)<0);return r?e:null}).filter(t=>t);if(p.length)return!0}return!1}}Yw.X_POS_FACE=[new Wr(1,-1,-1),new Wr(1,-1,1),new Wr(1,1,1),new Wr(1,1,-1)],Yw.ROTATIONS=[{direction:"xPos",euler:new Ri(0,0,0),suffix:"r",index:0},{direction:"xNeg",euler:new Ri(0,0,Math.PI),suffix:"l",index:1},{direction:"yPos",euler:new Ri(0,0,-Math.PI/2),suffix:"t",index:2},{direction:"yNeg",euler:new Ri(0,0,Math.PI/2),suffix:"d",index:3},{direction:"zPos",euler:new Ri(0,-Math.PI/2,0),suffix:"f",index:4},{direction:"zNeg",euler:new Ri(0,Math.PI/2,0),suffix:"b",index:5}];var Xw,Zw=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};(function(t){t[t["AlwaysHide"]=0]="AlwaysHide",t[t["AlwaysShow"]=1]="AlwaysShow",t[t["Editing"]=2]="Editing",t[t["Show"]=3]="Show"})(Xw||(Xw={}));class Kw extends dw{constructor(t,e,n){super(),this.initialized=!1;const{modelElement:r,groundParams:i,indicatorImageURL:o,invisibleIndicatorImageURL:s,indicatorWidth:a,indicatorHeight:u,indicatorPositionMap:l,globalScale:c}=e||{globalScale:1};this.currentPanoramaID=-1,this.ifCurrentPanoramaShow=!0,this.panoramaMap=new Map,this.indicatorMap=new Map,this.indicatorVisibilityMap=new Map,this.indicatorHiddenMap=new Map,this.indicatorPositionMap=l||new Map,this.inSightIndicators=[],this.inDetectIndicators=[],this.indicatorWidth=a||2*Kw.IndicatorRadius,this.indicatorHeight=u||2*Kw.IndicatorRadius,this.maxWorldDistance=13,this.globalScale=c||1,this.group=new yh,this.add(this.group),this.viewConfigurations=new Map,this.eventListeners={onFloorModelLoaded:t=>{t===this.modelElement&&(this.updateIndicatorsPositions(),this.bindModelElement(t))}},this.groundParams=i,this.bindModelElement(r);const h=["varying vec2 vUv;","void main(){","   vUv = uv;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),p=["uniform sampler2D map;","uniform float opacity;","uniform vec4 blendColor;","varying vec2 vUv;","void main(){","   vec4 texColor = texture2D(map, vUv);","   gl_FragColor = vec4((texColor * (1.0 - blendColor.a) + blendColor * blendColor.a).rgb, texColor.a * opacity);","}"].join("\n");let d,f,g;this.indicatorShaderUniforms={map:{type:"t",value:null},blendColor:{type:"v4",value:new Ur(0,0,0,0)},opacity:{value:1}},this.invisibleIndicatorShaderUniforms={map:{type:"t",value:null},blendColor:{type:"v4",value:new Ur(1,0,0,.5)},opacity:{value:1}},this.indicatorMaterials=new Map,o?(f=new Ls(this.indicatorWidth,this.indicatorHeight),d=new ms({transparent:!0,vertexShader:h,fragmentShader:p,uniforms:this.indicatorShaderUniforms,side:ct,depthTest:!1,depthWrite:!1,name:"indicatorMaterial"}),this.indicatorImageURL=o,(new Tf).load(o,t=>{this.indicatorShaderUniforms.map.value=t})):(f=new Rp(this.indicatorWidth/2,32),d=new xo({transparent:!0}),d.side=ct,d.depthTest=!1,d.depthWrite=!1,d.color=new vo(16777215));const m=s||o;m?(g=new ms({transparent:!0,vertexShader:h,fragmentShader:p,uniforms:this.invisibleIndicatorShaderUniforms,side:ct,depthTest:!1,depthWrite:!1,name:"invisibleIndicatorMaterial"}),(new Tf).load(m,t=>{this.invisibleIndicatorShaderUniforms.map.value=t})):(g=new xo,g.side=ct,g.depthTest=!1,g.depthWrite=!1,g.color=new vo(16711680));const y=new as(f,d);this.setIndicatorMeshPrototype(y),this.setIndicatorMaterial(d,Xw.Editing,!0),this.setIndicatorMaterial(g,Xw.Editing,!1),this.setIndicatorMaterial(d,Xw.Show,!0),this.panoramaDatas=new Map,t.forEach(t=>{this.panoramaDatas.set(t.pid,t)}),this.panoramaCreatingTasks=new Map,!0===n&&t.forEach(t=>{this.getPanoramaByPID(t.pid)}),this.modelElement instanceof vw&&this.modelElement.isModelLoaded()&&this.updateIndicatorsPositions(),ow.on(uw.ELEMENT_LOADED,this.eventListeners.onFloorModelLoaded),this.initialized=!1,this.needUpdate=!1}dispose(t){super.dispose(),ow.off(uw.ELEMENT_LOADED,this.eventListeners.onFloorModelLoaded),this.panoramaMap&&(this.panoramaMap.forEach(e=>{this.group.remove(e),t!==e.pid&&jw.sharedInstance.recycleCubeTexture(e.textureURLs),e.dispose()}),this.panoramaMap.clear()),this.indicatorMap&&(this.indicatorMap.forEach(t=>{this.group.remove(t)}),this.indicatorMap.clear()),this.boundBox&&(this.group.remove(this.boundBox),this.boundBox.geometry.dispose()),this.remove(this.group)}update(){const t=new pw(this);if(this.initialized)if(this.needUpdate){const e=this.getPIDPositionMap(this.inDetectIndicators);e.forEach((t,e)=>{const n=this.indicatorPositionMap.get(e);if(!n&&(this.groundParams||this.modelElement instanceof vw)){let n;if(this.groundParams&&this.groundParams.groundPlane)n=vw.intersectWithGroundPlane(t,this.groundParams);else{const e=this.modelElement;n=e.intersectGround(t)}n&&this.indicatorPositionMap.set(e,n)}}),this.inDetectIndicators.forEach(t=>{let e=this.indicatorMap.get(t);if(!e){e=this.indicatorMeshPrototype.clone(),this.indicatorMap.set(t,e),this.group.add(e);const n=this.panoramaDatas.get(t);n&&n.position&&e.position.copy(n.position)}const n=this.indicatorPositionMap.get(t);n&&e.position.copy(n)}),this.needUpdate=!1,t.needUpdate=!0}else this.panoramaMap.forEach(e=>{const n=e.update();n.needUpdate&&(t.needUpdate=!0)});else this.initialized=!0,t.needUpdate=!0;return this.initialized&&!this.parent&&(t.shouldPlaceElement=!0),t}bindModelElement(t){t&&(this.modelElement=t),this.boundBox&&(this.group.remove(this.boundBox),this.boundBox=null),this.getModelBoundBox()}static getBoundBox(t){if(!t)return null;const e=(new Xr).setFromObject(t),n=e.getSize(new Wr),r=Math.max(n.x,n.y,n.z),i=new as(new cs(r,r,r));return i.position.copy(e.max.clone().add(e.min).multiplyScalar(.5)),i}getModelBoundBox(){this.boundBox||(this.boundBox=Kw.getBoundBox(this.modelElement),this.boundBox&&(this.boundBox.visible=!0,this.boundBox.frustumCulled=!1,this.boundBox.renderOrder=100,this.group.add(this.boundBox)))}setBoundBoxAppearance(t){this.getModelBoundBox(),this.boundBox&&(this.boundBox.material=t,this.needUpdate=!0)}setBoundBoxVisible(t){this.boundBox&&(this.boundBox.visible=t)}presentPanorama(t,e,n){return Zw(this,void 0,void 0,(function*(){t.legacyMode||(yield t.updateFaceGridsTextures(e,n),this.needUpdate=!0)}))}presentPanoramaOfPID(t,e,n){return Zw(this,void 0,void 0,(function*(){const r=yield this.getPanoramaByPID(t);this.currentPanorama=r,r&&(yield this.presentPanorama(r,e,n)),this.currentPanoramaID=t,r.setSkyBoxVisible(this.ifCurrentPanoramaShow),this.emit(aw.PANORAMA_PRESENTED,t)}))}preloadCubeTexturesOfPIDs(t,e){return Zw(this,void 0,void 0,(function*(){const n=t.map(t=>{const e=this.panoramaDatas.get(t);if(e)return e.textureURLs});return jw.sharedInstance.preloadCubeTextures(n,e)}))}setCurrentPanoramaVisible(t){return Zw(this,void 0,void 0,(function*(){const e=yield this.getPanoramaByPID(this.currentPanoramaID);this.ifCurrentPanoramaShow=t,e.setSkyBoxVisible(t)}))}visibleRadiusOfView(t){if(!t)return Kw.DefaultVisibleRadius;const e=this.viewConfigurations.get(t);return e&&e.visibleRadius?e.visibleRadius:Kw.DefaultVisibleRadius}detectRadiusOfView(t){if(!t)return Kw.DefaultVisibleRadius;const e=this.viewConfigurations.get(t);if(e&&e.detectRadius){if(!e.visibleRadius&&e.detectRadius>Kw.DefaultVisibleRadius)return e.detectRadius;if(e.visibleRadius&&e.detectRadius>e.visibleRadius)return e.detectRadius;if(e.visibleRadius&&e.detectRadius<e.visibleRadius)return e.visibleRadius}return Kw.DefaultVisibleRadius}allPanoramas(){return Zw(this,void 0,void 0,(function*(){const t=Array.from(this.panoramaMap.values()),e=yield Promise.all(Array.from(this.panoramaCreatingTasks.values()));return t.concat(e)}))}getAllPanoramas(){return Zw(this,void 0,void 0,(function*(){return this.initializePanoramasIfNecessary("all")}))}panoramaIDsAround(t,e){const n=this.panoramaDatas.get(t);if(!n||!n.position)return null;const r=[t],i=[t],o=this.visibleRadiusOfView(e),s=this.detectRadiusOfView(e),a=n.neighbourPanoramaIDs.map(t=>this.panoramaDatas.get(t));return a.forEach(t=>{if(t&&t.position){const e=n.position.distanceTo(t.position);e<=o&&r.push(t.pid),e<=s&&i.push(t.pid)}}),[r,i]}presentPanoramaAround(t,e,n,r){return Zw(this,void 0,void 0,(function*(){const i=this.panoramaIDsAround(t,r);i&&i[0]&&(yield this.presentPanoramaOfPID(t,e,n))}))}getPIDPositionMap(t){const e=new Map;return t.forEach(t=>{const n=this.panoramaDatas.get(t);n&&e.set(t,n.position)}),e}getIndicatorPosition(t){return this.indicatorPositionMap.get(t)}handlePanoramaIndicators(t,e){if(!this.modelElement)return;const n="inSight"===e?"inSightIndicators":"inDetectIndicators";this[n]=[],t.forEach((t,e)=>{if(this.groundParams||this.modelElement instanceof vw){const n=this.indicatorPositionMap.get(e);if(!n){let n;if(this.groundParams&&this.groundParams.groundPlane)n=vw.intersectWithGroundPlane(t,this.groundParams);else{const e=this.modelElement;n=e.intersectGround(t)}n&&this.indicatorPositionMap.set(e,n.add(new Wr(0,0,Kw.IndicatorOffsetZ)))}}this[n].push(e)}),this.needUpdate=!0}presentPanoramaIndicators(t){this.modelElement&&(this.inSightIndicators=[],t.forEach((t,e)=>{if(this.groundParams||this.modelElement instanceof vw){const n=this.indicatorPositionMap.get(e);if(!n){let n;if(this.groundParams&&this.groundParams.groundPlane)n=vw.intersectWithGroundPlane(t,this.groundParams);else{const e=this.modelElement;n=e.intersectGround(t)}n&&this.indicatorPositionMap.set(e,n.add(new Wr(0,0,Kw.IndicatorOffsetZ)))}}this.inSightIndicators.push(e)}),this.needUpdate=!0)}updateIndicatorsPositions(){return Zw(this,void 0,void 0,(function*(){this.panoramaMap.forEach((t,e)=>{const n=this.indicatorPositionMap.get(e);if(n)return;const{position:r}=t;let i;if(this.groundParams&&this.groundParams.groundPlane)i=vw.intersectWithGroundPlane(r,this.groundParams);else{const t=this.modelElement;i=t.intersectGround(r)}i&&this.indicatorPositionMap.set(e,i.add(new Wr(0,0,Kw.IndicatorOffsetZ)))});const t=yield this.getPIDPositionMap(this.inSightIndicators);this.presentPanoramaIndicators(t)}))}presentPanoramaIndicatorsAround(t,e){return Zw(this,void 0,void 0,(function*(){const n=this.panoramaIDsAround(t,e);if(n){const[t,e]=n;if(t){const e=yield this.getPIDPositionMap(t);this.handlePanoramaIndicators(e,"inSight")}if(e){const t=yield this.getPIDPositionMap(e);this.handlePanoramaIndicators(t,"inDetect")}}}))}getIndicatorVisibility(t){const e=this.indicatorVisibilityMap.get(t);return void 0===e||e}setIndicatorVisibility(t,e){let n;void 0===e?(n=[],this.indicatorMap.forEach((t,e)=>{n.push(e)})):n=Array.isArray(e)?e:[e],n.forEach(e=>{this.indicatorVisibilityMap.set(e,t);const n=this.indicatorMap.get(e);n&&(this.group.remove(n),this.indicatorMap.delete(e))}),this.needUpdate=!0}setIndicatorHidden(t,e){let n;void 0===e?(n=[],this.indicatorMap.forEach((t,e)=>{n.push(e)})):n=Array.isArray(e)?e:[e],n.forEach(e=>{this.indicatorHiddenMap.set(e,t);const n=this.indicatorMap.get(e);n&&(this.group.remove(n),this.indicatorMap.delete(e))}),this.needUpdate=!0}intersectIndicators(t,e){let n=[];const r=e.normalize(),i=Math.min(this.indicatorHeight,this.indicatorWidth)/2;return this.indicatorMap.forEach((e,o)=>{const s=e.position;if(Number.isNaN(s.x))return;const a=s.clone().sub(t),u=a.dot(r);if(u>0){const t=r.clone().multiplyScalar(u),e=a.sub(t).length();e<=i&&n.push({pid:o,distance:e})}}),n.length>0?(n=n.sort((t,e)=>t.distance<e.distance?-1:t.distance>e.distance?1:0),n[0].pid):-1}intersectIndicatorsOnScreen(t,e,{screenWidth:n,screenHeight:r},i){const o=Array.from(this.indicatorMap),s=o.map(([,t])=>t),a=fw.getMouseIntersectionOnScreen(s,t,{screenWidth:n,screenHeight:r},e,i,s,this.maxWorldDistance);if(a){const t=o.find(([,t])=>t===a);if(t)return t[0]}return-1}putPanorama(t){const e=this.panoramaMap.get(t.pid);e&&(this.group.remove(e),e.dispose()),this.panoramaMap.set(t.pid,t),this.group.add(t),this.needUpdate=!0}initializePanoramasIfNecessary(t){return Zw(this,void 0,void 0,(function*(){let e=[];if(Array.isArray(t))e=t;else if("all"===t)e=Array.from(this.panoramaDatas.keys());else{const n=t;e.push(n);const r=new Set;r.add(n);const i=[n];while(i.length>0){const t=i.splice(0,1)[0],n=this.panoramaDatas.get(t);n&&n.neighbourPanoramaIDs.forEach(t=>{r.has(t)||(r.add(t),i.push(t),e.push(t))})}}const n=e.map(t=>this.getPanoramaByPID(t));return Promise.all(n)}))}getPanoramaByPID(t){return Zw(this,void 0,void 0,(function*(){const e=this.panoramaMap.get(t);if(e)return e;const n=this.panoramaCreatingTasks.get(t);if(n)return n;const r=this.panoramaDatas.get(t);if(!r)return;const i=new Promise(t=>{const e=new qw(r.pid,r.seqID,r.textureURLs,[2,2],r.neighbourPanoramaIDs,r.highTextureURLs,r.useLowTextureURLsOnly,r.tiledTextureURLRoot,r.position,r.quaternion,!!r.legacyMode);e.scale.set(this.globalScale,this.globalScale,this.globalScale),this.putPanorama(e),this.panoramaCreatingTasks.delete(r.pid),t(e)});return this.panoramaCreatingTasks.set(r.pid,i),i}))}getPanoramaByPIDInstant(t){const e=this.panoramaMap.get(t);return e||null}getNeghbourPanoClosestToRay(t){if(-1===this.currentPanoramaID)return-1;const e=this.panoramaMap.get(this.currentPanoramaID);if(!e)return-1;if(!e.neighborPanoramaIDs||0===e.neighborPanoramaIDs.length)return-1;const n=12,r=t.clone().normalize();let i=-1,o=-1;return e.neighborPanoramaIDs.forEach(t=>{const n=this.panoramaMap.get(t);if(!n)return;const s=n.position.clone().sub(e.position).normalize().dot(r);s>i&&(i=s,o=t)}),i>=Math.cos(Math.PI*n/180)?o:-1}updateIndicatorGeometry(){let t;t=this.indicatorImageURL?new Ls(this.indicatorWidth,this.indicatorHeight):new Rp(this.indicatorWidth/2,32);const e=new Set;Array.from(this.indicatorMap).forEach(([,n])=>{e.add(n.geometry),n.geometry=t}),Array.from(e).forEach(t=>{t.dispose()}),this.indicatorMeshPrototype.geometry=t;const n=new as(t,this.indicatorMeshPrototype.material);this.setIndicatorMeshPrototype(n)}setIndicatorSize(t,e){this.indicatorWidth=t,this.indicatorHeight=e,this.updateIndicatorGeometry()}setIndicatorImageURL(t){(new Tf).load(t,e=>{const n=["varying vec2 vUv;","void main(){","   vUv = uv;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),r=["uniform sampler2D map;","uniform float opacity;","uniform vec4 blendColor;","varying vec2 vUv;","void main(){","   vec4 texColor = texture2D(map, vUv);","   gl_FragColor = vec4((texColor * (1.0 - blendColor.a) + blendColor * blendColor.a).rgb, texColor.a * opacity);","}"].join("\n");let i=this.getIndicatorMaterial(Xw.Editing,!0),o=new ms({transparent:!0,vertexShader:n,fragmentShader:r,uniforms:this.indicatorShaderUniforms,side:ct,depthTest:!1,depthWrite:!1,name:"indicatorMaterial"});this.setIndicatorMaterial(o,Xw.Editing,!0),i.dispose(),i=this.getIndicatorMaterial(Xw.Show,!0),this.setIndicatorMaterial(o,Xw.Show,!0),i.dispose(),o=new ms({transparent:!0,vertexShader:n,fragmentShader:r,uniforms:this.invisibleIndicatorShaderUniforms,side:ct,depthTest:!1,depthWrite:!1,name:"invisibleIndicatorMaterial"}),this.indicatorShaderUniforms.map.value=e,this.invisibleIndicatorShaderUniforms.map.value=e,this.setIndicatorMaterial(o,Xw.Editing,!1),this.indicatorImageURL||this.setIndicatorMeshPrototype(new as(new Ls(this.indicatorWidth,this.indicatorHeight),o)),this.indicatorImageURL=t,this.needUpdate=!0,this.updateIndicatorGeometry()})}getIndicatorSize(){return[this.indicatorWidth,this.indicatorHeight]}setIndicatorMeshPrototype(t){this.indicatorMeshPrototype=t,this.panoramaMap.forEach((t,e)=>{const n=this.indicatorMap.get(e);n&&(this.group.remove(n),this.indicatorMap.delete(e))}),t.renderOrder=300,this.needUpdate=!0}setIndicatorMaterial(t,e,n){let r=this.indicatorMaterials.get(e);r||(r=new Map,this.indicatorMaterials.set(e,r)),r.set(n,t),this.needUpdate=!0}getIndicatorMaterial(t,e){let n=this.indicatorMaterials.get(t);return n||(n=new Map,this.indicatorMaterials.set(t,n)),n.get(e)}addGroupViewConfiguration(t){const e=this.viewConfigurations.get(t.targetView);e&&(void 0===t.showBoundBox&&void 0!==e.showBoundBox&&(t.showBoundBox=e.showBoundBox),void 0===t.visibleRadius&&void 0!==e.visibleRadius&&(t.visibleRadius=e.visibleRadius),void 0===t.detectRadius&&void 0!==e.detectRadius&&(t.detectRadius=e.detectRadius),void 0===t.indicatorDisplayMode&&void 0!==e.indicatorDisplayMode&&(t.indicatorDisplayMode=e.indicatorDisplayMode)),this.viewConfigurations.set(t.targetView,t),this.needUpdate=!0}addViewConfiguration(t){return Zw(this,void 0,void 0,(function*(){const e=yield this.allPanoramas();e.forEach(e=>{e.addViewConfiguration(t)})}))}setMaxWorldDistance(t){this.maxWorldDistance=t}renderingViewChanged(t){const e={showBoundBox:!1,indicatorDisplayMode:Xw.AlwaysHide},n=this.viewConfigurations.get(t);switch(n&&(void 0!==n.showBoundBox&&(e.showBoundBox=n.showBoundBox),void 0!==n.indicatorDisplayMode&&(e.indicatorDisplayMode=n.indicatorDisplayMode)),this.setBoundBoxVisible(e.showBoundBox),e.indicatorDisplayMode){case Xw.AlwaysHide:this.panoramaDatas.forEach((t,e)=>{const n=this.indicatorMap.get(e);n&&(n.material instanceof ms?n.material.uniforms.opacity.value=0:n.material.opacity=0)});break;case Xw.AlwaysShow:this.panoramaDatas.forEach((t,e)=>{const n=this.indicatorMap.get(e);if(!n)return;let r=this.indicatorVisibilityMap.get(e);void 0===r&&(r=!0);const i=this.getIndicatorMaterial(Xw.AlwaysShow,r);i&&(n.material=i),n.material instanceof ms?n.material.uniforms.opacity.value=1:n.material.opacity=1});break;case Xw.Editing:this.panoramaDatas.forEach((t,e)=>{const n=this.indicatorMap.get(e);if(!n)return;let r=this.indicatorVisibilityMap.get(e);const i=!!this.indicatorHiddenMap.get(e);void 0===r&&(r=!0),n.visible=!i;const o=this.getIndicatorMaterial(Xw.Editing,r);o&&(n.material=o),n.material instanceof ms?n.material.uniforms.opacity.value=1:n.material.opacity=1});break;case Xw.Show:this.panoramaDatas.forEach((t,e)=>{const n=this.indicatorMap.get(e);n&&(n.material.visible=!1,n.visible=!1,n.userData.enableDetected=!1,n.material instanceof ms?n.material.uniforms.opacity.value=0:n.material.opacity=0)}),this.inDetectIndicators.forEach(t=>{const e=this.indicatorMap.get(t);if(!e)return;let n=this.indicatorVisibilityMap.get(t);void 0===n&&(n=!0);const r=this.getIndicatorMaterial(Xw.Editing,n);r&&(e.material=r);const i=this.indicatorPositionMap.get(t);e.material.visible=n&&void 0!==i,e.visible=n&&void 0!==i&&this.inSightIndicators.includes(t),e.userData.enableDetected=!0,e.material instanceof ms?e.material.uniforms.opacity.value=n&&void 0!==i?1:0:e.material.opacity=n&&void 0!==i?1:0});break;default:break}this.panoramaMap.forEach(e=>{e.renderingViewChanged(t)})}}Kw.DefaultVisibleRadius=10,Kw.IndicatorRadius=.1,Kw.IndicatorOffsetZ=.1;var Jw;(function(t){t["GIF89a"]="GIF89a",t["GIF87a"]="GIF87a"})(Jw||(Jw={}));var Qw=n("595b");class $w extends dw{constructor(t,e={width:.3}){super(),this.initialized=!1,this.ready=!0,this.points=[],this.distances=[],this.options=Object.assign({textureMode:"repeat"},e),e.animateSpeed||(this.options.animateSpeed=.01),"tail"===e.textureMode&&this.createTailArrow(),this.init(t)}calcPoints(t,e=.3){const n=t.length;if(n<2)return[];const r=[],i=t.map(t=>[t[0],t[1]]);for(let o=0;o<n;o++){const t=new Or(...i[o]),s=0===o?null:new Or(...i[o-1]),a=o===n-1?null:new Or(...i[o+1]),u=s?(new Or).subVectors(t,s).normalize():null,l=a?(new Or).subVectors(a,t).normalize():null,c=l&&u?(new Or).addVectors(l,u).normalize():null,h=0===o?new Or(-l.y,l.x):o===n-1?new Or(-u.y,u.x):new Or(-c.y,c.x),p=(new Or).addVectors(t,h.clone().multiplyScalar(-e)),d=(new Or).addVectors(t,h.clone().multiplyScalar(e));r.push([p.x,p.y,0],[d.x,d.y,0],[h.x,h.y,0])}return r}createTailArrow(){const t=this.options.textureUrl;(new Tf).load(t,t=>{const e=this.options.width||.3,n=this.options.strokeWidth?e+2*this.options.strokeWidth:this.options.width,r=this.options.textureSize?this.options.textureSize[0]:n,i=this.options.textureSize?this.options.textureSize[1]:r,o=new Ls(r,i),s=this.options.color?this.options.color:16777215,a=new xo({color:s,map:t,transparent:!0,opacity:1,depthTest:!1});a.needsUpdate=!0;const u=new as(o,a);u.renderOrder=2,this.tailArrow=u,this.tailArrow.visible=!1,this.add(this.tailArrow)})}orgPoints(t,e=.3){const n=t.length,r=this.calcPoints(t,e),i=r.map(t=>new Wr(...t)),o=_w.chunk(i,3),s=t.map((t,e)=>({point:t,normal:[o[e][2].x,o[e][2].y],scale:1})),a=t.map(t=>[t[0],t[1]]),u=_w.calcTurning(a);if(!u.length)return s;const l=u.map(r=>{const{startIndex:i,endIndex:s,angle:a}=r,u=a>180?1:0;if(s-i===1)return null;const l=i>0?o[i-2][u]:o[i-1][u],c=o[i-1][u],h=(new Wr).subVectors(c,l).normalize().multiplyScalar(e),p=(new Wr).addVectors(c,h),d=(new Wr).subVectors(l,h),f=o[s+1][u],g=n>s+2?o[s+2][u]:o[s][u],m=(new Wr).subVectors(g,f).normalize().multiplyScalar(e),y=(new Wr).addVectors(g,m),v=(new Wr).subVectors(f,m),x=Qw["lineString"]([[d.x,d.y],[l.x,l.y],[c.x,c.y],[p.x,p.y]]),_=Qw["lineString"]([[v.x,v.y],[f.x,f.y],[g.x,g.y],[y.x,y.y]]),b=Qw["lineIntersect"](x,_);if(!b.features[0])return null;const w=b.features[0].geometry.coordinates,M=new Or(t[s][0]-t[i-1][0],t[s][1]-t[i-1][1]).normalize().multiplyScalar(e),E=[w[0]-M.x,w[1]-M.y],S=[w[0]+M.x,w[1]+M.y],T=a>180?M.normalize().multiplyScalar(-1):M.normalize().multiplyScalar(1),C=[w[0]-T.y*e,w[1]+T.x*e],A=[w[0]+T.y*e,w[1]-T.x*e],P=Qw["featureCollection"]([Qw["point"](E),Qw["point"](A),Qw["point"](S),Qw["point"](C),Qw["point"](E)]),L=Qw["convex"](P);return{hull:L,intersectCrd:w,startIndex:i,endIndex:s}});let c=0,h=0,p=!1;while(h<n&&l[c]){const[t,e]=o[h],n=l[c].hull,r=l[c].intersectCrd,i=l[c+1]?l[c+1].intersectCrd:null,a=l[c+1]?l[c+1].hull:null,u=Qw["booleanWithin"](Qw["point"]([t.x,t.y]),n),d=Qw["booleanWithin"](Qw["point"]([e.x,e.y]),n),f=u||d;if(f&&u){p=!0;const n=new Wr(...r,0);let o=e;i&&a&&Qw["booleanWithin"](Qw["point"]([e.x,e.y]),a)&&(o=new Wr(i[0],i[1],i[2]));const u=(new Wr).subVectors(e,t).length(),l=(new Wr).subVectors(o,new Wr(n.x,n.y,0)).length(),c=(new Wr).subVectors(o,new Wr(n.x,n.y,0)).normalize();s.splice(h,1,{point:[(n.x+o.x)/2,(n.y+o.y)/2,0],scale:l/u,normal:[c.x,c.y]})}else if(f&&d){p=!0;const n=new Wr(...r,0);let o=t;i&&a&&Qw["booleanWithin"](Qw["point"]([t.x,t.y]),a)&&(o=new Wr(i[0],i[1],i[2]));const u=(new Wr).subVectors(e,t).length(),l=(new Wr).subVectors(o,new Wr(n.x,n.y,0)).length(),c=(new Wr).subVectors(new Wr(n.x,n.y,0),o).normalize();s.splice(h,1,{point:[(n.x+o.x)/2,(n.y+o.y)/2,0],scale:l/u,normal:[c.x,c.y]})}else p&&(h--,p=!1,c++);h++}return s}init(t){const e=t,n=this.options.strokeWidth||0,r=this.options.width?this.options.width/2:.3,i=n+r,o=this.orgPoints(e,i);this.orgedPoints=o,this.points=[];let s=.1;if(e.length>1){const[t,n,r,i]=[e[0],e[1],e[e.length-2],e[e.length-1]],o=new Wr(...t),a=new Wr(...n),u=(new Wr).subVectors(o,a).normalize().multiplyScalar(.05*o.distanceTo(a)),l=o.clone().add(u);s=u.length();const c=new Wr(...r),h=new Wr(...i),p=(new Wr).subVectors(c,h).normalize().multiplyScalar(.05*o.distanceTo(a)),d=h.clone().sub(p),f=this.orgedPoints[0],g=this.orgedPoints[this.orgedPoints.length-1];this.orgedPoints.unshift({point:[l.x,l.y,l.z],normal:f.normal,scale:1}),this.orgedPoints.push({point:[d.x,d.y,d.z],normal:g.normal,scale:1}),this.points.push([l.x,l.y,l.z]),this.points.push(...e),this.points.push([d.x,d.y,d.z])}this.distances=[-s];for(let A=1,P=this.points.length,L=new Wr(...this.points[0]),I=new Wr;A<P;A+=1)I.set(...this.points[A]),this.distances.push(1===A?0:this.distances[A-1]+I.distanceTo(L)),L.copy(I);this.bufferGeometry=new Ho;const a=9;let[u,l,c]=this.points[0],h=0;const p=[];for(let A=0;A<this.orgedPoints.length;A+=1){const[t,e,n]=this.orgedPoints[A].point,[r,i]=this.orgedPoints[A].normal,o=this.orgedPoints[A].scale;let s=t-u,a=e-l,d=n-c;const f=Math.sqrt(s*s+a*a+d*d);s/=f,a/=f,d/=f,h+=3*f,this.options.strokeWidth?(p.push(t,e,n,-2,h,this.distances[A],r,i,o),p.push(t,e,n,-1,h,this.distances[A],r,i,o),p.push(t,e,n,1,h,this.distances[A],r,i,o),p.push(t,e,n,2,h,this.distances[A],r,i,o)):(p.push(t,e,n,-1,h,this.distances[A],r,i,o),p.push(t,e,n,1,h,this.distances[A],r,i,o)),u=t,l=e,c=n}const d=new Float32Array(p),f=this.options.strokeWidth?4:2,g=new Ch(d,a),m=new Ph(g,4,0,!1);this.bufferGeometry.setAttribute("last",m);const y=new Ph(g,4,a*f,!1);this.bufferGeometry.setAttribute("current",y);const v=new Ph(g,4,a*f*2,!1);this.bufferGeometry.setAttribute("next",v);const x=new Ph(g,1,a*f+4,!1);this.bufferGeometry.setAttribute("texoff",x);const _=new Ph(g,1,a*f+5,!1);this.bufferGeometry.setAttribute("progress",_);const b=new Ph(g,2,a*f+6,!1);this.bufferGeometry.setAttribute("normalVec",b);const w=new Ph(g,1,a*f+8,!1);this.bufferGeometry.setAttribute("normalScale",w);const M=new Ch(d.slice(a*f,p.length-a*f),a),E=new Ph(M,4,0);this.bufferGeometry.setAttribute("position",E),this.bufferGeometry.computeBoundingBox(),this.bufferGeometry.computeBoundingSphere(),this.bufferGeometry.computeVertexNormals();let S=[];if(this.options.strokeWidth){const t=[0,1,4,1,4,5,1,2,5,2,5,6,2,3,6,3,6,7];for(let e=4;e<p.length/a-8;e+=4){const n=e/4-1,r=t.map(t=>t+4*n);S=[...S,...r]}}else for(let A=2;A<p.length/a-4;A+=2)S.push(A-2,A-1,A),S.push(A,A-1,A+1);this.bufferGeometry.setIndex(S);const T=this.options.color?new Fw.a(this.options.color):new Fw.a("rgb(255, 255, 255)").alpha(0),C=this.options.strokeColor?new Fw.a(this.options.strokeColor):new Fw.a("rgb(240, 68, 55)");if(this.uniforms={stripTexture:{type:"t",value:null},fillColor:{type:"v4",value:new Ur(T.red()/255,T.green()/255,T.blue()/255,T.alpha())},strokeColor:{type:"v4",value:new Ur(C.red()/255,C.green()/255,C.blue()/255,C.alpha())},width:{type:"f",value:this.options.width||.3},strokeWidth:{type:"f",value:this.options.strokeWidth||.1},currentDistance:{type:"f",value:this.options.current||0},texOffset:{type:"f",value:0},fullLength:{type:"f",value:this.distances[this.distances.length-1]},viewDistance:{type:"f",value:this.options.viewDistance||15},gradientDistance:{type:"f",value:this.options.gradientDistance||4},gradientEnabled:{value:this.options.gradientEnabled||!1}},this.material=new ms({fragmentShader:$w.FragmentShader,vertexShader:$w.VertexShader,uniforms:this.uniforms,depthTest:!1,side:ct,transparent:!0,opacity:1,blending:ft,blendEquation:xt,blendSrc:At,blendDst:Pt}),this.options.textureUrl&&"repeat"===this.options.textureMode)(new Tf).load(this.options.textureUrl,t=>{t.wrapS=oe,t.wrapT=oe,t.generateMipmaps=!0,this.uniforms.stripTexture.value=t,this.needsUpdate=!0});else if(this.options.textureUrl&&"tail"===this.options.textureMode){const t=this.distances[this.distances.length-1];this.updateTailArrowPos(t)}this.mesh=new as(this.bufferGeometry,this.material),this.add(this.mesh)}getBestView(t,e,n){let r=this.getPointOnDistance(e+.2).point,i=t,o=e+1;for(;o<e+10;o+=1){const t=this.getPointOnDistance(o),e=(new Wr).subVectors(t.point,r),n=(new Wr).subVectors(r,i),s=Nr.radToDeg(e.angleTo(n));if(s>30){r=this.getPointOnDistance(o+.5).point,i=t.point;break}}let s=0;for(let a=o;a<n;a++){const t=this.getPointOnDistance(a),n=(new Wr).subVectors(t.point,r),o=(new Wr).subVectors(r,i),u=Nr.radToDeg(n.angleTo(o));if(u>32&&a-e>10){s=a;break}if(u>20&&a-e>15){s=a;break}}return s-e}getPointOnDistance(t){let e=0;const{distances:n,points:r}=this;let i=r.length-1,o=-1;while(e<i-1)if(o=Math.floor((e+i)/2),n[o]>t)i=o;else{if(!(n[o]<t)){e=o;break}e=o}if(o=e,o>-1){const e=new Wr(...r[o]);if(o===this.points.length-1||t<=0)return{point:e,index:o+1};const n=this.distances[o],i=new Wr(...this.points[o+1]),s=this.distances[o+1],a=s-n,u=i.clone().sub(e);return{point:e.clone().add(u.multiplyScalar((t-n)/a)),index:o+1}}throw new Error("Cannot find point on distance "+t)}getNearestPoint(t,e=0){const n=this.distances[this.distances.length-1];let r,i,o,s,a,u,l=8,c=new Wr,h=0,p=1/0,d=-1;for(let f,g,m=e;m<=n;m+=l)f=this.getPointOnDistance(m),g=t.distanceTo(f.point),g<p&&(c=f.point,h=m,p=g,d=f.index);l/=2;while(l>.1)o=h-l,a=t.distanceTo(r=this.getPointOnDistance(o).point),s=h+l,u=t.distanceTo(i=this.getPointOnDistance(s).point),o>=0&&a<p?(c=r,h=o,p=a):s<=n&&u<p?(c=i,h=s,p=u):l/=2;return{point:c,distance:h,index:d}}update(){const t=new pw(this);return!this.initialized&&this.ready?(this.initialized=!0,t.needUpdate=!0):this.needsUpdate&&(t.needUpdate=!0,this.needsUpdate=!1),this.options.animateEnabled&&(this.uniforms.texOffset.value=this.uniforms.texOffset.value-this.options.animateSpeed,t.needUpdate=!0),this.initialized&&!this.parent&&(t.shouldPlaceElement=!0),t}dispose(){super.dispose(),this.remove(this.mesh),this.material.dispose(),this.bufferGeometry.dispose()}setCurrent(t){this.uniforms.currentDistance.value=t,this.needsUpdate=!0}getCurrent(){return this.uniforms.currentDistance.value}setViewDistance(t){this.uniforms.viewDistance.value=t;const e=t+this.uniforms.currentDistance.value;if(this.options.textureUrl&&"tail"===this.options.textureMode){if(!this.tailArrow)return void setTimeout(()=>{this.setViewDistance(t)},1e3);this.updateTailArrowPos(e)}}updateTailArrowPos(t){if(!this.tailArrow)return void setTimeout(()=>{this.updateTailArrowPos(t)},1e3);this.tailArrow.visible=!0;const{index:e}=this.getPointOnDistance(t),n=this.orgedPoints[e],r=n.point[0],i=n.point[1],o=n.point[2],s=[-n.normal[1],n.normal[0]],a=Math.atan2(s[1],s[0]),u=a+Math.PI/2;this.tailArrow.position.set(r,i,o),this.tailArrow.rotation.z=u,this.needsUpdate=!0}getViewDistance(){return this.uniforms.viewDistance.value}}$w.VertexShader="\n    attribute vec4 last, current, next;\n    attribute vec2 normalVec;\n    attribute float normalScale;\n    attribute float texoff;\n    attribute float progress;\n\n    varying vec2 texcoord;\n    varying float vProgress;\n    varying float isBorder;\n\n    uniform float width;\n    uniform float texOffset;\n    uniform float strokeWidth;\n\n    float pi = 3.141592653589793;\n    float fwidth = width;\n    float swidth = strokeWidth;\n\n    vec4 transform(vec3 coord){\n      return projectionMatrix * modelViewMatrix * vec4(coord, 1.0);\n    }\n\n    void main(){\n      float off = 1.0;\n      if (current.w < 0.0 ) {\n        off = -1.0;\n      }\n      // float offsetW = fwidth / 2.0;\n      float offsetW = fwidth / 2.0 * normalScale;\n      float factor = 0.6 / fwidth * 0.2;\n      isBorder = -1.0;\n      if (abs(current.w) > 1.0) {\n        offsetW = (swidth + (fwidth / 2.0)) * normalScale;\n        isBorder = 1.0;\n      }\n\n      vec2 dir = vec2(normalVec.x, normalVec.y)*off;\n      vec3 pos = vec3(current.xy + dir * offsetW, 0.0);\n\n      texcoord = vec2(off*0.5+0.5, texoff * factor + texOffset);\n      vProgress = progress;\n\n      gl_Position = transform(pos);\n    }\n  ",$w.FragmentShader="\n    uniform sampler2D stripTexture;\n    uniform float currentDistance;\n    uniform float fullLength;\n    uniform float viewDistance;\n    uniform float gradientDistance;\n    uniform vec4 fillColor;\n    uniform vec4 strokeColor;\n    uniform bool gradientEnabled;\n\n    varying vec2 texcoord;\n    varying float vProgress;\n    varying float isBorder;\n\n    float opacity = 1.0;\n\n    void main(){\n      vec4 texColor = texture2D(stripTexture, texcoord);\n\n      float alpha = 1.0;\n      float cur = currentDistance;\n      float grad = gradientDistance;\n      float view = viewDistance;\n\n      if (gradientEnabled) {\n        if (vProgress < cur) {\n          alpha = 0.0;\n        } else {\n          if (vProgress > cur + view) {\n            alpha = 0.0;\n          } else {\n            if (fullLength <= cur + view) {\n              view = fullLength - cur;\n              if (view < 2.0 * grad) {\n                grad = view * 0.5;\n              }\n            }\n\n            if (vProgress > cur + grad) {\n              alpha = 1.0;\n              if (vProgress > cur + view - grad) {\n                  alpha = abs(cur + view - vProgress) / grad * 1.0;\n              }\n            } else {\n              alpha = abs(vProgress - cur) / grad * 1.0;\n            }\n          }\n        }\n      }\n      if (isBorder > -0.99) {\n        gl_FragColor = vec4(strokeColor.rgb, opacity * alpha * strokeColor.a);\n      } else {\n        gl_FragColor = vec4((fillColor * (1.0 - texColor.a) + texColor * texColor.a).rgb, opacity * alpha * (fillColor.a * (1.0 - texColor.a) + texColor.a));\n      }\n    }\n  ";class tM extends dw{constructor(t){super(),this.domElement=t,this.wrapper=document.createElement("div"),this.wrapper.appendChild(this.domElement),this.cssObject=new Lw(this.wrapper),this.add(this.cssObject),this.up.set(0,0,1),this.initialzed=!0,this.visibleRadius=1/0}setWrapperCSSClass(t){this.wrapper.className=t}setWrapperDomID(t){this.wrapper.id=t}update(){const t=new pw(this);return this.initialzed&&(t.shouldPlaceElement=!0,this.initialzed=!1),this.needUpdate&&(t.needUpdate=!0,this.needUpdate=!1),t}renderingViewChanged(t){let e=this.domElement;for(let n=0;n<3;n++){if(!e.parentElement)return;e=e.parentElement}if(t.container===e&&t.camera){if(Number.isFinite(this.visibleRadius)){const e=Math.pow(this.visibleRadius,2),n=t.camera.position.distanceToSquared(this.position)<e;this.visible=n}this.wrapper.style.visibility=this.visible?"visible":"hidden"}}}class eM extends tM{constructor(){super(document.createElement("div")),this.boundingBox=document.createElement("div"),this.textElement=document.createElement("div"),this.imageElement=document.createElement("img"),this.textPositionInfo={anchor:"center",offsetX:0,offsetY:0},this.imagePositionInfo={anchor:"center",offsetX:0,offsetY:0},this.imageElement.setAttribute("draggable","false"),this.textElement.style.cssText="\n      position: absolute;\n      transform: translate(-50%, -50%);\n      white-space: nowrap;\n      border-style: solid;\n      border-width: 0;\n      border-color: white;\n      line-height: 1.5;\n    ",this.imageElement.style.cssText="\n      position: absolute;\n      transform: translate(-50%, -50%);\n    ",this.boundingBox.style.cssText="\n      position: absolute;\n      transform: translate(-50%, -50%);\n      display: none;\n      border-style: solid;\n      border-width: 2px;\n      border-color: red;\n      border-radius: 4px;\n      pointer-events: none;\n    ",this.status="idle",this.mouseStart=new Or,this.mouseEnd=new Or,this.listeners={onImageLoaded:()=>{this.onImageLoaded()},onMouseDown:t=>{this.onMouseDown(t)},onMouseMove:t=>{this.onMouseMove(t)},onMouseUp:t=>{this.onMouseUp(t)},onTouchStart:t=>{this.onTouchStart(t)},onTouchMove:t=>{this.onTouchMove(t)},onTouchEnd:t=>{this.onTouchEnd(t)}},this.registerListeners(),this.domElement.appendChild(this.imageElement),this.domElement.appendChild(this.textElement),this.domElement.appendChild(this.boundingBox),this.calcBBoxNextFrame=!0}updateTextTransform(){const{offsetX:t,offsetY:e,anchor:n}=this.textPositionInfo,{x:r,y:i}=eM.ANCHOR_MAP[n];this.textElement.style.transform=`translate(${r}, ${i}) translate(${t}px, ${e}px)`}updateImageTransform(){const{offsetX:t,offsetY:e,anchor:n}=this.imagePositionInfo,{x:r,y:i}=eM.ANCHOR_MAP[n];this.imageElement.style.transform=`translate(${r}, ${i}) translate(${t}px, ${e}px)`}calcBBox(){if(!this.visible||"none"===this.boundingBox.style.display)return;const t=this.domElement.getBoundingClientRect(),e=this.textElement.getBoundingClientRect(),n=this.imageElement.getBoundingClientRect(),{left:r,right:i,top:o,bottom:s}=e,{left:a,right:u,top:l,bottom:c}=n,h=[];"none"!==this.textElement.style.display&&(h.push(new Or(r,o)),h.push(new Or(i,s))),"none"!==this.imageElement.style.display&&(h.push(new Or(a,l)),h.push(new Or(u,c)));let p=0,d=0,f=0,g=0;if(h.length){const e=(new Im).setFromPoints(h),{x:n,y:r}=t;p=e.max.x-e.min.x+12,d=e.max.y-e.min.y+12,f=e.min.x-n-6,g=e.min.y-r-6}this.boundingBox.style.transform=`translate(${f}px, ${g}px)`,this.boundingBox.style.width=p+"px",this.boundingBox.style.height=d+"px"}registerListeners(){this.imageElement.addEventListener("load",this.listeners.onImageLoaded),this.imageElement.addEventListener("pointerdown",this.listeners.onMouseDown),this.imageElement.addEventListener("touchstart",this.listeners.onTouchStart),this.imageElement.addEventListener("touchmove",this.listeners.onTouchMove),this.imageElement.addEventListener("touchend",this.listeners.onTouchEnd),this.textElement.addEventListener("pointerdown",this.listeners.onMouseDown),this.textElement.addEventListener("touchstart",this.listeners.onTouchStart),this.textElement.addEventListener("touchmove",this.listeners.onTouchMove),this.textElement.addEventListener("touchend",this.listeners.onTouchEnd)}unregisterListeners(){this.imageElement.removeEventListener("load",this.listeners.onImageLoaded),this.imageElement.removeEventListener("pointerdown",this.listeners.onMouseDown),this.imageElement.removeEventListener("touchstart",this.listeners.onTouchStart),this.imageElement.removeEventListener("touchmove",this.listeners.onTouchMove),this.imageElement.removeEventListener("touchend",this.listeners.onTouchEnd),this.textElement.removeEventListener("pointerdown",this.listeners.onMouseDown),this.textElement.removeEventListener("touchstart",this.listeners.onTouchStart),this.textElement.removeEventListener("touchmove",this.listeners.onTouchMove),this.textElement.removeEventListener("touchend",this.listeners.onTouchEnd)}onImageLoaded(){""===this.imageElement.style.width&&(this.imageElement.style.width=this.imageElement.width+"px"),""===this.imageElement.style.height&&(this.imageElement.style.height=this.imageElement.height+"px"),this.calcBBoxNextFrame=!0}onMouseDown(t){"idle"===this.status&&"mouse"===t.pointerType&&0===t.button&&(this.mouseStart.set(t.clientX,t.clientY),this.emit(aw.LABEL_DOWN,this,null,0),this.imageElement.ownerDocument.addEventListener("pointermove",this.listeners.onMouseMove),this.imageElement.ownerDocument.addEventListener("pointerup",this.listeners.onMouseUp),this.status="down")}onMouseMove(t){"down"===this.status&&"mouse"===t.pointerType&&0===t.button&&(this.status="move")}onMouseUp(t){"idle"!==this.status&&"mouse"===t.pointerType&&(this.mouseEnd.set(t.clientX,t.clientY),("down"===this.status||this.mouseStart.distanceToSquared(this.mouseEnd)<100)&&this.emit(aw.ELEMENT_SELECTED,this,null,0),this.imageElement.ownerDocument.removeEventListener("pointermove",this.listeners.onMouseMove),this.imageElement.ownerDocument.removeEventListener("pointerup",this.listeners.onMouseUp),this.status="idle")}onTouchStart(t){"idle"!==this.status||t.touches.length>1||(this.mouseStart.set(t.touches[0].pageX,t.touches[0].pageY),this.emit(aw.LABEL_DOWN,this,null,0),this.status="down")}onTouchMove(t){"down"!==this.status||t.touches.length>1||(this.status="move")}onTouchEnd(t){"idle"!==this.status&&(this.mouseEnd.set(t.changedTouches[0].pageX,t.changedTouches[0].pageY),("down"===this.status||this.mouseStart.distanceToSquared(this.mouseEnd)<100)&&this.emit(aw.ELEMENT_SELECTED,this,null,0),this.status="idle")}setAttributes({labelAttrs:t,imageAttrs:e,textAttrs:n}){void 0!==t&&this.setLabelAttrs(t),void 0!==e&&this.setImageAttrs(e),void 0!==n&&this.setTextAttrs(n)}setLabelAttrs(t){void 0!==t.position&&this.setPosition(t.position),void 0!==t.visible&&this.setVisible(t.visible),void 0!==t.bBoxVisible&&this.setBBoxVisible(t.bBoxVisible),void 0!==t.bBoxBorderWidth&&this.setBBoxBorderWidth(t.bBoxBorderWidth),void 0!==t.bBoxBorderColor&&this.setBBoxBorderColor(t.bBoxBorderColor)}setPosition(t){this.position.copy(t),this.needUpdate=!0}setVisible(t){this.visible=t,this.cssObject.visible=t,this.needUpdate=!0}setBBoxVisible(t){this.boundingBox.style.display=t?"block":"none",t&&(this.calcBBoxNextFrame=!0)}setBBoxBorderWidth(t){this.boundingBox.style.borderWidth=t+"px"}setBBoxBorderColor(t){this.boundingBox.style.borderColor=t}setImageAttrs(t){void 0!==t.src&&this.setImageSource(t.src),void 0!==t.visible&&this.setImageVisible(t.visible),void 0!==t.size&&this.setImageSize(t.size.width,t.size.height),void 0!==t.anchor&&this.setImageAnchor(t.anchor),void 0!==t.offset&&this.setImageOffset(t.offset.x,t.offset.y)}setImageVisible(t){this.imageElement.style.display=t?"block":"none"}setImageSource(t){this.imageElement.src=t}setImageSize(t,e){this.imageElement.style.height=e+"px",this.imageElement.style.width=t+"px",this.calcBBoxNextFrame=!0}setImageAnchor(t){this.imagePositionInfo.anchor=t,this.updateImageTransform(),this.calcBBoxNextFrame=!0}setImageOffset(t,e){this.imagePositionInfo.offsetX=t,this.imagePositionInfo.offsetY=e,this.updateImageTransform(),this.calcBBoxNextFrame=!0}setTextAttrs(t){void 0!==t.content&&this.setTextContent(t.content),void 0!==t.visible&&this.setTextVisible(t.visible),void 0!==t.fontSize&&this.setTextFontSize(t.fontSize),void 0!==t.color&&this.setTextColor(t.color),void 0!==t.padding&&this.setTextPadding(t.padding),void 0!==t.anchor&&this.setTextAnchor(t.anchor),void 0!==t.offset&&this.setTextOffset(t.offset.x,t.offset.y),void 0!==t.align&&this.setTextAlign(t.align),void 0!==t.borderWidth&&this.setTextBorderWidth(t.borderWidth),void 0!==t.borderColor&&this.setTextBorderColor(t.borderColor),void 0!==t.borderRadius&&this.setTextBorderRadius(t.borderRadius),void 0!==t.backgroundColor&&this.setTextBackgroundColor(t.backgroundColor)}setTextVisible(t){this.textElement.style.display=t?"block":"none",this.calcBBoxNextFrame=!0}setTextContent(t){this.textElement.innerText=t,this.calcBBoxNextFrame=!0}setTextFontSize(t){this.textElement.style.fontSize=t+"px",this.calcBBoxNextFrame=!0}setTextColor(t){this.textElement.style.color=t}setTextPadding(t){const e={left:0,right:0,top:0,bottom:0};void 0!==t.left&&(e.left=t.left),void 0!==t.right&&(e.right=t.right),void 0!==t.top&&(e.top=t.top),void 0!==t.bottom&&(e.bottom=t.bottom);const{left:n,right:r,top:i,bottom:o}=e;this.textElement.style.padding=`${i}px ${r}px ${o}px ${n}px`,this.calcBBoxNextFrame=!0}setTextAnchor(t){this.textPositionInfo.anchor=t,this.updateTextTransform(),this.calcBBoxNextFrame=!0}setTextOffset(t,e){this.textPositionInfo.offsetX=t,this.textPositionInfo.offsetY=e,this.updateTextTransform(),this.calcBBoxNextFrame=!0}setTextBorderWidth(t){this.textElement.style.borderWidth=t+"px",this.calcBBoxNextFrame=!0}setTextAlign(t){this.textElement.style.textAlign=t}setTextBorderColor(t){this.textElement.style.borderColor=t}setTextBorderRadius(t){this.textElement.style.borderRadius=t+"px"}setTextBackgroundColor(t){this.textElement.style.backgroundColor=t}setLabelID(t){this.labelID=t}update(){const t=new pw(this);return this.needCalcBBox&&this.calcBBox(),this.needCalcBBox=!1,this.calcBBoxNextFrame&&(this.needCalcBBox=!0),this.calcBBoxNextFrame=!1,this.initialzed&&(t.shouldPlaceElement=!0,this.initialzed=!1),this.needUpdate&&(t.needUpdate=!0,this.needUpdate=!1),t}dispose(){this.unregisterListeners(),this.domElement.removeChild(this.boundingBox),this.domElement.removeChild(this.textElement),this.domElement.removeChild(this.imageElement),super.dispose()}}eM.ANCHOR_MAP={center:{x:"-50%",y:"-50%"},left:{x:"0",y:"-50%"},right:{x:"-100%",y:"-50%"},top:{x:"-50%",y:"0"},bottom:{x:"-50%",y:"-100%"},topleft:{x:"0",y:"0"},topright:{x:"-100%",y:"0"},bottomleft:{x:"0",y:"-100%"},bottomright:{x:"-100%",y:"-100%"}};class nM extends sw{unbind(){this.eventMap.clear()}}var rM=function(t,e){void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new Wr,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Q.ROTATE,MIDDLE:Q.DOLLY,RIGHT:Q.PAN},this.touches={ONE:$.ROTATE,TWO:$.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.listenToKeyEvents=function(t){t.addEventListener("keydown",at),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),a=s.NONE},this.update=function(){var e=new Wr,i=(new jr).setFromUnitVectors(t.up,new Wr(0,1,0)),o=i.clone().invert(),f=new Wr,g=new jr,m=2*Math.PI;return function(){var t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(i),l.setFromVector3(e),n.autoRotate&&a===s.NONE&&S(M()),n.enableDamping?(l.theta+=c.theta*n.dampingFactor,l.phi+=c.phi*n.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);var y=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(y)&&isFinite(v)&&(y<-Math.PI?y+=m:y>Math.PI&&(y-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),l.theta=y<=v?Math.max(y,Math.min(v,l.theta)):l.theta>(y+v)/2?Math.max(y,l.theta):Math.min(v,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=h,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),!0===n.enableDamping?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),e.setFromSpherical(l),e.applyQuaternion(o),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),p.set(0,0,0)),h=1,!!(d||f.distanceToSquared(n.object.position)>u||8*(1-g.dot(n.object.quaternion))>u)&&(n.dispatchEvent(r),f.copy(n.object.position),g.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",ht),n.domElement.removeEventListener("pointerdown",tt),n.domElement.removeEventListener("wheel",st),n.domElement.removeEventListener("touchstart",ut),n.domElement.removeEventListener("touchend",ct),n.domElement.removeEventListener("touchmove",lt),n.domElement.ownerDocument.removeEventListener("pointermove",et),n.domElement.ownerDocument.removeEventListener("pointerup",nt),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",at)};var n=this,r={type:"change"},i={type:"start"},o={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},a=s.NONE,u=1e-6,l=new Am,c=new Am,h=1,p=new Wr,d=!1,f=new Or,g=new Or,m=new Or,y=new Or,v=new Or,x=new Or,_=new Or,b=new Or,w=new Or;function M(){return 2*Math.PI/60/60*n.autoRotateSpeed}function E(){return Math.pow(.95,n.zoomSpeed)}function S(t){c.theta-=t}function T(t){c.phi-=t}var C=function(){var t=new Wr;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),p.add(t)}}(),A=function(){var t=new Wr;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),p.add(t)}}(),P=function(){var t=new Wr;return function(e,r){var i=n.domElement;if(n.object.isPerspectiveCamera){var o=n.object.position;t.copy(o).sub(n.target);var s=t.length();s*=Math.tan(n.object.fov/2*Math.PI/180),C(2*e*s/i.clientHeight,n.object.matrix),A(2*r*s/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(C(e*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),A(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function L(t){n.object.isPerspectiveCamera?h/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(t){n.object.isPerspectiveCamera?h*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(t){f.set(t.clientX,t.clientY)}function N(t){_.set(t.clientX,t.clientY)}function O(t){y.set(t.clientX,t.clientY)}function D(t){g.set(t.clientX,t.clientY),m.subVectors(g,f).multiplyScalar(n.rotateSpeed);var e=n.domElement;S(2*Math.PI*m.x/e.clientHeight),T(2*Math.PI*m.y/e.clientHeight),f.copy(g),n.update()}function F(t){b.set(t.clientX,t.clientY),w.subVectors(b,_),w.y>0?L(E()):w.y<0&&I(E()),_.copy(b),n.update()}function k(t){v.set(t.clientX,t.clientY),x.subVectors(v,y).multiplyScalar(n.panSpeed),P(x.x,x.y),y.copy(v),n.update()}function B(){}function z(t){t.deltaY<0?I(E()):t.deltaY>0&&L(E()),n.update()}function G(t){var e=!1;switch(t.code){case n.keys.UP:P(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:P(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),n.update())}function U(t){if(1==t.touches.length)f.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);f.set(e,n)}}function V(t){if(1==t.touches.length)y.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);y.set(e,n)}}function H(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+n*n);_.set(0,r)}function j(t){n.enableZoom&&H(t),n.enablePan&&V(t)}function W(t){n.enableZoom&&H(t),n.enableRotate&&U(t)}function q(t){if(1==t.touches.length)g.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);g.set(e,r)}m.subVectors(g,f).multiplyScalar(n.rotateSpeed);var i=n.domElement;S(2*Math.PI*m.x/i.clientHeight),T(2*Math.PI*m.y/i.clientHeight),f.copy(g)}function Y(t){if(1==t.touches.length)v.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);v.set(e,r)}x.subVectors(v,y).multiplyScalar(n.panSpeed),P(x.x,x.y),y.copy(v)}function X(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);b.set(0,i),w.set(0,Math.pow(b.y/_.y,n.zoomSpeed)),L(w.y),_.copy(b)}function Z(t){n.enableZoom&&X(t),n.enablePan&&Y(t)}function K(t){n.enableZoom&&X(t),n.enableRotate&&q(t)}function J(){}function tt(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":rt(t);break}}function et(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":it(t);break}}function nt(t){switch(t.pointerType){case"mouse":case"pen":ot(t);break}}function rt(t){var e;switch(t.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Q.DOLLY:if(!1===n.enableZoom)return;N(t),a=s.DOLLY;break;case Q.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;O(t),a=s.PAN}else{if(!1===n.enableRotate)return;R(t),a=s.ROTATE}break;case Q.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;R(t),a=s.ROTATE}else{if(!1===n.enablePan)return;O(t),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&(n.domElement.ownerDocument.addEventListener("pointermove",et),n.domElement.ownerDocument.addEventListener("pointerup",nt),n.dispatchEvent(i))}function it(t){if(!1!==n.enabled)switch(t.preventDefault(),a){case s.ROTATE:if(!1===n.enableRotate)return;D(t);break;case s.DOLLY:if(!1===n.enableZoom)return;F(t);break;case s.PAN:if(!1===n.enablePan)return;k(t);break}}function ot(t){n.domElement.ownerDocument.removeEventListener("pointermove",et),n.domElement.ownerDocument.removeEventListener("pointerup",nt),!1!==n.enabled&&(B(t),n.dispatchEvent(o),a=s.NONE)}function st(t){!1===n.enabled||!1===n.enableZoom||a!==s.NONE&&a!==s.ROTATE||(t.preventDefault(),n.dispatchEvent(i),z(t),n.dispatchEvent(o))}function at(t){!1!==n.enabled&&!1!==n.enablePan&&G(t)}function ut(t){if(!1!==n.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(n.touches.ONE){case $.ROTATE:if(!1===n.enableRotate)return;U(t),a=s.TOUCH_ROTATE;break;case $.PAN:if(!1===n.enablePan)return;V(t),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(n.touches.TWO){case $.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;j(t),a=s.TOUCH_DOLLY_PAN;break;case $.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;W(t),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&n.dispatchEvent(i)}}function lt(t){if(!1!==n.enabled)switch(t.preventDefault(),a){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;q(t),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;Y(t),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;Z(t),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;K(t),n.update();break;default:a=s.NONE}}function ct(t){!1!==n.enabled&&(J(t),n.dispatchEvent(o),a=s.NONE)}function ht(t){!1!==n.enabled&&t.preventDefault()}n.domElement.addEventListener("contextmenu",ht),n.domElement.addEventListener("pointerdown",tt),n.domElement.addEventListener("wheel",st),n.domElement.addEventListener("touchstart",ut),n.domElement.addEventListener("touchend",ct),n.domElement.addEventListener("touchmove",lt),this.update()};rM.prototype=Object.create(Lr.prototype),rM.prototype.constructor=rM;var iM,oM,sM=function(t,e){rM.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Q.PAN,this.mouseButtons.RIGHT=Q.ROTATE,this.touches.ONE=$.PAN,this.touches.TWO=$.DOLLY_ROTATE};sM.prototype=Object.create(Lr.prototype),sM.prototype.constructor=sM;(function(t){t[t["IDLE"]=0]="IDLE",t[t["TO_MOVE_CAMERA"]=1]="TO_MOVE_CAMERA",t[t["MOVE_CAMERA"]=2]="MOVE_CAMERA"})(iM||(iM={}));(function(t){t[t["IDLE"]=0]="IDLE",t[t["TO_MOVE_ELEMENT"]=1]="TO_MOVE_ELEMENT",t[t["MOVE_ELEMENT"]=2]="MOVE_ELEMENT"})(oM||(oM={}));var aM=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};const uM=3/180*Math.PI;class lM extends nM{constructor(t,e,n){super(),this.hidePanoramas=!1,this.showModel=void 0===n||n,this.panoramaGroupChanged=!0,this.touches={s:[new Or,new Or],c:[new Or,new Or],state:"idle",dist:0,fov:60},this.touchStartHandler=t=>{const e=t.touches.length,n=t.targetTouches.length;for(let r=0;r<Math.min(e,2);r++){const e=t.touches[r];this.touches.s[r]=new Or(e.clientX,e.clientY)}this.touches.state="down",n>1&&this.view.camera instanceof vs&&(this.touches.state="zoom",this.touches.dist=this.touches.s[0].distanceTo(this.touches.s[1]),this.touches.fov=this.view.camera.fov)},this.touchMoveHandler=t=>{if(!this.view.camera||!(this.view.camera instanceof vs))return;if("idle"===this.touches.state)return;t.preventDefault(),t.stopPropagation();const e=t.touches.length;for(let n=0;n<Math.min(e,2);n++){const e=t.touches[n];this.touches.c[n]=new Or(e.clientX,e.clientY)}if("down"===this.touches.state&&this.touches.c[0].distanceToSquared(this.touches.s[0])>100)this.touches.state="move";else if("zoom"===this.touches.state){const t=this.touches.c[0].distanceTo(this.touches.c[1])-this.touches.dist,{innerWidth:e,innerHeight:n}=window,r=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),i=t/r;this.view.camera.fov=Math.min(Math.max(this.touches.fov-90*i,this.fovRange.min),this.fovRange.max),this.view.camera.updateProjectionMatrix(),this.orbitControl.rotateSpeed=-this.view.camera.fov/360*this.rotateSpeed,this.renderThisFrame()}},this.touchEndHandler=t=>aM(this,void 0,void 0,(function*(){if("idle"!==this.touches.state){if("down"===this.touches.state&&this.view.renderer){const e=new Or(this.touches.s[0].x,this.touches.s[0].y),{clientWidth:n,clientHeight:r}=this.view.container,{left:i,top:o}=this.view.container.getBoundingClientRect(),s=e.x-i,a=e.y-o;if(this.raycaster.setFromCamera({x:s,y:a},this.view.camera),this.currentPanoramaGroup){let e;e=this.onScreenDetectRadius>0&&this.view.camera?this.currentPanoramaGroup.intersectIndicatorsOnScreen(new Or(s,a),this.onScreenDetectRadius,{screenWidth:n,screenHeight:r},this.view.camera):this.currentPanoramaGroup.intersectIndicators(this.raycaster.ray.origin,this.raycaster.ray.direction),-1!==e&&(this.emit(aw.CLICK_PANORAMA,e,t),this.moveOnClick&&this.currentPanoramaGroup.currentPanoramaID!==e&&(yield this.moveToPanorama(e,{interval:1e3,showModel:!0,fadeInOut:!1})))}}this.touches.state="idle"}})),this.mouseDownHandler=t=>{"mouse"===t.pointerType&&(this.touches.s[0]=new Or(t.clientX,t.clientY),this.touches.state="down")},this.mouseMoveHandler=t=>{if("mouse"===t.pointerType&&(this.touches.c[0]=new Or(t.clientX,t.clientY),"down"===this.touches.state&&this.touches.c[0].distanceToSquared(this.touches.s[0])>100&&(this.touches.state="move"),this.raycaster&&this.captureMove)){const{clientWidth:e,clientHeight:n}=this.view.container,{left:r,top:i}=this.view.container.getBoundingClientRect(),o=t.clientX-r,s=t.clientY-i;if(this.raycaster.setFromCamera({x:o,y:s},this.view.camera),this.currentPanoramaGroup){let t;t=this.onScreenDetectRadius>0&&this.view.camera?this.currentPanoramaGroup.intersectIndicatorsOnScreen(new Or(o,s),this.onScreenDetectRadius,{screenWidth:e,screenHeight:n},this.view.camera):this.currentPanoramaGroup.intersectIndicators(this.raycaster.ray.origin,this.raycaster.ray.direction),t>-1&&this.emit(aw.PANORAMA_HOVER,t,this.currentPanoramaGroup.getIndicatorPosition(t))}}},this.mouseUpHandler=t=>aM(this,void 0,void 0,(function*(){if("mouse"===t.pointerType){if("down"===this.touches.state){const{clientWidth:e,clientHeight:n}=this.view.container,{left:r,top:i}=this.view.container.getBoundingClientRect(),o=t.clientX-r,s=t.clientY-i;if(this.raycaster&&(this.raycaster.setFromCamera({x:o,y:s},this.view.camera),this.onScreenDetectRadius&&this.currentPanoramaGroup)){let r;r=this.view.camera?this.currentPanoramaGroup.intersectIndicatorsOnScreen(new Or(o,s),this.onScreenDetectRadius,{screenWidth:e,screenHeight:n},this.view.camera):this.currentPanoramaGroup.intersectIndicators(this.raycaster.ray.origin,this.raycaster.ray.direction),-1!==r&&(this.emit(aw.CLICK_PANORAMA,r,t),0===t.button&&this.moveOnClick&&this.currentPanoramaGroup.currentPanoramaID!==r&&(yield this.moveToPanorama(r,{interval:1e3,showModel:!0,fadeInOut:!1})))}}this.touches.state="idle"}})),this.mouseWheelHandler=t=>{t.preventDefault(),this.view.camera instanceof vs&&(this.view.camera.fov=Math.min(Math.max(this.view.camera.fov-1.5*Math.sign(t.deltaY),this.fovRange.min),this.fovRange.max),this.view.camera.updateProjectionMatrix(),this.orbitControl.rotateSpeed=-this.view.camera.fov/360*this.rotateSpeed,this.renderThisFrame())},this.moveOnClick=!0,this.onScreenDetectRadius=1e3,this.rotateSpeed=1,t&&(this.bindView(t),this.renderThisFrame()),this.panoramaGroups=e?e instanceof Kw?[e]:e:[],this.panoramaGroups.length>0&&([this.currentPanoramaGroup]=this.panoramaGroups),this.pid2GroupMap=new Map;const r=void 0===n||!0===n||this.showModel;this.panoramaGroups.forEach(t=>{const e=lM.getModelMesh(t);this.setModelAppearance(t.modelElement,r,void 0,e)}),this.isAnimating=!1,this.rotationLocks={lockAzimuth:!1,lockPolar:!1,centralAzimuth:0,centralPolar:Math.PI/2,azimuthRange:Math.PI,polarRange:Math.PI/2},this.fovRange={min:60,max:90},this.raycaster=new Sm}static getModelVS(){const t="\n      uniform vec3 pano0Position;\n      uniform mat4 pano0Matrix;\n      uniform vec3 pano1Position;\n      uniform mat4 pano1Matrix;\n\n      varying vec3 vWorldPosition0;\n      varying vec3 vWorldPosition1;\n\n      void main() {\n\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n      vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\n      vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n      vWorldPosition0.y *= -1.0;\n\n      vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n      vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n      vWorldPosition1.y *= -1.0;\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }";return t}static getInstantTranslationVS(){const t="\n      uniform mat4 matrixT;\n\n      uniform vec3 pano0Position;\n      uniform mat4 pano0Matrix;\n      uniform vec3 pano1Position;\n      uniform mat4 pano1Matrix;\n\n      varying vec3 vWorldPosition0;\n      varying vec3 vWorldPosition1;\n\n      void main() {\n\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vec4 worldPosition0 = matrixT * worldPosition;\n\n      vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n      vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n      vWorldPosition1.y *= -1.0;\n\n      vec3 positionLocalToPanoCenter0 = worldPosition0.xyz - pano0Position;\n      vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n      vWorldPosition0.y *= -1.0;\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }";return t}static getModelFS(){const t="\n      uniform float weight0;\n      uniform float weight1;\n\n      uniform samplerCube pano0Map;\n\n      uniform samplerCube pano1Map;\n\n      varying vec3 vWorldPosition0;\n      varying vec3 vWorldPosition1;\n\n      void main() {\n      vec3 cp0 = vWorldPosition0.xyz;\n      vec3 cp1 = vWorldPosition1.xyz;\n      vec4 colorFromPano0 = textureCube( pano0Map, cp0);\n      vec4 colorFromPano1 = textureCube( pano1Map, cp1);\n\n      vec4 colorFromPanos;\n      // 'colorFromPanos = mix(colorFromPano0, colorFromPano1, progress);\n      colorFromPanos = colorFromPano0 * weight0 + colorFromPano1 * weight1;\n      gl_FragColor = vec4(colorFromPanos.rgb, 1.0);\n      }";return t}static debugModelVS(){const t="\n      uniform vec2 xRange;\n      uniform vec2 yRange;\n      uniform vec2 zRange;\n      varying vec4 vColor;\n\n      void main() {\n      vColor = vec4((position.x - xRange.x) / xRange.y, (position.y - yRange.x) / yRange.y, (position.z - zRange.x) / zRange.y, 1.0);\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n      }";return t}static debugModelFS(){const t="\n      varying vec4 vColor;\n\n      void main() {\n      gl_FragColor = vColor;\n      }";return t}dispose(){return aM(this,void 0,void 0,(function*(){this.modelMaterial&&this.modelMaterial.dispose(),this.instantTranslationMaterial&&this.instantTranslationMaterial.dispose(),this.setTouchEnabled(!1),this.setMouseClickEnabled(!1),Vw.disposeAll(),jw.disposeAll(),this.translatePromise&&(yield this.translatePromise)}))}setViewConfiguration(t,e){return aM(this,void 0,void 0,(function*(){if(this.hidePanoramas=t,this.showModel=e,this.currentPanoramaGroup){const n=yield this.currentPanoramaGroup.getPanoramaByPID(this.currentPanoramaGroup.currentPanoramaID);n&&n.addViewConfiguration({targetView:this.view,showSkyBox:!t}),this.setModelAppearance(this.currentPanoramaGroup.modelElement,e)}}))}bindElement(t){t instanceof Array?t.forEach(t=>{this.bindElement(t)}):(this.elements||(this.elements=new Set),this.elements.add(t))}unbindElement(t){t instanceof Array?t.forEach(t=>{this.unbindElement(t)}):this.elements&&this.elements.has(t)&&this.elements.delete(t)}addPanoramaGroups(t,e){let n;n=t instanceof Kw?[t]:t,this.panoramaGroups.push(...n);const r=void 0===e||!0===e||this.showModel;n.forEach(t=>{const e=lM.getModelMesh(t);this.setModelAppearance(t.modelElement,r,void 0,e)})}removePanoramaGroup(t){const e=this.panoramaGroups.indexOf(t);return e>=0&&(this.panoramaGroups=this.panoramaGroups.slice(0,e).concat(this.panoramaGroups.slice(e+1)),t===this.currentPanoramaGroup&&(this.currentPanoramaGroup=void 0),!0)}renderThisFrame(){this.renderFrame||(this.renderFrame=!0)}static getModelMeshInElement(t){let e;return t instanceof as?t:(t&&t.traverse(t=>{t instanceof as&&(e=t)}),e)}static getModelMesh(t){if(t&&t.modelElement)return lM.getModelMeshInElement(t.modelElement)}bindView(t){if(!t.camera||!t.renderer)throw new Error("No Camera or Renderer found in view");if(this.view=t,this.setTouchEnabled(!0),this.orbitControl=new rM(t.camera,t.container),this.orbitControl.addEventListener("start",()=>{this.renderThisFrame()}),this.orbitControl.addEventListener("end",()=>{this.renderThisFrame()}),this.orbitControl.addEventListener("change",()=>{this.emit(aw.PANORAMA_CAMERA_CHANGED,t.camera.position,t.camera.quaternion,this);const{lockAzimuth:e,lockPolar:n}=this.rotationLocks;let r=0,i=0;if(this.orbitControl.object instanceof vs){const{clientWidth:t,clientHeight:e}=this.view.container;r=this.orbitControl.object.fov/180*Math.PI,i=r*t/e}if(e){const{centralAzimuth:t,azimuthRange:e}=this.rotationLocks,n=this.orbitControl.getAzimuthalAngle();let r=t-e/2+i/2,o=t+e/2-i/2;r>Math.PI&&(r-=2*Math.PI),o<-Math.PI&&(o+=2*Math.PI),r>o?(this.orbitControl.minAzimuthAngle=t,this.orbitControl.maxAzimuthAngle=t):(r<-Math.PI&&(r+=2*Math.PI),o>Math.PI&&(o-=2*Math.PI),r>o?Math.abs(n)>Math.PI-uM?(this.orbitControl.minAzimuthAngle=-1/0,this.orbitControl.maxAzimuthAngle=1/0):n>0?(this.orbitControl.minAzimuthAngle=r,this.orbitControl.maxAzimuthAngle=1/0):n<0&&(this.orbitControl.minAzimuthAngle=-1/0,this.orbitControl.maxAzimuthAngle=o):(this.orbitControl.minAzimuthAngle=r,this.orbitControl.maxAzimuthAngle=o))}if(n){const{centralPolar:t,polarRange:e}=this.rotationLocks,n=this.orbitControl.getPolarAngle();let i=t-e/2+r/2,o=t+e/2-r/2;i>Math.PI&&(i-=Math.PI),o<0&&(o+=Math.PI),i>o?(this.orbitControl.minPolarAngle=t,this.orbitControl.maxPolarAngle=t):(i<0&&(i+=Math.PI),o>Math.PI&&(o-=Math.PI),i>o?Math.abs(n-Math.PI/2)>Math.PI/2-uM?(this.orbitControl.minPolarAngle=-1/0,this.orbitControl.maxPolarAngle=1/0):n>0?(this.orbitControl.minPolarAngle=i,this.orbitControl.maxPolarAngle=1/0):n<0&&(this.orbitControl.minPolarAngle=-1/0,this.orbitControl.maxPolarAngle=o):(this.orbitControl.minPolarAngle=i,this.orbitControl.maxPolarAngle=o))}this.renderThisFrame()}),this.orbitControl.rotateSpeed=lM.RotateSpeed,t.camera&&t.camera instanceof vs){const{fov:e}=t.camera;this.orbitControl.rotateSpeed=-e/360*this.rotateSpeed}this.setMouseControls({LEFT:Q.ROTATE,MIDDLE:Q.DOLLY,RIGHT:Q.PAN}),this.setTouchControls({ONE:$.ROTATE,TWO:$.PAN}),this.setDampingEnabled(!0),this.setDampingFactor(.25),this.setKeysEnabled(!1),this.setRotateEnabled(!0),this.setPanEnabled(!1),this.setZoomEnabled(!1),this.orbitControl.update(),this.setEnabled(!0),this.renderThisFrame()}unbind(){const t=Object.create(null,{unbind:{get:()=>super.unbind}});return aM(this,void 0,void 0,(function*(){t.unbind.call(this),this.orbitControl&&this.orbitControl.dispose(),yield this.dispose()}))}update(){this.orbitControl&&this.orbitControl.enabled&&this.orbitControl.update();let t=!0;return this.renderFrame||(t=!1),this.renderFrame=!1,t}setEnabled(t){this.orbitControl&&(this.orbitControl.enabled=t)}setKeysEnabled(t){this.orbitControl&&(this.orbitControl.enableKeys=t)}setMouseClickEnabled(t){return!!this.view.renderer&&(this.view.camera&&this.view.camera instanceof ys&&(t?(this.view.container.addEventListener("pointerup",this.mouseUpHandler,!1),this.view.container.addEventListener("pointermove",this.mouseMoveHandler,!1),this.view.container.addEventListener("pointerdown",this.mouseDownHandler,!1),this.view.container.addEventListener("wheel",this.mouseWheelHandler,!1)):(this.view.container.removeEventListener("pointerup",this.mouseUpHandler,!1),this.view.container.removeEventListener("pointermove",this.mouseMoveHandler,!1),this.view.container.removeEventListener("pointerdown",this.mouseDownHandler,!1),this.view.container.removeEventListener("wheel",this.mouseWheelHandler,!1))),!0)}setTouchEnabled(t){return!!this.view.renderer&&(this.view.camera&&this.view.camera instanceof ys&&(t?(this.view.container.addEventListener("touchstart",this.touchStartHandler,!1),this.view.container.addEventListener("touchmove",this.touchMoveHandler,!1),this.view.container.addEventListener("touchend",this.touchEndHandler,!1),this.view.container.addEventListener("touchcancel",this.touchEndHandler,!1)):(this.view.container.removeEventListener("touchstart",this.touchStartHandler),this.view.container.removeEventListener("touchmove",this.touchMoveHandler),this.view.container.removeEventListener("touchend",this.touchEndHandler),this.view.container.removeEventListener("touchcancel",this.touchEndHandler))),!0)}setDampingEnabled(t){this.orbitControl&&(this.orbitControl.enableDamping=t)}setRotateEnabled(t){this.orbitControl&&(this.orbitControl.enableRotate=t)}setPanEnabled(t){this.orbitControl&&(this.orbitControl.enablePan=t)}setZoomEnabled(t){this.orbitControl&&(this.orbitControl.enableZoom=t)}setZoom(t){if(this.orbitControl){if(!(this.view.camera instanceof vs)&&!(this.view.camera instanceof mg))throw new Error("Cannot set zoom for camera");this.view.camera.zoom=t,this.view.camera.updateProjectionMatrix(),this.renderFrame=!0}}setFOV(t){if(!this.orbitControl||!(this.view.camera instanceof vs))return;const e=Math.min(Math.max(t,this.fovRange.min),this.fovRange.max);this.view.camera.fov=e,this.view.camera.updateProjectionMatrix(),this.orbitControl.rotateSpeed=-e/360*this.rotateSpeed,this.renderFrame=!0}setFOVRange(t,e){this.fovRange.min=t,this.fovRange.max=e,this.orbitControl&&this.view.camera instanceof vs&&this.setFOV(this.view.camera.fov)}setDampingFactor(t){this.orbitControl&&(this.orbitControl.dampingFactor=t)}setPanSpeed(t){this.orbitControl&&(this.orbitControl.panSpeed=t)}setTouchControls(t){this.orbitControl&&(this.orbitControl.touches=t)}setMouseControls(t){this.orbitControl&&(this.orbitControl.mouseButtons=t)}setTarget(t,e,n){this.orbitControl&&(this.orbitControl.target.set(t,e,n),this.orbitControl.update())}setCameraPose(t,e,n=!0){this.view.camera&&this.view.camera.position.set(...t),n&&this.setTarget(...e),this.renderThisFrame()}getPanoramaOfPID(t){return aM(this,void 0,void 0,(function*(){const e=this.pid2GroupMap.get(t);if(e){const n=yield e.getPanoramaByPID(t);return{pano:n,panoramaGroup:e}}for(let n=0;n<this.panoramaGroups.length;n+=1){const e=this.panoramaGroups[n],r=yield e.getPanoramaByPID(t);if(r)return this.pid2GroupMap.set(t,e),{pano:r,panoramaGroup:e}}return{}}))}preloadCubeTexturesOfPIDs(t,e,n){return aM(this,void 0,void 0,(function*(){const r=yield Promise.all(t.map(t=>this.getPanoramaOfPID(t))),i=r.map(({pano:t})=>{if(t)return t.textureURLs});return jw.sharedInstance.preloadCubeTextures(i,e,n)}))}setCameraLookAt(t,e){const{x:n,y:r,z:i}=t;let o;o=e?e.clone().normalize():this.view.camera?this.view.camera.getWorldDirection(new Wr(0,0,-1)):new Wr(1,0,0);const s=o.multiplyScalar(lM.DirectionVectorScalar).add(t);this.setCameraPose([s.x,s.y,s.z],[n,r,i])}showPanorama(t,e){return aM(this,void 0,void 0,(function*(){const{lookDirection:n,target:r,showModel:i,preInitPanoramasStrategy:o}=e||{},{pano:s,panoramaGroup:a}=yield this.getPanoramaOfPID(t);if(a){if(this.currentPanoramaGroup!==a&&(this.panoramaGroupChanged=!0),this.currentPanoramaGroup=a,a.modelElement&&this.setModelAppearance(a.modelElement,!1,void 0),o&&a.initializePanoramasIfNecessary(o),a.panoramaIDsAround(t),a.presentPanoramaIndicatorsAround(t,this.view),s){if(n?this.setCameraLookAt(s.position,n):r&&this.setCameraLookAt(s.position,r.clone().sub(s.position)),s.legacyMode)yield a.presentPanoramaAround(t,[],[],this.view);else{const e=s.getIntersectedTiles(this.view.camera);yield a.presentPanoramaAround(t,e.hdTiles,e.ldTiles,this.view)}if(s.addViewConfiguration({targetView:this.view,showBorder:!1,showSkyBox:!this.hidePanoramas}),void 0===i||!0===i){const t=this.getModelMaterial(),e=t.uniforms;e.pano0Matrix.value=s.matrix,e.pano0Position.value=s.position,e.pano1Matrix.value=s.matrix,e.pano1Position.value=s.position,e.weight0.value=1,e.weight1.value=0;const n=yield jw.sharedInstance.preloadCubeTextures([s.textureURLs],1);[e.pano0Map.value,e.pano1Map.value]=[n[0],n[0]],this.setModelAppearance(a.modelElement,!0,t)}}return s}}))}lookFromPanorama(t,e,n,r){return aM(this,void 0,void 0,(function*(){const i=yield this.showPanorama(t,{lookDirection:e,showModel:n,preInitPanoramasStrategy:r});this.emit(aw.MOVE_TO_PANORAMA,t,i?i.position:null,this.panoramaGroupChanged),this.panoramaGroupChanged=!1}))}lookFromPanoramaTo(t,e,n,r){return aM(this,void 0,void 0,(function*(){const i=yield this.showPanorama(t,{target:e,showModel:n,preInitPanoramasStrategy:r});this.emit(aw.MOVE_TO_PANORAMA,t,i?i.position:null,this.panoramaGroupChanged),this.panoramaGroupChanged=!1}))}static createModelUniforms(){const t={weight0:{type:"f",value:0},weight1:{type:"f",value:0},pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new Wr},pano0Matrix:{type:"m4",value:new wi},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new Wr},pano1Matrix:{type:"m4",value:new wi}};return t}static createInstantTranslationUniforms(){const t={weight0:{type:"f",value:0},weight1:{type:"f",value:0},pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new Wr},pano0Matrix:{type:"m4",value:new wi},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new Wr},pano1Matrix:{type:"m4",value:new wi},matrixT:{type:"m4",value:new wi}};return t}getModelMaterial(){if(this.modelMaterial)return this.modelMaterial;const t=lM.createModelUniforms();return this.modelMaterial=new ms({side:ct,vertexShader:lM.getModelVS(),fragmentShader:lM.getModelFS(),uniforms:t,name:"modelMaterial"}),this.modelMaterial}getInstantTranslationMaterial(){if(this.instantTranslationMaterial)return this.instantTranslationMaterial;const t=lM.createInstantTranslationUniforms();return this.instantTranslationMaterial=new ms({side:ct,vertexShader:lM.getInstantTranslationVS(),fragmentShader:lM.getModelFS(),uniforms:t,name:"instantTranslationMaterial"}),this.instantTranslationMaterial}setModelAppearance(t,e,n,r){if(t)if(t instanceof vw)t.addViewConfiguration({targetView:this.view,visible:e,meshMaterial:n});else{t.visible=e;let i=r;i||(i=lM.getModelMeshInElement(t)),i&&n&&(i.material=n)}}setMoveOnClickEnabled(t){this.moveOnClick=t}moveToPanorama(t,e){return aM(this,void 0,void 0,(function*(){const n=e||{};return this.moveInPath([t],{queueIfBusy:!1,lookAtTargets:n.lookAtTarget,toDirections:n.toDirection,intervals:n.interval,fovs:n.fov,fadeInOuts:n.fadeInOut,easings:n.easing,freeRotation:!n.lookAtTarget,showModel:n.showModel,rotateDelays:n.rotateDelays})}))}moveToPanoramaSync(t,e){return aM(this,void 0,void 0,(function*(){const n=e||{};return this.moveInPath([t],{queueIfBusy:!0,lookAtTargets:n.lookAtTarget,toDirections:n.toDirection,intervals:n.interval,fovs:n.fov,fadeInOuts:n.fadeInOut,easings:n.easing,freeRotation:!n.lookAtTarget,showModel:n.showModel,rotateDelays:n.rotateDelays})}))}moveInPath(t,e){return aM(this,void 0,void 0,(function*(){if(0===t.length)return;const n=[],r=yield Promise.all(t.map(t=>this.getPanoramaOfPID(t)));r.forEach(t=>{t.pano&&n.push(t.pano.position.clone())});const{toDirections:i,lookAtTargets:o,intervals:s,fovs:a,easings:u,fadeInOuts:l,queueIfBusy:c,showModel:h,freeRotation:p,rotateDelays:d}=e||{},f=void 0===h||!0===h||this.showModel;let g,m,y,v,x=-1,_=!1;const b=jw.sharedInstance.getCapacity();let w,M,E;const S=t=>t,T=t=>t<.25?0:t>.75?1:2*(t-.25);let C;Array.isArray(l)?C=l.map(t=>t?T:S):!0===l&&(C=T),yield this.moveCameraInPath(n,{queueIfBusy:c,toDirections:i,lookAtTargets:o,intervals:s,fovs:a,easings:u,progressTransforms:C,freeRotation:p,rotateDelays:d,beforeAllMoves:()=>aM(this,void 0,void 0,(function*(){x=this.currentPanoramaGroup?this.currentPanoramaGroup.currentPanoramaID:-1,g=this.getModelMaterial(),m=g.uniforms,t.length>1&&this.emit(aw.PATH_MOVEMENT_START,t)})),onOneMoveStart:(e,n,r,i,o)=>aM(this,void 0,void 0,(function*(){if(v=t[e],w=yield this.getPanoramaOfPID(x),M=yield this.getPanoramaOfPID(v),!w.pano||!M.pano||!w.panoramaGroup||!M.panoramaGroup)return!1;w.modelMesh=lM.getModelMesh(w.panoramaGroup),M.modelMesh=lM.getModelMesh(M.panoramaGroup);const s=[x],a=new Set;a.add(x);for(let n=e;s.length<b&&n<t.length;n+=1)a.has(t[n])||(a.add(t[n]),s.push(t[n]));if(yield this.preloadCubeTexturesOfPIDs(s,s.length,s.map(t=>t===x)),this.emit(aw.WILL_MOVE_TO_PANORAMA,v,M.pano?M.pano.position:null),x===v)return!1;Array.isArray(l)?l.length>e?_=l[e]:l.length>0&&(_=l[l.length-1]):l&&(_=l);const u=w.panoramaGroup!==M.panoramaGroup;if(u?(g=this.getInstantTranslationMaterial(),m=g.uniforms):(g=this.getModelMaterial(),m=g.uniforms),!u&&!f){const t=M.pano.position.distanceTo(w.pano.position),e=new cs(5,2*(w.pano.position.z+.93),4*t);E=new as(e,g),E.position.copy(w.pano.position),E.up.set(0,0,1),E.lookAt(M.pano.position),M.panoramaGroup.add(E)}if([M].forEach(({panoramaGroup:t,modelMesh:e})=>{e&&t&&(y=e.material,w.panoramaGroup===M.panoramaGroup?this.setModelAppearance(t.modelElement,f,g,e):this.setModelAppearance(t.modelElement,!1,g,e),t.setBoundBoxAppearance(g),t.addGroupViewConfiguration({targetView:this.view,showBoundBox:!0}))}),w.pano.addViewConfiguration({targetView:this.view,showBorder:!1,showSkyBox:!1}),u){let t=new Wr(0,1,0);this.view.camera&&(t=this.view.camera.up);const e=(new wi).lookAt(r,n,t),s=(new wi).lookAt(o,i,t);m.matrixT.value=e.multiply((new wi).copy(s).invert())}m.pano0Matrix.value=w.pano.matrix,m.pano0Position.value=w.pano.position,m.pano1Matrix.value=M.pano.matrix,m.pano1Position.value=M.pano.position,m.weight0.value=1,m.weight1.value=0;const c=yield jw.sharedInstance.preloadCubeTextures([w.pano.textureURLs,M.pano.textureURLs],2,[!0,!1]);return[m.pano0Map.value,m.pano1Map.value]=c,u})),onOneMoveUpdate:(t,e)=>{if(x===v)return;const n=w.panoramaGroup!==M.panoramaGroup;n?e<.5?(m.weight0.value=1-2*e,m.weight1.value=0):(m.weight1.value=2*e-1,m.weight0.value=0):_?e<.25?(m.weight0.value=1-4*e,m.weight1.value=0):e>.75?(m.weight1.value=4*e-3,m.weight0.value=0):(m.weight1.value=0,m.weight0.value=0):(m.weight0.value=1-e,m.weight1.value=e)},onOneMoveComplete:e=>aM(this,void 0,void 0,(function*(){w.modelMesh&&w.panoramaGroup&&w.panoramaGroup!==M.panoramaGroup&&(f||this.setModelAppearance(w.panoramaGroup.modelElement,!1,y,w.modelMesh),w.panoramaGroup.addGroupViewConfiguration({targetView:this.view,showBoundBox:!1})),M.panoramaGroup.remove(E),this.emit(aw.MOVE_TO_PANORAMA,v,M.pano?M.pano.position:null,w.panoramaGroup!==M.panoramaGroup),this.panoramaGroupChanged=!1,e<t.length-1&&(x=t[e])})),afterAllMoves:()=>aM(this,void 0,void 0,(function*(){const e=M.pano.getIntersectedTiles(this.view.camera);yield M.panoramaGroup.presentPanoramaAround(v,e.hdTiles,e.ldTiles,this.view),M.pano.addViewConfiguration({targetView:this.view,showBorder:!1,showSkyBox:!this.hidePanoramas},!0),M.panoramaGroup.presentPanoramaIndicatorsAround(v,this.view),x!==v&&M&&w&&(M.modelMesh&&M.panoramaGroup&&(f||this.setModelAppearance(M.panoramaGroup.modelElement,!1,y,M.modelMesh),M.panoramaGroup.addGroupViewConfiguration({targetView:this.view,showBoundBox:!1})),M.panoramaGroup&&(this.currentPanoramaGroup=M.panoramaGroup)),t.length>1&&this.emit(aw.PATH_MOVEMENT_COMPLETED,t)}))})}))}moveCameraInPath(t,e){return aM(this,void 0,void 0,(function*(){if(!t||0===t.length)return;const{queueIfBusy:n=!1}=e||{};if(!n){if(this.isAnimating)return;this.isAnimating=!0}while(this.translatePromise)yield this.translatePromise;const r=new Promise(r=>aM(this,void 0,void 0,(function*(){const{beforeAllMoves:i,onOneMoveStart:o,onOneMoveUpdate:s,onOneMoveComplete:a,afterAllMoves:u}=e||{};let l=0;const c=()=>new Promise((n,r)=>aM(this,void 0,void 0,(function*(){if(!this.view.camera||this.cancelAnimation)return r(),void(this.cancelAnimation=!1);const{toDirections:i,lookAtTargets:u,intervals:c,fovs:h,easings:p,progressTransforms:d,freeRotation:f,rotateDelays:g}=e||{},m=this.orbitControl.target.clone(),y=t[l],v=y.clone().sub(m);let x=y.clone();Array.isArray(u)?u.length>l?x=u[l].clone():u.length>0&&(x=u[u.length-1].clone()):u instanceof Wr&&(x=u.clone());let _=0;g&&(Array.isArray(g)?g.length>l?_=g[l]:g.length>0&&(_=g[g.length-1]):_=g||0),u||!i?x.distanceToSquared(y)<1e-6?x=this.orbitControl.target.clone().sub(this.view.camera.position):x.sub(y):Array.isArray(i)?i.length>l?x=i[l]:i.length>0&&(x=i[i.length-1]):i instanceof Wr&&(x=i),x.normalize();const b=this.orbitControl.target.clone().sub(this.view.camera.position).normalize(),w=(new jr).setFromUnitVectors(this.view.camera.up,new Wr(0,1,0)),M=w.clone().invert();b.applyQuaternion(w),x.applyQuaternion(w);const E=(new Am).setFromVector3(b),S=(new Am).setFromVector3(x),T=E.theta-S.theta;b.applyQuaternion(M),x.applyQuaternion(M);let C=60,A=60;if(this.view.camera instanceof vs){const t=this.view.camera;A=t.fov,C=t.fov,Array.isArray(h)?h.length>l?C=h[l]:h.length>0&&(C=h[h.length-1]):h&&(C=h)}let P=1e3;Array.isArray(c)?c.length>l?P=c[l]:c.length>0&&(P=c[c.length-1]):c&&(P=c);let L,I=bw["a"].Easing.Linear.None;Array.isArray(p)?p.length>l?I=p[l]:p.length>0&&(I=p[p.length-1]):"function"===typeof p?I=p:0===l?(I=bw["a"].Easing.Quadratic.Out,l===t.length-1&&(I=bw["a"].Easing.Quadratic.InOut)):l===t.length-1&&(I=bw["a"].Easing.Quadratic.In),Array.isArray(d)?d.length>l?L=d[l]:d.length>0&&(L=d[d.length-1]):d&&(L=d);const R=y,N=x.clone().multiplyScalar(lM.DirectionVectorScalar).add(R),O=m,D=b.clone().multiplyScalar(lM.DirectionVectorScalar).add(O);let F=!1;o&&(F=yield o(l,O,D,R,N));const k=E.theta,B=Math.abs(T)>Math.PI?S.theta+Math.sign(T)*Math.PI*2:S.theta,z=E.phi,G=S.phi;new bw["a"].Tween({timer:0}).to({timer:P},P).easing(I).onStart(()=>{let t=F?N:D;const e=F?R:O;if(f){this.orbitControl.update();const n=this.orbitControl.target.clone(),r=this.orbitControl.object.position.clone(),i=n.sub(r).normalize();t=i.multiplyScalar(lM.DirectionVectorScalar).add(e)}this.setCameraPose([t.x,t.y,t.z],[e.x,e.y,e.z]),this.renderThisFrame()}).onUpdate(({timer:t})=>{const e=t/P;let n=(t-_)/(P-_);n=I(Math.max(Math.min(n,1),0));const r=k+(B-k)*n,i=z+(G-z)*n,o=L?L(e):e;if(!F){const t=new Am(1,i,Math.abs(r)>Math.PI?r-Math.sign(r)*Math.PI*2:r);t.makeSafe();const e=(new Wr).setFromSpherical(t).applyQuaternion(M),n=m.clone().addScaledVector(v,o);this.orbitControl.update();const s=this.orbitControl.target.clone(),a=this.orbitControl.object.position.clone(),u=s.sub(a).normalize(),l=b.clone().normalize(),c=u.distanceToSquared(l),h=(f&&c>1e-4?u:e).multiplyScalar(lM.DirectionVectorScalar).add(n);this.setCameraPose([h.x,h.y,h.z],[n.x,n.y,n.z])}const a=A+o*(C-A);this.setFOV(a),s&&s(l,e,o),this.renderThisFrame()}).onComplete(()=>aM(this,void 0,void 0,(function*(){if(!F){const t=y;this.orbitControl.update();const e=this.orbitControl.target.clone(),n=this.orbitControl.object.position.clone(),r=e.sub(n).normalize(),i=(f?r:x).clone().multiplyScalar(lM.DirectionVectorScalar).add(t);this.setCameraPose([i.x,i.y,i.z],[t.x,t.y,t.z])}this.renderThisFrame(),a&&(yield a(l)),n()}))).start()})));i&&(yield i());while(l<t.length){if(this.cancelAnimation)break;const t=c();yield t,l+=1}this.cancelAnimation||u&&(yield u()),this.cancelAnimation=!1,this.translatePromise=void 0,n||(this.isAnimating=!1),r()})));this.translatePromise=r,yield r}))}unlockRotation(){this.rotationLocks={lockAzimuth:!1,lockPolar:!1,centralAzimuth:0,centralPolar:Math.PI/2,azimuthRange:Math.PI,polarRange:Math.PI/2},this.orbitControl.maxAzimuthAngle=1/0,this.orbitControl.minAzimuthAngle=-1/0,this.orbitControl.maxPolarAngle=1/0,this.orbitControl.minPolarAngle=-1/0}unlockPolarAngle(){Object.assign(this.rotationLocks,{lockPolar:!1,centralPolar:Math.PI/2,polarRange:Math.PI/2}),this.orbitControl.maxPolarAngle=1/0,this.orbitControl.minPolarAngle=-1/0}lockPolarAngle(t){if(t<uM)throw new Error("Cannot set polar range smaller than "+uM);Object.assign(this.rotationLocks,{lockPolar:!0,polarRange:t,centralPolar:this.orbitControl.getPolarAngle()})}unlockAzimuthalAngle(){Object.assign(this.rotationLocks,{lockAzimuth:!1,centralAzimuth:0,azimuthRange:Math.PI}),this.orbitControl.maxAzimuthAngle=1/0,this.orbitControl.minAzimuthAngle=-1/0}lockAzimuthalAngle(t){if(t<uM)throw new Error("Cannot set azimuth range smaller than "+uM);Object.assign(this.rotationLocks,{lockAzimuth:!0,azimuthRange:t,centralAzimuth:this.orbitControl.getAzimuthalAngle()})}getPolarAngle(){return this.orbitControl.getPolarAngle()}getAzimuthalAngle(){return this.orbitControl.getAzimuthalAngle()}setCaptureMove(t){this.captureMove=t}setOnScreenDetectRadius(t){this.onScreenDetectRadius=t}setPolarAngleRange(t,e){this.orbitControl.minPolarAngle=t,this.orbitControl.maxPolarAngle=e}setAzimuthAngleRange(t,e){this.orbitControl.minAzimuthAngle=t,this.orbitControl.maxAzimuthAngle=e}setAzimuthAngle(t){const{minAzimuthAngle:e,maxAzimuthAngle:n}=this.orbitControl;this.setAzimuthAngleRange(t,t+1e-6),this.orbitControl.update(),this.setAzimuthAngleRange(e,n),this.orbitControl.update(),this.renderThisFrame()}setPolarAngle(t){const{minPolarAngle:e,maxPolarAngle:n}=this.orbitControl;this.setPolarAngleRange(t,t+1e-6),this.orbitControl.update(),this.setPolarAngleRange(e,n),this.orbitControl.update(),this.renderThisFrame()}stopMoving(){this.cancelAnimation=!1}}var cM;lM.RotateSpeed=-1,lM.DirectionVectorScalar=-1e-4,function(t){t[t["IDLE"]=0]="IDLE",t[t["TO_MOVE_CAMERA"]=1]="TO_MOVE_CAMERA",t[t["MOVE_CAMERA"]=2]="MOVE_CAMERA"}(cM||(cM={}));var hM=function(t,e){void 0===e&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),Yi.call(this),this.visible=!1,this.domElement=e;var n=new pM;this.add(n);var r=new fM;this.add(r);var i=this;G("camera",t),G("object",void 0),G("enabled",!0),G("axis",null),G("mode","translate"),G("translationSnap",null),G("rotationSnap",null),G("scaleSnap",null),G("space","world"),G("size",1),G("dragging",!1),G("showX",!0),G("showY",!0),G("showZ",!0);var o={type:"change"},s={type:"mouseDown"},a={type:"mouseUp",mode:i.mode},u={type:"objectChange"},l=new Sm;function c(t,e,n){for(var r=e.intersectObject(t,!0),i=0;i<r.length;i++)if(r[i].object.visible||n)return r[i];return!1}var h=new Wr,p=new Wr,d=new jr,f={X:new Wr(1,0,0),Y:new Wr(0,1,0),Z:new Wr(0,0,1)},g=new Wr,m=new Wr,y=new Wr,v=new Wr,x=new Wr,_=new Wr,b=0,w=new Wr,M=new jr,E=new Wr,S=new Wr,T=new jr,C=new jr,A=new Wr,P=new Wr,L=new jr,I=new Wr,R=new Wr,N=new jr,O=new jr,D=new Wr,F=new Wr,k=new Wr,B=new jr,z=new Wr;function G(t,e){var s=e;Object.defineProperty(i,t,{get:function(){return void 0!==s?s:e},set:function(e){s!==e&&(s=e,r[t]=e,n[t]=e,i.dispatchEvent({type:t+"-changed",value:e}),i.dispatchEvent(o))}}),i[t]=e,r[t]=e,n[t]=e}function U(t){if(i.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:t.button};var n=t.changedTouches?t.changedTouches[0]:t,r=e.getBoundingClientRect();return{x:(n.clientX-r.left)/r.width*2-1,y:-(n.clientY-r.top)/r.height*2+1,button:t.button}}function V(t){if(i.enabled)switch(t.pointerType){case"mouse":case"pen":i.pointerHover(U(t));break}}function H(t){i.enabled&&(i.domElement.style.touchAction="none",i.domElement.ownerDocument.addEventListener("pointermove",j),i.pointerHover(U(t)),i.pointerDown(U(t)))}function j(t){i.enabled&&i.pointerMove(U(t))}function W(t){i.enabled&&(i.domElement.style.touchAction="",i.domElement.ownerDocument.removeEventListener("pointermove",j),i.pointerUp(U(t)))}G("worldPosition",R),G("worldPositionStart",P),G("worldQuaternion",N),G("worldQuaternionStart",L),G("cameraPosition",w),G("cameraQuaternion",M),G("pointStart",g),G("pointEnd",m),G("rotationAxis",v),G("rotationAngle",b),G("eye",F),e.addEventListener("pointerdown",H),e.addEventListener("pointermove",V),i.domElement.ownerDocument.addEventListener("pointerup",W),this.dispose=function(){e.removeEventListener("pointerdown",H),e.removeEventListener("pointermove",V),i.domElement.ownerDocument.removeEventListener("pointermove",j),i.domElement.ownerDocument.removeEventListener("pointerup",W),this.traverse((function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},this.attach=function(t){return this.object=t,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(S,T,A),this.object.matrixWorld.decompose(R,N,D),C.copy(T).invert(),O.copy(N).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(w,M,E),F.copy(w).sub(R).normalize(),Yi.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(t){if(void 0!==this.object&&!0!==this.dragging){l.setFromCamera(t,this.camera);var e=c(n.picker[this.mode],l);this.axis=e?e.object.name:null}},this.pointerDown=function(t){if(void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis){l.setFromCamera(t,this.camera);var e=c(r,l,!0);if(e){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),k.copy(this.object.position),B.copy(this.object.quaternion),z.copy(this.object.scale),this.object.matrixWorld.decompose(P,L,I),g.copy(e.point).sub(P)}this.dragging=!0,s.mode=this.mode,this.dispatchEvent(s)}},this.pointerMove=function(t){var e=this.axis,n=this.mode,i=this.object,s=this.space;if("scale"===n?s="local":"E"!==e&&"XYZE"!==e&&"XYZ"!==e||(s="world"),void 0!==i&&null!==e&&!1!==this.dragging&&-1===t.button){l.setFromCamera(t,this.camera);var a=c(r,l,!0);if(a){if(m.copy(a.point).sub(P),"translate"===n)y.copy(m).sub(g),"local"===s&&"XYZ"!==e&&y.applyQuaternion(O),-1===e.indexOf("X")&&(y.x=0),-1===e.indexOf("Y")&&(y.y=0),-1===e.indexOf("Z")&&(y.z=0),"local"===s&&"XYZ"!==e?y.applyQuaternion(B).divide(A):y.applyQuaternion(C).divide(A),i.position.copy(y).add(k),this.translationSnap&&("local"===s&&(i.position.applyQuaternion(d.copy(B).invert()),-1!==e.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(B)),"world"===s&&(i.parent&&i.position.add(h.setFromMatrixPosition(i.parent.matrixWorld)),-1!==e.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(h.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==e.search("XYZ")){var w=m.length()/g.length();m.dot(g)<0&&(w*=-1),p.set(w,w,w)}else h.copy(g),p.copy(m),h.applyQuaternion(O),p.applyQuaternion(O),p.divide(h),-1===e.search("X")&&(p.x=1),-1===e.search("Y")&&(p.y=1),-1===e.search("Z")&&(p.z=1);i.scale.copy(z).multiply(p),this.scaleSnap&&(-1!==e.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){y.copy(m).sub(g);var M=20/R.distanceTo(h.setFromMatrixPosition(this.camera.matrixWorld));"E"===e?(v.copy(F),b=m.angleTo(g),x.copy(g).normalize(),_.copy(m).normalize(),b*=_.cross(x).dot(F)<0?1:-1):"XYZE"===e?(v.copy(y).cross(F).normalize(),b=y.dot(h.copy(v).cross(this.eye))*M):"X"!==e&&"Y"!==e&&"Z"!==e||(v.copy(f[e]),h.copy(f[e]),"local"===s&&h.applyQuaternion(N),b=y.dot(h.cross(F).normalize())*M),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===s&&"E"!==e&&"XYZE"!==e?(i.quaternion.copy(B),i.quaternion.multiply(d.setFromAxisAngle(v,b)).normalize()):(v.applyQuaternion(C),i.quaternion.copy(d.setFromAxisAngle(v,b)),i.quaternion.multiply(B).normalize())}this.dispatchEvent(o),this.dispatchEvent(u)}}},this.pointerUp=function(t){0===t.button&&(this.dragging&&null!==this.axis&&(a.mode=this.mode,this.dispatchEvent(a)),this.dragging=!1,this.axis=null)},this.getMode=function(){return i.mode},this.setMode=function(t){i.mode=t},this.setTranslationSnap=function(t){i.translationSnap=t},this.setRotationSnap=function(t){i.rotationSnap=t},this.setScaleSnap=function(t){i.scaleSnap=t},this.setSize=function(t){i.size=t},this.setSpace=function(t){i.space=t},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};hM.prototype=Object.assign(Object.create(Yi.prototype),{constructor:hM,isTransformControls:!0});var pM=function(){Yi.call(this),this.type="TransformControlsGizmo";var t=new xo({depthTest:!1,depthWrite:!1,transparent:!0,side:ct,fog:!1,toneMapped:!1}),e=new cp({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=t.clone();n.opacity=.15;var r=t.clone();r.opacity=.33;var i=t.clone();i.color.set(16711680);var o=t.clone();o.color.set(65280);var s=t.clone();s.color.set(255);var a=t.clone();a.opacity=.25;var u=a.clone();u.color.set(16776960);var l=a.clone();l.color.set(65535);var c=a.clone();c.color.set(16711935);var h=t.clone();h.color.set(16776960);var p=e.clone();p.color.set(16711680);var d=e.clone();d.color.set(65280);var f=e.clone();f.color.set(255);var g=e.clone();g.color.set(65535);var m=e.clone();m.color.set(16711935);var y=e.clone();y.color.set(16776960);var v=e.clone();v.color.set(7895160);var x=y.clone();x.opacity=.25;var _=new Np(0,.05,.2,12,1,!1),b=new cs(.125,.125,.125),w=new Ho;w.setAttribute("position",new Io([0,0,0,1,0,0],3));var M=function(t,e){for(var n=new Ho,r=[],i=0;i<=64*e;++i)r.push(0,Math.cos(i/32*Math.PI)*t,Math.sin(i/32*Math.PI)*t);return n.setAttribute("position",new Io(r,3)),n},E=function(){var t=new Ho;return t.setAttribute("position",new Io([0,0,0,1,1,1],3)),t},S={X:[[new as(_,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new as(_,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new mp(w,p)]],Y:[[new as(_,o),[0,1,0],null,null,"fwd"],[new as(_,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new mp(w,d),null,[0,0,Math.PI/2]]],Z:[[new as(_,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new as(_,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new mp(w,f),null,[0,-Math.PI/2,0]]],XYZ:[[new as(new Ad(.1,0),a.clone()),[0,0,0],[0,0,0]]],XY:[[new as(new Ls(.295,.295),u.clone()),[.15,.15,0]],[new mp(w,y),[.18,.3,0],null,[.125,1,1]],[new mp(w,y),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new as(new Ls(.295,.295),l.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new mp(w,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new mp(w,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new as(new Ls(.295,.295),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new mp(w,m),[.18,0,.3],null,[.125,1,1]],[new mp(w,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new as(new Np(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new as(new Np(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new as(new Np(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new as(new Ad(.2,0),n)]],XY:[[new as(new Ls(.4,.4),n),[.2,.2,0]]],YZ:[[new as(new Ls(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new as(new Ls(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},C={START:[[new as(new Ad(.01,2),r),null,null,null,"helper"]],END:[[new as(new Ad(.01,2),r),null,null,null,"helper"]],DELTA:[[new mp(E(),r),null,null,null,"helper"]],X:[[new mp(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mp(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mp(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={X:[[new mp(M(1,.5),p)],[new as(new Ad(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new mp(M(1,.5),d),null,[0,0,-Math.PI/2]],[new as(new Ad(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new mp(M(1,.5),f),null,[0,Math.PI/2,0]],[new as(new Ad(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new mp(M(1.25,1),x),null,[0,Math.PI/2,0]],[new as(new Np(.03,0,.15,4,1,!1),x),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new as(new Np(.03,0,.15,4,1,!1),x),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new as(new Np(.03,0,.15,4,1,!1),x),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new as(new Np(.03,0,.15,4,1,!1),x),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new mp(M(1,1),v),null,[0,Math.PI/2,0]]]},P={AXIS:[[new mp(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new as(new Fd(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new as(new Fd(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new as(new Fd(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new as(new Fd(1.25,.1,2,24),n)]],XYZE:[[new as(new Nd(.7,10,8),n)]]},I={X:[[new as(b,i),[.8,0,0],[0,0,-Math.PI/2]],[new mp(w,p),null,null,[.8,1,1]]],Y:[[new as(b,o),[0,.8,0]],[new mp(w,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new as(b,s),[0,0,.8],[Math.PI/2,0,0]],[new mp(w,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new as(b,u),[.85,.85,0],null,[2,2,.2]],[new mp(w,y),[.855,.98,0],null,[.125,1,1]],[new mp(w,y),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new as(b,l),[0,.85,.85],null,[.2,2,2]],[new mp(w,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new mp(w,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new as(b,c),[.85,0,.85],null,[2,.2,2]],[new mp(w,m),[.855,0,.98],null,[.125,1,1]],[new mp(w,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new as(new cs(.125,.125,.125),a.clone()),[1.1,0,0]]],XYZY:[[new as(new cs(.125,.125,.125),a.clone()),[0,1.1,0]]],XYZZ:[[new as(new cs(.125,.125,.125),a.clone()),[0,0,1.1]]]},R={X:[[new as(new Np(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new as(new Np(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new as(new Np(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new as(b,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new as(b,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new as(b,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new as(new cs(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new as(new cs(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new as(new cs(.2,.2,.2),n),[0,0,1.1]]]},N={X:[[new mp(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mp(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mp(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},O=function(t){var e=new Yi;for(var n in t)for(var r=t[n].length;r--;){var i=t[n][r][0].clone(),o=t[n][r][1],s=t[n][r][2],a=t[n][r][3],u=t[n][r][4];i.name=n,i.tag=u,o&&i.position.set(o[0],o[1],o[2]),s&&i.rotation.set(s[0],s[1],s[2]),a&&i.scale.set(a[0],a[1],a[2]),i.updateMatrix();var l=i.geometry.clone();l.applyMatrix4(i.matrix),i.geometry=l,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),e.add(i)}return e},D=new Wr(0,0,0),F=new Ri,k=new Wr(0,1,0),B=new Wr(0,0,0),z=new wi,G=new jr,U=new jr,V=new jr,H=new Wr(1,0,0),j=new Wr(0,1,0),W=new Wr(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo["translate"]=O(S)),this.add(this.gizmo["rotate"]=O(A)),this.add(this.gizmo["scale"]=O(I)),this.add(this.picker["translate"]=O(T)),this.add(this.picker["rotate"]=O(L)),this.add(this.picker["scale"]=O(R)),this.add(this.helper["translate"]=O(C)),this.add(this.helper["rotate"]=O(P)),this.add(this.helper["scale"]=O(N)),this.picker["translate"].visible=!1,this.picker["rotate"].visible=!1,this.picker["scale"].visible=!1,this.updateMatrixWorld=function(){var t=this.space;"scale"===this.mode&&(t="local");var e="local"===t?this.worldQuaternion:V;this.gizmo["translate"].visible="translate"===this.mode,this.gizmo["rotate"].visible="rotate"===this.mode,this.gizmo["scale"].visible="scale"===this.mode,this.helper["translate"].visible="translate"===this.mode,this.helper["rotate"].visible="rotate"===this.mode,this.helper["scale"].visible="scale"===this.mode;var n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(var r=0;r<n.length;r++){var i,o=n[r];if(o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"!==o.tag){if(o.quaternion.copy(e),"translate"===this.mode||"scale"===this.mode){var s=.99,a=.2,u=0;"X"!==o.name&&"XYZX"!==o.name||Math.abs(k.copy(H).applyQuaternion(e).dot(this.eye))>s&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"!==o.name&&"XYZY"!==o.name||Math.abs(k.copy(j).applyQuaternion(e).dot(this.eye))>s&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"!==o.name&&"XYZZ"!==o.name||Math.abs(k.copy(W).applyQuaternion(e).dot(this.eye))>s&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs(k.copy(W).applyQuaternion(e).dot(this.eye))<a&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs(k.copy(H).applyQuaternion(e).dot(this.eye))<a&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs(k.copy(j).applyQuaternion(e).dot(this.eye))<a&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),-1!==o.name.search("X")&&(k.copy(H).applyQuaternion(e).dot(this.eye)<u?"fwd"===o.tag?o.visible=!1:o.scale.x*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Y")&&(k.copy(j).applyQuaternion(e).dot(this.eye)<u?"fwd"===o.tag?o.visible=!1:o.scale.y*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Z")&&(k.copy(W).applyQuaternion(e).dot(this.eye)<u?"fwd"===o.tag?o.visible=!1:o.scale.z*=-1:"bwd"===o.tag&&(o.visible=!1))}else"rotate"===this.mode&&(U.copy(e),k.copy(this.eye).applyQuaternion(G.copy(e).invert()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix(z.lookAt(this.eye,B,j)),"X"===o.name&&(G.setFromAxisAngle(H,Math.atan2(-k.y,k.z)),G.multiplyQuaternions(U,G),o.quaternion.copy(G)),"Y"===o.name&&(G.setFromAxisAngle(j,Math.atan2(k.x,k.z)),G.multiplyQuaternions(U,G),o.quaternion.copy(G)),"Z"===o.name&&(G.setFromAxisAngle(W,Math.atan2(k.y,k.x)),G.multiplyQuaternions(U,G),o.quaternion.copy(G)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._opacity=o.material._opacity||o.material.opacity,o.material._color=o.material._color||o.material.color.clone(),o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled?this.axis&&(o.name===this.axis||this.axis.split("").some((function(t){return o.name===t}))?(o.material.opacity=1,o.material.color.lerp(new vo(1,1,1),.5)):(o.material.opacity*=.25,o.material.color.lerp(new vo(1,1,1),.5))):(o.material.opacity*=.5,o.material.color.lerp(new vo(1,1,1),.5))}else o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&(G.setFromEuler(F.set(0,0,0)),o.quaternion.copy(e).multiply(G),Math.abs(k.copy(H).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),"Y"===this.axis&&(G.setFromEuler(F.set(0,0,Math.PI/2)),o.quaternion.copy(e).multiply(G),Math.abs(k.copy(j).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),"Z"===this.axis&&(G.setFromEuler(F.set(0,Math.PI/2,0)),o.quaternion.copy(e).multiply(G),Math.abs(k.copy(W).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),"XYZE"===this.axis&&(G.setFromEuler(F.set(0,Math.PI/2,0)),k.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(z.lookAt(B,k,j)),o.quaternion.multiply(G),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),D.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),D.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(D),o.visible=this.dragging):(o.quaternion.copy(e),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)))}Yi.prototype.updateMatrixWorld.call(this)}};pM.prototype=Object.assign(Object.create(Yi.prototype),{constructor:pM,isTransformControlsGizmo:!0});var dM,fM=function(){as.call(this,new Ls(1e5,1e5,2,2),new xo({visible:!1,wireframe:!0,side:ct,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var t=new Wr(1,0,0),e=new Wr(0,1,0),n=new Wr(0,0,1),r=new Wr,i=new Wr,o=new Wr,s=new wi,a=new jr;this.updateMatrixWorld=function(){var u=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(u="local"),t.set(1,0,0).applyQuaternion("local"===u?this.worldQuaternion:a),e.set(0,1,0).applyQuaternion("local"===u?this.worldQuaternion:a),n.set(0,0,1).applyQuaternion("local"===u?this.worldQuaternion:a),o.copy(e),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(t),i.copy(t).cross(o);break;case"Y":o.copy(this.eye).cross(e),i.copy(e).cross(o);break;case"Z":o.copy(this.eye).cross(n),i.copy(n).cross(o);break;case"XY":i.copy(n);break;case"YZ":i.copy(t);break;case"XZ":o.copy(n),i.copy(e);break;case"XYZ":case"E":i.set(0,0,0);break}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(r.set(0,0,0),i,o),this.quaternion.setFromRotationMatrix(s)),Yi.prototype.updateMatrixWorld.call(this)}};fM.prototype=Object.assign(Object.create(as.prototype),{constructor:fM,isTransformControlsPlane:!0}),function(t){t[t["IDLE"]=0]="IDLE",t[t["DOWN"]=1]="DOWN",t[t["MOVE"]=2]="MOVE"}(dM||(dM={}));var gM;(function(t){t[t["IDLE"]=0]="IDLE",t[t["ROTATE"]=1]="ROTATE",t[t["ORBIT"]=2]="ORBIT",t[t["PAN"]=3]="PAN",t[t["DOLLY"]=4]="DOLLY",t[t["TOUCH_ROTATE"]=5]="TOUCH_ROTATE",t[t["TOUCH_ORBIT"]=6]="TOUCH_ORBIT",t[t["TOUCH_PAN"]=7]="TOUCH_PAN",t[t["TOUCH_DOLLY_ROTATE"]=8]="TOUCH_DOLLY_ROTATE",t[t["TOUCH_DOLLY_PAN"]=9]="TOUCH_DOLLY_PAN",t[t["TOUCH_MAP"]=10]="TOUCH_MAP"})(gM||(gM={}));window.innerWidth},"4c3b":function(t,e,n){var r=n("5bc4"),i={x:!1,y:!1};function o(t,e,n){if("Z"!==e){if("M"!==e){var r=[!1,i.x,i.y].concat(n),o=t.bind.apply(t,r),s=new o,a=n.slice(-2);return i={x:a[0],y:a[1]},s}i={x:n[0],y:n[1]}}}function s(t,e){var n,i,s,a=r(e).split(" "),u=new RegExp("[MLCQZ]",""),l=[],c={C:6,Q:4,L:2,M:2};while(a.length)n=a.splice(0,1)[0],u.test(n)&&(s=a.splice(0,c[n]).map(parseFloat),i=o(t,n,s),i&&l.push(i));return new t.PolyBezier(l)}t.exports=s},"4f4d":function(t,e,n){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},5414:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i,o=n("9cb8"),s=n("f0b4"),a=n("fce6"),u=n("d777"),l=n("4546"),c=n("d777"),h="auto",p="center",d="justify",f="Change.konva",g="2d",m="-",y="left",v="text",x="Text",_="top",b="bottom",w="middle",M="normal",E="px ",S=" ",T="right",C="word",A="char",P="none",L="…",I=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],R=I.length;function N(){return i||(i=o.Util.createCanvasElement().getContext(g),i)}function O(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function D(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function F(t){return t=t||{},t.fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}String.prototype.trimRight;var k=function(t){function e(e){var n=t.call(this,F(e))||this;n._partialTextX=0,n._partialTextY=0;for(var r=0;r<R;r++)n.on(I[r]+f,n._setTextData);return n._setTextData(),n}return r(e,t),e.prototype._sceneFunc=function(t){var e,n=this.padding(),r=this.fontSize(),i=this.lineHeight()*r,o=this.textArr,s=o.length,a=this.verticalAlign(),u=0,l=this.align(),c=this.getWidth(),h=this.letterSpacing(),f=this.fill(),g=this.textDecoration(),m=-1!==g.indexOf("underline"),v=-1!==g.indexOf("line-through"),x=0,_=(x=i/2,0),M=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",w),t.setAttr("textAlign",y),a===w?u=(this.getHeight()-s*i-2*n)/2:a===b&&(u=this.getHeight()-s*i-2*n),t.translate(n,u+n),e=0;e<s;e++){_=0,M=0;var E,S,C,A=o[e],P=A.text,L=A.width,I=e!==s-1;if(t.save(),l===T?_+=c-L-2*n:l===p&&(_+=(c-L-2*n)/2),m&&(t.save(),t.beginPath(),t.moveTo(_,x+M+Math.round(r/2)),E=P.split(" ").length-1,S=0===E,C=l===d&&I&&!S?c-2*n:L,t.lineTo(_+Math.round(C),x+M+Math.round(r/2)),t.lineWidth=r/15,t.strokeStyle=f,t.stroke(),t.restore()),v&&(t.save(),t.beginPath(),t.moveTo(_,x+M),E=P.split(" ").length-1,S=0===E,C=l===d&&I&&!S?c-2*n:L,t.lineTo(_+Math.round(C),x+M),t.lineWidth=r/15,t.strokeStyle=f,t.stroke(),t.restore()),0!==h||l===d){E=P.split(" ").length-1;for(var R=0;R<P.length;R++){var N=P[R];" "===N&&e!==s-1&&l===d&&(_+=Math.floor((c-2*n-L)/E)),this._partialTextX=_,this._partialTextY=x+M,this._partialText=N,t.fillStrokeShape(this),_+=Math.round(this.measureSize(N).width)+h}}else this._partialTextX=_,this._partialTextY=x+M,this._partialText=P,t.fillStrokeShape(this);t.restore(),s>1&&(x+=i)}},e.prototype._hitFunc=function(t){var e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)},e.prototype.setText=function(t){var e=o.Util._isString(t)?t:null===t||void 0===t?"":t+"";return this._setAttr(v,e),this},e.prototype.getWidth=function(){var t=this.attrs.width===h||void 0===this.attrs.width;return t?this.getTextWidth()+2*this.padding():this.attrs.width},e.prototype.getHeight=function(){var t=this.attrs.height===h||void 0===this.attrs.height;return t?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height},e.prototype.getTextWidth=function(){return this.textWidth},e.prototype.getTextHeight=function(){return o.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},e.prototype.measureSize=function(t){var e,n=N(),r=this.fontSize();return n.save(),n.font=this._getContextFont(),e=n.measureText(t),n.restore(),{width:e.width,height:r}},e.prototype._getContextFont=function(){return u.Konva.UA.isIE?this.fontStyle()+S+this.fontSize()+E+this.fontFamily():this.fontStyle()+S+this.fontVariant()+S+this.fontSize()+E+this.fontFamily()},e.prototype._addTextLine=function(t){this.align()===d&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e})},e.prototype._getTextWidth=function(t){var e=this.letterSpacing(),n=t.length;return N().measureText(t).width+(n?e*(n-1):0)},e.prototype._setTextData=function(){var t=this.text().split("\n"),e=+this.fontSize(),n=0,r=this.lineHeight()*e,i=this.attrs.width,o=this.attrs.height,s=i!==h&&void 0!==i,a=o!==h&&void 0!==o,u=this.padding(),l=i-2*u,c=o-2*u,p=0,d=this.wrap(),f=d!==P,g=d!==A&&f,y=this.ellipsis()&&!f;this.textArr=[],N().font=this._getContextFont();for(var v=y?this._getTextWidth(L):0,x=0,_=t.length;x<_;++x){var b=t[x],w=this._getTextWidth(b);if(s&&w>l)while(b.length>0){var M=0,E=b.length,T="",C=0;while(M<E){var I=M+E>>>1,R=b.slice(0,I+1),O=this._getTextWidth(R)+v;O<=l?(M=I+1,T=R+(y?L:""),C=O):E=I}if(!T)break;if(g){var D,F=b[T.length],k=F===S||F===m;D=k&&C<=l?T.length:Math.max(T.lastIndexOf(S),T.lastIndexOf(m))+1,D>0&&(M=D,T=T.slice(0,M),C=this._getTextWidth(T))}if(T=T.trimRight(),this._addTextLine(T),n=Math.max(n,C),p+=r,!f||a&&p+r>c)break;if(b=b.slice(M),b=b.trimLeft(),b.length>0&&(w=this._getTextWidth(b),w<=l)){this._addTextLine(b),p+=r,n=Math.max(n,w);break}}else this._addTextLine(b),p+=r,n=Math.max(n,w);if(a&&p+r>c)break}this.textHeight=e,this.textWidth=n},e.prototype.getStrokeScaleEnabled=function(){return!0},e}(a.Shape);e.Text=k,k.prototype._fillFunc=O,k.prototype._strokeFunc=D,k.prototype.className=x,k.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight"],c._registerNode(k),s.Factory.overWriteSetter(k,"width",l.getNumberOrAutoValidator()),s.Factory.overWriteSetter(k,"height",l.getNumberOrAutoValidator()),s.Factory.addGetterSetter(k,"fontFamily","Arial"),s.Factory.addGetterSetter(k,"fontSize",12,l.getNumberValidator()),s.Factory.addGetterSetter(k,"fontStyle",M),s.Factory.addGetterSetter(k,"fontVariant",M),s.Factory.addGetterSetter(k,"padding",0,l.getNumberValidator()),s.Factory.addGetterSetter(k,"align",y),s.Factory.addGetterSetter(k,"verticalAlign",_),s.Factory.addGetterSetter(k,"lineHeight",1,l.getNumberValidator()),s.Factory.addGetterSetter(k,"wrap",C),s.Factory.addGetterSetter(k,"ellipsis",!1),s.Factory.addGetterSetter(k,"letterSpacing",0,l.getNumberValidator()),s.Factory.addGetterSetter(k,"text","",l.getStringValidator()),s.Factory.addGetterSetter(k,"textDecoration",""),o.Collection.mapMethods(k)},5664:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,o,a,u,l,c,p,d=e&&e.length,f=d?e[0]*n:t.length,g=i(t,0,f,n,!0),m=[];if(!g||g.next===g.prev)return m;if(d&&(g=h(t,e,g,n)),t.length>80*n){r=a=t[0],o=u=t[1];for(var y=n;y<f;y+=n)l=t[y],c=t[y+1],l<r&&(r=l),c<o&&(o=c),l>a&&(a=l),c>u&&(u=c);p=Math.max(a-r,u-o),p=0!==p?32767/p:0}return s(g,m,n,r,o,p,0),m}function i(t,e,n,r,i){var o,s;if(i===O(t,e,n,r)>0)for(o=e;o<n;o+=r)s=I(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=I(o,t[o],t[o+1],s);return s&&M(s,s.next)&&(R(s),s=s.next),s}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!M(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(R(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function s(t,e,n,r,i,h,p){if(t){!p&&h&&m(t,r,i,h);var d,f,g=t;while(t.prev!==t.next)if(d=t.prev,f=t.next,h?u(t,r,i,h):a(t))e.push(d.i/n|0),e.push(t.i/n|0),e.push(f.i/n|0),R(t),t=f.next,g=f.next;else if(t=f,t===g){p?1===p?(t=l(o(t),e,n),s(t,e,n,r,i,h,2)):2===p&&c(t,e,n,r,i,h):s(o(t),e,n,r,i,h,1);break}}}function a(t){var e=t.prev,n=t,r=t.next;if(w(e,n,r)>=0)return!1;var i=e.x,o=n.x,s=r.x,a=e.y,u=n.y,l=r.y,c=i<o?i<s?i:s:o<s?o:s,h=a<u?a<l?a:l:u<l?u:l,p=i>o?i>s?i:s:o>s?o:s,d=a>u?a>l?a:l:u>l?u:l,f=r.next;while(f!==e){if(f.x>=c&&f.x<=p&&f.y>=h&&f.y<=d&&_(i,a,o,u,s,l,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,s=t.next;if(w(i,o,s)>=0)return!1;var a=i.x,u=o.x,l=s.x,c=i.y,h=o.y,p=s.y,d=a<u?a<l?a:l:u<l?u:l,f=c<h?c<p?c:p:h<p?h:p,g=a>u?a>l?a:l:u>l?u:l,m=c>h?c>p?c:p:h>p?h:p,y=v(d,f,e,n,r),x=v(g,m,e,n,r),b=t.prevZ,M=t.nextZ;while(b&&b.z>=y&&M&&M.z<=x){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=m&&b!==i&&b!==s&&_(a,c,u,h,l,p,b.x,b.y)&&w(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,M.x>=d&&M.x<=g&&M.y>=f&&M.y<=m&&M!==i&&M!==s&&_(a,c,u,h,l,p,M.x,M.y)&&w(M.prev,M,M.next)>=0)return!1;M=M.nextZ}while(b&&b.z>=y){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=m&&b!==i&&b!==s&&_(a,c,u,h,l,p,b.x,b.y)&&w(b.prev,b,b.next)>=0)return!1;b=b.prevZ}while(M&&M.z<=x){if(M.x>=d&&M.x<=g&&M.y>=f&&M.y<=m&&M!==i&&M!==s&&_(a,c,u,h,l,p,M.x,M.y)&&w(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function l(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!M(i,s)&&E(i,r,r.next,s)&&A(i,s)&&A(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),R(r),R(r.next),r=t=s),r=r.next}while(r!==t);return o(r)}function c(t,e,n,r,i,a){var u=t;do{var l=u.next.next;while(l!==u.prev){if(u.i!==l.i&&b(u,l)){var c=L(u,l);return u=o(u,u.next),c=o(c,c.next),s(u,e,n,r,i,a,0),void s(c,e,n,r,i,a,0)}l=l.next}u=u.next}while(u!==t)}function h(t,e,n,r){var o,s,a,u,l,c=[];for(o=0,s=e.length;o<s;o++)a=e[o]*r,u=o<s-1?e[o+1]*r:t.length,l=i(t,a,u,r,!1),l===l.next&&(l.steiner=!0),c.push(x(l));for(c.sort(p),o=0;o<c.length;o++)n=d(c[o],n);return n}function p(t,e){return t.x-e.x}function d(t,e){var n=f(t,e);if(!n)return e;var r=L(n,t);return o(r,r.next),o(n,n.next)}function f(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==e);if(!n)return null;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&_(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),A(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}function g(t,e){return w(t.prev,t,e.prev)<0&&w(e.next,t,t.next)<0}function m(t,e,n,r){var i=t;do{0===i.z&&(i.z=v(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,y(i)}function y(t){var e,n,r,i,o,s,a,u,l=1;do{n=t,t=null,o=null,s=0;while(n){for(s++,r=n,a=0,e=0;e<l;e++)if(a++,r=r.nextZ,!r)break;u=l;while(a>0||u>0&&r)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1);return t}function v(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function x(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function _(t,e,n,r,i,o,s,a){return(i-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(n-s)*(e-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function b(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!C(t,e)&&(A(t,e)&&A(e,t)&&P(t,e)&&(w(t.prev,t,e.prev)||w(t,e.prev,e))||M(t,e)&&w(t.prev,t,t.next)>0&&w(e.prev,e,e.next)>0)}function w(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function M(t,e){return t.x===e.x&&t.y===e.y}function E(t,e,n,r){var i=T(w(t,e,n)),o=T(w(t,e,r)),s=T(w(n,r,t)),a=T(w(n,r,e));return i!==o&&s!==a||(!(0!==i||!S(t,n,e))||(!(0!==o||!S(t,r,e))||(!(0!==s||!S(n,t,r))||!(0!==a||!S(n,e,r)))))}function S(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function T(t){return t>0?1:t<0?-1:0}function C(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&E(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function A(t,e){return w(t.prev,t,t.next)<0?w(t,e,t.next)>=0&&w(t,t.prev,e)>=0:w(t,e,t.prev)<0||w(t,t.next,e)<0}function P(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function L(t,e){var n=new N(t.i,t.x,t.y),r=new N(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function I(t,e,n,r){var i=new N(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function N(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,s=Math.abs(O(t,0,o,n));if(i)for(var a=0,u=e.length;a<u;a++){var l=e[a]*n,c=a<u-1?e[a+1]*n:t.length;s-=Math.abs(O(t,l,c,n))}var h=0;for(a=0;a<r.length;a+=3){var p=r[a]*n,d=r[a+1]*n,f=r[a+2]*n;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},"595b":function(t,e,n){(function(t){!function(t,n){n(e)}(0,(function(e){"use strict";var n=6371008.8,r={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*n,kilometers:6371.0088,kilometres:6371.0088,meters:n,metres:n,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:n/1852,radians:1,yards:6967335.223679999},i={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n,yards:1.0936133},o={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function s(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function a(t,e,n){switch(t){case"Point":return u(e).geometry;case"LineString":return p(e).geometry;case"Polygon":return c(e).geometry;case"MultiPoint":return m(e).geometry;case"MultiLineString":return g(e).geometry;case"MultiPolygon":return y(e).geometry;default:throw new Error(t+" is invalid")}}function u(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!A(t[0])||!A(t[1]))throw new Error("coordinates must contain numbers");return s({type:"Point",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return u(t,e)})),n)}function c(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:t},e,n)}function h(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return c(t,e)})),n)}function p(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:t},e,n)}function d(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return p(t,e)})),n)}function f(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function g(t,e,n){return void 0===n&&(n={}),s({type:"MultiLineString",coordinates:t},e,n)}function m(t,e,n){return void 0===n&&(n={}),s({type:"MultiPoint",coordinates:t},e,n)}function y(t,e,n){return void 0===n&&(n={}),s({type:"MultiPolygon",coordinates:t},e,n)}function v(t,e,n){return void 0===n&&(n={}),s({type:"GeometryCollection",geometries:t},e,n)}function x(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function _(t,e){void 0===e&&(e="kilometers");var n=r[e];if(!n)throw new Error(e+" units is invalid");return t*n}function b(t,e){void 0===e&&(e="kilometers");var n=r[e];if(!n)throw new Error(e+" units is invalid");return t/n}function w(t,e){return E(b(t,e))}function M(t){var e=t%360;return e<0&&(e+=360),e}function E(t){return t%(2*Math.PI)*180/Math.PI}function S(t){return t%360*Math.PI/180}function T(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return _(b(t,e),n)}function C(t,e,n){if(void 0===e&&(e="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=o[e];if(!r)throw new Error("invalid original units");var i=o[n];if(!i)throw new Error("invalid final units");return t/r*i}function A(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function P(t){return!!t&&t.constructor===Object}function L(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!A(t))throw new Error("bbox must only contain numbers")}))}function I(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}var R=Object.freeze({__proto__:null,earthRadius:n,factors:r,unitsFactors:i,areaFactors:o,feature:s,geometry:a,point:u,points:l,polygon:c,polygons:h,lineString:p,lineStrings:d,featureCollection:f,multiLineString:g,multiPoint:m,multiPolygon:y,geometryCollection:v,round:x,radiansToLength:_,lengthToRadians:b,lengthToDegrees:w,bearingToAzimuth:M,radiansToDegrees:E,degreesToRadians:S,convertLength:T,convertArea:C,isNumber:A,isObject:P,validateBBox:L,validateId:I});function N(t,e,n){if(null!==t)for(var r,i,o,s,a,u,l,c,h=0,p=0,d=t.type,f="FeatureCollection"===d,g="Feature"===d,m=f?t.features.length:1,y=0;y<m;y++){a=(c=!!(l=f?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var v=0;v<a;v++){var x=0,_=0;if(null!==(s=c?l.geometries[v]:l)){u=s.coordinates;var b=s.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(u,p,y,x,_))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],p,y,x,_))return!1;p++,"MultiPoint"===b&&x++}"LineString"===b&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===e(u[r][i],p,y,x,_))return!1;p++}"MultiLineString"===b&&x++,"Polygon"===b&&_++}"Polygon"===b&&x++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(_=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===e(u[r][i][o],p,y,x,_))return!1;p++}_++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===N(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function O(t,e,n,r){var i=n;return N(t,(function(t,r,o,s,a){i=0===r&&void 0===n?t:e(i,t,r,o,s,a)}),r),i}function D(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function F(t,e,n){var r=n;return D(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r}function k(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function B(t,e,n){var r=n;return k(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r}function z(t){var e=[];return N(t,(function(t){e.push(t)})),e}function G(t,e){var n,r,i,o,s,a,u,l,c,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,g=d?t.features.length:1;for(n=0;n<g;n++){for(a=d?t.features[n].geometry:f?t.geometry:t,l=d?t.features[n].properties:f?t.properties:{},c=d?t.features[n].bbox:f?t.bbox:void 0,h=d?t.features[n].id:f?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,h))return!1;p++}}function U(t,e,n){var r=n;return G(t,(function(t,i,o,s,a){r=0===i&&void 0===n?t:e(r,t,i,o,s,a)})),r}function V(t,e){G(t,(function(t,n,r,i,o){var a,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(s(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(u){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c=t.coordinates[l];if(!1===e(s({type:a,coordinates:c},r),n,l))return!1}}))}function H(t,e,n){var r=n;return V(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r}function j(t,e){V(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,u=0,l=0;return!1!==N(t,(function(o,c,h,d,f){if(void 0===s||n>a||d>u||f>l)return s=o,a=n,u=d,l=f,void(i=0);var g=p([s,o],t.properties);if(!1===e(g,n,r,f,i))return!1;i++,s=o}))&&void 0}}}))}function W(t,e,n){var r=n,i=!1;return j(t,(function(t,o,s,a,u){r=!1===i&&void 0===n?t:e(r,t,o,s,a,u),i=!0})),r}function q(t,e){if(!t)throw new Error("geojson is required");V(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(p(o[s],t.properties),n,r,s))return!1}}}))}function Y(t,e,n){var r=n;return q(t,(function(t,i,o,s){r=0===i&&void 0===n?t:e(r,t,i,o,s)})),r}function X(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),p([u[s],u[s+1]],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s-1),p([u[o][s],u[o][s+1]],a,e);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),p([u[i][s],u[i][s+1]],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),s<0&&(s=u[i][o].length-s-1),p([u[i][o][s],u[i][o][s+1]],a,e)}throw new Error("geojson is invalid")}function Z(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":return u(l,a,e);case"MultiPoint":return i<0&&(i=l.length+i),u(l[i],a,e);case"LineString":return s<0&&(s=l.length+s),u(l[s],a,e);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s),u(l[o][s],a,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s),u(l[i][s],a,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),s<0&&(s=l[i][o].length-s),u(l[i][o][s],a,e)}throw new Error("geojson is invalid")}var K=Object.freeze({__proto__:null,coordAll:z,coordEach:N,coordReduce:O,featureEach:k,featureReduce:B,findPoint:Z,findSegment:X,flattenEach:V,flattenReduce:H,geomEach:G,geomReduce:U,lineEach:q,lineReduce:Y,propEach:D,propReduce:F,segmentEach:j,segmentReduce:W});function J(t){var e=[1/0,1/0,-1/0,-1/0];return N(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function Q(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function $(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function tt(t){if(t.length>1&&A(t[0])&&A(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return tt(t[0]);throw new Error("coordinates must only contain numbers")}function et(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}function nt(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function rt(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0,i=t.features;r<i.length;r++){var o=i[r];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!o.geometry||o.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+o.geometry.type)}}function it(t){return"Feature"===t.type?t.geometry:t}function ot(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}J.default=J;var st=Object.freeze({__proto__:null,getCoord:Q,getCoords:$,containsNumber:tt,geojsonType:et,featureOf:nt,collectionOf:rt,getGeom:it,getType:ot}),at=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;
/*
    object-assign
    (c) Sindre Sorhus
    @license MIT
    */function ct(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var ht=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,r,i=ct(t),o=1;o<arguments.length;o++){for(var s in n=Object(arguments[o]))ut.call(n,s)&&(i[s]=n[s]);if(at){r=at(n);for(var a=0;a<r.length;a++)lt.call(n,r[a])&&(i[r[a]]=n[r[a]])}}return i},pt={successCallback:null,verbose:!1},dt={};
/**
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */function ft(t,e,n){n=n||{};for(var r=Object.keys(pt),i=0;i<r.length;i++){var o=r[i],s=n[o];s=null!=s?s:pt[o],dt[o]=s}dt.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var a=function(t){var e=[],n=0,r=1e-7;return t.cells.forEach((function(i,o){i.forEach((function(i,s){if(void 0!==i&&5!==(d=i).cval&&10!==d.cval&&!mt(i)){var a=function(t,e,n){var r,i,o=t.length,s=[],a=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],u=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],l=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],h=t[e][n],p=h.cval,d=l[p],f=vt(h,d);s.push([n+f[0],e+f[1]]),d=c[p],f=vt(h,d),s.push([n+f[0],e+f[1]]),yt(h);for(var g=n+a[p],m=e+u[p],y=p;g>=0&&m>=0&&m<o&&(g!=n||m!=e)&&void 0!==(h=t[m][g]);){if(0===(p=h.cval)||15===p)return{path:s,info:"mergeable"};d=c[p],r=a[p],i=u[p],5!==p&&10!==p||(5===p?h.flipped?-1===u[y]?(d="left",r=-1,i=0):(d="right",r=1,i=0):-1===a[y]&&(d="bottom",r=0,i=-1):10===p&&(h.flipped?-1===a[y]?(d="top",r=0,i=1):(d="bottom",r=0,i=-1):1===u[y]&&(d="left",r=-1,i=0))),f=vt(h,d),s.push([g+f[0],m+f[1]]),yt(h),g+=r,m+=i,y=p}return{path:s,info:"closed"}}(t.cells,o,s),u=!1;if("mergeable"===a.info)for(var l=a.path[a.path.length-1][0],c=a.path[a.path.length-1][1],h=n-1;h>=0;h--)if(Math.abs(e[h][0][0]-l)<=r&&Math.abs(e[h][0][1]-c)<=r){for(var p=a.path.length-2;p>=0;--p)e[h].unshift(a.path[p]);u=!0;break}u||(e[n++]=a.path)}var d}))})),e}(function(t,e){for(var n=t.length-1,r=t[0].length-1,i={rows:n,cols:r,cells:[]},o=0;o<n;++o){i.cells[o]=[];for(var s=0;s<r;++s){var a=0,u=t[o+1][s],l=t[o+1][s+1],c=t[o][s+1],h=t[o][s];if(!(isNaN(u)||isNaN(l)||isNaN(c)||isNaN(h))){a|=u>=e?8:0,a|=l>=e?4:0,a|=c>=e?2:0;var p,d,f,g,m=!1;if(5===(a|=h>=e?1:0)||10===a){var y=(u+l+c+h)/4;5===a&&y<e?(a=10,m=!0):10===a&&y<e&&(a=5,m=!0)}0!==a&&15!==a&&(p=d=f=g=.5,1===a?(f=1-gt(e,u,h),d=1-gt(e,c,h)):2===a?(d=gt(e,h,c),g=1-gt(e,l,c)):3===a?(f=1-gt(e,u,h),g=1-gt(e,l,c)):4===a?(p=gt(e,u,l),g=gt(e,c,l)):5===a?(p=gt(e,u,l),g=gt(e,c,l),d=1-gt(e,c,h),f=1-gt(e,u,h)):6===a?(d=gt(e,h,c),p=gt(e,u,l)):7===a?(f=1-gt(e,u,h),p=gt(e,u,l)):8===a?(f=gt(e,h,u),p=1-gt(e,l,u)):9===a?(d=1-gt(e,c,h),p=1-gt(e,l,u)):10===a?(p=1-gt(e,l,u),g=1-gt(e,l,c),d=gt(e,h,c),f=gt(e,h,u)):11===a?(p=1-gt(e,l,u),g=1-gt(e,l,c)):12===a?(f=gt(e,h,u),g=gt(e,c,l)):13===a?(d=1-gt(e,c,h),g=gt(e,c,l)):14===a?(f=gt(e,h,u),d=gt(e,h,c)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+a),i.cells[o][s]={cval:a,flipped:m,top:p,right:g,bottom:d,left:f})}}}return i}(t,e));return"function"==typeof dt.successCallback&&dt.successCallback(a),a}function gt(t,e,n){return(t-e)/(n-e)}function mt(t){return 0===t.cval||15===t.cval}function yt(t){mt(t)||5===t.cval||10===t.cval||(t.cval=15)}function vt(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function xt(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;rt(t,"Point","input must contain Points");for(var o=function(t,e){var n={};return k(t,(function(t){var e=$(t)[1];n[e]||(n[e]=[]),n[e].push(t)})),Object.keys(n).map((function(t){return n[t].sort((function(t,e){return $(t)[0]-$(e)[0]}))})).sort((function(t,n){return e?$(t[0])[1]-$(n[0])[1]:$(n[0])[1]-$(t[0])[1]}))}(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],l=[],c=0;c<u.length;c++){var h=u[c];h.properties[n]?l.push(h.properties[n]):l.push(0),!0===i&&(h.properties.matrixPosition=[a,c])}s.push(l)}return s}var _t=wt,bt=wt;function wt(t,e,n,r,i){Mt(t,e,n||0,r||t.length-1,i||St)}function Mt(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);Mt(t,e,Math.max(n,Math.floor(e-s*u/o+l)),Math.min(r,Math.floor(e+(o-s)*u/o+l)),i)}var c=t[e],h=n,p=r;for(Et(t,n,e),i(t[r],c)>0&&Et(t,n,r);h<p;){for(Et(t,h,p),h++,p--;i(t[h],c)<0;)h++;for(;i(t[p],c)>0;)p--}0===i(t[n],c)?Et(t,n,p):Et(t,++p,r),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function Et(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function St(t,e){return t<e?-1:t>e?1:0}_t.default=bt;var Tt=At,Ct=At;function At(t,e){if(!(this instanceof At))return new At(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Pt(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function Lt(t,e){It(t,0,t.children.length,e,t)}function It(t,e,n,r,i){i||(i=zt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],Rt(i,t.leaf?r(o):o);return i}function Rt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Nt(t,e){return t.minX-e.minX}function Ot(t,e){return t.minY-e.minY}function Dt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Ft(t){return t.maxX-t.minX+(t.maxY-t.minY)}function kt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Bt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function zt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Gt(t,e,n,r,i){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=r||(o=e+Math.ceil((n-e)/r/2)*r,_t(t,o,e,n,i),s.push(e,o,o,n))}function Ut(t){var e={exports:{}};return t(e,e.exports),e.exports}At.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!Bt(t,e))return n;for(var i,o,s,a,u=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],Bt(t,a=e.leaf?r(s):s)&&(e.leaf?n.push(s):kt(t,a)?this._all(s,n):u.push(s));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!Bt(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],Bt(t,s=e.leaf?n(o):o)){if(e.leaf||kt(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=zt([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),u=[],l=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=l.pop(),o=!0),s.leaf&&-1!==(i=Pt(t,s.children,e)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!kt(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),l.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:Nt,compareMinY:Ot,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return Lt(i=zt(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=zt([])).leaf=!1,i.height=r;var a,u,l,c,h=Math.ceil(o/s),p=h*Math.ceil(Math.sqrt(s));for(Gt(t,e,n,p,this.compareMinX),a=e;a<=n;a+=p)for(Gt(t,a,l=Math.min(a+p-1,n),h,this.compareMinY),u=a;u<=l;u+=h)c=Math.min(u+h-1,l),i.children.push(this._build(t,u,c,r-1));return Lt(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,u,l,c,h,p,d;r.push(e),!e.leaf&&r.length-1!==n;){for(c=h=1/0,i=0,o=e.children.length;i<o;i++)u=Dt(s=e.children[i]),p=t,d=s,(l=(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-u)<h?(h=l,c=u<c?u:c,a=s):l===h&&u<c&&(c=u,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),Rt(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=zt(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,Lt(n,this.toBBox),Lt(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=zt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Lt(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,u,l,c,h,p,d,f,g,m;for(u=l=1/0,r=e;r<=n-e;r++)i=It(t,0,r,this.toBBox),o=It(t,r,n,this.toBBox),h=i,p=o,d=void 0,f=void 0,g=void 0,m=void 0,d=Math.max(h.minX,p.minX),f=Math.max(h.minY,p.minY),g=Math.min(h.maxX,p.maxX),m=Math.min(h.maxY,p.maxY),s=Math.max(0,g-d)*Math.max(0,m-f),a=Dt(i)+Dt(o),s<u?(u=s,c=r,l=a<l?a:l):s===u&&a<l&&(l=a,c=r);return c},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:Nt,i=t.leaf?this.compareMinY:Ot;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=It(t,0,e,s),u=It(t,n-e,n,s),l=Ft(a)+Ft(u);for(i=e;i<n-e;i++)o=t.children[i],Rt(a,t.leaf?s(o):o),l+=Ft(a);for(i=n-e-1;i>=e;i--)o=t.children[i],Rt(u,t.leaf?s(o):o),l+=Ft(u);return l},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)Rt(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():Lt(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},Tt.default=Ct;var Vt=function(t,e,n){var r=t*e,i=Ht*t,o=i-(i-t),s=t-o,a=Ht*e,u=a-(a-e),l=e-u,c=s*l-(r-o*u-s*u-o*l);return n?(n[0]=c,n[1]=r,n):[c,r]},Ht=+(Math.pow(2,27)+1),jt=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],e[0]);var i,o,s=new Array(n+r),a=0,u=0,l=0,c=Math.abs,h=t[u],p=c(h),d=e[l],f=c(d);p<f?(o=h,(u+=1)<n&&(h=t[u],p=c(h))):(o=d,(l+=1)<r&&(d=e[l],f=c(d))),u<n&&p<f||l>=r?(i=h,(u+=1)<n&&(h=t[u],p=c(h))):(i=d,(l+=1)<r&&(d=e[l],f=c(d)));for(var g,m,y=i+o,v=y-i,x=o-v,_=x,b=y;u<n&&l<r;)p<f?(i=h,(u+=1)<n&&(h=t[u],p=c(h))):(i=d,(l+=1)<r&&(d=e[l],f=c(d))),(x=(o=_)-(v=(y=i+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g;for(;u<n;)(x=(o=_)-(v=(y=(i=h)+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g,(u+=1)<n&&(h=t[u]);for(;l<r;)(x=(o=_)-(v=(y=(i=d)+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g,(l+=1)<r&&(d=e[l]);return _&&(s[a++]=_),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s},Wt=function(t,e,n){var r=t+e,i=r-t,o=e-i,s=t-(r-i);return n?(n[0]=s+o,n[1]=r,n):[s+o,r]},qt=function(t,e){var n=t.length;if(1===n){var r=Vt(t[0],e);return r[0]?r:[r[1]]}var i=new Array(2*n),o=[.1,.1],s=[.1,.1],a=0;Vt(t[0],e,o),o[0]&&(i[a++]=o[0]);for(var u=1;u<n;++u){Vt(t[u],e,s);var l=o[1];Wt(l,s[0],o),o[0]&&(i[a++]=o[0]);var c=s[1],h=o[1],p=c+h,d=h-(p-c);o[1]=p,d&&(i[a++]=d)}return o[1]&&(i[a++]=o[1]),0===a&&(i[a++]=0),i.length=a,i},Yt=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],-e[0]);var i,o,s=new Array(n+r),a=0,u=0,l=0,c=Math.abs,h=t[u],p=c(h),d=-e[l],f=c(d);p<f?(o=h,(u+=1)<n&&(h=t[u],p=c(h))):(o=d,(l+=1)<r&&(d=-e[l],f=c(d))),u<n&&p<f||l>=r?(i=h,(u+=1)<n&&(h=t[u],p=c(h))):(i=d,(l+=1)<r&&(d=-e[l],f=c(d)));for(var g,m,y=i+o,v=y-i,x=o-v,_=x,b=y;u<n&&l<r;)p<f?(i=h,(u+=1)<n&&(h=t[u],p=c(h))):(i=d,(l+=1)<r&&(d=-e[l],f=c(d))),(x=(o=_)-(v=(y=i+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g;for(;u<n;)(x=(o=_)-(v=(y=(i=h)+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g,(u+=1)<n&&(h=t[u]);for(;l<r;)(x=(o=_)-(v=(y=(i=d)+o)-i))&&(s[a++]=x),_=b-((g=b+y)-(m=g-b))+(y-m),b=g,(l+=1)<r&&(d=-e[l]);return _&&(s[a++]=_),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s},Xt=Ut((function(t){function e(t,e){for(var n=new Array(t.length-1),r=1;r<t.length;++r)for(var i=n[r-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(i[s++]=t[r][o]);return n}function n(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",n(t.slice(0,e)),",",n(t.slice(e)),")"].join("")}function r(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var i=[],o=0;o<t.length;++o)i.push(["scale(",n(r(e(t,o))),",",(s=o,1&s?"-":""),t[0][o],")"].join(""));return i;var s}function i(t){for(var i=[],o=[],s=function(t){for(var e=new Array(t),n=0;n<t;++n){e[n]=new Array(t);for(var r=0;r<t;++r)e[n][r]=["m",r,"[",t-n-1,"]"].join("")}return e}(t),a=[],u=0;u<t;++u)0==(1&u)?i.push.apply(i,r(e(s,u))):o.push.apply(o,r(e(s,u))),a.push("m"+u);var l=n(i),c=n(o),h="orientation"+t+"Exact",p=["function ",h,"(",a.join(),"){var p=",l,",n=",c,",d=sub(p,n);return d[d.length-1];};return ",h].join("");return new Function("sum","prod","scale","sub",p)(jt,Vt,qt,Yt)}var o=i(3),s=i(4),a=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){var r,i=(t[1]-n[1])*(e[0]-n[0]),s=(t[0]-n[0])*(e[1]-n[1]),a=i-s;if(i>0){if(s<=0)return a;r=i+s}else{if(!(i<0))return a;if(s>=0)return a;r=-(i+s)}var u=33306690738754716e-32*r;return a>=u||a<=-u?a:o(t,e,n)},function(t,e,n,r){var i=t[0]-r[0],o=e[0]-r[0],a=n[0]-r[0],u=t[1]-r[1],l=e[1]-r[1],c=n[1]-r[1],h=t[2]-r[2],p=e[2]-r[2],d=n[2]-r[2],f=o*c,g=a*l,m=a*u,y=i*c,v=i*l,x=o*u,_=h*(f-g)+p*(m-y)+d*(v-x),b=7771561172376103e-31*((Math.abs(f)+Math.abs(g))*Math.abs(h)+(Math.abs(m)+Math.abs(y))*Math.abs(p)+(Math.abs(v)+Math.abs(x))*Math.abs(d));return _>b||-_>b?_:s(t,e,n,r)}];function u(t){var e=a[t.length];return e||(e=a[t.length]=i(t.length)),e.apply(void 0,t)}!function(){for(;a.length<=5;)a.push(i(a.length));for(var e=[],n=["slow"],r=0;r<=5;++r)e.push("a"+r),n.push("o"+r);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;r<=5;++r)o.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(o.join(""));var s=Function.apply(void 0,n);for(t.exports=s.apply(void 0,[u].concat(a)),r=0;r<=5;++r)t.exports[r]=a[r]}()})),Zt=function(t){var e=t.length;if(e<3){for(var n=new Array(e),r=0;r<e;++r)n[r]=r;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:n}var i=new Array(e);for(r=0;r<e;++r)i[r]=r;i.sort((function(e,n){var r=t[e][0]-t[n][0];return r||t[e][1]-t[n][1]}));var o=[i[0],i[1]],s=[i[0],i[1]];for(r=2;r<e;++r){for(var a=i[r],u=t[a],l=o.length;l>1&&Kt(t[o[l-2]],t[o[l-1]],u)<=0;)l-=1,o.pop();for(o.push(a),l=s.length;l>1&&Kt(t[s[l-2]],t[s[l-1]],u)>=0;)l-=1,s.pop();s.push(a)}n=new Array(s.length+o.length-2);for(var c=0,h=(r=0,o.length);r<h;++r)n[c++]=o[r];for(var p=s.length-2;p>0;--p)n[c++]=s[p];return n},Kt=Xt[3],Jt=$t,Qt=$t;function $t(t,e){if(!(this instanceof $t))return new $t(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||te,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function te(t,e){return t<e?-1:t>e?1:0}$t.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}},Jt.default=Qt;var ee=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o][0],u=e[o][1],l=e[s][0],c=e[s][1];u>r!=c>r&&n<(l-a)*(r-u)/(c-u)+a&&(i=!i)}return i},ne=Xt[3],re=oe,ie=oe;function oe(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;for(var r,i=function(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>r[0]&&(r=s),s[1]<n[1]&&(n=s),s[1]>i[1]&&(i=s)}var a=[e,n,r,i],u=a.slice();for(o=0;o<t.length;o++)ee(t[o],a)||u.push(t[o]);var l=Zt(u),c=[];for(o=0;o<l.length;o++)c.push(u[l[o]]);return c}(t),o=Tt(16,["[0]","[1]","[0]","[1]"]).load(t),s=[],a=0;a<i.length;a++){var u=i[a];o.remove(u),r=pe(u,r),s.push(r)}var l=Tt(16);for(a=0;a<s.length;a++)l.insert(he(s[a]));for(var c=e*e,h=n*n;s.length;){var p=s.shift(),d=p.p,f=p.next.p,g=de(d,f);if(!(g<h)){var m=g/c;(u=se(o,p.prev.p,d,f,p.next.next.p,m,l))&&Math.min(de(u,d),de(u,f))<=m&&(s.push(p),s.push(pe(u,p)),o.remove(u),l.remove(p),l.insert(he(p)),l.insert(he(p.next)))}}p=r;var y=[];do{y.push(p.p),p=p.next}while(p!==r);return y.push(p.p),y}function se(t,e,n,r,i,o,s){for(var a=new Jt(null,ae),u=t.data;u;){for(var l=0;l<u.children.length;l++){var c=u.children[l],h=u.leaf?fe(c,n,r):ue(n,r,c);h>o||a.push({node:c,dist:h})}for(;a.length&&!a.peek().node.children;){var p=a.pop(),d=p.node,f=fe(d,e,n),g=fe(d,r,i);if(p.dist<f&&p.dist<g&&ce(n,d,s)&&ce(r,d,s))return d}(u=a.pop())&&(u=u.node)}return null}function ae(t,e){return t.dist-e.dist}function ue(t,e,n){if(le(t,n)||le(e,n))return 0;var r=ge(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=ge(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=ge(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=ge(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(r,i,o,s)}function le(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function ce(t,e,n){for(var r,i,o,s,a=Math.min(t[0],e[0]),u=Math.min(t[1],e[1]),l=Math.max(t[0],e[0]),c=Math.max(t[1],e[1]),h=n.search({minX:a,minY:u,maxX:l,maxY:c}),p=0;p<h.length;p++)if(r=h[p].p,i=h[p].next.p,o=t,r!==(s=e)&&i!==o&&ne(r,i,o)>0!=ne(r,i,s)>0&&ne(o,s,r)>0!=ne(o,s,i)>0)return!1;return!0}function he(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function pe(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function de(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function fe(t,e,n){var r=e[0],i=e[1],o=n[0]-r,s=n[1]-i;if(0!==o||0!==s){var a=((t[0]-r)*o+(t[1]-i)*s)/(o*o+s*s);a>1?(r=n[0],i=n[1]):a>0&&(r+=o*a,i+=s*a)}return(o=t[0]-r)*o+(s=t[1]-i)*s}function ge(t,e,n,r,i,o,s,a){var u,l,c,h,p=n-t,d=r-e,f=s-i,g=a-o,m=t-i,y=e-o,v=p*p+d*d,x=p*f+d*g,_=f*f+g*g,b=p*m+d*y,w=f*m+g*y,M=v*_-x*x,E=M,S=M;0===M?(l=0,E=1,h=w,S=_):(h=v*w-x*b,(l=x*w-_*b)<0?(l=0,h=w,S=_):l>E&&(l=E,h=w+x,S=_)),h<0?(h=0,-b<0?l=0:-b>v?l=E:(l=-b,E=v)):h>S&&(h=S,-b+x<0?l=0:-b+x>v?l=E:(l=-b+x,E=v));var T=(1-(c=0===h?0:h/S))*i+c*s-((1-(u=0===l?0:l/E))*t+u*n),C=(1-c)*o+c*a-((1-u)*e+u*r);return T*T+C*C}function me(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var n=[];if(N(t,(function(t){n.push([t[0],t[1]])})),!n.length)return null;var r=re(n,e.concavity);return r.length>3?c([r]):null}function ye(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=Q(t),i=it(e),o=i.type,s=e.bbox,a=i.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,s))return!1;"Polygon"===o&&(a=[a]);for(var u=!1,l=0;l<a.length&&!u;l++)if(ve(r,a[l][0],n.ignoreBoundary)){for(var c=!1,h=1;h<a[l].length&&!c;)ve(r,a[l][h],!n.ignoreBoundary)&&(c=!0),h++;c||(u=!0)}return u}function ve(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var s=e[i][0],a=e[i][1],u=e[o][0],l=e[o][1];if(t[1]*(s-u)+a*(u-t[0])+l*(t[0]-s)==0&&(s-t[0])*(u-t[0])<=0&&(a-t[1])*(l-t[1])<=0)return!n;a>t[1]!=l>t[1]&&t[0]<(u-s)*(t[1]-a)/(l-a)+s&&(r=!r)}return r}function xe(t,e){var n=[];return k(t,(function(t){var r=!1;if("Point"===t.geometry.type)G(e,(function(e){ye(t,e)&&(r=!0)})),r&&n.push(t);else{if("MultiPoint"!==t.geometry.type)throw new Error("Input geometry must be a Point or MultiPoint");var i=[];G(e,(function(e){N(t,(function(t){ye(t,e)&&(r=!0,i.push(t))}))})),r&&n.push(m(i))}})),f(n)}function _e(t,e,n){void 0===n&&(n={});var r=Q(t),i=Q(e),o=S(i[1]-r[1]),s=S(i[0]-r[0]),a=S(r[1]),u=S(i[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(u);return _(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function be(t,e){var n=!1;return f(function(t){if(t.length<3)return[];t.sort(Me);for(var e,n,r,i,o,s,a=t.length-1,u=t[a].x,l=t[0].x,c=t[a].y,h=c,p=1e-12;a--;)t[a].y<c&&(c=t[a].y),t[a].y>h&&(h=t[a].y);var d,f=l-u,g=h-c,m=f>g?f:g,y=.5*(l+u),v=.5*(h+c),x=[new we({__sentinel:!0,x:y-20*m,y:v-m},{__sentinel:!0,x:y,y:v+20*m},{__sentinel:!0,x:y+20*m,y:v-m})],_=[],b=[];for(a=t.length;a--;){for(b.length=0,d=x.length;d--;)(f=t[a].x-x[d].x)>0&&f*f>x[d].r?(_.push(x[d]),x.splice(d,1)):f*f+(g=t[a].y-x[d].y)*g>x[d].r||(b.push(x[d].a,x[d].b,x[d].b,x[d].c,x[d].c,x[d].a),x.splice(d,1));for(Ee(b),d=b.length;d;)n=b[--d],e=b[--d],r=t[a],i=n.x-e.x,o=n.y-e.y,s=2*(i*(r.y-n.y)-o*(r.x-n.x)),Math.abs(s)>p&&x.push(new we(e,n,r))}for(Array.prototype.push.apply(_,x),a=_.length;a--;)(_[a].a.__sentinel||_[a].b.__sentinel||_[a].c.__sentinel)&&_.splice(a,1);return _}(t.features.map((function(t){var r={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return e?r.z=t.properties[e]:3===t.geometry.coordinates.length&&(n=!0,r.z=t.geometry.coordinates[2]),r}))).map((function(t){var e=[t.a.x,t.a.y],r=[t.b.x,t.b.y],i=[t.c.x,t.c.y],o={};return n?(e.push(t.a.z),r.push(t.b.z),i.push(t.c.z)):o={a:t.a.z,b:t.b.z,c:t.c.z},c([[e,r,i,e]],o)})))}re.default=ie;var we=function(t,e,n){this.a=t,this.b=e,this.c=n;var r,i,o=e.x-t.x,s=e.y-t.y,a=n.x-t.x,u=n.y-t.y,l=o*(t.x+e.x)+s*(t.y+e.y),c=a*(t.x+n.x)+u*(t.y+n.y),h=2*(o*(n.y-e.y)-s*(n.x-e.x));this.x=(u*l-s*c)/h,this.y=(o*c-a*l)/h,r=this.x-t.x,i=this.y-t.y,this.r=r*r+i*i};function Me(t,e){return e.x-t.x}function Ee(t){var e,n,r,i,o,s=t.length;t:for(;s;)for(n=t[--s],e=t[--s],r=s;r;)if(o=t[--r],e===(i=t[--r])&&n===o||e===o&&n===i){t.splice(s,2),t.splice(r,2),s-=2;continue t}}function Se(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Te(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return Te(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ae(t);default:throw new Error("unknown GeoJSON type")}}function Te(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=Ce(t.properties),e.geometry=Ae(t.geometry),e}function Ce(t){var e={};return t?(Object.keys(t).forEach((function(n){var r=t[n];"object"==typeof r?null===r?e[n]=null:Array.isArray(r)?e[n]=r.map((function(t){return t})):e[n]=Ce(r):e[n]=r})),e):e}function Ae(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return Ae(t)})),e):(e.coordinates=Pe(t.coordinates),e)}function Pe(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return Pe(t)}))}function Le(t,e){if(void 0===e&&(e={}),!P(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Se(t));var r=[],i=Y(t,(function(t,e){var n=function(t,e){var n,r=t.geometry.coordinates,i=e.geometry.coordinates,o=Ie(r[0]),s=Ie(r[r.length-1]),a=Ie(i[0]),u=Ie(i[i.length-1]);if(o===u)n=i.concat(r.slice(1));else if(a===s)n=r.concat(i.slice(1));else if(o===a)n=r.slice(1).reverse().concat(i);else{if(s!==u)return null;n=r.concat(i.reverse().slice(1))}return p(n)}(t,e);return n||(r.push(t),e)}));return i&&r.push(i),r.length?1===r.length?r[0]:g(r.map((function(t){return t.coordinates}))):null}function Ie(t){return t[0].toString()+","+t[1].toString()}function Re(t){return t}function Ne(t,e){var n=function(t){if(null==t)return Re;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],s=t.translate[1];return function(t,a){a||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+o,c[1]=(n+=t[1])*i+s;u<l;)c[u]=t[u],++u;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,s=i.length;o<s;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,s)}function o(t){return n(t)}function s(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function a(t){for(var e=s(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(a)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=s(e.arcs);break;case"MultiLineString":n=e.arcs.map(s);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(e)}function Oe(t,e){var n={},r={},i={},o=[],s=-1;function a(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++s],e[s]=n,e[r]=i)})),e.forEach((function(e){var n,o,s=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),a=s[0],u=s[1];if(n=i[a])if(delete i[n.end],n.push(e),n.end=u,o=r[u]){delete r[o.start];var l=o===n?n:n.concat(o);r[l.start=n.start]=i[l.end=o.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=a,o=i[a]){delete i[o.end];var c=o===n?n:o.concat(n);r[c.start=o.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=a]=i[n.end=u]=n})),a(i,r),a(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function De(t,e){var n={},r=[],i=[];function o(t){t.forEach((function(e){e.forEach((function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)}))})),r.push(t)}function s(e){return function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(Ne(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach((function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":o(e.arcs);break;case"MultiPolygon":e.arcs.forEach(o)}})),r.forEach((function(t){if(!t._){var e=[],r=[t];for(t._=1,i.push(e);t=r.pop();)e.push(t),t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].forEach((function(t){t._||(t._=1,r.push(t))}))}))}))}})),r.forEach((function(t){delete t._})),{type:"MultiPolygon",arcs:i.map((function(e){var r,i=[];if(e.forEach((function(t){t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].length<2&&i.push(t)}))}))})),(r=(i=Oe(t,i)).length)>1)for(var o,a,u=1,l=s(i[0]);u<r;++u)(o=s(i[u]))>l&&(a=i[0],i[0]=i[u],i[u]=a,l=o);return i})).filter((function(t){return t.length>0}))}}var Fe=Object.prototype.hasOwnProperty;function ke(t,e,n,r,i,o){3===arguments.length&&(r=o=Array,i=null);for(var s=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),a=new o(t),u=t-1,l=0;l<t;++l)s[l]=i;function c(r,o){for(var l=e(r)&u,c=s[l],h=0;c!=i;){if(n(c,r))return a[l]=o;if(++h>=t)throw new Error("full hashmap");c=s[l=l+1&u]}return s[l]=r,a[l]=o,o}function h(r,o){for(var l=e(r)&u,c=s[l],h=0;c!=i;){if(n(c,r))return a[l];if(++h>=t)throw new Error("full hashmap");c=s[l=l+1&u]}return s[l]=r,a[l]=o,o}function p(r,o){for(var l=e(r)&u,c=s[l],h=0;c!=i;){if(n(c,r))return a[l];if(++h>=t)break;c=s[l=l+1&u]}return o}function d(){for(var t=[],e=0,n=s.length;e<n;++e){var r=s[e];r!=i&&t.push(r)}return t}return{set:c,maybeSet:h,get:p,keys:d}}function Be(t,e){return t[0]===e[0]&&t[1]===e[1]}var ze=new ArrayBuffer(16),Ge=new Float64Array(ze),Ue=new Uint32Array(ze);function Ve(t){Ge[0]=t[0],Ge[1]=t[1];var e=Ue[0]^Ue[1];return 2147483647&(e<<5^e>>7^Ue[2]^Ue[3])}function He(t){var e,n,r,i,o=t.coordinates,s=t.lines,a=t.rings,u=function(){for(var t=ke(1.4*o.length,b,w,Int32Array,-1,Int32Array),e=new Int32Array(o.length),n=0,r=o.length;n<r;++n)e[n]=t.maybeSet(n,n);return e}(),l=new Int32Array(o.length),c=new Int32Array(o.length),h=new Int32Array(o.length),p=new Int8Array(o.length),d=0;for(e=0,n=o.length;e<n;++e)l[e]=c[e]=h[e]=-1;for(e=0,n=s.length;e<n;++e){var f=s[e],g=f[0],m=f[1];for(r=u[g],i=u[++g],++d,p[r]=1;++g<=m;)_(e,r,r=i,i=u[g]);++d,p[i]=1}for(e=0,n=o.length;e<n;++e)l[e]=-1;for(e=0,n=a.length;e<n;++e){var y=a[e],v=y[0]+1,x=y[1];for(_(e,u[x-1],r=u[v-1],i=u[v]);++v<=x;)_(e,r,r=i,i=u[v])}function _(t,e,n,r){if(l[n]!==t){l[n]=t;var i=c[n];if(i>=0){var o=h[n];i===e&&o===r||i===r&&o===e||(++d,p[n]=1)}else c[n]=e,h[n]=r}}function b(t){return Ve(o[t])}function w(t,e){return Be(o[t],o[e])}l=c=h=null;var M,E=function(t,e,n,r,i){3===arguments.length&&(r=Array,i=null);for(var o=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=t-1,a=0;a<t;++a)o[a]=i;function u(r){for(var a=e(r)&s,u=o[a],l=0;u!=i;){if(n(u,r))return!0;if(++l>=t)throw new Error("full hashset");u=o[a=a+1&s]}return o[a]=r,!0}function l(r){for(var a=e(r)&s,u=o[a],l=0;u!=i;){if(n(u,r))return!0;if(++l>=t)break;u=o[a=a+1&s]}return!1}function c(){for(var t=[],e=0,n=o.length;e<n;++e){var r=o[e];r!=i&&t.push(r)}return t}return{add:u,has:l,values:c}}(1.4*d,Ve,Be);for(e=0,n=o.length;e<n;++e)p[M=u[e]]&&E.add(o[M]);return E}function je(t,e,n,r){We(t,e,n),We(t,e,e+r),We(t,e+r,n)}function We(t,e,n){for(var r,i=e+(n---e>>1);e<i;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function qe(t){var e,n,r={};for(e in t)r[e]=null==(n=t[e])?{type:null}:("FeatureCollection"===n.type?Ye:"Feature"===n.type?Xe:Ze)(n);return r}function Ye(t){var e={type:"GeometryCollection",geometries:t.features.map(Xe)};return null!=t.bbox&&(e.bbox=t.bbox),e}function Xe(t){var e,n=Ze(t.geometry);for(e in null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox),t.properties){n.properties=t.properties;break}return n}function Ze(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(Ze)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function Ke(t,e){var n=function(t){var e=1/0,n=1/0,r=-1/0,i=-1/0;function o(t){null!=t&&Fe.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(o)},Point:function(t){a(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(a)},LineString:function(t){u(t.arcs)},MultiLineString:function(t){t.arcs.forEach(u)},Polygon:function(t){t.arcs.forEach(u)},MultiPolygon:function(t){t.arcs.forEach(l)}};function a(t){var o=t[0],s=t[1];o<e&&(e=o),o>r&&(r=o),s<n&&(n=s),s>i&&(i=s)}function u(t){t.forEach(a)}function l(t){t.forEach(u)}for(var c in t)o(t[c]);return r>=e&&i>=n?[e,n,r,i]:void 0}(t=qe(t)),r=e>0&&n&&function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=o-r?(n-1)/(o-r):1,u=s-i?(n-1)/(s-i):1;function l(t){return[Math.round((t[0]-r)*a),Math.round((t[1]-i)*u)]}function c(t,e){for(var n,o,s,l,c,h=-1,p=0,d=t.length,f=new Array(d);++h<d;)n=t[h],l=Math.round((n[0]-r)*a),c=Math.round((n[1]-i)*u),l===o&&c===s||(f[p++]=[o=l,s=c]);for(f.length=p;p<e;)p=f.push([f[0][0],f[0][1]]);return f}function h(t){return c(t,2)}function p(t){return c(t,4)}function d(t){return t.map(p)}function f(t){null!=t&&Fe.call(g,t.type)&&g[t.type](t)}var g={GeometryCollection:function(t){t.geometries.forEach(f)},Point:function(t){t.coordinates=l(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(l)},LineString:function(t){t.arcs=h(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(h)},Polygon:function(t){t.arcs=d(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(d)}};for(var m in t)f(t[m]);return{scale:[1/a,1/u],translate:[r,i]}}(t,n,e),i=function(t){var e,n,r,i,o=t.coordinates,s=t.lines,a=t.rings,u=s.length+a.length;for(delete t.lines,delete t.rings,r=0,i=s.length;r<i;++r)for(e=s[r];e=e.next;)++u;for(r=0,i=a.length;r<i;++r)for(n=a[r];n=n.next;)++u;var l=ke(2*u*1.4,Ve,Be),c=t.arcs=[];for(r=0,i=s.length;r<i;++r){e=s[r];do{h(e)}while(e=e.next)}for(r=0,i=a.length;r<i;++r)if((n=a[r]).next)do{h(n)}while(n=n.next);else p(n);function h(t){var e,n,r,i,s,a,u,h;if(r=l.get(e=o[t[0]]))for(u=0,h=r.length;u<h;++u)if(d(i=r[u],t))return t[0]=i[0],void(t[1]=i[1]);if(s=l.get(n=o[t[1]]))for(u=0,h=s.length;u<h;++u)if(f(a=s[u],t))return t[1]=a[0],void(t[0]=a[1]);r?r.push(t):l.set(e,[t]),s?s.push(t):l.set(n,[t]),c.push(t)}function p(t){var e,n,r,i,s;if(n=l.get(o[t[0]]))for(i=0,s=n.length;i<s;++i){if(g(r=n[i],t))return t[0]=r[0],void(t[1]=r[1]);if(m(r,t))return t[0]=r[1],void(t[1]=r[0])}if(n=l.get(e=o[t[0]+y(t)]))for(i=0,s=n.length;i<s;++i){if(g(r=n[i],t))return t[0]=r[0],void(t[1]=r[1]);if(m(r,t))return t[0]=r[1],void(t[1]=r[0])}n?n.push(t):l.set(e,[t]),c.push(t)}function d(t,e){var n=t[0],r=e[0],i=t[1];if(n-i!=r-e[1])return!1;for(;n<=i;++n,++r)if(!Be(o[n],o[r]))return!1;return!0}function f(t,e){var n=t[0],r=e[0],i=t[1],s=e[1];if(n-i!=r-s)return!1;for(;n<=i;++n,--s)if(!Be(o[n],o[s]))return!1;return!0}function g(t,e){var n=t[0],r=e[0],i=t[1]-n;if(i!==e[1]-r)return!1;for(var s=y(t),a=y(e),u=0;u<i;++u)if(!Be(o[n+(u+s)%i],o[r+(u+a)%i]))return!1;return!0}function m(t,e){var n=t[0],r=e[0],i=t[1],s=e[1],a=i-n;if(a!==s-r)return!1;for(var u=y(t),l=a-y(e),c=0;c<a;++c)if(!Be(o[n+(c+u)%a],o[s-(c+l)%a]))return!1;return!0}function y(t){for(var e=t[0],n=t[1],r=e,i=r,s=o[r];++r<n;){var a=o[r];(a[0]<s[0]||a[0]===s[0]&&a[1]<s[1])&&(i=r,s=a)}return i-e}return t}(function(t){var e,n,r,i=He(t),o=t.coordinates,s=t.lines,a=t.rings;for(n=0,r=s.length;n<r;++n)for(var u=s[n],l=u[0],c=u[1];++l<c;)i.has(o[l])&&(e={0:l,1:u[1]},u[1]=l,u=u.next=e);for(n=0,r=a.length;n<r;++n)for(var h=a[n],p=h[0],d=p,f=h[1],g=i.has(o[p]);++d<f;)i.has(o[d])&&(g?(e={0:d,1:h[1]},h[1]=d,h=h.next=e):(je(o,p,f,f-d),o[f]=o[p],g=!0,d=p));return t}(function(t){var e=-1,n=[],r=[],i=[];function o(t){t&&Fe.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(o)},LineString:function(t){t.arcs=a(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(a)},Polygon:function(t){t.arcs=t.arcs.map(u)},MultiPolygon:function(t){t.arcs=t.arcs.map(l)}};function a(t){for(var r=0,o=t.length;r<o;++r)i[++e]=t[r];var s={0:e-o+1,1:e};return n.push(s),s}function u(t){for(var n=0,o=t.length;n<o;++n)i[++e]=t[n];var s={0:e-o+1,1:e};return r.push(s),s}function l(t){return t.map(u)}for(var c in t)o(t[c]);return{type:"Topology",coordinates:i,lines:n,rings:r,objects:t}}(t))),o=i.coordinates,s=ke(1.4*i.arcs.length,Je,Qe);function a(t){t&&Fe.call(u,t.type)&&u[t.type](t)}t=i.objects,i.bbox=n,i.arcs=i.arcs.map((function(t,e){return s.set(t,e),o.slice(t[0],t[1]+1)})),delete i.coordinates,o=null;var u={GeometryCollection:function(t){t.geometries.forEach(a)},LineString:function(t){t.arcs=l(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(l)},Polygon:function(t){t.arcs=t.arcs.map(l)},MultiPolygon:function(t){t.arcs=t.arcs.map(c)}};function l(t){var e=[];do{var n=s.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function c(t){return t.map(l)}for(var h in t)a(t[h]);return r&&(i.transform=r,i.arcs=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,i,o=t[e],s=0,a=1,u=o.length,l=o[0],c=l[0],h=l[1];++s<u;)r=(l=o[s])[0],i=l[1],r===c&&i===h||(o[a++]=[r-c,i-h],c=r,h=i);1===a&&(o[a++]=[0,0]),o.length=a}return t}(i.arcs)),i}function Je(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function Qe(t,e){var n,r=t[0],i=t[1],o=e[0],s=e[1];return i<r&&(n=r,r=i,i=n),s<o&&(n=o,o=s,s=n),r===o&&i===s}function $e(t,e){if(void 0===e&&(e={}),"FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==e.mutate&&void 0!==e.mutate||(t=Se(t));var n=[];V(t,(function(t){n.push(t.geometry)}));var r=Ke({geoms:v(n).geometry});return function(t){return Ne(t,De.apply(this,arguments))}(r,r.objects.geoms.geometries)}function tn(t,e){if(void 0===e&&(e={}),!P(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Se(t));var r=function(t){var e={};V(t,(function(t){e[t.geometry.type]=!0}));var n=Object.keys(e);return 1===n.length?n[0]:null}(t);if(!r)throw new Error("geojson must be homogenous");var i=t;switch(r){case"LineString":return Le(i,e);case"Polygon":return $e(i,e);default:throw new Error(r+" is not supported")}}function en(t,e){void 0===e&&(e={});var n="object"==typeof e?e.mutate:e;if(!t)throw new Error("geojson is required");var r=ot(t),i=[];switch(r){case"LineString":i=nn(t);break;case"MultiLineString":case"Polygon":$(t).forEach((function(t){i.push(nn(t))}));break;case"MultiPolygon":$(t).forEach((function(t){var e=[];t.forEach((function(t){e.push(nn(t))})),i.push(e)}));break;case"Point":return t;case"MultiPoint":var o={};$(t).forEach((function(t){var e=t.join("-");Object.prototype.hasOwnProperty.call(o,e)||(i.push(t),o[e]=!0)}));break;default:throw new Error(r+" geometry not supported")}return t.coordinates?!0===n?(t.coordinates=i,t):{type:r,coordinates:i}:!0===n?(t.geometry.coordinates=i,t):s({type:r,coordinates:i},t.properties,{bbox:t.bbox,id:t.id})}function nn(t){var e=$(t);if(2===e.length&&!rn(e[0],e[1]))return e;var n=[],r=e.length-1,i=n.length;n.push(e[0]);for(var o=1;o<r;o++){var s=n[n.length-1];e[o][0]===s[0]&&e[o][1]===s[1]||(n.push(e[o]),(i=n.length)>2&&on(n[i-3],n[i-1],n[i-2])&&n.splice(n.length-2,1))}if(n.push(e[e.length-1]),i=n.length,rn(e[0],e[e.length-1])&&i<4)throw new Error("invalid polygon");return on(n[i-3],n[i-1],n[i-2])&&n.splice(n.length-2,1),n}function rn(t,e){return t[0]===e[0]&&t[1]===e[1]}function on(t,e,n){var r=n[0],i=n[1],o=t[0],s=t[1],a=e[0],u=e[1],l=a-o,c=u-s;return 0===(r-o)*c-(i-s)*l&&(Math.abs(l)>=Math.abs(c)?l>0?o<=r&&r<=a:a<=r&&r<=o:c>0?s<=i&&i<=u:u<=i&&i<=s)}function sn(t,e,n){var r=e.x,i=e.y,o=n.x-r,s=n.y-i;if(0!==o||0!==s){var a=((t.x-r)*o+(t.y-i)*s)/(o*o+s*s);a>1?(r=n.x,i=n.y):a>0&&(r+=o*a,i+=s*a)}return(o=t.x-r)*o+(s=t.y-i)*s}function an(t,e,n,r,i){for(var o,s=r,a=e+1;a<n;a++){var u=sn(t[a],t[e],t[n]);u>s&&(o=a,s=u)}s>r&&(o-e>1&&an(t,e,o,r,i),i.push(t[o]),n-o>1&&an(t,o,n,r,i))}function un(t,e){var n=t.length-1,r=[t[0]];return an(t,0,n,e,r),r.push(t[n]),r}function ln(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return un(t=n?t:function(t,e){for(var n,r,i,o,s,a=t[0],u=[a],l=1,c=t.length;l<c;l++)n=t[l],i=a,o=void 0,s=void 0,o=(r=n).x-i.x,s=r.y-i.y,o*o+s*s>e&&(u.push(n),a=n);return a!==n&&u.push(n),u}(t,r),r)}function cn(t,e,n){return ln(t.map((function(t){return{x:t[0],y:t[1],z:t[2]}})),e,n).map((function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]}))}function hn(t,e,n){return t.map((function(t){var r=t.map((function(t){return{x:t[0],y:t[1]}}));if(r.length<4)throw new Error("invalid polygon");for(var i=ln(r,e,n).map((function(t){return[t.x,t.y]}));!pn(i);)i=ln(r,e-=.01*e,n).map((function(t){return[t.x,t.y]}));return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i}))}function pn(t){return!(t.length<3)&&!(3===t.length&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}var dn=function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var n=this.points[e],r=this.points[e+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return t.prototype.cacheSteps=function(t){var e=[],n=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>t&&(e.push(r),n=i)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),n=this.pos(t-10);return{angle:180*Math.atan2(e.y-n.y,e.x-n.x)/3.14,speed:Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var n=e/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n);return function(t,e,n,r,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+e.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+e.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+e.z*o[3]}}((this.length-1)*n-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])},t}();function fn(t,e){void 0===e&&(e={});for(var n=e.resolution||1e4,r=e.sharpness||.85,i=[],o=it(t).coordinates.map((function(t){return{x:t[0],y:t[1]}})),s=new dn({duration:n,points:o,sharpness:r}),a=function(t){var e=s.pos(t);Math.floor(t/100)%2==0&&i.push([e.x,e.y])},u=0;u<s.duration;u+=10)a(u);return a(s.duration),p(i,e.properties)}function gn(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[n,r];return c([[s,[i,r],[i,o],[n,o],s]],e.properties,{bbox:t,id:e.id})}function mn(t){return gn(J(t))}function yn(t){var e=t[0],n=t[1],r=t[2],i=t[3];if(_e(t.slice(0,2),[r,n])>=_e(t.slice(0,2),[e,i])){var o=(n+i)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}var s=(e+r)/2;return[s-(i-n)/2,n,s+(i-n)/2,i]}function vn(t,e,n,r){void 0===r&&(r={});var i=Q(t),o=S(i[0]),s=S(i[1]),a=S(n),l=b(e,r.units),c=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a));return u([E(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(c))),E(c)],r.properties)}function xn(t,e,n){void 0===n&&(n={});for(var r=n.steps||64,i=n.properties?n.properties:!Array.isArray(t)&&"Feature"===t.type&&t.properties?t.properties:{},o=[],s=0;s<r;s++)o.push(vn(t,e,-360*s/r,n).geometry.coordinates);return o.push(o[0]),c([o],i)}function _n(t,e,n){if(void 0===n&&(n={}),!0===n.final)return function(t,e){var n=_n(e,t);return(n+180)%360}(t,e);var r=Q(t),i=Q(e),o=S(r[0]),s=S(i[0]),a=S(r[1]),u=S(i[1]),l=Math.sin(s-o)*Math.cos(u),c=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(s-o);return E(Math.atan2(l,c))}function bn(t,e){void 0===e&&(e={});var n=J(t);return u([(n[0]+n[2])/2,(n[1]+n[3])/2],e.properties,e)}function wn(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return N(t,(function(t){n+=t[0],r+=t[1],i++}),!0),u([n/i,r/i],e.properties)}function Mn(t){var e=[];return"FeatureCollection"===t.type?k(t,(function(t){N(t,(function(n){e.push(u(n,t.properties))}))})):N(t,(function(n){e.push(u(n,t.properties))})),f(e)}var En=Tn,Sn=Tn;function Tn(t,e,n){n=n||2;var r,i,o,s,a,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Cn(t,0,h,n,!0),d=[];if(!p)return d;if(c&&(p=function(t,e,n,r){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=Cn(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(kn(s));for(a.sort(On),i=0;i<a.length;i++)Dn(a[i],n),n=An(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=s=t[1];for(var f=n;f<h;f+=n)(a=t[f])<r&&(r=a),(u=t[f+1])<i&&(i=u),a>o&&(o=a),u>s&&(s=u);l=0!==(l=Math.max(o-r,s-i))?1/l:0}return Pn(p,d,n,r,i,l),d}function Cn(t,e,n,r,i){var o,s;if(i===Xn(t,e,n,r)>0)for(o=e;o<n;o+=r)s=Wn(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=Wn(o,t[o],t[o+1],s);return s&&Un(s,s.next)&&(qn(s),s=s.next),s}function An(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Un(r,r.next)&&0!==Gn(r.prev,r,r.next))r=r.next;else{if(qn(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Pn(t,e,n,r,i,o,s){if(t){!s&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Fn(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,s,a,u,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(u=l;a>0||u>0&&r;)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(t,r,i,o);for(var a,u,l=t;t.prev!==t.next;)if(a=t.prev,u=t.next,o?In(t,r,i,o):Ln(t))e.push(a.i/n),e.push(t.i/n),e.push(u.i/n),qn(t),t=u.next,l=u.next;else if((t=u)===l){s?1===s?Pn(t=Rn(t,e,n),e,n,r,i,o,2):2===s&&Nn(t,e,n,r,i,o):Pn(An(t),e,n,r,i,o,1);break}}}function Ln(t){var e=t.prev,n=t,r=t.next;if(Gn(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Bn(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Gn(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function In(t,e,n,r){var i=t.prev,o=t,s=t.next;if(Gn(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,u=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=Fn(a,u,e,n,r),p=Fn(l,c,e,n,r),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&Bn(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Gn(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&Bn(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Gn(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Bn(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Gn(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Bn(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Gn(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Rn(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Un(i,o)&&Vn(i,r,r.next,o)&&Hn(i,o)&&Hn(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),qn(r),qn(r.next),r=t=o),r=r.next}while(r!==t);return r}function Nn(t,e,n,r,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&zn(s,a)){var u=jn(s,a);return s=An(s,s.next),u=An(u,u.next),Pn(s,e,n,r,i,o),void Pn(u,e,n,r,i,o)}a=a.next}s=s.next}while(s!==t)}function On(t,e){return t.x-e.x}function Dn(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n.prev;var u,l=n,c=n.x,h=n.y,p=1/0;for(r=n.next;r!==l;)i>=r.x&&r.x>=c&&i!==r.x&&Bn(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<p||u===p&&r.x>n.x)&&Hn(r,t)&&(n=r,p=u),r=r.next;return n}(t,e)){var n=jn(e,t);An(n,n.next)}}function Fn(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function kn(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function Bn(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function zn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Vn(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&Hn(t,e)&&Hn(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function Gn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Un(t,e){return t.x===e.x&&t.y===e.y}function Vn(t,e,n,r){return!!(Un(t,e)&&Un(n,r)||Un(t,r)&&Un(n,e))||Gn(t,e,n)>0!=Gn(t,e,r)>0&&Gn(n,r,t)>0!=Gn(n,r,e)>0}function Hn(t,e){return Gn(t.prev,t,t.next)<0?Gn(t,e,t.next)>=0&&Gn(t,t.prev,e)>=0:Gn(t,e,t.prev)<0||Gn(t,t.next,e)<0}function jn(t,e){var n=new Yn(t.i,t.x,t.y),r=new Yn(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Wn(t,e,n,r){var i=new Yn(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function qn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Yn(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xn(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function Zn(t){var e=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}(t),n=En(e.vertices,e.holes,2),r=[],i=[];n.forEach((function(t,r){var o=n[r];i.push([e.vertices[2*o],e.vertices[2*o+1]])}));for(var o=0;o<i.length;o+=3){var s=i.slice(o,o+3);s.push(i[o]),r.push(c([s]))}return r}function Kn(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var n,r=1/0,i=0;return k(e,(function(e,n){var o=_e(t,e);o<r&&(i=n,r=o)})),(n=Se(e.features[i])).properties.featureIndex=i,n.properties.distanceToPoint=r,n}function Jn(t){if(!t)throw new Error("geojson is required");var e=[];return V(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=$(r);break;case"LineString":n=[$(r)]}n.forEach((function(n){(function(t,e){var n=[];return t.reduce((function(t,r){var i=p([t,r],e);return i.bbox=function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return[n<i?n:i,r<o?r:o,n>i?n:i,r>o?r:o]}(t,r),n.push(i),r})),n})(n,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),f(e)}Tn.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,s=Math.abs(Xn(t,0,o,n));if(i)for(var a=0,u=e.length;a<u;a++){var l=e[a]*n,c=a<u-1?e[a+1]*n:t.length;s-=Math.abs(Xn(t,l,c,n))}var h=0;for(a=0;a<r.length;a+=3){var p=r[a]*n,d=r[a+1]*n,f=r[a+2]*n;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Tn.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},En.default=Sn;var Qn=Ut((function(t,e){function n(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function r(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!d(t[0])||!d(t[1]))throw new Error("coordinates must contain numbers");return n({type:"Point",coordinates:t},e,r)}function i(t,e,r){void 0===r&&(r={});for(var i=0,o=t;i<o.length;i++){var s=o[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:t},e,r)}function o(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:t},e,r)}function s(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function a(t,e,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:t},e,r)}function u(t,e,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:t},e,r)}function c(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t*r}function h(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t/r}function p(t){return t%(2*Math.PI)*180/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=n,e.geometry=function(t,e,n){switch(t){case"Point":return r(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=r,e.points=function(t,e,n){return void 0===n&&(n={}),s(t.map((function(t){return r(t,e)})),n)},e.polygon=i,e.polygons=function(t,e,n){return void 0===n&&(n={}),s(t.map((function(t){return i(t,e)})),n)},e.lineString=o,e.lineStrings=function(t,e,n){return void 0===n&&(n={}),s(t.map((function(t){return o(t,e)})),n)},e.featureCollection=s,e.multiLineString=a,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},e.radiansToLength=c,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return p(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return c(h(t,e),n)},e.convertArea=function(t,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=e.areaFactors[n];if(!i)throw new Error("invalid original units");var o=e.areaFactors[r];if(!o)throw new Error("invalid final units");return t/i*o},e.isNumber=d,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}));function $n(t,e,n){if(null!==t)for(var r,i,o,s,a,u,l,c,h=0,p=0,d=t.type,f="FeatureCollection"===d,g="Feature"===d,m=f?t.features.length:1,y=0;y<m;y++){a=(c=!!(l=f?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var v=0;v<a;v++){var x=0,_=0;if(null!==(s=c?l.geometries[v]:l)){u=s.coordinates;var b=s.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(u,p,y,x,_))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],p,y,x,_))return!1;p++,"MultiPoint"===b&&x++}"LineString"===b&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===e(u[r][i],p,y,x,_))return!1;p++}"MultiLineString"===b&&x++,"Polygon"===b&&_++}"Polygon"===b&&x++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(_=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===e(u[r][i][o],p,y,x,_))return!1;p++}_++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===$n(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tr(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function er(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function nr(t,e){var n,r,i,o,s,a,u,l,c,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,g=d?t.features.length:1;for(n=0;n<g;n++){for(a=d?t.features[n].geometry:f?t.geometry:t,l=d?t.features[n].properties:f?t.properties:{},c=d?t.features[n].bbox:f?t.bbox:void 0,h=d?t.features[n].id:f?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,h))return!1;p++}}function rr(t,e){nr(t,(function(t,n,r,i,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Qn.feature(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l={type:s,coordinates:t.coordinates[u]};if(!1===e(Qn.feature(l,r),n,u))return!1}}))}function ir(t,e){rr(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,u=0,l=0;return!1!==$n(t,(function(o,c,h,p,d){if(void 0===s||n>a||p>u||d>l)return s=o,a=n,u=p,l=d,void(i=0);var f=Qn.lineString([s,o],t.properties);if(!1===e(f,n,r,d,i))return!1;i++,s=o}))&&void 0}}}))}function or(t,e){if(!t)throw new Error("geojson is required");rr(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(Qn.lineString(o[s],t.properties),n,r,s))return!1}}}))}var sr=function(t){var e=[];return $n(t,(function(t){e.push(t)})),e},ar=$n,ur=function(t,e,n,r){var i=n;return $n(t,(function(t,r,o,s,a){i=0===r&&void 0===n?t:e(i,t,r,o,s,a)}),r),i},lr=er,cr=function(t,e,n){var r=n;return er(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},hr=function(t,e){if(e=e||{},!Qn.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":return Qn.point(u,a,e);case"MultiPoint":return i<0&&(i=u.length+i),Qn.point(u[i],a,e);case"LineString":return s<0&&(s=u.length+s),Qn.point(u[s],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s),Qn.point(u[o][s],a,e);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),Qn.point(u[i][s],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),s<0&&(s=u[i][o].length-s),Qn.point(u[i][o][s],a,e)}throw new Error("geojson is invalid")},pr=function(t,e){if(e=e||{},!Qn.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":a=a||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),Qn.lineString([u[s],u[s+1]],a,e);case"Polygon":return o<0&&(o=u.length+o),s<0&&(s=u[o].length+s-1),Qn.lineString([u[o][s],u[o][s+1]],a,e);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),Qn.lineString([u[i][s],u[i][s+1]],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),s<0&&(s=u[i][o].length-s-1),Qn.lineString([u[i][o][s],u[i][o][s+1]],a,e)}throw new Error("geojson is invalid")},dr=rr,fr=function(t,e,n){var r=n;return rr(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r},gr=nr,mr=function(t,e,n){var r=n;return nr(t,(function(t,i,o,s,a){r=0===i&&void 0===n?t:e(r,t,i,o,s,a)})),r},yr=or,vr=function(t,e,n){var r=n;return or(t,(function(t,i,o,s){r=0===i&&void 0===n?t:e(r,t,i,o,s)})),r},xr=tr,_r=function(t,e,n){var r=n;return tr(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},br=ir,wr=function(t,e,n){var r=n,i=!1;return ir(t,(function(t,o,s,a,u){r=!1===i&&void 0===n?t:e(r,t,o,s,a,u),i=!0})),r},Mr=Object.defineProperty({coordAll:sr,coordEach:ar,coordReduce:ur,featureEach:lr,featureReduce:cr,findPoint:hr,findSegment:pr,flattenEach:dr,flattenReduce:fr,geomEach:gr,geomReduce:mr,lineEach:yr,lineReduce:vr,propEach:xr,propReduce:_r,segmentEach:br,segmentReduce:wr},"__esModule",{value:!0});function Er(t){var e=[1/0,1/0,-1/0,-1/0];return Mr.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Er.default=Er;var Sr=Er,Tr=Object.defineProperty({default:Sr},"__esModule",{value:!0}).default,Cr=Mr.featureEach,Ar=(Mr.coordEach,Qn.polygon,Qn.featureCollection);function Pr(t){var e=Tt(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tr(t),Tt.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tr(t),e.push(t)})):Cr(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tr(t),e.push(t)})),Tt.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tr(t),Tt.prototype.remove.call(this,t,e)},e.clear=function(){return Tt.prototype.clear.call(this)},e.search=function(t){var e=Tt.prototype.search.call(this,this.toBBox(t));return Ar(e)},e.collides=function(t){return Tt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Tt.prototype.all.call(this);return Ar(t)},e.toJSON=function(){return Tt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Tt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=Tr(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=Tr(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var Lr=Pr,Ir=Pr;function Rr(t,e){var n={},r=[];if("LineString"===t.type&&(t=s(t)),"LineString"===e.type&&(e=s(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=Nr(t,e);return i&&r.push(i),f(r)}var o=Lr();return o.load(Jn(e)),k(Jn(t),(function(t){k(o.search(t),(function(e){var i=Nr(t,e);if(i){var o=$(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),f(r)}function Nr(t,e){var n=$(t),r=$(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],s=n[1][0],a=n[1][1],l=r[0][0],c=r[0][1],h=r[1][0],p=r[1][1],d=(p-c)*(s-i)-(h-l)*(a-o),f=(h-l)*(o-c)-(p-c)*(i-l),g=(s-i)*(o-c)-(a-o)*(i-l);if(0===d)return null;var m=f/d,y=g/d;return m>=0&&m<=1&&y>=0&&y<=1?u([i+m*(s-i),o+m*(a-o)]):null}function Or(t,e,n){void 0===n&&(n={});var r=u([1/0,1/0],{dist:1/0}),i=0;return V(t,(function(t){for(var o=$(t),s=0;s<o.length-1;s++){var a=u(o[s]);a.properties.dist=_e(e,a,n);var l=u(o[s+1]);l.properties.dist=_e(e,l,n);var c=_e(a,l,n),h=Math.max(a.properties.dist,l.properties.dist),d=_n(a,l),f=vn(e,h,d+90,n),g=vn(e,h,d-90,n),m=Rr(p([f.geometry.coordinates,g.geometry.coordinates]),p([a.geometry.coordinates,l.geometry.coordinates])),y=null;m.features.length>0&&((y=m.features[0]).properties.dist=_e(e,y,n),y.properties.location=i+_e(a,y,n)),a.properties.dist<r.properties.dist&&((r=a).properties.index=s,r.properties.location=i),l.properties.dist<r.properties.dist&&((r=l).properties.index=s+1,r.properties.location=i+c),y&&y.properties.dist<r.properties.dist&&((r=y).properties.index=s),i+=c}})),r}function Dr(t,e,r){void 0===r&&(r={});var i=Q(t),o=Q(e);return o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0,T(function(t,e,r){var i=r=void 0===r?n:Number(r),o=t[1]*Math.PI/180,s=e[1]*Math.PI/180,a=s-o,u=Math.abs(e[0]-t[0])*Math.PI/180;u>Math.PI&&(u-=2*Math.PI);var l=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),c=Math.abs(l)>1e-11?a/l:Math.cos(o);return Math.sqrt(a*a+c*c*u*u)*i}(i,o),"meters",r.units)}function Fr(t,e,n){if(void 0===n&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=u(t):"Point"===t.type?t=s(t):nt(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=p(e):"LineString"===e.type?e=s(e):nt(e,"LineString","line");var r=1/0,i=t.geometry.coordinates;return j(e,(function(t){var e=t.geometry.coordinates[0],o=t.geometry.coordinates[1],s=function(t,e,n,r){var i=[n[0]-e[0],n[1]-e[1]],o=kr([t[0]-e[0],t[1]-e[1]],i);if(o<=0)return Br(t,e,{method:r.method,units:"degrees"});var s=kr(i,i);if(s<=o)return Br(t,n,{method:r.method,units:"degrees"});var a=o/s,u=[e[0]+a*i[0],e[1]+a*i[1]];return Br(t,u,{method:r.method,units:"degrees"})}(i,e,o,n);s<r&&(r=s)})),T(r,"degrees",n.units)}function kr(t,e){return t[0]*e[0]+t[1]*e[1]}function Br(t,e,n){return"planar"===n.method?Dr(t,e,n):_e(t,e,n)}function zr(t,e,n,r,i,o,s,a){var u,l,c,h,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0===(u=(a-o)*(n-t)-(s-i)*(r-e))?null!==p.x&&null!==p.y&&p:(h=(n-t)*(l=e-o)-(r-e)*(c=t-i),l=((s-i)*l-(a-o)*c)/u,c=h/u,p.x=t+l*(n-t),p.y=e+l*(r-e),l>=0&&l<=1&&(p.onLine1=!0),c>=0&&c<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}function Gr(t){for(var e=function(t){return"FeatureCollection"!==t.type?"Feature"!==t.type?f([s(t)]):f([t]):t}(t),n=bn(e),r=!1,i=0;!r&&i<e.features.length;){var o,a=e.features[i].geometry,l=!1;if("Point"===a.type)n.geometry.coordinates[0]===a.coordinates[0]&&n.geometry.coordinates[1]===a.coordinates[1]&&(r=!0);else if("MultiPoint"===a.type){var c=!1;for(o=0;!c&&o<a.coordinates.length;)n.geometry.coordinates[0]===a.coordinates[o][0]&&n.geometry.coordinates[1]===a.coordinates[o][1]&&(r=!0,c=!0),o++}else if("LineString"===a.type)for(o=0;!l&&o<a.coordinates.length-1;)Ur(n.geometry.coordinates[0],n.geometry.coordinates[1],a.coordinates[o][0],a.coordinates[o][1],a.coordinates[o+1][0],a.coordinates[o+1][1])&&(l=!0,r=!0),o++;else if("MultiLineString"===a.type)for(var h=0;h<a.coordinates.length;){l=!1,o=0;for(var p=a.coordinates[h];!l&&o<p.length-1;)Ur(n.geometry.coordinates[0],n.geometry.coordinates[1],p[o][0],p[o][1],p[o+1][0],p[o+1][1])&&(l=!0,r=!0),o++;h++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||ye(n,a)&&(r=!0);i++}if(r)return n;var d=f([]);for(i=0;i<e.features.length;i++)d.features=d.features.concat(Mn(e.features[i]).features);return u(Kn(n,d).geometry.coordinates)}function Ur(t,e,n,r,i,o){return Math.sqrt((i-n)*(i-n)+(o-r)*(o-r))===Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}Lr.default=Ir;var Vr=6378137;function Hr(t){return U(t,(function(t,e){return t+function(t){var e,n=0;switch(t.type){case"Polygon":return jr(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=jr(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function jr(t){var e=0;if(t&&t.length>0){e+=Math.abs(Wr(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(Wr(t[n]))}return e}function Wr(t){var e,n,r,i,o,s,a=0,u=t.length;if(u>2){for(s=0;s<u;s++)s===u-2?(r=u-2,i=u-1,o=0):s===u-1?(r=u-1,i=0,o=1):(r=s,i=s+1,o=s+2),e=t[r],n=t[i],a+=(qr(t[o][0])-qr(e[0]))*Math.sin(qr(n[1]));a=a*Vr*Vr/2}return a}function qr(t){return t*Math.PI/180}function Yr(t,e){return void 0===e&&(e={}),W(t,(function(t,n){var r=n.geometry.coordinates;return t+_e(r[0],r[1],e)}),0)}function Xr(t,e,n,r){if(!P(r=r||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var s,a,u,l=i.length,c=0,h=0;h<i.length&&!(e>=c&&h===i.length-1);h++){if(c>e&&0===o.length){if(!(s=e-c))return o.push(i[h]),p(o);a=_n(i[h],i[h-1])-180,u=vn(i[h],s,a,r),o.push(u.geometry.coordinates)}if(c>=n)return(s=n-c)?(a=_n(i[h],i[h-1])-180,u=vn(i[h],s,a,r),o.push(u.geometry.coordinates),p(o)):(o.push(i[h]),p(o));if(c>=e&&o.push(i[h]),h===i.length-1)return p(o);c+=_e(i[h],i[h+1],r)}if(c<e&&i.length===l)throw new Error("Start position is beyond line");var d=i[i.length-1];return p([d,d])}function Zr(t,e,n){void 0===n&&(n={});for(var r=Q(t),i=$(e),o=0;o<i.length-1;o++){var s=!1;if(n.ignoreEndVertices&&(0===o&&(s="start"),o===i.length-2&&(s="end"),0===o&&o+1===i.length-1&&(s="both")),Kr(i[o],i[o+1],r,s,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function Kr(t,e,n,r,i){var o=n[0],s=n[1],a=t[0],u=t[1],l=e[0],c=e[1],h=l-a,p=c-u,d=(n[0]-a)*p-(n[1]-u)*h;if(null!==i){if(Math.abs(d)>i)return!1}else if(0!==d)return!1;return r?"start"===r?Math.abs(h)>=Math.abs(p)?h>0?a<o&&o<=l:l<=o&&o<a:p>0?u<s&&s<=c:c<=s&&s<u:"end"===r?Math.abs(h)>=Math.abs(p)?h>0?a<=o&&o<l:l<o&&o<=a:p>0?u<=s&&s<c:c<s&&s<=u:"both"===r&&(Math.abs(h)>=Math.abs(p)?h>0?a<o&&o<l:l<o&&o<a:p>0?u<s&&s<c:c<s&&s<u):Math.abs(h)>=Math.abs(p)?h>0?a<=o&&o<=l:l<=o&&o<=a:p>0?u<=s&&s<=c:c<=s&&s<=u}function Jr(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;switch(i){case"Point":switch(o){case"MultiPoint":return function(t,e){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if($r(e.coordinates[n],t.coordinates)){r=!0;break}return r}(n,r);case"LineString":return Zr(n,r,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return ye(n,r,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(t,e){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)$r(t.coordinates[n],e.coordinates[i])&&(r=!0);if(!r)return!1}return!0}(n,r);case"LineString":return function(t,e){for(var n=!1,r=0;r<t.coordinates.length;r++){if(!Zr(t.coordinates[r],e))return!1;n||(n=Zr(t.coordinates[r],e,{ignoreEndVertices:!0}))}return n}(n,r);case"Polygon":case"MultiPolygon":return function(t,e){for(var n=!0,r=!1,i=0;i<t.coordinates.length;i++){if(!(r=ye(t.coordinates[1],e))){n=!1;break}r=ye(t.coordinates[1],e,{ignoreBoundary:!0})}return n&&r}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(t,e){for(var n=0;n<t.coordinates.length;n++)if(!Zr(t.coordinates[n],e))return!1;return!0}(n,r);case"Polygon":case"MultiPolygon":return function(t,e){var n=J(e),r=J(t);if(!Qr(n,r))return!1;for(var i=!1,o=0;o<t.coordinates.length-1;o++){if(!ye(t.coordinates[o],e))return!1;i||(i=ye(t.coordinates[o],e,{ignoreBoundary:!0})),i||(i=ye(ti(t.coordinates[o],t.coordinates[o+1]),e,{ignoreBoundary:!0}))}return i}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":case"MultiPolygon":return function(t,e){var n=J(t);if(!Qr(J(e),n))return!1;for(var r=0;r<t.coordinates[0].length;r++)if(!ye(t.coordinates[0][r],e))return!1;return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function Qr(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function $r(t,e){return t[0]===e[0]&&t[1]===e[1]}function ti(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function ei(t,e,n){void 0===n&&(n={}),n.mask&&!n.units&&(n.units="kilometers");for(var r=[],i=t[0],o=t[1],s=t[2],a=t[3],l=e/_e([i,o],[s,o],n)*(s-i),c=e/_e([i,o],[i,a],n)*(a-o),h=s-i,p=a-o,d=Math.floor(h/l),g=(p-Math.floor(p/c)*c)/2,m=i+(h-d*l)/2;m<=s;){for(var y=o+g;y<=a;){var v=u([m,y],n.properties);n.mask?Jr(v,n.mask)&&r.push(v):r.push(v),y+=c}m+=l}return f(r)}function ni(t,e){void 0===e&&(e={});var n=e.precision,r=e.coordinates,i=e.mutate;if(n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return N(t,(function(t){!function(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e}(t,o,r)})),t}function ri(t){if(!t)throw new Error("geojson is required");var e=[];return V(t,(function(t){e.push(t)})),f(e)}function ii(t,e,n){if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===n&&(n=1);var r=t.geometry.coordinates,i=[],o={};if(n){for(var s=[],a=0;a<r.length;a++)for(var u=0;u<r[a].length-1;u++)s.push(g(a,u));var l=Tt();l.load(s)}for(var c=0;c<r.length;c++)for(var h=0;h<r[c].length-1;h++)if(n)l.search(g(c,h)).forEach((function(t){var e=t.ring,n=t.edge;f(c,h,e,n)}));else for(var p=0;p<r.length;p++)for(var d=0;d<r[p].length-1;d++)f(c,h,p,d);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function f(t,n,s,a){var u,l,c=r[t][n],h=r[t][n+1],p=r[s][a],d=r[s][a+1],f=function(t,e,n,r){if(oi(t,n)||oi(t,r)||oi(e,n)||oi(r,n))return null;var i=t[0],o=t[1],s=e[0],a=e[1],u=n[0],l=n[1],c=r[0],h=r[1],p=(i-s)*(l-h)-(o-a)*(u-c);return 0===p?null:[((i*a-o*s)*(u-c)-(i-s)*(u*h-l*c))/p,((i*a-o*s)*(l-h)-(o-a)*(u*h-l*c))/p]}(c,h,p,d);if(null!==f&&(u=h[0]!==c[0]?(f[0]-c[0])/(h[0]-c[0]):(f[1]-c[1])/(h[1]-c[1]),l=d[0]!==p[0]?(f[0]-p[0])/(d[0]-p[0]):(f[1]-p[1])/(d[1]-p[1]),!(u>=1||u<=0||l>=1||l<=0))){var g=f,m=!o[g];m&&(o[g]=!0),e?i.push(e(f,t,n,c,h,u,s,a,p,d,l,m)):i.push(f)}}function g(t,e){var n,i,o,s,a=r[t][e],u=r[t][e+1];return a[0]<u[0]?(n=a[0],i=u[0]):(n=u[0],i=a[0]),a[1]<u[1]?(o=a[1],s=u[1]):(o=u[1],s=a[1]),{minX:n,minY:o,maxX:i,maxY:s,ring:t,edge:e}}}function oi(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!oi(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function si(t){if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,n=[],r=0;r<e;r++){var i=t.geometry.coordinates[r];hi(i[0],i[i.length-1])||i.push(i[0]),n.push.apply(n,i.slice(0,i.length-1))}if(!function(t){for(var e={},n=1,r=0,i=t.length;r<i;++r){if(Object.prototype.hasOwnProperty.call(e,t[r])){n=0;break}e[t[r]]=1}return n}(n))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var o=n.length,s=ii(t,(function(t,e,n,r,i,o,s,a,u,l,c,h){return[t,e,n,r,i,o,s,a,u,l,c,h]})),a=s.length;if(0==a){var u=[];for(r=0;r<e;r++)u.push(c([t.geometry.coordinates[r]],{parent:-1,winding:ci(t.geometry.coordinates[r])}));var l=f(u);return B(),z(),l}var h=[],p=[];for(r=0;r<e;r++){h.push([]);for(var d=0;d<t.geometry.coordinates[r].length-1;d++)h[r].push([new ai(t.geometry.coordinates[r][pi(d+1,t.geometry.coordinates[r].length-1)],1,[r,d],[r,pi(d+1,t.geometry.coordinates[r].length-1)],void 0)]),p.push(new ui(t.geometry.coordinates[r][d],[r,pi(d-1,t.geometry.coordinates[r].length-1)],[r,d],void 0,void 0,!1,!0))}for(r=0;r<a;r++)h[s[r][1]][s[r][2]].push(new ai(s[r][0],s[r][5],[s[r][1],s[r][2]],[s[r][6],s[r][7]],void 0)),s[r][11]&&p.push(new ui(s[r][0],[s[r][1],s[r][2]],[s[r][6],s[r][7]],void 0,void 0,!0,!0));var g=p.length;for(r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)h[r][d].sort((function(t,e){return t.param<e.param?-1:1}));var m=[];for(r=0;r<g;r++)m.push({minX:p[r].coord[0],minY:p[r].coord[1],maxX:p[r].coord[0],maxY:p[r].coord[1],index:r});var y=Tt();for(y.load(m),r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)for(var v=0;v<h[r][d].length;v++){_=v==h[r][d].length-1?h[r][pi(d+1,t.geometry.coordinates[r].length-1)][0].coord:h[r][d][v+1].coord;var x=y.search({minX:_[0],minY:_[1],maxX:_[0],maxY:_[1]})[0];h[r][d][v].nxtIsectAlongEdgeIn=x.index}for(r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)for(v=0;v<h[r][d].length;v++){var _=h[r][d][v].coord,b=(x=y.search({minX:_[0],minY:_[1],maxX:_[0],maxY:_[1]})[0]).index;b<o?p[b].nxtIsectAlongRingAndEdge2=h[r][d][v].nxtIsectAlongEdgeIn:hi(p[b].ringAndEdge1,h[r][d][v].ringAndEdgeIn)?p[b].nxtIsectAlongRingAndEdge1=h[r][d][v].nxtIsectAlongEdgeIn:p[b].nxtIsectAlongRingAndEdge2=h[r][d][v].nxtIsectAlongEdgeIn}var w=[];for(r=0,d=0;d<e;d++){var M=r;for(v=0;v<t.geometry.coordinates[d].length-1;v++)p[r].coord[0]<p[M].coord[0]&&(M=r),r++;var E=p[M].nxtIsectAlongRingAndEdge2;for(v=0;v<p.length;v++)if(p[v].nxtIsectAlongRingAndEdge1==M||p[v].nxtIsectAlongRingAndEdge2==M){var S=v;break}var T=li([p[S].coord,p[M].coord,p[E].coord],!0)?1:-1;w.push({isect:M,parent:-1,winding:T})}for(w.sort((function(t,e){return p[t.isect].coord>p[e.isect].coord?-1:1})),u=[];w.length>0;){var C=w.pop(),A=C.isect,P=C.parent,L=C.winding,I=u.length,R=[p[A].coord],N=A;if(p[A].ringAndEdge1Walkable)var O=p[A].ringAndEdge1,D=p[A].nxtIsectAlongRingAndEdge1;else O=p[A].ringAndEdge2,D=p[A].nxtIsectAlongRingAndEdge2;for(;!hi(p[A].coord,p[D].coord);){R.push(p[D].coord);var F=void 0;for(r=0;r<w.length;r++)if(w[r].isect==D){F=r;break}if(null!=F&&w.splice(F,1),hi(O,p[D].ringAndEdge1)){if(O=p[D].ringAndEdge2,p[D].ringAndEdge2Walkable=!1,p[D].ringAndEdge1Walkable){var k={isect:D};li([p[N].coord,p[D].coord,p[p[D].nxtIsectAlongRingAndEdge2].coord],1==L)?(k.parent=P,k.winding=-L):(k.parent=I,k.winding=L),w.push(k)}N=D,D=p[D].nxtIsectAlongRingAndEdge2}else O=p[D].ringAndEdge1,p[D].ringAndEdge1Walkable=!1,p[D].ringAndEdge2Walkable&&(k={isect:D},li([p[N].coord,p[D].coord,p[p[D].nxtIsectAlongRingAndEdge1].coord],1==L)?(k.parent=P,k.winding=-L):(k.parent=I,k.winding=L),w.push(k)),N=D,D=p[D].nxtIsectAlongRingAndEdge1}R.push(p[D].coord),u.push(c([R],{index:I,parent:P,winding:L,netWinding:void 0}))}function B(){for(var t=[],e=0;e<l.features.length;e++)-1==l.features[e].properties.parent&&t.push(e);if(t.length>1)for(e=0;e<t.length;e++){for(var n=-1,r=0;r<l.features.length;r++)t[e]!=r&&ye(l.features[t[e]].geometry.coordinates[0][0],l.features[r],{ignoreBoundary:!0})&&Hr(l.features[r])<1/0&&(n=r);l.features[t[e]].properties.parent=n}}function z(){for(var t=0;t<l.features.length;t++)if(-1==l.features[t].properties.parent){var e=l.features[t].properties.winding;l.features[t].properties.netWinding=e,G(t,e)}}function G(t,e){for(var n=0;n<l.features.length;n++)if(l.features[n].properties.parent==t){var r=e+l.features[n].properties.winding;l.features[n].properties.netWinding=r,G(n,r)}}return l=f(u),B(),z(),l}var ai=function(t,e,n,r,i){this.coord=t,this.param=e,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},ui=function(t,e,n,r,i,o,s){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=s};function li(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])>=0==e}function ci(t){for(var e=0,n=0;n<t.length-1;n++)t[n][0]<t[e][0]&&(e=n);if(li([t[pi(e-1,t.length-1)],t[e],t[pi(e+1,t.length-1)]],!0))var r=1;else r=-1;return r}function hi(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!hi(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0}function pi(t,e){return(t%e+e)%e}var di=Math.PI/180,fi=180/Math.PI,gi=function(t,e){this.lon=t,this.lat=e,this.x=di*t,this.y=di*e};gi.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},gi.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new gi(e,t)};var mi=function(){this.coords=[],this.length=0};mi.prototype.move_to=function(t){this.length++,this.coords.push(t)};var yi=function(t){this.properties=t||{},this.geometries=[]};yi.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},yi.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var vi=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new gi(t.x,t.y),this.end=new gi(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};function xi(t,e){var n=[],r=Lr();return V(e,(function(e){if(n.forEach((function(t,e){t.id=e})),n.length){var i=r.search(e);if(i.features.length){var o=bi(e,i);n=n.filter((function(t){return t.id!==o.id})),r.remove(o),k(_i(o,e),(function(t){n.push(t),r.insert(t)}))}}else(n=_i(t,e).features).forEach((function(t){t.bbox||(t.bbox=yn(J(t)))})),r.load(f(n))})),f(n)}function _i(t,e){var n=[],r=$(t)[0],i=$(t)[t.geometry.coordinates.length-1];if(wi(r,Q(e))||wi(i,Q(e)))return f([t]);var o=Lr(),s=Jn(t);o.load(s);var a=o.search(e);if(!a.features.length)return f([t]);var u=bi(e,a),l=B(s,(function(t,r,i){var o=$(r)[1],s=Q(e);return i===u.id?(t.push(s),n.push(p(t)),wi(s,o)?[s]:[s,o]):(t.push(o),t)}),[r]);return l.length>1&&n.push(p(l)),f(n)}function bi(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var n,r=1/0;return k(e,(function(e){var i=Or(e,t).properties.dist;i<r&&(n=e,r=i)})),n}function wi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Mi(t,e,n,r,i){void 0===i&&(i={});var o=i.steps||64,s=Ei(n),a=Ei(r),u=Array.isArray(t)||"Feature"!==t.type?{}:t.properties;if(s===a)return p(xn(t,e,i).geometry.coordinates[0],u);for(var l=s,c=s<a?a:a+360,h=l,d=[],f=0;h<c;)d.push(vn(t,e,h,i).geometry.coordinates),h=l+360*++f/o;return h>c&&d.push(vn(t,e,c,i).geometry.coordinates),p(d,u)}function Ei(t){var e=t%360;return e<0&&(e+=360),e}function Si(t,e){void 0===e&&(e={});var n=it(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return Ti(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=it(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return n.forEach((function(t){i.push(Ci(t,r))})),f(i)}(n,e);default:throw new Error("invalid poly")}}function Ti(t,e){return void 0===e&&(e={}),Ci(it(t).coordinates,e.properties?e.properties:"Feature"===t.type?t.properties:{})}function Ci(t,e){return t.length>1?g(t,e):p(t[0],e)}function Ai(t,e){var n,r,i;void 0===e&&(e={});var o=e.properties,s=null===(n=e.autoComplete)||void 0===n||n,a=null===(r=e.orderCoords)||void 0===r||r;switch(null!==(i=e.mutate)&&void 0!==i&&i||(t=Se(t)),t.type){case"FeatureCollection":var u=[];return t.features.forEach((function(t){u.push($(Pi(t,{},s,a)))})),y(u,o);default:return Pi(t,o,s,a)}}function Pi(t,e,n,r){e=e||("Feature"===t.type?t.properties:{});var i=it(t),o=i.coordinates,s=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return n&&(o=Li(o)),c([o],e);case"MultiLineString":var a=[],u=0;return o.forEach((function(t){if(n&&(t=Li(t)),r){var e=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}(J(p(t)));e>u?(a.unshift(t),u=e):a.push(t)}else a.push(t)})),c(a,e);default:throw new Error("geometry type "+s+" is not supported")}}function Li(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],s=i[1];return n===o&&r===s||t.push(e),t}function Ii(t,e){var n,r,i,o,s,a,u;for(r=1;r<=8;r*=2){for(n=[],o=!(Ni(i=t[t.length-1],e)&r),s=0;s<t.length;s++)(u=!(Ni(a=t[s],e)&r))!==o&&n.push(Ri(i,a,r,e)),u&&n.push(a),i=a,o=u;if(!(t=n).length)break}return n}function Ri(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function Ni(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Oi(t,e){for(var n=[],r=0,i=t;r<i.length;r++){var o=Ii(i[r],e);o.length>0&&(o[0][0]===o[o.length-1][0]&&o[0][1]===o[o.length-1][1]||o.push(o[0]),o.length>=4&&n.push(o))}return n}vi.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),s=fi*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[fi*Math.atan2(i,r),s]},vi.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var o=r*i,s=this.interpolate(o);n.push(s)}for(var a=!1,u=0,l=e&&e.offset?e.offset:10,c=180-l,h=-180+l,p=360-l,d=1;d<n.length;++d){var f=n[d-1][0],g=n[d][0],m=Math.abs(g-f);m>p&&(g>c&&f<h||f>c&&g<h)?a=!0:m>u&&(u=m)}var y=[];if(a&&u<l){var v=[];y.push(v);for(var x=0;x<n.length;++x){var _=parseFloat(n[x][0]);if(x>0&&Math.abs(_-n[x-1][0])>p){var b=parseFloat(n[x-1][0]),w=parseFloat(n[x-1][1]),M=parseFloat(n[x][0]),E=parseFloat(n[x][1]);if(b>-180&&b<h&&180===M&&x+1<n.length&&n[x-1][0]>-180&&n[x-1][0]<h){v.push([-180,n[x][1]]),x++,v.push([n[x][0],n[x][1]]);continue}if(b>c&&b<180&&-180===M&&x+1<n.length&&n[x-1][0]>c&&n[x-1][0]<180){v.push([180,n[x][1]]),x++,v.push([n[x][0],n[x][1]]);continue}if(b<h&&M>c){var S=b;b=M,M=S;var T=w;w=E,E=T}if(b>c&&M<h&&(M+=360),b<=180&&M>=180&&b<M){var C=(180-b)/(M-b),A=C*E+(1-C)*w;v.push([n[x-1][0]>c?180:-180,A]),(v=[]).push([n[x-1][0]>c?-180:180,A]),y.push(v)}else v=[],y.push(v);v.push([_,n[x][1]])}else v.push([n[x][0],n[x][1]])}}else{var P=[];y.push(P);for(var L=0;L<n.length;++L)P.push([n[L][0],n[L][1]])}for(var I=new yi(this.properties),R=0;R<y.length;++R){var N=new mi;I.geometries.push(N);for(var O=y[R],D=0;D<O.length;++D)N.move_to(O[D])}return I};var Di=Ut((function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n})),Fi=Ut((function(t,e){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=n?r:i).supported=r,e.unsupported=i})),ki=Ut((function(t){var e=Array.prototype.slice,n=t.exports=function(t,o,s){return s||(s={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?s.strict?t===o:t==o:function(t,o,s){var a,u;if(r(t)||r(o))return!1;if(t.prototype!==o.prototype)return!1;if(Fi(t))return!!Fi(o)&&(t=e.call(t),o=e.call(o),n(t,o,s));if(i(t)){if(!i(o))return!1;if(t.length!==o.length)return!1;for(a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0}try{var l=Di(t),c=Di(o)}catch(t){return!1}if(l.length!=c.length)return!1;for(l.sort(),c.sort(),a=l.length-1;a>=0;a--)if(l[a]!=c[a])return!1;for(a=l.length-1;a>=0;a--)if(u=l[a],!n(t[u],o[u],s))return!1;return typeof t==typeof o}(t,o,s))};function r(t){return null==t}function i(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&"function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0])}}));function Bi(t,e,n){if(void 0===n&&(n={}),!P(n=n||{}))throw new Error("options is invalid");var r,i=n.tolerance||0,o=[],s=Lr(),a=Jn(t);return s.load(a),j(e,(function(t){var e=!1;t&&(k(s.search(t),(function(n){if(!1===e){var o=$(t).sort(),s=$(n).sort();ki(o,s)||(0===i?Zr(o[0],n)&&Zr(o[1],n):Or(n,o[0]).properties.dist<=i&&Or(n,o[1]).properties.dist<=i)?(e=!0,r=r?zi(r,t):t):(0===i?Zr(s[0],t)&&Zr(s[1],t):Or(t,s[0]).properties.dist<=i&&Or(t,s[1]).properties.dist<=i)&&(r=r?zi(r,n):n)}})),!1===e&&r&&(o.push(r),r=void 0))})),r&&o.push(r),f(o)}function zi(t,e){var n=$(e),r=$(t),i=r[0],o=r[r.length-1],s=t.geometry.coordinates;return ki(n[0],i)?s.unshift(n[1]):ki(n[0],o)?s.push(n[1]):ki(n[1],i)?s.unshift(n[0]):ki(n[1],o)&&s.push(n[0]),t}function Gi(t){var e=t%360;return e<0&&(e+=360),e}function Ui(t,e,n){var r;return void 0===n&&(n={}),(r=n.final?Vi(Q(e),Q(t)):Vi(Q(t),Q(e)))>180?-(360-r):r}function Vi(t,e){var n=S(t[1]),r=S(e[1]),i=S(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(E(Math.atan2(i,o))+360)%360}function Hi(t,e,r,i){void 0===i&&(i={});var o=e<0,s=T(Math.abs(e),i.units,"meters");o&&(s=-Math.abs(s));var a=Q(t),l=function(t,e,r,i){i=void 0===i?n:Number(i);var o=e/i,s=t[0]*Math.PI/180,a=S(t[1]),u=S(r),l=o*Math.cos(u),c=a+l;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),p=Math.abs(h)>1e-11?l/h:Math.cos(a),d=o*Math.sin(u)/p;return[(180*(s+d)/Math.PI+540)%360-180,180*c/Math.PI]}(a,s,r);return l[0]+=l[0]-a[0]>180?-360:a[0]-l[0]>180?360:0,u(l,i.properties)}function ji(t,e,n,r,i,o){for(var s=0;s<t.length;s++){var a=t[s],u=t[s+1];s===t.length-1&&(u=t[0]),r=qi(a,u,e),n<=0&&r>0?qi(e,a,i)<0||(i=a):n>0&&r<=0&&(Wi(e,a,o)||(o=a)),n=r}return[i,o]}function Wi(t,e,n){return qi(t,e,n)>0}function qi(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function Yi(t){for(var e,n,r=$(t),i=0,o=1;o<r.length;)e=n||r[0],i+=((n=r[o])[0]-e[0])*(n[1]+e[1]),o++;return i>0}function Xi(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return G(t,(function(t){Xi(t,e)})),t;case"LineString":return Zi($(t),e),t;case"Polygon":return Ki($(t),e),t;case"MultiLineString":return $(t).forEach((function(t){Zi(t,e)})),t;case"MultiPolygon":return $(t).forEach((function(t){Ki(t,e)})),t;case"Point":case"MultiPoint":return t}}function Zi(t,e){Yi(t)===e&&t.reverse()}function Ki(t,e){Yi(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)Yi(t[n])===e&&t[n].reverse()}function Ji(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;rt(t,"Point","input must contain Points");for(var o=function(t,e){var n={};return k(t,(function(t){var e=$(t)[1];n[e]||(n[e]=[]),n[e].push(t)})),Object.keys(n).map((function(t){return n[t].sort((function(t,e){return $(t)[0]-$(e)[0]}))})).sort((function(t,n){return e?$(t[0])[1]-$(n[0])[1]:$(n[0])[1]-$(t[0])[1]}))}
/*!
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],l=[],c=0;c<u.length;c++){var h=u[c];h.properties[n]?l.push(h.properties[n]):l.push(0),!0===i&&(h.properties.matrixPosition=[a,c])}s.push(l)}return s}var Qi={successCallback:null,verbose:!1,polygons:!1},$i={};function to(t,e,n,r){r=r||{};for(var i=Object.keys(Qi),o=0;o<i.length;o++){var s=i[o],a=r[s];a=null!=a?a:Qi[s],$i[s]=a}$i.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+n)+"]");var u,l=function(t,e,n){for(var r=t.length-1,i=t[0].length-1,o={rows:r,cols:i,cells:[]},s=e+Math.abs(n),a=0;a<r;++a){o.cells[a]=[];for(var u=0;u<i;++u){var l=0,c=t[a+1][u],h=t[a+1][u+1],p=t[a][u+1],d=t[a][u];if(!(isNaN(c)||isNaN(h)||isNaN(p)||isNaN(d))){l|=c<e?0:c>s?128:64,l|=h<e?0:h>s?32:16,l|=p<e?0:p>s?8:4;var f=+(l|=d<e?0:d>s?2:1),g=0;if(17===l||18===l||33===l||34===l||38===l||68===l||72===l||98===l||102===l||132===l||136===l||137===l||152===l||153===l){var m=(c+h+p+d)/4;g=m>s?2:m<e?0:1,34===l?1===g?l=35:0===g&&(l=136):136===l?1===g?(l=35,g=4):0===g&&(l=34):17===l?1===g?(l=155,g=4):0===g&&(l=153):68===l?1===g?(l=103,g=4):0===g&&(l=102):153===l?1===g&&(l=155):102===l?1===g&&(l=103):152===l?g<2&&(l=156,g=1):137===l?g<2&&(l=139,g=1):98===l?g<2&&(l=99,g=1):38===l?g<2&&(l=39,g=1):18===l?g>0?(l=156,g=4):l=152:33===l?g>0?(l=139,g=4):l=137:72===l?g>0?(l=99,g=4):l=98:132===l&&(g>0?(l=39,g=4):l=38)}if(0!=l&&170!=l){var y,v,x,_,b,w,M,E;y=v=x=_=b=w=M=E=.5;var S=[];1===l?(x=1-Wo(e,p,d),E=1-Wo(e,c,d),S.push(zo[l])):169===l?(x=Wo(s,d,p),E=Wo(s,d,c),S.push(zo[l])):4===l?(w=1-Wo(e,h,p),_=Wo(e,d,p),S.push(ko[l])):166===l?(w=Wo(s,p,h),_=1-Wo(s,p,d),S.push(ko[l])):16===l?(b=Wo(e,p,h),v=Wo(e,c,h),S.push(Fo[l])):154===l?(b=1-Wo(s,h,p),v=1-Wo(s,h,c),S.push(Fo[l])):64===l?(M=Wo(e,d,c),y=1-Wo(e,h,c),S.push(Uo[l])):106===l?(M=1-Wo(s,c,d),y=Wo(s,c,h),S.push(Uo[l])):168===l?(_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),S.push(Bo[l]),S.push(zo[l])):2===l?(_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),S.push(Bo[l]),S.push(zo[l])):162===l?(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),S.push(Bo[l]),S.push(zo[l])):8===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),S.push(Fo[l]),S.push(ko[l])):138===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(Fo[l]),S.push(ko[l])):32===l?(b=Wo(s,p,h),w=Wo(e,p,h),y=Wo(e,c,h),v=Wo(s,c,h),S.push(Fo[l]),S.push(ko[l])):42===l?(E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h),S.push(Go[l]),S.push(Uo[l])):128===l&&(E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(Go[l]),S.push(Uo[l])),5===l?(w=1-Wo(e,h,p),E=1-Wo(e,c,d),S.push(ko[l])):165===l?(w=Wo(s,p,h),E=Wo(s,d,c),S.push(ko[l])):20===l?(_=Wo(e,d,p),v=Wo(e,c,h),S.push(Bo[l])):150===l?(_=1-Wo(s,p,d),v=1-Wo(s,h,c),S.push(Bo[l])):80===l?(b=Wo(e,p,h),M=Wo(e,d,c),S.push(Fo[l])):90===l?(b=1-Wo(s,h,p),M=1-Wo(s,c,d),S.push(Fo[l])):65===l?(x=1-Wo(e,p,d),y=1-Wo(e,h,c),S.push(zo[l])):105===l?(x=Wo(s,d,p),y=Wo(s,c,h),S.push(zo[l])):160===l?(b=Wo(s,p,h),w=Wo(e,p,h),E=Wo(e,d,c),M=Wo(s,d,c),S.push(Fo[l]),S.push(ko[l])):10===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),E=1-Wo(s,c,d),M=1-Wo(e,c,d),S.push(Fo[l]),S.push(ko[l])):130===l?(_=1-Wo(e,p,d),x=1-Wo(s,p,d),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(Bo[l]),S.push(zo[l])):40===l?(_=Wo(s,d,p),x=Wo(e,d,p),y=Wo(e,c,h),v=Wo(s,c,h),S.push(Bo[l]),S.push(zo[l])):101===l?(w=Wo(s,p,h),y=Wo(s,c,h),S.push(ko[l])):69===l?(w=1-Wo(e,h,p),y=1-Wo(e,h,c),S.push(ko[l])):149===l?(E=Wo(s,d,c),v=1-Wo(s,h,c),S.push(Go[l])):21===l?(E=1-Wo(e,c,d),v=Wo(e,c,h),S.push(Go[l])):86===l?(_=1-Wo(s,p,d),M=1-Wo(s,c,d),S.push(Bo[l])):84===l?(_=Wo(e,d,p),M=Wo(e,d,c),S.push(Bo[l])):89===l?(b=1-Wo(s,h,p),x=Wo(s,d,p),S.push(zo[l])):81===l?(b=Wo(e,p,h),x=1-Wo(e,p,d),S.push(zo[l])):96===l?(b=Wo(s,p,h),w=Wo(e,p,h),M=Wo(e,d,c),y=Wo(s,c,h),S.push(Fo[l]),S.push(ko[l])):74===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),M=1-Wo(s,c,d),y=1-Wo(e,h,c),S.push(Fo[l]),S.push(ko[l])):24===l?(b=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),v=Wo(e,c,h),S.push(Fo[l]),S.push(zo[l])):146===l?(b=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),v=1-Wo(s,h,c),S.push(Fo[l]),S.push(zo[l])):6===l?(w=1-Wo(e,h,p),_=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),S.push(ko[l]),S.push(Bo[l])):164===l?(w=Wo(s,p,h),_=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),S.push(ko[l]),S.push(Bo[l])):129===l?(x=1-Wo(e,p,d),E=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(zo[l]),S.push(Go[l])):41===l?(x=Wo(s,d,p),E=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h),S.push(zo[l]),S.push(Go[l])):66===l?(_=1-Wo(e,p,d),x=1-Wo(s,p,d),M=1-Wo(s,c,d),y=1-Wo(e,h,c),S.push(Bo[l]),S.push(zo[l])):104===l?(_=Wo(s,d,p),x=Wo(e,d,p),M=Wo(e,d,c),y=Wo(s,c,h),S.push(zo[l]),S.push(Vo[l])):144===l?(b=Wo(e,p,h),E=Wo(e,d,c),M=Wo(s,d,c),v=1-Wo(s,h,c),S.push(Fo[l]),S.push(Uo[l])):26===l?(b=1-Wo(s,h,p),E=1-Wo(s,c,d),M=1-Wo(e,c,d),v=Wo(e,c,h),S.push(Fo[l]),S.push(Uo[l])):36===l?(w=Wo(s,p,h),_=Wo(e,d,p),y=Wo(e,c,h),v=Wo(s,c,h),S.push(ko[l]),S.push(Bo[l])):134===l?(w=1-Wo(e,h,p),_=1-Wo(s,p,d),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(ko[l]),S.push(Bo[l])):9===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),x=Wo(s,d,p),E=1-Wo(e,c,d),S.push(Fo[l]),S.push(ko[l])):161===l?(b=Wo(s,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),E=Wo(s,d,c),S.push(Fo[l]),S.push(ko[l])):37===l?(w=Wo(s,p,h),E=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h),S.push(ko[l]),S.push(Go[l])):133===l?(w=1-Wo(e,h,p),E=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c),S.push(ko[l]),S.push(Go[l])):148===l?(_=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),v=1-Wo(s,h,c),S.push(Bo[l]),S.push(Uo[l])):22===l?(_=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),v=Wo(e,c,h),S.push(Bo[l]),S.push(Uo[l])):82===l?(b=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),M=1-Wo(s,c,d),S.push(Fo[l]),S.push(zo[l])):88===l?(b=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),M=Wo(e,d,c),S.push(Fo[l]),S.push(zo[l])):73===l?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),x=Wo(s,d,p),y=1-Wo(e,h,c),S.push(Fo[l]),S.push(ko[l])):97===l?(b=Wo(s,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),y=Wo(s,c,h),S.push(Fo[l]),S.push(ko[l])):145===l?(b=Wo(e,p,h),x=1-Wo(e,p,d),E=Wo(s,d,c),v=1-Wo(s,h,c),S.push(Fo[l]),S.push(Go[l])):25===l?(b=1-Wo(s,h,p),x=Wo(s,d,p),E=1-Wo(e,c,d),v=Wo(e,c,h),S.push(Fo[l]),S.push(Go[l])):70===l?(w=1-Wo(e,h,p),_=1-Wo(s,p,d),M=1-Wo(s,c,d),y=1-Wo(e,h,c),S.push(ko[l]),S.push(Bo[l])):100===l?(w=Wo(s,p,h),_=Wo(e,d,p),M=Wo(e,d,c),y=Wo(s,c,h),S.push(ko[l]),S.push(Bo[l])):34===l?(0===g?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)):(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)),S.push(Fo[l]),S.push(ko[l]),S.push(Go[l]),S.push(Uo[l])):35===l?(4===g?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)):(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)),S.push(Fo[l]),S.push(ko[l]),S.push(zo[l]),S.push(Uo[l])):136===l?(0===g?(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)):(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)),S.push(Fo[l]),S.push(ko[l]),S.push(Go[l]),S.push(Uo[l])):153===l?(0===g?(b=Wo(e,p,h),x=1-Wo(e,p,d),E=1-Wo(e,c,d),v=Wo(e,c,h)):(b=1-Wo(s,h,p),x=Wo(s,d,p),E=Wo(s,d,c),v=1-Wo(s,h,c)),S.push(Fo[l]),S.push(zo[l])):102===l?(0===g?(w=1-Wo(e,h,p),_=Wo(e,d,p),M=Wo(e,d,c),y=1-Wo(e,h,c)):(w=Wo(s,p,h),_=1-Wo(s,p,d),M=1-Wo(s,c,d),y=Wo(s,c,h)),S.push(ko[l]),S.push(Uo[l])):155===l?(4===g?(b=Wo(e,p,h),x=1-Wo(e,p,d),E=1-Wo(e,c,d),v=Wo(e,c,h)):(b=1-Wo(s,h,p),x=Wo(s,d,p),E=Wo(s,d,c),v=1-Wo(s,h,c)),S.push(Fo[l]),S.push(Go[l])):103===l?(4===g?(w=1-Wo(e,h,p),_=Wo(e,d,p),M=Wo(e,d,c),y=1-Wo(e,h,c)):(w=Wo(s,p,h),_=1-Wo(s,p,d),M=1-Wo(s,c,d),y=Wo(s,c,h)),S.push(ko[l]),S.push(Bo[l])):152===l?(0===g?(b=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),v=Wo(e,c,h)):(b=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),v=1-Wo(s,h,c)),S.push(Fo[l]),S.push(Bo[l]),S.push(zo[l])):156===l?(4===g?(b=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),v=Wo(e,c,h)):(b=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),v=1-Wo(s,h,c)),S.push(Fo[l]),S.push(zo[l]),S.push(Uo[l])):137===l?(0===g?(b=Wo(s,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),E=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)):(b=1-Wo(e,h,p),w=1-Wo(s,h,p),x=Wo(s,d,p),E=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)),S.push(Fo[l]),S.push(ko[l]),S.push(zo[l])):139===l?(4===g?(b=Wo(s,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),E=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)):(b=1-Wo(e,h,p),w=1-Wo(s,h,p),x=Wo(s,d,p),E=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)),S.push(Fo[l]),S.push(ko[l]),S.push(Go[l])):98===l?(0===g?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),M=Wo(e,d,c),y=1-Wo(e,h,c)):(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),M=1-Wo(s,c,d),y=Wo(s,c,h)),S.push(Fo[l]),S.push(ko[l]),S.push(Uo[l])):99===l?(4===g?(b=1-Wo(e,h,p),w=1-Wo(s,h,p),_=Wo(s,d,p),x=Wo(e,d,p),M=Wo(e,d,c),y=1-Wo(e,h,c)):(b=Wo(s,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),x=1-Wo(s,p,d),M=1-Wo(s,c,d),y=Wo(s,c,h)),S.push(Fo[l]),S.push(ko[l]),S.push(zo[l])):38===l?(0===g?(w=1-Wo(e,h,p),_=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)):(w=Wo(s,p,h),_=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)),S.push(ko[l]),S.push(Go[l]),S.push(Uo[l])):39===l?(4===g?(w=1-Wo(e,h,p),_=Wo(e,d,p),E=Wo(e,d,c),M=Wo(s,d,c),y=1-Wo(s,h,c),v=1-Wo(e,h,c)):(w=Wo(s,p,h),_=1-Wo(s,p,d),E=1-Wo(s,c,d),M=1-Wo(e,c,d),y=Wo(e,c,h),v=Wo(s,c,h)),S.push(ko[l]),S.push(Bo[l]),S.push(Uo[l])):85===l&&(b=1,w=0,_=1,x=0,E=0,M=1,y=0,v=1),(y<0||y>1||v<0||v>1||b<0||b>1||_<0||_>1||E<0||E>1||M<0||M>1)&&console.log("MarchingSquaresJS-isoBands: "+l+" "+f+" "+c+","+h+","+p+","+d+" "+g+" "+y+" "+v+" "+b+" "+w+" "+_+" "+x+" "+E+" "+M),o.cells[a][u]={cval:l,cval_real:f,flipped:g,topleft:y,topright:v,righttop:b,rightbottom:w,bottomright:_,bottomleft:x,leftbottom:E,lefttop:M,edges:S}}}}}return o}(t,e,n);return $i.polygons?($i.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),u=function(t){var e=[],n=0;return t.cells.forEach((function(t,r){t.forEach((function(t,i){if(void 0!==t){var o=jo[t.cval](t);"object"==typeof o&&qo(o)?"object"==typeof o[0]&&qo(o[0])?"object"==typeof o[0][0]&&qo(o[0][0])?o.forEach((function(t){t.forEach((function(t){t[0]+=i,t[1]+=r})),e[n++]=t})):(o.forEach((function(t){t[0]+=i,t[1]+=r})),e[n++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}}))})),e}(l)):($i.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),u=function(t){for(var e=[],n=t.rows,r=t.cols,i=[],o=0;o<n;o++)for(var s=0;s<r;s++)if(void 0!==t.cells[o][s]&&t.cells[o][s].edges.length>0){var a=Xo(t.cells[o][s]),u=null,l=s,c=o;null!==a&&i.push([a.p[0]+l,a.p[1]+c]);do{if(null===(u=Zo(t.cells[c][l],a.x,a.y,a.o)))break;if(i.push([u.p[0]+l,u.p[1]+c]),l+=u.x,a=u,(c+=u.y)<0||c>=n||l<0||l>=r||void 0===t.cells[c][l]){var h=Yo(t,l-=u.x,c-=u.y,u.x,u.y,u.o);if(null===h)break;h.path.forEach((function(t){i.push(t)})),l=h.i,c=h.j,a=h}}while(void 0!==t.cells[c][l]&&t.cells[c][l].edges.length>0);e.push(i),i=[],t.cells[o][s].edges.length>0&&s--}return e}(l)),"function"==typeof $i.successCallback&&$i.successCallback(u),u}var eo=64,no=16,ro=[],io=[],oo=[],so=[],ao=[],uo=[],lo=[],co=[],ho=[],po=[],fo=[],go=[],mo=[],yo=[],vo=[],xo=[],_o=[],bo=[],wo=[],Mo=[],Eo=[],So=[],To=[],Co=[];lo[85]=po[85]=-1,co[85]=fo[85]=0,ho[85]=go[85]=1,wo[85]=So[85]=1,Mo[85]=To[85]=0,Eo[85]=Co[85]=1,ro[85]=so[85]=0,io[85]=ao[85]=-1,oo[85]=vo[85]=0,xo[85]=mo[85]=0,_o[85]=yo[85]=1,uo[85]=bo[85]=1,So[1]=So[169]=0,To[1]=To[169]=-1,Co[1]=Co[169]=0,mo[1]=mo[169]=-1,yo[1]=yo[169]=0,vo[1]=vo[169]=0,po[4]=po[166]=0,fo[4]=fo[166]=-1,go[4]=go[166]=1,xo[4]=xo[166]=1,_o[4]=_o[166]=0,bo[4]=bo[166]=0,lo[16]=lo[154]=0,co[16]=co[154]=1,ho[16]=ho[154]=1,so[16]=so[154]=1,ao[16]=ao[154]=0,uo[16]=uo[154]=1,wo[64]=wo[106]=0,Mo[64]=Mo[106]=1,Eo[64]=Eo[106]=0,ro[64]=ro[106]=-1,io[64]=io[106]=0,oo[64]=oo[106]=1,wo[2]=wo[168]=0,Mo[2]=Mo[168]=-1,Eo[2]=Eo[168]=1,So[2]=So[168]=0,To[2]=To[168]=-1,Co[2]=Co[168]=0,mo[2]=mo[168]=-1,yo[2]=yo[168]=0,vo[2]=vo[168]=0,xo[2]=xo[168]=-1,_o[2]=_o[168]=0,bo[2]=bo[168]=1,lo[8]=lo[162]=0,co[8]=co[162]=-1,ho[8]=ho[162]=0,po[8]=po[162]=0,fo[8]=fo[162]=-1,go[8]=go[162]=1,mo[8]=mo[162]=1,yo[8]=yo[162]=0,vo[8]=vo[162]=1,xo[8]=xo[162]=1,_o[8]=_o[162]=0,bo[8]=bo[162]=0,lo[32]=lo[138]=0,co[32]=co[138]=1,ho[32]=ho[138]=1,po[32]=po[138]=0,fo[32]=fo[138]=1,go[32]=go[138]=0,ro[32]=ro[138]=1,io[32]=io[138]=0,oo[32]=oo[138]=0,so[32]=so[138]=1,ao[32]=ao[138]=0,uo[32]=uo[138]=1,So[128]=So[42]=0,To[128]=To[42]=1,Co[128]=Co[42]=1,wo[128]=wo[42]=0,Mo[128]=Mo[42]=1,Eo[128]=Eo[42]=0,ro[128]=ro[42]=-1,io[128]=io[42]=0,oo[128]=oo[42]=1,so[128]=so[42]=-1,ao[128]=ao[42]=0,uo[128]=uo[42]=0,po[5]=po[165]=-1,fo[5]=fo[165]=0,go[5]=go[165]=0,So[5]=So[165]=1,To[5]=To[165]=0,Co[5]=Co[165]=0,xo[20]=xo[150]=0,_o[20]=_o[150]=1,bo[20]=bo[150]=1,so[20]=so[150]=0,ao[20]=ao[150]=-1,uo[20]=uo[150]=1,lo[80]=lo[90]=-1,co[80]=co[90]=0,ho[80]=ho[90]=1,wo[80]=wo[90]=1,Mo[80]=Mo[90]=0,Eo[80]=Eo[90]=1,mo[65]=mo[105]=0,yo[65]=yo[105]=1,vo[65]=vo[105]=0,ro[65]=ro[105]=0,io[65]=io[105]=-1,oo[65]=oo[105]=0,lo[160]=lo[10]=-1,co[160]=co[10]=0,ho[160]=ho[10]=1,po[160]=po[10]=-1,fo[160]=fo[10]=0,go[160]=go[10]=0,So[160]=So[10]=1,To[160]=To[10]=0,Co[160]=Co[10]=0,wo[160]=wo[10]=1,Mo[160]=Mo[10]=0,Eo[160]=Eo[10]=1,xo[130]=xo[40]=0,_o[130]=_o[40]=1,bo[130]=bo[40]=1,mo[130]=mo[40]=0,yo[130]=yo[40]=1,vo[130]=vo[40]=0,ro[130]=ro[40]=0,io[130]=io[40]=-1,oo[130]=oo[40]=0,so[130]=so[40]=0,ao[130]=ao[40]=-1,uo[130]=uo[40]=1,po[37]=po[133]=0,fo[37]=fo[133]=1,go[37]=go[133]=1,So[37]=So[133]=0,To[37]=To[133]=1,Co[37]=Co[133]=0,ro[37]=ro[133]=-1,io[37]=io[133]=0,oo[37]=oo[133]=0,so[37]=so[133]=1,ao[37]=ao[133]=0,uo[37]=uo[133]=0,xo[148]=xo[22]=-1,_o[148]=_o[22]=0,bo[148]=bo[22]=0,So[148]=So[22]=0,To[148]=To[22]=-1,Co[148]=Co[22]=1,wo[148]=wo[22]=0,Mo[148]=Mo[22]=1,Eo[148]=Eo[22]=1,so[148]=so[22]=-1,ao[148]=ao[22]=0,uo[148]=uo[22]=1,lo[82]=lo[88]=0,co[82]=co[88]=-1,ho[82]=ho[88]=1,xo[82]=xo[88]=1,_o[82]=_o[88]=0,bo[82]=bo[88]=1,mo[82]=mo[88]=-1,yo[82]=yo[88]=0,vo[82]=vo[88]=1,wo[82]=wo[88]=0,Mo[82]=Mo[88]=-1,Eo[82]=Eo[88]=0,lo[73]=lo[97]=0,co[73]=co[97]=1,ho[73]=ho[97]=0,po[73]=po[97]=0,fo[73]=fo[97]=-1,go[73]=go[97]=0,mo[73]=mo[97]=1,yo[73]=yo[97]=0,vo[73]=vo[97]=0,ro[73]=ro[97]=1,io[73]=io[97]=0,oo[73]=oo[97]=1,lo[145]=lo[25]=0,co[145]=co[25]=-1,ho[145]=ho[25]=0,mo[145]=mo[25]=1,yo[145]=yo[25]=0,vo[145]=vo[25]=1,So[145]=So[25]=0,To[145]=To[25]=1,Co[145]=Co[25]=1,so[145]=so[25]=-1,ao[145]=ao[25]=0,uo[145]=uo[25]=0,po[70]=po[100]=0,fo[70]=fo[100]=1,go[70]=go[100]=0,xo[70]=xo[100]=-1,_o[70]=_o[100]=0,bo[70]=bo[100]=1,wo[70]=wo[100]=0,Mo[70]=Mo[100]=-1,Eo[70]=Eo[100]=1,ro[70]=ro[100]=1,io[70]=io[100]=0,oo[70]=oo[100]=0,po[101]=po[69]=0,fo[101]=fo[69]=1,go[101]=go[69]=0,ro[101]=ro[69]=1,io[101]=io[69]=0,oo[101]=oo[69]=0,So[149]=So[21]=0,To[149]=To[21]=1,Co[149]=Co[21]=1,so[149]=so[21]=-1,ao[149]=ao[21]=0,uo[149]=uo[21]=0,xo[86]=xo[84]=-1,_o[86]=_o[84]=0,bo[86]=bo[84]=1,wo[86]=wo[84]=0,Mo[86]=Mo[84]=-1,Eo[86]=Eo[84]=1,lo[89]=lo[81]=0,co[89]=co[81]=-1,ho[89]=ho[81]=0,mo[89]=mo[81]=1,yo[89]=yo[81]=0,vo[89]=vo[81]=1,lo[96]=lo[74]=0,co[96]=co[74]=1,ho[96]=ho[74]=0,po[96]=po[74]=-1,fo[96]=fo[74]=0,go[96]=go[74]=1,wo[96]=wo[74]=1,Mo[96]=Mo[74]=0,Eo[96]=Eo[74]=0,ro[96]=ro[74]=1,io[96]=io[74]=0,oo[96]=oo[74]=1,lo[24]=lo[146]=0,co[24]=co[146]=-1,ho[24]=ho[146]=1,xo[24]=xo[146]=1,_o[24]=_o[146]=0,bo[24]=bo[146]=1,mo[24]=mo[146]=0,yo[24]=yo[146]=1,vo[24]=vo[146]=1,so[24]=so[146]=0,ao[24]=ao[146]=-1,uo[24]=uo[146]=0,po[6]=po[164]=-1,fo[6]=fo[164]=0,go[6]=go[164]=1,xo[6]=xo[164]=-1,_o[6]=_o[164]=0,bo[6]=bo[164]=0,So[6]=So[164]=0,To[6]=To[164]=-1,Co[6]=Co[164]=1,wo[6]=wo[164]=1,Mo[6]=Mo[164]=0,Eo[6]=Eo[164]=0,mo[129]=mo[41]=0,yo[129]=yo[41]=1,vo[129]=vo[41]=1,So[129]=So[41]=0,To[129]=To[41]=1,Co[129]=Co[41]=0,ro[129]=ro[41]=-1,io[129]=io[41]=0,oo[129]=oo[41]=0,so[129]=so[41]=0,ao[129]=ao[41]=-1,uo[129]=uo[41]=0,xo[66]=xo[104]=0,_o[66]=_o[104]=1,bo[66]=bo[104]=0,mo[66]=mo[104]=-1,yo[66]=yo[104]=0,vo[66]=vo[104]=1,wo[66]=wo[104]=0,Mo[66]=Mo[104]=-1,Eo[66]=Eo[104]=0,ro[66]=ro[104]=0,io[66]=io[104]=-1,oo[66]=oo[104]=1,lo[144]=lo[26]=-1,co[144]=co[26]=0,ho[144]=ho[26]=0,So[144]=So[26]=1,To[144]=To[26]=0,Co[144]=Co[26]=1,wo[144]=wo[26]=0,Mo[144]=Mo[26]=1,Eo[144]=Eo[26]=1,so[144]=so[26]=-1,ao[144]=ao[26]=0,uo[144]=uo[26]=1,po[36]=po[134]=0,fo[36]=fo[134]=1,go[36]=go[134]=1,xo[36]=xo[134]=0,_o[36]=_o[134]=1,bo[36]=bo[134]=0,ro[36]=ro[134]=0,io[36]=io[134]=-1,oo[36]=oo[134]=1,so[36]=so[134]=1,ao[36]=ao[134]=0,uo[36]=uo[134]=0,lo[9]=lo[161]=-1,co[9]=co[161]=0,ho[9]=ho[161]=0,po[9]=po[161]=0,fo[9]=fo[161]=-1,go[9]=go[161]=0,mo[9]=mo[161]=1,yo[9]=yo[161]=0,vo[9]=vo[161]=0,So[9]=So[161]=1,To[9]=To[161]=0,Co[9]=Co[161]=1,lo[136]=0,co[136]=1,ho[136]=1,po[136]=0,fo[136]=1,go[136]=0,xo[136]=-1,_o[136]=0,bo[136]=1,mo[136]=-1,yo[136]=0,vo[136]=0,So[136]=0,To[136]=-1,Co[136]=0,wo[136]=0,Mo[136]=-1,Eo[136]=1,ro[136]=1,io[136]=0,oo[136]=0,so[136]=1,ao[136]=0,uo[136]=1,lo[34]=0,co[34]=-1,ho[34]=0,po[34]=0,fo[34]=-1,go[34]=1,xo[34]=1,_o[34]=0,bo[34]=0,mo[34]=1,yo[34]=0,vo[34]=1,So[34]=0,To[34]=1,Co[34]=1,wo[34]=0,Mo[34]=1,Eo[34]=0,ro[34]=-1,io[34]=0,oo[34]=1,so[34]=-1,ao[34]=0,uo[34]=0,lo[35]=0,co[35]=1,ho[35]=1,po[35]=0,fo[35]=-1,go[35]=1,xo[35]=1,_o[35]=0,bo[35]=0,mo[35]=-1,yo[35]=0,vo[35]=0,So[35]=0,To[35]=-1,Co[35]=0,wo[35]=0,Mo[35]=1,Eo[35]=0,ro[35]=-1,io[35]=0,oo[35]=1,so[35]=1,ao[35]=0,uo[35]=1,lo[153]=0,co[153]=1,ho[153]=1,mo[153]=-1,yo[153]=0,vo[153]=0,So[153]=0,To[153]=-1,Co[153]=0,so[153]=1,ao[153]=0,uo[153]=1,po[102]=0,fo[102]=-1,go[102]=1,xo[102]=1,_o[102]=0,bo[102]=0,wo[102]=0,Mo[102]=1,Eo[102]=0,ro[102]=-1,io[102]=0,oo[102]=1,lo[155]=0,co[155]=-1,ho[155]=0,mo[155]=1,yo[155]=0,vo[155]=1,So[155]=0,To[155]=1,Co[155]=1,so[155]=-1,ao[155]=0,uo[155]=0,po[103]=0,fo[103]=1,go[103]=0,xo[103]=-1,_o[103]=0,bo[103]=1,wo[103]=0,Mo[103]=-1,Eo[103]=1,ro[103]=1,io[103]=0,oo[103]=0,lo[152]=0,co[152]=1,ho[152]=1,xo[152]=-1,_o[152]=0,bo[152]=1,mo[152]=-1,yo[152]=0,vo[152]=0,So[152]=0,To[152]=-1,Co[152]=0,wo[152]=0,Mo[152]=-1,Eo[152]=1,so[152]=1,ao[152]=0,uo[152]=1,lo[156]=0,co[156]=-1,ho[156]=1,xo[156]=1,_o[156]=0,bo[156]=1,mo[156]=-1,yo[156]=0,vo[156]=0,So[156]=0,To[156]=-1,Co[156]=0,wo[156]=0,Mo[156]=1,Eo[156]=1,so[156]=-1,ao[156]=0,uo[156]=1,lo[137]=0,co[137]=1,ho[137]=1,po[137]=0,fo[137]=1,go[137]=0,mo[137]=-1,yo[137]=0,vo[137]=0,So[137]=0,To[137]=-1,Co[137]=0,ro[137]=1,io[137]=0,oo[137]=0,so[137]=1,ao[137]=0,uo[137]=1,lo[139]=0,co[139]=1,ho[139]=1,po[139]=0,fo[139]=-1,go[139]=0,mo[139]=1,yo[139]=0,vo[139]=0,So[139]=0,To[139]=1,Co[139]=0,ro[139]=-1,io[139]=0,oo[139]=0,so[139]=1,ao[139]=0,uo[139]=1,lo[98]=0,co[98]=-1,ho[98]=0,po[98]=0,fo[98]=-1,go[98]=1,xo[98]=1,_o[98]=0,bo[98]=0,mo[98]=1,yo[98]=0,vo[98]=1,wo[98]=0,Mo[98]=1,Eo[98]=0,ro[98]=-1,io[98]=0,oo[98]=1,lo[99]=0,co[99]=1,ho[99]=0,po[99]=0,fo[99]=-1,go[99]=1,xo[99]=1,_o[99]=0,bo[99]=0,mo[99]=-1,yo[99]=0,vo[99]=1,wo[99]=0,Mo[99]=-1,Eo[99]=0,ro[99]=1,io[99]=0,oo[99]=1,po[38]=0,fo[38]=-1,go[38]=1,xo[38]=1,_o[38]=0,bo[38]=0,So[38]=0,To[38]=1,Co[38]=1,wo[38]=0,Mo[38]=1,Eo[38]=0,ro[38]=-1,io[38]=0,oo[38]=1,so[38]=-1,ao[38]=0,uo[38]=0,po[39]=0,fo[39]=1,go[39]=1,xo[39]=-1,_o[39]=0,bo[39]=0,So[39]=0,To[39]=-1,Co[39]=1,wo[39]=0,Mo[39]=1,Eo[39]=0,ro[39]=-1,io[39]=0,oo[39]=1,so[39]=1,ao[39]=0,uo[39]=0;var Ao=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Po=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Lo=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Io=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Ro=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},No=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Oo=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},Do=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Fo=[],ko=[],Bo=[],zo=[],Go=[],Uo=[],Vo=[],Ho=[];zo[1]=Go[1]=18,zo[169]=Go[169]=18,Bo[4]=ko[4]=12,Bo[166]=ko[166]=12,Fo[16]=Ho[16]=4,Fo[154]=Ho[154]=4,Uo[64]=Vo[64]=22,Uo[106]=Vo[106]=22,Bo[2]=Uo[2]=17,zo[2]=Go[2]=18,Bo[168]=Uo[168]=17,zo[168]=Go[168]=18,Fo[8]=zo[8]=9,ko[8]=Bo[8]=12,Fo[162]=zo[162]=9,ko[162]=Bo[162]=12,Fo[32]=Ho[32]=4,ko[32]=Vo[32]=1,Fo[138]=Ho[138]=4,ko[138]=Vo[138]=1,Go[128]=Ho[128]=21,Uo[128]=Vo[128]=22,Go[42]=Ho[42]=21,Uo[42]=Vo[42]=22,ko[5]=Go[5]=14,ko[165]=Go[165]=14,Bo[20]=Ho[20]=6,Bo[150]=Ho[150]=6,Fo[80]=Uo[80]=11,Fo[90]=Uo[90]=11,zo[65]=Vo[65]=3,zo[105]=Vo[105]=3,Fo[160]=Uo[160]=11,ko[160]=Go[160]=14,Fo[10]=Uo[10]=11,ko[10]=Go[10]=14,Bo[130]=Ho[130]=6,zo[130]=Vo[130]=3,Bo[40]=Ho[40]=6,zo[40]=Vo[40]=3,ko[101]=Vo[101]=1,ko[69]=Vo[69]=1,Go[149]=Ho[149]=21,Go[21]=Ho[21]=21,Bo[86]=Uo[86]=17,Bo[84]=Uo[84]=17,Fo[89]=zo[89]=9,Fo[81]=zo[81]=9,Fo[96]=Vo[96]=0,ko[96]=Uo[96]=15,Fo[74]=Vo[74]=0,ko[74]=Uo[74]=15,Fo[24]=Bo[24]=8,zo[24]=Ho[24]=7,Fo[146]=Bo[146]=8,zo[146]=Ho[146]=7,ko[6]=Uo[6]=15,Bo[6]=Go[6]=16,ko[164]=Uo[164]=15,Bo[164]=Go[164]=16,zo[129]=Ho[129]=7,Go[129]=Vo[129]=20,zo[41]=Ho[41]=7,Go[41]=Vo[41]=20,Bo[66]=Vo[66]=2,zo[66]=Uo[66]=19,Bo[104]=Vo[104]=2,zo[104]=Uo[104]=19,Fo[144]=Go[144]=10,Uo[144]=Ho[144]=23,Fo[26]=Go[26]=10,Uo[26]=Ho[26]=23,ko[36]=Ho[36]=5,Bo[36]=Vo[36]=2,ko[134]=Ho[134]=5,Bo[134]=Vo[134]=2,Fo[9]=Go[9]=10,ko[9]=zo[9]=13,Fo[161]=Go[161]=10,ko[161]=zo[161]=13,ko[37]=Ho[37]=5,Go[37]=Vo[37]=20,ko[133]=Ho[133]=5,Go[133]=Vo[133]=20,Bo[148]=Go[148]=16,Uo[148]=Ho[148]=23,Bo[22]=Go[22]=16,Uo[22]=Ho[22]=23,Fo[82]=Bo[82]=8,zo[82]=Uo[82]=19,Fo[88]=Bo[88]=8,zo[88]=Uo[88]=19,Fo[73]=Vo[73]=0,ko[73]=zo[73]=13,Fo[97]=Vo[97]=0,ko[97]=zo[97]=13,Fo[145]=zo[145]=9,Go[145]=Ho[145]=21,Fo[25]=zo[25]=9,Go[25]=Ho[25]=21,ko[70]=Vo[70]=1,Bo[70]=Uo[70]=17,ko[100]=Vo[100]=1,Bo[100]=Uo[100]=17,Fo[34]=zo[34]=9,ko[34]=Bo[34]=12,Go[34]=Ho[34]=21,Uo[34]=Vo[34]=22,Fo[136]=Ho[136]=4,ko[136]=Vo[136]=1,Bo[136]=Uo[136]=17,zo[136]=Go[136]=18,Fo[35]=Ho[35]=4,ko[35]=Bo[35]=12,zo[35]=Go[35]=18,Uo[35]=Vo[35]=22,Fo[153]=Ho[153]=4,zo[153]=Go[153]=18,ko[102]=Bo[102]=12,Uo[102]=Vo[102]=22,Fo[155]=zo[155]=9,Go[155]=Ho[155]=23,ko[103]=Vo[103]=1,Bo[103]=Uo[103]=17,Fo[152]=Ho[152]=4,Bo[152]=Uo[152]=17,zo[152]=Go[152]=18,Fo[156]=Bo[156]=8,zo[156]=Go[156]=18,Uo[156]=Ho[156]=23,Fo[137]=Ho[137]=4,ko[137]=Vo[137]=1,zo[137]=Go[137]=18,Fo[139]=Ho[139]=4,ko[139]=zo[139]=13,Go[139]=Vo[139]=20,Fo[98]=zo[98]=9,ko[98]=Bo[98]=12,Uo[98]=Vo[98]=22,Fo[99]=Vo[99]=0,ko[99]=Bo[99]=12,zo[99]=Uo[99]=19,ko[38]=Bo[38]=12,Go[38]=Ho[38]=21,Uo[38]=Vo[38]=22,ko[39]=Ho[39]=5,Bo[39]=Go[39]=16,Uo[39]=Vo[39]=22;var jo=[];function Wo(t,e,n){return(t-e)/(n-e)}function qo(t){return t.constructor.toString().indexOf("Array")>-1}function Yo(t,e,n,r,i,o){for(var s=t.cells[n][e],a=s.cval_real,u=e+r,l=n+i,c=[],h=!1;!h;){if(void 0===t.cells[l]||void 0===t.cells[l][u])if(l-=i,u-=r,a=(s=t.cells[l][u]).cval_real,-1===i)if(0===o)if(1&a)c.push([u,l]),r=-1,i=0,o=0;else{if(!(4&a)){c.push([u+s.bottomright,l]),r=0,i=1,o=1,h=!0;break}c.push([u+1,l]),r=1,i=0,o=0}else{if(!(1&a)){if(4&a){c.push([u+s.bottomright,l]),r=0,i=1,o=1,h=!0;break}c.push([u+s.bottomleft,l]),r=0,i=1,o=0,h=!0;break}c.push([u,l]),r=-1,i=0,o=0}else if(1===i)if(0===o){if(!(a&no)){if(a&eo){c.push([u+s.topleft,l+1]),r=0,i=-1,o=0,h=!0;break}c.push([u+s.topright,l+1]),r=0,i=-1,o=1,h=!0;break}c.push([u+1,l+1]),r=1,i=0,o=1}else c.push([u+1,l+1]),r=1,i=0,o=1;else if(-1===r)if(0===o){if(!(a&eo)){if(1&a){c.push([u,l+s.leftbottom]),r=1,i=0,o=0,h=!0;break}c.push([u,l+s.lefttop]),r=1,i=0,o=1,h=!0;break}c.push([u,l+1]),r=0,i=1,o=0}else{if(!(a&eo)){console.log("MarchingSquaresJS-isoBands: wtf");break}c.push([u,l+1]),r=0,i=1,o=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(4&a)){c.push([u+1,l+s.rightbottom]),r=-1,i=0,o=0,h=!0;break}c.push([u+1,l]),r=0,i=-1,o=1}else{if(!(4&a)){if(a&no){c.push([u+1,l+s.righttop]),r=-1,i=0,o=1;break}c.push([u+1,l+s.rightbottom]),r=-1,i=0,o=0,h=!0;break}c.push([u+1,l]),r=0,i=-1,o=1}}else if(a=(s=t.cells[l][u]).cval_real,-1===r)if(0===o)if(void 0!==t.cells[l-1]&&void 0!==t.cells[l-1][u])r=0,i=-1,o=1;else{if(!(1&a)){c.push([u+s.bottomright,l]),r=0,i=1,o=1,h=!0;break}c.push([u,l])}else{if(!(a&eo)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+l);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[l+1]&&void 0!==t.cells[l+1][u])r=0,i=1,o=0;else{if(!(a&no)){c.push([u+s.topleft,l+1]),r=0,i=-1,o=0,h=!0;break}c.push([u+1,l+1]),r=1,i=0,o=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[l][u+1])r=1,i=0,o=1;else{if(!(4&a)){c.push([u+1,l+s.righttop]),r=-1,i=0,o=1,h=!0;break}c.push([u+1,l]),r=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[l][u-1])r=-1,i=0,o=0;else{if(!(a&eo)){c.push([u,l+s.leftbottom]),r=1,i=0,o=0,h=!0;break}c.push([u,l+1]),r=0,i=1,o=0}}if(l+=i,(u+=r)===e&&l===n)break}return{path:c,i:u,j:l,x:r,y:i,o:o}}function Xo(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],n=t.cval_real;switch(e){case 0:return n&no?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return 4&n?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return 1&n?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return n&no?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return 4&n?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return 1&n?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return 1&n?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return n&eo?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return 1&n?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return n&eo?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return n&eo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return n&eo?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return n&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return n&no?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return n&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return n&no?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function Zo(t,e,n,r){var i,o,s,a,u,l=t.cval;switch(e){case-1:switch(r){case 0:i=ko[l],s=po[l],a=fo[l],u=go[l];break;default:i=Fo[l],s=lo[l],a=co[l],u=ho[l]}break;case 1:switch(r){case 0:i=Go[l],s=So[l],a=To[l],u=Co[l];break;default:i=Uo[l],s=wo[l],a=Mo[l],u=Eo[l]}break;default:switch(n){case-1:switch(r){case 0:i=Vo[l],s=ro[l],a=io[l],u=oo[l];break;default:i=Ho[l],s=so[l],a=ao[l],u=uo[l]}break;case 1:switch(r){case 0:i=zo[l],s=mo[l],a=yo[l],u=vo[l];break;default:i=Bo[l],s=xo[l],a=_o[l],u=bo[l]}}}if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;switch(function(t,e){delete t.edges[e];for(var n=e+1;n<t.edges.length;n++)t.edges[n-1]=t.edges[n];t.edges.pop()}(t,o),l=t.cval_real,i){case 0:l&no?(e=t.topleft,n=1):(e=1,n=t.righttop);break;case 1:4&l?(e=1,n=t.rightbottom):(e=t.topleft,n=1);break;case 2:4&l?(e=t.topleft,n=1):(e=t.bottomright,n=0);break;case 3:1&l?(e=t.bottomleft,n=0):(e=t.topleft,n=1);break;case 4:l&no?(e=t.topright,n=1):(e=1,n=t.righttop);break;case 5:4&l?(e=1,n=t.rightbottom):(e=t.topright,n=1);break;case 6:4&l?(e=t.topright,n=1):(e=t.bottomright,n=0);break;case 7:1&l?(e=t.bottomleft,n=0):(e=t.topright,n=1);break;case 8:4&l?(e=1,n=t.righttop):(e=t.bottomright,n=0);break;case 9:1&l?(e=t.bottomleft,n=0):(e=1,n=t.righttop);break;case 10:1&l?(e=1,n=t.righttop):(e=0,n=t.leftbottom);break;case 11:l&eo?(e=0,n=t.lefttop):(e=1,n=t.righttop);break;case 12:4&l?(e=1,n=t.rightbottom):(e=t.bottomright,n=0);break;case 13:1&l?(e=t.bottomleft,n=0):(e=1,n=t.rightbottom);break;case 14:1&l?(e=1,n=t.rightbottom):(e=0,n=t.leftbottom);break;case 15:l&eo?(e=0,n=t.lefttop):(e=1,n=t.rightbottom);break;case 16:4&l?(e=0,n=t.leftbottom):(e=t.bottomright,n=0);break;case 17:l&eo?(e=0,n=t.lefttop):(e=t.bottomright,n=0);break;case 18:1&l?(e=t.bottomleft,n=0):(e=0,n=t.leftbottom);break;case 19:l&eo?(e=0,n=t.lefttop):(e=t.bottomleft,n=0);break;case 20:l&eo?(e=0,n=t.leftbottom):(e=t.topleft,n=1);break;case 21:l&no?(e=t.topright,n=1):(e=0,n=t.leftbottom);break;case 22:l&eo?(e=0,n=t.lefttop):(e=t.topleft,n=1);break;case 23:l&no?(e=t.topright,n=1):(e=0,n=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==n&&void 0!==s&&void 0!==a&&void 0!==u||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+n+" "+s+" "+a+" "+u)),{p:[e,n],x:s,y:a,o:u}}function Ko(t){var e=[],n=[];t.forEach((function(t){var r=Hr(c([t]));n.push(r),e.push({ring:t,area:r})})),n.sort((function(t,e){return e-t}));var r=[];return n.forEach((function(t){for(var n=0;n<e.length;n++)if(e[n].area===t){r.push(e[n].ring),e.splice(n,1);break}})),r}function Jo(t){for(var e=t.map((function(t){return{lrCoordinates:t,grouped:!1}})),n=[];!$o(e);)for(var r=0;r<e.length;r++)if(!e[r].grouped){var i=[];i.push(e[r].lrCoordinates),e[r].grouped=!0;for(var o=c([e[r].lrCoordinates]),s=r+1;s<e.length;s++)e[s].grouped||Qo(c([e[s].lrCoordinates]),o)&&(i.push(e[s].lrCoordinates),e[s].grouped=!0);n.push(i)}return n}function Qo(t,e){for(var n=Mn(t),r=0;r<n.features.length;r++)if(!ye(n.features[r],e))return!1;return!0}function $o(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}function ts(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("angle is required");return 0===e||(r||(r=wn(t)),!1!==i&&void 0!==i||(t=Se(t)),N(t,(function(t){var n=Ui(r,t)+e,i=Dr(r,t),o=$(Hi(r,i,n));t[0]=o[0],t[1]=o[1]}))),t}function es(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw new Error("geojson required");if("number"!=typeof e||0===e)throw new Error("invalid factor");var o=Array.isArray(r)||"object"==typeof r;return!0!==i&&(t=Se(t)),"FeatureCollection"!==t.type||o?ns(t,e,r):(k(t,(function(n,i){t.features[i]=ns(n,e,r)})),t)}function ns(t,e,n){var r="Point"===ot(t);return n=function(t,e){if(null==e&&(e="centroid"),Array.isArray(e)||"object"==typeof e)return Q(e);var n=t.bbox?t.bbox:J(t),r=n[0],i=n[1],o=n[2],s=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return u([r,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return u([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return u([r,s]);case"ne":case"northeast":case"eastnorth":case"topright":return u([o,s]);case"center":return bn(t);case void 0:case null:case"centroid":return wn(t);default:throw new Error("invalid origin")}}(t,n),1===e||r||N(t,(function(t){var r=Dr(n,t),i=Ui(n,t),o=$(Hi(n,r*e,i));t[0]=o[0],t[1]=o[1],3===t.length&&(t[2]*=e)})),t}function rs(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function is(t,e){return t[0]*e[1]-e[0]*t[1]}function os(t,e){return!function(t,e){return 0===is(rs(t),rs(e))}(t,e)&&function(t,e){var n,r,i=t[0],o=rs(t),s=e[0],a=rs(e),u=is(o,a);return function(t,e){return[t[0]+e[0],t[1]+e[1]]}(i,function(t,e){return[t*e[0],t*e[1]]}(is((r=i,[(n=s)[0]-r[0],n[1]-r[1]]),a)/u,o))}(t,e)}function ss(t,e,n){var r=[],i=w(e,n),o=$(t),s=[];return o.forEach((function(t,e){if(e!==o.length-1){var n=(l=t,c=o[e+1],h=i,p=Math.sqrt((l[0]-c[0])*(l[0]-c[0])+(l[1]-c[1])*(l[1]-c[1])),d=l[0]+h*(c[1]-l[1])/p,f=c[0]+h*(c[1]-l[1])/p,g=l[1]+h*(l[0]-c[0])/p,m=c[1]+h*(l[0]-c[0])/p,[[d,g],[f,m]]);if(r.push(n),e>0){var a=r[e-1],u=os(n,a);!1!==u&&(a[1]=u,n[0]=u),s.push(a[0]),e===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}var l,c,h,p,d,f,g,m})),p(s,t.properties)}function as(t,e,n){var r=e[0]-t[0],i=e[1]-t[1],o=n[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(r*(n[1]-e[1])-o*i)}function us(t,e){return e.geometry.coordinates[0].every((function(e){return ye(u(e),t)}))}jo[1]=jo[169]=Ao,jo[4]=jo[166]=Po,jo[16]=jo[154]=Lo,jo[64]=jo[106]=Io,jo[168]=jo[2]=Ro,jo[162]=jo[8]=No,jo[138]=jo[32]=Oo,jo[42]=jo[128]=Do,jo[5]=jo[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},jo[20]=jo[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},jo[80]=jo[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},jo[65]=jo[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},jo[160]=jo[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},jo[130]=jo[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},jo[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},jo[101]=jo[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},jo[149]=jo[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},jo[86]=jo[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},jo[89]=jo[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},jo[96]=jo[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},jo[24]=jo[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},jo[6]=jo[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},jo[129]=jo[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},jo[66]=jo[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},jo[144]=jo[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},jo[36]=jo[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},jo[9]=jo[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},jo[37]=jo[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},jo[148]=jo[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},jo[82]=jo[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},jo[73]=jo[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},jo[145]=jo[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},jo[70]=jo[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},jo[34]=function(t){return[Do(t),No(t)]},jo[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},jo[136]=function(t){return[Oo(t),Ro(t)]},jo[153]=function(t){return[Lo(t),Ao(t)]},jo[102]=function(t){return[Po(t),Io(t)]},jo[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},jo[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},jo[152]=function(t){return[Lo(t),Ro(t)]},jo[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},jo[137]=function(t){return[Oo(t),Ao(t)]},jo[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},jo[98]=function(t){return[No(t),Io(t)]},jo[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},jo[38]=function(t){return[Po(t),Do(t)]},jo[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var ls=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,n){var r=e.to,i=n.to;if(r.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(r.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(r.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return r.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=as(t.coordinates,r.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}(),cs=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return p([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return as(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}(),hs=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,n,r){return n.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e}),0),n=(0===e?this.length:e)-1,r=(e+1)%this.length,i=as(this.edges[n].from.coordinates,this.edges[e].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},t.prototype.toMultiPoint=function(){return m(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=c([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=mn(this.toPolygon())},t.findEdgeRingContaining=function(t,e){var n,r,i=t.getEnvelope();return e.forEach((function(e){var o,s,a,l,c,h,p=e.getEnvelope();if(r&&(n=r.getEnvelope()),s=i,a=(o=p).geometry.coordinates[0].map((function(t){return t[0]})),l=o.geometry.coordinates[0].map((function(t){return t[1]})),c=s.geometry.coordinates[0].map((function(t){return t[0]})),h=s.geometry.coordinates[0].map((function(t){return t[1]})),(Math.max.apply(null,a)!==Math.max.apply(null,c)||Math.max.apply(null,l)!==Math.max.apply(null,h)||Math.min.apply(null,a)!==Math.min.apply(null,c)||Math.min.apply(null,l)!==Math.min.apply(null,h))&&us(p,i)){for(var d=t.map((function(t){return t.from.coordinates})),f=void 0,g=function(t){e.some((function(e){return n=t,r=e.from.coordinates,n[0]===r[0]&&n[1]===r[1];var n,r}))||(f=t)},m=0,y=d;m<y.length;m++)g(y[m]);f&&e.inside(u(f))&&(r&&!us(n,p)||(r=e))}})),r},t.prototype.inside=function(t){return ye(t,this.toPolygon())},t}(),ps=function(){function t(){this.edges=[],this.nodes={}}return t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var n=new t;return V(e,(function(t){nt(t,"LineString","Graph::fromGeoJson"),O(t,(function(t,e){if(t){var r=n.getNode(t),i=n.getNode(e);n.addEdge(r,i)}return e}))})),n},t.prototype.getNode=function(t){var e=ls.buildId(t),n=this.nodes[e];return n||(n=this.nodes[e]=new ls(t)),n},t.prototype.addEdge=function(t,e){var n=new cs(t,e),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),n.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,n){t.getOuterEdge((0===n?t.getOuterEdges().length:n)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var n,r,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var s=i[o],a=s.symetric,u=void 0,l=void 0;s.label===e&&(u=s),a.label===e&&(l=a),u&&l&&(l&&(r=l),u&&(r&&(r.next=u,r=void 0),n||(n=u)))}r&&(r.next=n)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(n){if(!(n.label>=0)){t.push(n);var r=n;do{r.label=e,r=r.next}while(!n.isEqual(r));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(n){t._computeNextCCWEdges(n,e.label)}))}));var e=[];return this.edges.forEach((function(n){n.ring||e.push(t._findEdgeRing(n))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],n=t,r=function(){var r=0;n.from.getOuterEdges().forEach((function(e){e.label===t.label&&++r})),r>1&&e.push(n.from),n=n.next};do{r()}while(!t.isEqual(n));return e},t.prototype._findEdgeRing=function(t){var e=t,n=new hs;do{n.push(e),e.ring=n,e=e.next}while(!t.isEqual(e));return n},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()},t}();function ds(t,e){var n=!0;return V(t,(function(t){V(e,(function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return n=t.coordinates,r=e.coordinates,!(n[0]===r[0]&&n[1]===r[1]);case"LineString":return!fs(e,t);case"Polygon":return!ye(t,e)}break;case"LineString":switch(e.type){case"Point":return!fs(t,e);case"LineString":return!function(t,e){return Rr(t,e).features.length>0}(t,e);case"Polygon":return!gs(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ye(e,t);case"LineString":return!gs(t,e);case"Polygon":return!function(t,e){for(var n=0,r=t.coordinates[0];n<r.length;n++)if(ye(r[n],e))return!0;for(var i=0,o=e.coordinates[0];i<o.length;i++)if(ye(o[i],t))return!0;return Rr(Si(t),Si(e)).features.length>0}(e,t)}}var n,r;return!1}(t.geometry,e.geometry)}))})),n}function fs(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(ms(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function gs(t,e){for(var n=0,r=e.coordinates;n<r.length;n++)if(ye(r[n],t))return!0;return Rr(e,Si(t)).features.length>0}function ms(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];return 0==r*s-i*o&&(Math.abs(o)>=Math.abs(s)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}function ys(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function vs(t,e){return t[0]===e[0]&&t[1]===e[1]}function xs(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function _s(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&!n&&!r;){for(var s=0;s<e.coordinates.length-1;s++){var a=!0;0!==s&&s!==e.coordinates.length-2||(a=!1),Ms(e.coordinates[s],e.coordinates[s+1],t.coordinates[o],a)?n=!0:r=!0}o++}return n&&r}function bs(t,e){return Rr(t,Ti(e)).features.length>0}function ws(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&(!n||!r);o++)ye(u(t.coordinates[o]),e)?n=!0:r=!0;return r&&n}function Ms(t,e,n,r){var i=n[0]-t[0],o=n[1]-t[1],s=e[0]-t[0],a=e[1]-t[1];return 0==i*a-o*s&&(r?Math.abs(s)>=Math.abs(a)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]:Math.abs(s)>=Math.abs(a)?s>0?t[0]<n[0]&&n[0]<e[0]:e[0]<n[0]&&n[0]<t[0]:a>0?t[1]<n[1]&&n[1]<e[1]:e[1]<n[1]&&n[1]<t[1])}var Es=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:Cs};function Ss(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function Ts(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function Cs(t,e){return ki(t,e,{strict:!0})}Es.prototype.compare=function(t,e){if(t.type!==e.type||!Ts(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,r=Ss(t),i=Ss(e);return r.every((function(t){return this.some((function(e){return n.compare(t,e)}))}),i)}}return!1},Es.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},Es.prototype.compareLine=function(t,e,n,r){if(!Ts(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[n],o[n]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},Es.prototype.fixStartIndex=function(t,e){for(var n,r=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){r=i;break}return r>=0&&(n=[].concat(t.slice(r,t.length),t.slice(1,r+1))),n},Es.prototype.comparePath=function(t,e){var n=this;return t.every((function(t,e){return n.compareCoord(t,this[e])}),e)},Es.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),i=this;return n.every((function(t){return this.some((function(e){return i.compareLine(t,e,1,!0)}))}),r)}return!1},Es.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},Es.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},Es.prototype.removePseudo=function(t){return t};var As=Es;function Ps(t,e){var n=!1;return V(t,(function(t){V(e,(function(e){if(!0===n)return!0;n=!ds(t.geometry,e.geometry)}))})),n}var Ls=Ut((function(t){function e(t,e,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,n,r)}e.prototype.run=function(t,e,n,r){this._init(t,e,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(i,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],n=0;n<this._datasetLength;n++)this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n);return e},e.prototype._mergeArrays=function(t,e){for(var n=e.length,r=0;r<n;r++){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)})),Is=Ut((function(t){function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(c),a=0,u=0;u<c;u++)s[u]=0;for(var l=0;l<n;l++){var c=this.dataset[l].length;if(o===this.assignments[l]){for(u=0;u<c;u++)s[u]+=this.dataset[l][u];a++}}if(a>0){for(u=0;u<c;u++)s[u]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,r=0;r<n;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===e[t=this.assignments[n]]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var r,i=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(r=n(t,e[a]))<i&&(i=r,o=a);return o},e.prototype.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)},t.exports&&(t.exports=e)})),Rs=Ut((function(t){function e(t,e,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,n)}e.prototype.insert=function(t,e){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?e>i&&(n=r):e<i&&(n=r)}this._insertAt(t,e,n)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this._queue.length;e<n;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,n){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}n&&(this._sorting=n)},e.prototype._insertAt=function(t,e,n){this._queue.length===n?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(n,0,t),this._priorities.splice(n,0,e))},t.exports&&(t.exports=e)})),Ns=Ut((function(t){if(t.exports)var e=Rs;function n(t,e,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,n,r)}n.prototype.run=function(t,n,r,i){this._init(t,n,r,i);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var u=new e(null,null,"asc"),l=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,l,u),this._expandCluster(a,u))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this._orderedList.length;e<n;e++){var r=this._orderedList[e],i=this._reachability[r];t.push([r,i])}return t},n.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},n.prototype._updateQueue=function(t,e,n){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===r._processed[e]){var i=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,i);void 0===r._reachability[e]?(r._reachability[e]=o,n.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,n.remove(e),n.insert(e,o))}}))},n.prototype._expandCluster=function(t,e){for(var n=e.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},n.prototype._distanceToCore=function(t){for(var e=this.epsilon,n=0;n<e;n++)if(this._regionQuery(t,n).length>=this.minPts)return n},n.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[t],this.dataset[r])<e&&n.push(r);return n},n.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=n)})),Os=Ut((function(t){t.exports&&(t.exports={DBSCAN:Ls,KMEANS:Is,OPTICS:Ns,PriorityQueue:Rs})})),Ds=function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++){var s=(t[o]||0)-(e[o]||0);i+=s*s}return n?Math.sqrt(i):i},Fs=Ds,ks=function(t,e,n){var r=Math.abs(t-e);return n?r:r*r},Bs=Ds,zs=function(t,e){for(var n={},r=[],i=e<<2,o=t.length,s=t[0].length>0;r.length<e&&i-- >0;){var a=t[Math.floor(Math.random()*o)],u=s?a.join("_"):""+a;n[u]||(n[u]=!0,r.push(a))}if(r.length<e)throw new Error("Error initializating clusters");return r},Gs=function(t,e){var n=t[0].length?Fs:ks,r=[],i=t.length,o=t[0].length>0,s=t[Math.floor(Math.random()*i)];for(o&&s.join("_"),r.push(s);r.length<e;){for(var a=[],u=r.length,l=0,c=[],h=0;h<i;h++){for(var p=1/0,d=0;d<u;d++){var f=n(t[h],r[d]);f<=p&&(p=f)}a[h]=p}for(var g=0;g<i;g++)l+=a[g];for(var m=0;m<i;m++)c[m]={i:m,v:t[m],pr:a[m]/l,cs:0};c.sort((function(t,e){return t.pr-e.pr})),c[0].cs=c[0].pr;for(var y=1;y<i;y++)c[y].cs=c[y-1].cs+c[y].pr;for(var v=Math.random(),x=0;x<i-1&&c[x++].cs<v;);r.push(c[x-1].v)}return r};function Us(t,e,n){n=n||[];for(var r=0;r<t;r++)n[r]=e;return n}var Vs=function(t,e,n,r){var i=[],o=[],s=[],a=[],u=!1,l=r||1e4,c=t.length,h=t[0].length,p=h>0,d=[];if(n)i="kmrand"==n?zs(t,e):"kmpp"==n?Gs(t,e):n;else for(var f={};i.length<e;){var g=Math.floor(Math.random()*c);f[g]||(f[g]=!0,i.push(t[g]))}do{Us(e,0,d);for(var m=0;m<c;m++){for(var y=1/0,v=0,x=0;x<e;x++)(a=p?Bs(t[m],i[x]):Math.abs(t[m]-i[x]))<=y&&(y=a,v=x);s[m]=v,d[v]++}for(var _=[],b=(o=[],0);b<e;b++)_[b]=p?Us(h,0,_[b]):0,o[b]=i[b];if(p){for(var w=0;w<e;w++)i[w]=[];for(var M=0;M<c;M++)for(var E=_[s[M]],S=t[M],T=0;T<h;T++)E[T]+=S[T];u=!0;for(var C=0;C<e;C++){for(var A=i[C],P=_[C],L=o[C],I=d[C],R=0;R<h;R++)A[R]=P[R]/I||0;if(u)for(var N=0;N<h;N++)if(L[N]!=A[N]){u=!1;break}}}else{for(var O=0;O<c;O++)_[s[O]]+=t[O];for(var D=0;D<e;D++)i[D]=_[D]/d[D]||0;u=!0;for(var F=0;F<e;F++)if(o[F]!=i[F]){u=!1;break}}u=u||--l<=0}while(!u);return{it:1e4-l,k:e,idxs:s,centroids:i}};function Hs(t,e){return M(Ui(t[0],t[1]))===M(Ui(e[0],e[1]))}function js(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function Ws(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}var qs={search:function(t,e,n,r){t.cleanDirty();var i=(r=r||{}).heuristic||qs.heuristics.manhattan,o=r.closest||!1,s=new Zs((function(t){return t.f})),a=e;for(e.h=i(e,n),s.push(e);s.size()>0;){var u=s.pop();if(u===n)return Ws(u);u.closed=!0;for(var l=t.neighbors(u),c=0,h=l.length;c<h;++c){var p=l[c];if(!p.closed&&!p.isWall()){var d=u.g+p.getCost(u),f=p.visited;(!f||d<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,n),p.g=d,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<a.h||p.h===a.h&&p.g<a.g)&&(a=p),f?s.rescoreElement(p):s.push(p))}}}return o?Ws(a):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var n=Math.sqrt(2),r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function Ys(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var o=new Xs(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function Xs(t,e,n){this.x=t,this.y=e,this.weight=n}function Zs(t){this.content=[],this.scoreFunction=t}function Ks(t,e){for(var n=0;n<e.features.length;n++)if(ye(t,e.features[n]))return!0;return!1}function Js(t){return function(){return t}}function Qs(t){return t[0]}function $s(t){return t[1]}function ta(){this._=null}function ea(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function na(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ra(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ia(t){for(;t.L;)t=t.L;return t}function oa(t,e,n,r){var i=[null,null],o=Pa.push(i)-1;return i.left=t,i.right=e,n&&aa(i,t,e,n),r&&aa(i,e,t,r),Ca[t.index].halfedges.push(o),Ca[e.index].halfedges.push(o),i}function sa(t,e,n){var r=[e,n];return r.left=t,r}function aa(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function ua(t,e,n,r,i){var o,s=t[0],a=t[1],u=s[0],l=s[1],c=0,h=1,p=a[0]-u,d=a[1]-l;if(o=e-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>c&&(c=o)}if(o=r-u,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<h&&(h=o)}if(o=n-l,d||!(o>0)){if(o/=d,d<0){if(o<c)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>c&&(c=o)}if(o=i-l,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>c&&(c=o)}else if(d>0){if(o<c)return;o<h&&(h=o)}return!(c>0||h<1)||(c>0&&(t[0]=[u+c*p,l+c*d]),h<1&&(t[1]=[u+h*p,l+h*d]),!0)}}}}}function la(t,e,n,r,i){var o=t[1];if(o)return!0;var s,a,u=t[0],l=t.left,c=t.right,h=l[0],p=l[1],d=c[0],f=c[1],g=(h+d)/2,m=(p+f)/2;if(f===p){if(g<e||g>=r)return;if(h>d){if(u){if(u[1]>=i)return}else u=[g,n];o=[g,i]}else{if(u){if(u[1]<n)return}else u=[g,i];o=[g,n]}}else if(a=m-(s=(h-d)/(f-p))*g,s<-1||s>1)if(h>d){if(u){if(u[1]>=i)return}else u=[(n-a)/s,n];o=[(i-a)/s,i]}else{if(u){if(u[1]<n)return}else u=[(i-a)/s,i];o=[(n-a)/s,n]}else if(p<f){if(u){if(u[0]>=r)return}else u=[e,s*e+a];o=[r,s*r+a]}else{if(u){if(u[0]<e)return}else u=[r,s*r+a];o=[e,s*e+a]}return t[0]=u,t[1]=o,!0}function ca(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function ha(t,e){return e[+(e.left!==t.site)]}function pa(t,e){return e[+(e.left===t.site)]}Ys.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)qs.cleanNode(this.nodes[t])},Ys.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)qs.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Ys.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Ys.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},Ys.prototype.toString=function(){for(var t,e,n,r,i=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],n=0,r=(e=o[s]).length;n<r;n++)t.push(e[n].weight);i.push(t.join(" "))}return i.join("\n")},Xs.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Xs.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Xs.prototype.isWall=function(){return 0===this.weight},Zs.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i,o=t+1<<1,s=o-1,a=null;if(s<e){var u=this.content[s];(i=this.scoreFunction(u))<r&&(a=s)}if(o<e){var l=this.content[o];this.scoreFunction(l)<(null===a?r:i)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}},ta.prototype={constructor:ta,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ia(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(na(this,n),n=(t=n).U),n.C=!1,r.C=!0,ra(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(ra(this,n),n=(t=n).U),n.C=!1,r.C=!0,na(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,s=t.R;if(n=o?s?ia(s):o:s,i?i.L===t?i.L=n:i.R=n:this._=n,o&&s?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==s?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=s,s.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,na(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ra(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,na(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,ra(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,na(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,ra(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var da,fa=[];function ga(){ea(this),this.x=this.y=this.arc=this.site=this.cy=null}function ma(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var s=i[0],a=i[1],u=r[0]-s,l=r[1]-a,c=o[0]-s,h=o[1]-a,p=2*(u*h-l*c);if(!(p>=-Ia)){var d=u*u+l*l,f=c*c+h*h,g=(h*d-l*f)/p,m=(u*f-c*d)/p,y=fa.pop()||new ga;y.arc=t,y.site=i,y.x=g+s,y.y=(y.cy=m+a)+Math.sqrt(g*g+m*m),t.circle=y;for(var v=null,x=Aa._;x;)if(y.y<x.y||y.y===x.y&&y.x<=x.x){if(!x.L){v=x.P;break}x=x.L}else{if(!x.R){v=x;break}x=x.R}Aa.insert(v,y),v||(da=y)}}}}function ya(t){var e=t.circle;e&&(e.P||(da=e.N),Aa.remove(e),fa.push(e),ea(e),t.circle=null)}var va=[];function xa(){ea(this),this.edge=this.site=this.circle=null}function _a(t){var e=va.pop()||new xa;return e.site=t,e}function ba(t){ya(t),Ta.remove(t),va.push(t),ea(t)}function wa(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,s=t.N,a=[t];ba(t);for(var u=o;u.circle&&Math.abs(n-u.circle.x)<La&&Math.abs(r-u.circle.cy)<La;)o=u.P,a.unshift(u),ba(u),u=o;a.unshift(u),ya(u);for(var l=s;l.circle&&Math.abs(n-l.circle.x)<La&&Math.abs(r-l.circle.cy)<La;)s=l.N,a.push(l),ba(l),l=s;a.push(l),ya(l);var c,h=a.length;for(c=1;c<h;++c)l=a[c],u=a[c-1],aa(l.edge,u.site,l.site,i);u=a[0],(l=a[h-1]).edge=oa(u.site,l.site,null,i),ma(u),ma(l)}function Ma(t){for(var e,n,r,i,o=t[0],s=t[1],a=Ta._;a;)if((r=Ea(a,s)-o)>La)a=a.L;else{if(!((i=o-Sa(a,s))>La)){r>-La?(e=a.P,n=a):i>-La?(e=a,n=a.N):e=n=a;break}if(!a.R){e=a;break}a=a.R}!function(t){Ca[t.index]={site:t,halfedges:[]}}(t);var u=_a(t);if(Ta.insert(e,u),e||n){if(e===n)return ya(e),n=_a(e.site),Ta.insert(u,n),u.edge=n.edge=oa(e.site,u.site),ma(e),void ma(n);if(n){ya(e),ya(n);var l=e.site,c=l[0],h=l[1],p=t[0]-c,d=t[1]-h,f=n.site,g=f[0]-c,m=f[1]-h,y=2*(p*m-d*g),v=p*p+d*d,x=g*g+m*m,_=[(m*v-d*x)/y+c,(p*x-g*v)/y+h];aa(n.edge,l,f,_),u.edge=oa(l,t,null,_),n.edge=oa(t,f,null,_),ma(e),ma(n)}else u.edge=oa(e.site,u.site)}}function Ea(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var s=t.P;if(!s)return-1/0;var a=(n=s.site)[0],u=n[1],l=u-e;if(!l)return a;var c=a-r,h=1/o-1/l,p=c/l;return h?(-p+Math.sqrt(p*p-2*h*(c*c/(-2*l)-u+l/2+i-o/2)))/h+r:(r+a)/2}function Sa(t,e){var n=t.N;if(n)return Ea(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var Ta,Ca,Aa,Pa,La=1e-6,Ia=1e-12;function Ra(t,e){return e[1]-t[1]||e[0]-t[0]}function Na(t,e){var n,r,i,o=t.sort(Ra).pop();for(Pa=[],Ca=new Array(t.length),Ta=new ta,Aa=new ta;;)if(i=da,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(Ma(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;wa(i.arc)}if(function(){for(var t,e,n,r,i=0,o=Ca.length;i<o;++i)if((t=Ca[i])&&(r=(e=t.halfedges).length)){var s=new Array(r),a=new Array(r);for(n=0;n<r;++n)s[n]=n,a[n]=ca(t,Pa[e[n]]);for(s.sort((function(t,e){return a[e]-a[t]})),n=0;n<r;++n)a[n]=e[s[n]];for(n=0;n<r;++n)e[n]=a[n]}}(),e){var s=+e[0][0],a=+e[0][1],u=+e[1][0],l=+e[1][1];!function(t,e,n,r){for(var i,o=Pa.length;o--;)la(i=Pa[o],t,e,n,r)&&ua(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>La||Math.abs(i[0][1]-i[1][1])>La)||delete Pa[o]}(s,a,u,l),function(t,e,n,r){var i,o,s,a,u,l,c,h,p,d,f,g,m=Ca.length,y=!0;for(i=0;i<m;++i)if(o=Ca[i]){for(s=o.site,a=(u=o.halfedges).length;a--;)Pa[u[a]]||u.splice(a,1);for(a=0,l=u.length;a<l;)f=(d=pa(o,Pa[u[a]]))[0],g=d[1],h=(c=ha(o,Pa[u[++a%l]]))[0],p=c[1],(Math.abs(f-h)>La||Math.abs(g-p)>La)&&(u.splice(a,0,Pa.push(sa(s,d,Math.abs(f-t)<La&&r-g>La?[t,Math.abs(h-t)<La?p:r]:Math.abs(g-r)<La&&n-f>La?[Math.abs(p-r)<La?h:n,r]:Math.abs(f-n)<La&&g-e>La?[n,Math.abs(h-n)<La?p:e]:Math.abs(g-e)<La&&f-t>La?[Math.abs(p-e)<La?h:t,e]:null))-1),++l);l&&(y=!1)}if(y){var v,x,_,b=1/0;for(i=0,y=null;i<m;++i)(o=Ca[i])&&(_=(v=(s=o.site)[0]-t)*v+(x=s[1]-e)*x)<b&&(b=_,y=o);if(y){var w=[t,e],M=[t,r],E=[n,r],S=[n,e];y.halfedges.push(Pa.push(sa(s=y.site,w,M))-1,Pa.push(sa(s,M,E))-1,Pa.push(sa(s,E,S))-1,Pa.push(sa(s,S,w))-1)}}for(i=0;i<m;++i)(o=Ca[i])&&(o.halfedges.length||delete Ca[i])}(s,a,u,l)}this.edges=Pa,this.cells=Ca,Ta=Aa=Pa=Ca=null}function Oa(t){return(t=t.slice()).push(t[0]),c([t])}function Da(t,e,n,r){var i=(r=r||{}).steps||64,o=r.units||"kilometers",s=r.angle||0,a=r.pivot||t,u=r.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!P(r))throw new Error("options must be an object");if(!A(i))throw new Error("steps must be a number");if(!A(s))throw new Error("angle must be a number");var l=Q(t);if("degrees"===o)var h=S(s);else e=Hi(t,e,90,{units:o}),n=Hi(t,n,0,{units:o}),e=Q(e)[0]-l[0],n=Q(n)[1]-l[1];for(var p=[],d=0;d<i;d+=1){var f=-360*d/i,g=e*n/Math.sqrt(Math.pow(n,2)+Math.pow(e,2)*Math.pow(Fa(f),2)),m=e*n/Math.sqrt(Math.pow(e,2)+Math.pow(n,2)/Math.pow(Fa(f),2));if(f<-90&&f>=-270&&(g=-g),f<-180&&f>=-360&&(m=-m),"degrees"===o){var y=g*Math.cos(h)+m*Math.sin(h),v=m*Math.cos(h)-g*Math.sin(h);g=y,m=v}p.push([g+l[0],m+l[1]])}return p.push(p[0]),"degrees"===o?c([p],u):ts(c([p],u),s,{pivot:a})}function Fa(t){var e=t*Math.PI/180;return Math.tan(e)}function ka(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return G(t,(function(t,o,s){var a=e.weight?null==s?void 0:s[e.weight]:void 0;if(!A(a=null==a?1:a))throw new Error("weight value must be a number for feature index "+o);(a=Number(a))>0&&N(t,(function(t){n+=t[0]*a,r+=t[1]*a,i+=a}))})),u([n/i,r/i],e.properties,e)}function Ba(t,e,n,r,i){var o=r.tolerance||.001,s=0,a=0,l=0,c=0;if(k(n,(function(e){var n,r=null===(n=e.properties)||void 0===n?void 0:n.weight,i=null==r?1:r;if(!A(i=Number(i)))throw new Error("weight value must be a number");if(i>0){c+=1;var o=i*_e(e,t);0===o&&(o=1);var u=i/o;s+=e.geometry.coordinates[0]*u,a+=e.geometry.coordinates[1]*u,l+=u}})),c<1)throw new Error("no features to measure");var h=s/l,p=a/l;return 1===c||0===i||Math.abs(h-e[0])<o&&Math.abs(p-e[1])<o?u([h,p],{medianCandidates:r.medianCandidates}):(r.medianCandidates.push([h,p]),Ba([h,p],t,n,r,i-1))}function za(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function Ga(t,e){var n=0,r=0;N(t,(function(i,o,s,a,u){u>n&&(n=u,r=o,e.push([]));var l=o-r,c=t.coordinates[u][l+1],h=i[0],p=i[1],d=c[0],f=c[1];e[u].push([.75*h+.25*d,.75*p+.25*f]),e[u].push([.25*h+.75*d,.25*p+.75*f])}),!0),e.forEach((function(t){t.push(t[0])}))}function Ua(t,e){var n=0,r=0,i=0;N(t,(function(o,s,a,u,l){u>i&&(i=u,r=s,e.push([[]])),l>n&&(n=l,r=s,e[u].push([]));var c=s-r,h=t.coordinates[u][l][c+1],p=o[0],d=o[1],f=h[0],g=h[1];e[u][l].push([.75*p+.25*f,.75*d+.25*g]),e[u][l].push([.25*p+.75*f,.25*d+.75*g])}),!0),e.forEach((function(t){t.forEach((function(t){t.push(t[0])}))}))}function Va(t,e,n){void 0===n&&(n=2);var r=Q(t),i=Q(e),o=r[0]-i[0],s=r[1]-i[1];return 1===n?Math.abs(o)+Math.abs(s):Math.pow(Math.pow(o,n)+Math.pow(s,n),1/n)}function Ha(t,e){var n=(e=e||{}).threshold||1e4,r=e.p||2,i=e.binary||!1,o=e.alpha||-1,s=e.standardization||!1,a=[];k(t,(function(t){a.push(wn(t))}));for(var u=[],l=0;l<a.length;l++)u[l]=[];for(l=0;l<a.length;l++)for(var c=l;c<a.length;c++){l===c&&(u[l][c]=0);var h=Va(a[l],a[c],r);u[l][c]=h,u[c][l]=h}for(l=0;l<a.length;l++)for(c=0;c<a.length;c++)0!==(h=u[l][c])&&(u[l][c]=i?h<=n?1:0:h<=n?Math.pow(h,o):0);if(s)for(l=0;l<a.length;l++){var p=u[l].reduce((function(t,e){return t+e}),0);for(c=0;c<a.length;c++)u[l][c]=u[l][c]/p}return u}function ja(t){for(var e=0,n=0,r=t;n<r.length;n++)e+=r[n];return e/t.length}function Wa(t,e){return void 0===e&&(e={}),Ya(t,"mercator",e)}function qa(t,e){return void 0===e&&(e={}),Ya(t,"wgs84",e)}function Ya(t,e,n){void 0===n&&(n={});var r=(n=n||{}).mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&A(t[0])?t="mercator"===e?Xa(t):Za(t):(!0!==r&&(t=Se(t)),N(t,(function(t){var n="mercator"===e?Xa(t):Za(t);t[0]=n[0],t[1]=n[1]}))),t}function Xa(t){var e=Math.PI/180,n=6378137,r=20037508.342789244,i=[n*(Math.abs(t[0])<=180?t[0]:t[0]-360*function(t){return t<0?-1:t>0?1:0}(t[0]))*e,n*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return i[0]>r&&(i[0]=r),i[0]<-r&&(i[0]=-r),i[1]>r&&(i[1]=r),i[1]<-r&&(i[1]=-r),i}function Za(t){var e=180/Math.PI,n=6378137;return[t[0]*e/n,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/n)))*e]}Na.prototype={constructor:Na,polygons:function(){var t=this.edges;return this.cells.map((function(e){var n=e.halfedges.map((function(n){return ha(e,t[n])}));return n.data=e.site.data,n}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(n,r){if(o=(i=n.halfedges).length)for(var i,o,s,a,u,l,c=n.site,h=-1,p=e[i[o-1]],d=p.left===c?p.right:p.left;++h<o;)s=d,d=(p=e[i[h]]).left===c?p.right:p.left,s&&d&&r<s.index&&r<d.index&&(u=s,l=d,((a=c)[0]-l[0])*(u[1]-a[1])-(a[0]-u[0])*(l[1]-a[1])<0)&&t.push([c.data,s.data,d.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,n){for(var r,i,o=this,s=o._found||0,a=o.cells.length;!(i=o.cells[s]);)if(++s>=a)return null;var u=t-i.site[0],l=e-i.site[1],c=u*u+l*l;do{i=o.cells[r=s],s=null,i.halfedges.forEach((function(n){var r=o.edges[n],a=r.left;if(a!==i.site&&a||(a=r.right)){var u=t-a[0],l=e-a[1],h=u*u+l*l;h<c&&(c=h,s=a.index)}}))}while(null!==s);return o._found=r,null==n||c<=n*n?i.site:null}};var Ka=Object.freeze({__proto__:null,toMercator:Wa,toWgs84:qa}),Ja=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};function Qa(t){return Array.isArray(t)?ru(t):t&&t.bbox?ru(t.bbox):[360*nu(),180*nu()]}function $a(t,e){void 0===e&&(e={}),null==t&&(t=1);for(var n=[],r=0;r<t;r++)n.push(u(Qa(e.bbox)));return f(n)}function tu(t,e){void 0===e&&(e={}),null==t&&(t=1),A(e.num_vertices)&&void 0!==e.num_vertices||(e.num_vertices=10),A(e.max_radial_length)&&void 0!==e.max_radial_length||(e.max_radial_length=10);for(var n=[],r=function(t){var r,i=[],o=Ja(Array(e.num_vertices+1)).map(Math.random);o.forEach((function(t,e,n){n[e]=e>0?t+n[e-1]:t})),o.forEach((function(t){t=2*t*Math.PI/o[o.length-1];var n=Math.random();i.push([n*(e.max_radial_length||10)*Math.sin(t),n*(e.max_radial_length||10)*Math.cos(t)])})),i[i.length-1]=i[0],i=i.map((r=Qa(e.bbox),function(t){return[t[0]+r[0],t[1]+r[1]]})),n.push(c([i]))},i=0;i<t;i++)r();return f(n)}function eu(t,e){if(void 0===e&&(e={}),!P(e=e||{}))throw new Error("options is invalid");var n=e.bbox,r=e.num_vertices,i=e.max_length,o=e.max_rotation;null==t&&(t=1),(!A(r)||void 0===r||r<2)&&(r=10),A(i)&&void 0!==i||(i=1e-4),A(o)&&void 0!==o||(o=Math.PI/8);for(var s=[],a=0;a<t;a++){for(var u=[Qa(n)],l=0;l<r-1;l++){var c=(0===l?2*Math.random()*Math.PI:Math.tan((u[l][1]-u[l-1][1])/(u[l][0]-u[l-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*i;u.push([u[l][0]+h*Math.cos(c),u[l][1]+h*Math.sin(c)])}s.push(p(u))}return f(s)}function nu(){return Math.random()-.5}function ru(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}var iu=Object.freeze({__proto__:null,randomPosition:Qa,randomPoint:$a,randomPolygon:tu,randomLineString:eu});function ou(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("filter is required");var n=[];return k(t,(function(t){lu(t.properties,e)&&n.push(t)})),f(n)}function su(t,e,n){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("property is required");for(var r=uu(t,e),i=Object.keys(r),o=0;o<i.length;o++){for(var s=i[o],a=r[s],u=[],l=0;l<a.length;l++)u.push(t.features[a[l]]);n(f(u),s,o)}}function au(t,e,n,r){var i=r;return su(t,e,(function(t,e,o){i=0===o&&void 0===r?t:n(i,t,e,o)})),i}function uu(t,e){var n={};return k(t,(function(t,r){var i=t.properties||{};if(Object.prototype.hasOwnProperty.call(i,String(e))){var o=i[e];Object.prototype.hasOwnProperty.call(n,o)?n[o].push(r):n[o]=[r]}})),n}function lu(t,e){if(void 0===t)return!1;var n=typeof e;if("number"===n||"string"===n)return Object.prototype.hasOwnProperty.call(t,e);if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(!lu(t,e[r]))return!1;return!0}return cu(t,e)}function cu(t,e){for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];if(t[i]!==e[i])return!1}return!0}function hu(t,e){if(!e)return{};if(!e.length)return{};for(var n={},r=0;r<e.length;r++){var i=e[r];Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n}var pu=Object.freeze({__proto__:null,getCluster:ou,clusterEach:su,clusterReduce:au,createBins:uu,applyFilter:lu,propertiesContainsFilter:cu,filterProperties:hu}),du=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null
/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */};function fu(t,e){return t>e?1:t<e?-1:0}function gu(t,e,n){for(var r=new du(null,null),i=r,o=r;;){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,null===(e=a).left)break}o.left=e,o=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(a=e.right,e.right=a.left,a.left=e,null===(e=a).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function mu(t,e,n,r){var i=new du(t,e);if(null===n)return i.left=i.right=null,i;var o=r(t,(n=gu(t,n,r)).key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function yu(t,e,n){var r=null,i=null;if(e){var o=n((e=gu(t,e,n)).key,t);0===o?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function vu(t,e,n,r,i){if(t){r(e+(n?"└── ":"├── ")+i(t)+"\n");var o=e+(n?"    ":"│   ");t.left&&vu(t.left,o,!1,r,i),t.right&&vu(t.right,o,!0,r,i)}}var xu=function(){function t(t){void 0===t&&(t=fu),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=mu(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new du(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,i=gu(t,this._root,r),o=r(t,i.key);return 0===o?this._root=i:(o<0?(n.left=i.left,n.right=i,i.left=null):o>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=gu(t,e,n)).key)?(null===e.left?r=e.right:(r=gu(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=gu(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=gu(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(o((s=i.pop()).key,e)>0)break;if(o(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){for(var e=t,n=[],r=!1,i=new du(null,null),o=i;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,i=this._comparator;if(n&&wu(t,e,0,r-1,i),null===this._root)this._root=_u(t,e,0,r),this._size=r;else{var o=function(t,e,n){for(var r=new du(null,null),i=r,o=t,s=e;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return null!==o?i.next=o:null!==s&&(i.next=s),r.next}(this.toList(),function(t,e){for(var n=new du(null,null),r=n,i=0;i<t.length;i++)r=r.next=new du(t[i],e[i]);return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=bu({head:o},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return vu(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=yu(t,this._root,r),o=i.left,s=i.right;r(t,e)<0?s=mu(e,n,s,r):o=mu(e,n,o,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=gu(t.key,e,n)).left=t),e)}(o,s,r)},t.prototype.split=function(t){return yu(t,this._root,this._comparator)},t}();function _u(t,e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),s=t[o],a=e[o],u=new du(s,a);return u.left=_u(t,e,n,o),u.right=_u(t,e,o+1,r),u}return null}function bu(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=bu(t,e,i),s=t.head;return s.left=o,t.head=t.head.next,s.right=bu(t,i+1,n),s}return null}function wu(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],s=n-1,a=r+1;;){do{s++}while(i(t[s],o)<0);do{a--}while(i(t[a],o)>0);if(s>=a)break;var u=t[s];t[s]=t[a],t[a]=u,u=e[s],e[s]=e[a],e[a]=u}wu(t,e,n,a,i),wu(t,e,a+1,r,i)}}function Mu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Eu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Su(t,e,n){return e&&Eu(t.prototype,e),n&&Eu(t,n),t}var Tu=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Cu=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},Au=Number.EPSILON;void 0===Au&&(Au=Math.pow(2,-52));var Pu=Au*Au,Lu=function(t,e){if(-Au<t&&t<Au&&-Au<e&&e<Au)return 0;var n=t-e;return n*n<Pu*t*e?0:t<e?-1:1},Iu=function(){function t(){Mu(this,t),this.reset()}return Su(t,[{key:"reset",value:function(){this.xRounder=new Ru,this.yRounder=new Ru}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),Ru=function(){function t(){Mu(this,t),this.tree=new xu,this.round(0)}return Su(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===Lu(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===Lu(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),Nu=new Iu,Ou=function(t,e){return t.x*e.y-t.y*e.x},Du=function(t,e){return t.x*e.x+t.y*e.y},Fu=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=Ou(r,i);return Lu(o,0)},ku=function(t){return Math.sqrt(Du(t,t))},Bu=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return Du(i,r)/ku(i)/ku(r)},zu=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},Gu=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},Uu=function(){function t(e,n){Mu(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Su(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Hu.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),Su(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,s,a,u,l=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,s=l.point,a={x:o.x-i.x,y:o.y-i.y},u={x:s.x-i.x,y:s.y-i.y},Ou(u,a)/ku(u)/ku(a)),cosine:Bu(e.point,t.point,l.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,a=n.get(e),u=a.sine,l=a.cosine;return o>=0&&u>=0?s<l?1:s>l?-1:0:o<0&&u<0?s<l?-1:s>l?1:0:u<o?-1:u>o?1:0}}}]),t}(),Vu=0,Hu=function(){function t(e,n,r,i){Mu(this,t),this.id=++Vu,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return Su(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(a<s&&a<u)return 1;if(a>s&&a>u)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(s<a&&s<l)return-1;if(s>a&&s>l)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var d=t.comparePoint(e.rightSE.point);return d<0?1:d>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(i<o){var f=e.comparePoint(t.rightSE.point);if(0!==f)return f}if(i>o){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(i!==o){var m=u-s,y=i-n,v=l-a,x=o-r;if(m>y&&v<x)return 1;if(m<y&&v>x)return-1}return i>o?1:i<o||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),Su(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,a=e.y+s*r.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=Cu(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,u=Tu(e,s)&&0===this.comparePoint(s),l=Tu(n,i)&&0===t.comparePoint(i),c=Tu(e,a)&&0===this.comparePoint(a),h=Tu(n,o)&&0===t.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?a:null;if(l)return c&&i.x===a.x&&i.y===a.y?null:i;if(u)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&c)return null;if(h)return o;if(c)return a;var p=function(t,e,n,r){if(0===e.x)return Gu(n,r,t.x);if(0===r.x)return Gu(t,e,n.x);if(0===e.y)return zu(n,r,t.y);if(0===r.y)return zu(t,e,n.y);var i=Ou(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=Ou(o,e)/i,a=Ou(o,r)/i;return{x:(t.x+a*e.x+(n.x+s*r.x))/2,y:(t.y+a*e.y+(n.y+s*r.y))/2}}(i,this.vector(),s,t.vector());return null===p?null:Tu(r,p)?Nu.round(p.x,p.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new Uu(e,!0),o=new Uu(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var a=new t(i,s,this.rings.slice(),this.windings.slice());return Uu.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Uu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var a=0,u=r.rings.length;a<u;a++){var l=r.rings[a],c=r.windings[a],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],a=this.windings[i],u=e.indexOf(s);-1===u?(e.push(s),n.push(a)):n[u]+=a}for(var l=[],c=[],h=0,p=e.length;h<p;h++)if(0!==n[h]){var d=e[h],f=d.poly;if(-1===c.indexOf(f))if(d.isExterior)l.push(f);else{-1===c.indexOf(f)&&c.push(f);var g=l.indexOf(d.poly);-1!==g&&l.splice(g,1)}}for(var m=0,y=l.length;m<y;m++){var v=l[m].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch($u.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===$u.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat($u.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,s,a=Uu.comparePoints(e,n);if(a<0)i=e,o=n,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,s=-1}return new t(new Uu(i,!0),new Uu(o,!1),[r],[s])}}]),t}(),ju=function(){function t(e,n,r){if(Mu(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Nu.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Nu.round(e[s][0],e[s][1]);u.x===o.x&&u.y===o.y||(this.segments.push(Hu.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}i.x===o.x&&i.y===o.y||this.segments.push(Hu.fromRing(o,i,this))}return Su(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),Wu=function(){function t(e,n){if(Mu(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ju(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new ju(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return Su(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),qu=function(){function t(e,n){if(Mu(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Wu(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return Su(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),Yu=function(){function t(e){Mu(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Su(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,u=o.rightSE,l=[a],c=a.point,h=[];s=a,a=u,l.push(a),a.point!==c;)for(;;){var p=a.getAvailableLinkedEvents();if(0===p.length){var d=l[0].point,f=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(f.x,", ").concat(f.y,"]."))}if(1===p.length){u=p[0].otherSE;break}for(var g=null,m=0,y=h.length;m<y;m++)if(h[m].point===a.point){g=m;break}if(null===g){h.push({index:l.length,point:a.point});var v=a.getLeftmostComparator(s);u=p.sort(v)[0].otherSE;break}var x=h.splice(g)[0],_=l.splice(x.index);_.unshift(_[0].otherSE),n.push(new t(_.reverse()))}n.push(new t(l))}}return n}}]),Su(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==Fu(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],a=e[1];0===Fu(s,t,a)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,h=[],p=l;p!=c;p+=u)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];Uu.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),Xu=function(){function t(e){Mu(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Su(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),Zu=function(){function t(e){Mu(this,t),this.rings=e,this.polys=this._composePolys(e)}return Su(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new Xu(i));else{var o=i.enclosingRing();o.poly||e.push(new Xu(o)),o.poly.addInterior(i)}}return e}}]),t}(),Ku=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hu.compare;Mu(this,t),this.queue=e,this.tree=new xu(n),this.segments=[]}return Su(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,a=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(t.isLeft){var u=null;if(s){var l=s.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(u=l),!s.isAnEndpoint(l)))for(var c=this._splitSafely(s,l),h=0,p=c.length;h<p;h++)n.push(c[h])}var d=null;if(a){var f=a.getIntersection(e);if(null!==f&&(e.isAnEndpoint(f)||(d=f),!a.isAnEndpoint(f)))for(var g=this._splitSafely(a,f),m=0,y=g.length;m<y;m++)n.push(g[m])}if(null!==u||null!==d){var v=null;v=null===u?d:null===d||Uu.comparePoints(u,d)<=0?u:d,this.queue.remove(e.rightSE),n.push(e.rightSE);for(var x=e.split(v),_=0,b=x.length;_<b;_++)n.push(x[_])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var w=s.getIntersection(a);if(null!==w){if(!s.isAnEndpoint(w))for(var M=this._splitSafely(s,w),E=0,S=M.length;E<S;E++)n.push(M[E]);if(!a.isAnEndpoint(w))for(var T=this._splitSafely(a,w),C=0,A=T.length;C<A;C++)n.push(T[C])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),Ju="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:""}).POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Qu="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:""}).POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,$u=new(function(){function t(){Mu(this,t)}return Su(t,[{key:"run",value:function(t,e,n){$u.type=t,Nu.reset();for(var r=[new qu(e,!0)],i=0,o=n.length;i<o;i++)r.push(new qu(n[i],!1));if($u.numMultiPolys=r.length,"difference"===$u.type)for(var s=r[0],a=1;a<r.length;)null!==Cu(r[a].bbox,s.bbox)?a++:r.splice(a,1);if("intersection"===$u.type)for(var u=0,l=r.length;u<l;u++)for(var c=r[u],h=u+1,p=r.length;h<p;h++)if(null===Cu(c.bbox,r[h].bbox))return[];for(var d=new xu(Uu.compare),f=0,g=r.length;f<g;f++)for(var m=r[f].getSweepEvents(),y=0,v=m.length;y<v;y++)if(d.insert(m[y]),d.size>Ju)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var x=new Ku(d),_=d.size,b=d.pop();b;){var w=b.key;if(d.size===_){var M=w.segment;throw new Error("Unable to pop() ".concat(w.isLeft?"left":"right"," SweepEvent ")+"[".concat(w.point.x,", ").concat(w.point.y,"] from segment #").concat(M.id," ")+"[".concat(M.leftSE.point.x,", ").concat(M.leftSE.point.y,"] -> ")+"[".concat(M.rightSE.point.x,", ").concat(M.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>Ju)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(x.segments.length>Qu)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var E=x.process(w),S=0,T=E.length;S<T;S++){var C=E[S];void 0===C.consumedBy&&d.insert(C)}_=d.size,b=d.pop()}Nu.reset();var A=Yu.factory(x.segments);return new Zu(A).getGeom()}}]),t}()),tl={union:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $u.run("union",t,n)},intersection:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $u.run("intersection",t,n)},xor:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $u.run("xor",t,n)},difference:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return $u.run("difference",t,n)}};"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var el=function(){};el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el},el.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var nl=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),rl=function(){},il={MAX_VALUE:{configurable:!0}};rl.isNaN=function(t){return Number.isNaN(t)},rl.doubleToLongBits=function(t){return t},rl.longBitsToDouble=function(t){return t},rl.isInfinite=function(t){return!Number.isFinite(t)},il.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(rl,il);var ol=function(){},sl=function(){},al=function(){};function ul(){}var ll=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},cl={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};ll.prototype.setOrdinate=function(t,e){switch(t){case ll.X:this.x=e;break;case ll.Y:this.y=e;break;case ll.Z:this.z=e;break;default:throw new nl("Invalid ordinate index: "+t)}},ll.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!el.equalsWithTolerance(this.x,e.x,n)&&!!el.equalsWithTolerance(this.y,e.y,n)}},ll.prototype.getOrdinate=function(t){switch(t){case ll.X:return this.x;case ll.Y:return this.y;case ll.Z:return this.z}throw new nl("Invalid ordinate index: "+t)},ll.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||rl.isNaN(this.z))&&rl.isNaN(t.z)},ll.prototype.equals=function(t){return t instanceof ll&&this.equals2D(t)},ll.prototype.equalInZ=function(t,e){return el.equalsWithTolerance(this.z,t.z,e)},ll.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},ll.prototype.clone=function(){},ll.prototype.copy=function(){return new ll(this)},ll.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},ll.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)},ll.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},ll.prototype.hashCode=function(){var t=17;return 37*(t=37*t+ll.hashCode(this.x))+ll.hashCode(this.y)},ll.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},ll.prototype.interfaces_=function(){return[ol,sl,ul]},ll.prototype.getClass=function(){return ll},ll.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=rl.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},cl.DimensionalComparator.get=function(){return hl},cl.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},cl.NULL_ORDINATE.get=function(){return rl.NaN},cl.X.get=function(){return 0},cl.Y.get=function(){return 1},cl.Z.get=function(){return 2},Object.defineProperties(ll,cl);var hl=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new nl("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};hl.prototype.compare=function(t,e){var n=t,r=e,i=hl.compare(n.x,r.x);if(0!==i)return i;var o=hl.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:hl.compare(n.z,r.z)},hl.prototype.interfaces_=function(){return[al]},hl.prototype.getClass=function(){return hl},hl.compare=function(t,e){return t<e?-1:t>e?1:rl.isNaN(t)?rl.isNaN(e)?0:-1:rl.isNaN(e)?1:0};var pl=function(){};pl.prototype.create=function(){},pl.prototype.interfaces_=function(){return[]},pl.prototype.getClass=function(){return pl};var dl=function(){},fl={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};dl.prototype.interfaces_=function(){return[]},dl.prototype.getClass=function(){return dl},dl.toLocationSymbol=function(t){switch(t){case dl.EXTERIOR:return"e";case dl.BOUNDARY:return"b";case dl.INTERIOR:return"i";case dl.NONE:return"-"}throw new nl("Unknown location value: "+t)},fl.INTERIOR.get=function(){return 0},fl.BOUNDARY.get=function(){return 1},fl.EXTERIOR.get=function(){return 2},fl.NONE.get=function(){return-1},Object.defineProperties(dl,fl);var gl=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},ml=function(){},yl={LOG_10:{configurable:!0}};ml.prototype.interfaces_=function(){return[]},ml.prototype.getClass=function(){return ml},ml.log10=function(t){var e=Math.log(t);return rl.isInfinite(e)||rl.isNaN(e)?e:e/ml.LOG_10},ml.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i},ml.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},ml.wrap=function(t,e){return t<0?e- -t%e:t%e},ml.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=i;return o>u&&(u=o),s>u&&(u=s),a>u&&(u=a),u}},ml.average=function(t,e){return(t+e)/2},yl.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(ml,yl);var vl=function(t){this.str=t};vl.prototype.append=function(t){this.str+=t},vl.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},vl.prototype.toString=function(t){return this.str};var xl=function(t){this.value=t};xl.prototype.intValue=function(){return this.value},xl.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},xl.isNaN=function(t){return Number.isNaN(t)};var _l=function(){};_l.isWhitespace=function(t){return t<=32&&t>=0||127===t},_l.toUpperCase=function(t){return t.toUpperCase()};var bl=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var r=arguments[0];t.call(this,t.parse(r))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i,o)}},wl={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};bl.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},bl.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=bl.magnitude(n._hi),i=bl.TEN.pow(r);(n=n.divide(i)).gt(bl.TEN)?(n=n.divide(bl.TEN),r+=1):n.lt(bl.ONE)&&(n=n.multiply(bl.TEN),r-=1);for(var o=r+1,s=new vl,a=bl.MAX_PRINT_DIGITS-1,u=0;u<=a;u++){t&&u===o&&s.append(".");var l=Math.trunc(n._hi);if(l<0)break;var c=!1,h=0;l>9?(c=!0,h="9"):h="0"+l,s.append(h),n=n.subtract(bl.valueOf(l)).multiply(bl.TEN),c&&n.selfAdd(bl.TEN);var p=!0,d=bl.magnitude(n._hi);if(d<0&&Math.abs(d)>=a-u&&(p=!1),!p)break}return e[0]=r,s.toString()},bl.prototype.sqr=function(){return this.multiply(this)},bl.prototype.doubleValue=function(){return this._hi+this._lo},bl.prototype.subtract=function(){if(arguments[0]instanceof bl){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},bl.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},bl.prototype.isZero=function(){return 0===this._hi&&0===this._lo},bl.prototype.selfSubtract=function(){if(arguments[0]instanceof bl){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},bl.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},bl.prototype.min=function(t){return this.le(t)?this:t},bl.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof bl){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,l=null,c=null,h=null;return u=this._hi/n,h=(i=(l=bl.SPLIT*u)-(i=l-u))*(s=(h=bl.SPLIT*n)-(s=h-n))-(c=u*n)+i*(a=n-s)+(o=u-i)*s+o*a,h=u+(l=(this._hi-c-h+this._lo-u*r)/n),this._hi=h,this._lo=u-h+l,this}},bl.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},bl.prototype.divide=function(){if(arguments[0]instanceof bl){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,s=null,a=null,u=null;n=(o=this._hi/t._hi)-(e=(s=bl.SPLIT*o)-(e=s-o)),u=e*(r=(u=bl.SPLIT*t._hi)-(r=u-t._hi))-(a=o*t._hi)+e*(i=t._hi-r)+n*r+n*i;var l=u=o+(s=(this._hi-a-u+this._lo-o*t._lo)/t._hi),c=o-u+s;return new bl(l,c)}if("number"==typeof arguments[0]){var h=arguments[0];return rl.isNaN(h)?bl.createNaN():bl.copy(this).selfDivide(h,0)}},bl.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},bl.prototype.pow=function(t){if(0===t)return bl.valueOf(1);var e=new bl(this),n=bl.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},bl.prototype.ceil=function(){if(this.isNaN())return bl.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new bl(t,e)},bl.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},bl.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},bl.prototype.setValue=function(){if(arguments[0]instanceof bl){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},bl.prototype.max=function(t){return this.ge(t)?this:t},bl.prototype.sqrt=function(){if(this.isZero())return bl.valueOf(0);if(this.isNegative())return bl.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=bl.valueOf(e),r=this.subtract(n.sqr())._hi*(.5*t);return n.add(r)},bl.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof bl){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,r=null,i=null,o=null,s=null,a=null;return o=(i=this._hi+e)-(s=i-this._hi),r=(a=(o=e-s+(this._hi-o))+this._lo)+(i-(n=i+a)),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var u=arguments[0],l=arguments[1],c=null,h=null,p=null,d=null,f=null,g=null,m=null;d=this._hi+u,h=this._lo+l,f=d-(g=d-this._hi),p=h-(m=h-this._lo);var y=(c=d+(g=(f=u-g+(this._hi-f))+h))+(g=(p=l-m+(this._lo-p))+(g+(d-c))),v=g+(c-y);return this._hi=y,this._lo=v,this}},bl.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof bl){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,l=null;i=(u=bl.SPLIT*this._hi)-this._hi,l=bl.SPLIT*n,i=u-i,o=this._hi-i,s=l-n;var c=(u=this._hi*n)+(l=i*(s=l-s)-u+i*(a=n-s)+o*s+o*a+(this._hi*r+this._lo*n)),h=l+(i=u-c);return this._hi=c,this._lo=h,this}},bl.prototype.selfSqr=function(){return this.selfMultiply(this)},bl.prototype.floor=function(){if(this.isNaN())return bl.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new bl(t,e)},bl.prototype.negate=function(){return this.isNaN()?this:new bl(-this._hi,-this._lo)},bl.prototype.clone=function(){},bl.prototype.multiply=function(){if(arguments[0]instanceof bl){var t=arguments[0];return t.isNaN()?bl.createNaN():bl.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return rl.isNaN(e)?bl.createNaN():bl.copy(this).selfMultiply(e,0)}},bl.prototype.isNaN=function(){return rl.isNaN(this._hi)},bl.prototype.intValue=function(){return Math.trunc(this._hi)},bl.prototype.toString=function(){var t=bl.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},bl.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+bl.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length;i=n+bl.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},bl.prototype.reciprocal=function(){var t,e,n,r,i=null,o=null,s=null,a=null;t=(n=1/this._hi)-(i=(s=bl.SPLIT*n)-(i=s-n)),o=(a=bl.SPLIT*this._hi)-this._hi;var u=n+(s=(1-(r=n*this._hi)-(a=i*(o=a-o)-r+i*(e=this._hi-o)+t*o+t*e)-n*this._lo)/this._hi);return new bl(u,n-u+s)},bl.prototype.toSciNotation=function(){if(this.isZero())return bl.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=bl.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},bl.prototype.abs=function(){return this.isNaN()?bl.NaN:this.isNegative()?this.negate():new bl(this)},bl.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},bl.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},bl.prototype.add=function(){if(arguments[0]instanceof bl){var t=arguments[0];return bl.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return bl.copy(this).selfAdd(e)}},bl.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof bl){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},bl.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},bl.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},bl.prototype.trunc=function(){return this.isNaN()?bl.NaN:this.isPositive()?this.floor():this.ceil()},bl.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},bl.prototype.interfaces_=function(){return[ul,ol,sl]},bl.prototype.getClass=function(){return bl},bl.sqr=function(t){return bl.valueOf(t).selfMultiply(t)},bl.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return bl.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new bl(e)}},bl.sqrt=function(t){return bl.valueOf(t).sqrt()},bl.parse=function(t){for(var e=0,n=t.length;_l.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(r=!0))}for(var o=new bl,s=0,a=0,u=0;!(e>=n);){var l=t.charAt(e);if(e++,_l.isDigit(l)){var c=l-"0";o.selfMultiply(bl.TEN),o.selfAdd(c),s++}else{if("."!==l){if("e"===l||"E"===l){var h=t.substring(e);try{u=xl.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+l+"' at position "+e+" in string "+t)}a=s}}var p=o,d=s-a-u;if(0===d)p=o;else if(d>0){var f=bl.TEN.pow(d);p=o.divide(f)}else if(d<0){var g=bl.TEN.pow(-d);p=o.multiply(g)}return r?p.negate():p},bl.createNaN=function(){return new bl(rl.NaN,rl.NaN)},bl.copy=function(t){return new bl(t)},bl.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=e&&(r+=1),r},bl.stringOfChar=function(t,e){for(var n=new vl,r=0;r<e;r++)n.append(t);return n.toString()},wl.PI.get=function(){return new bl(3.141592653589793,12246467991473532e-32)},wl.TWO_PI.get=function(){return new bl(6.283185307179586,24492935982947064e-32)},wl.PI_2.get=function(){return new bl(1.5707963267948966,6123233995736766e-32)},wl.E.get=function(){return new bl(2.718281828459045,14456468917292502e-32)},wl.NaN.get=function(){return new bl(rl.NaN,rl.NaN)},wl.EPS.get=function(){return 123259516440783e-46},wl.SPLIT.get=function(){return 134217729},wl.MAX_PRINT_DIGITS.get=function(){return 32},wl.TEN.get=function(){return bl.valueOf(10)},wl.ONE.get=function(){return bl.valueOf(1)},wl.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},wl.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(bl,wl);var Ml=function(){},El={DP_SAFE_EPSILON:{configurable:!0}};Ml.prototype.interfaces_=function(){return[]},Ml.prototype.getClass=function(){return Ml},Ml.orientationIndex=function(t,e,n){var r=Ml.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=bl.valueOf(e.x).selfAdd(-t.x),o=bl.valueOf(e.y).selfAdd(-t.y),s=bl.valueOf(n.x).selfAdd(-e.x),a=bl.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},Ml.signOfDet2x2=function(t,e,n,r){return t.multiply(r).selfSubtract(e.multiply(n)).signum()},Ml.intersection=function(t,e,n,r){var i=bl.valueOf(r.y).selfSubtract(n.y).selfMultiply(bl.valueOf(e.x).selfSubtract(t.x)),o=bl.valueOf(r.x).selfSubtract(n.x).selfMultiply(bl.valueOf(e.y).selfSubtract(t.y)),s=i.subtract(o),a=bl.valueOf(r.x).selfSubtract(n.x).selfMultiply(bl.valueOf(t.y).selfSubtract(n.y)),u=bl.valueOf(r.y).selfSubtract(n.y).selfMultiply(bl.valueOf(t.x).selfSubtract(n.x)),l=a.subtract(u).selfDivide(s).doubleValue(),c=bl.valueOf(t.x).selfAdd(bl.valueOf(e.x).selfSubtract(t.x).selfMultiply(l)).doubleValue(),h=bl.valueOf(e.x).selfSubtract(t.x).selfMultiply(bl.valueOf(t.y).selfSubtract(n.y)),p=bl.valueOf(e.y).selfSubtract(t.y).selfMultiply(bl.valueOf(t.x).selfSubtract(n.x)),d=h.subtract(p).selfDivide(s).doubleValue(),f=bl.valueOf(n.y).selfAdd(bl.valueOf(r.y).selfSubtract(n.y).selfMultiply(d)).doubleValue();return new ll(c,f)},Ml.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),s=i-o;if(i>0){if(o<=0)return Ml.signum(s);r=i+o}else{if(!(i<0))return Ml.signum(s);if(o>=0)return Ml.signum(s);r=-i-o}var a=Ml.DP_SAFE_EPSILON*r;return s>=a||-s>=a?Ml.signum(s):2},Ml.signum=function(t){return t>0?1:t<0?-1:0},El.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Ml,El);var Sl=function(){},Tl={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Tl.X.get=function(){return 0},Tl.Y.get=function(){return 1},Tl.Z.get=function(){return 2},Tl.M.get=function(){return 3},Sl.prototype.setOrdinate=function(t,e,n){},Sl.prototype.size=function(){},Sl.prototype.getOrdinate=function(t,e){},Sl.prototype.getCoordinate=function(){},Sl.prototype.getCoordinateCopy=function(t){},Sl.prototype.getDimension=function(){},Sl.prototype.getX=function(t){},Sl.prototype.clone=function(){},Sl.prototype.expandEnvelope=function(t){},Sl.prototype.copy=function(){},Sl.prototype.getY=function(t){},Sl.prototype.toCoordinateArray=function(){},Sl.prototype.interfaces_=function(){return[sl]},Sl.prototype.getClass=function(){return Sl},Object.defineProperties(Sl,Tl);var Cl=function(){},Al=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Cl),Pl=function(){};Pl.arraycopy=function(t,e,n,r,i){for(var o=0,s=e;s<e+i;s++)n[r+o]=t[s],o++},Pl.getProperty=function(t){return{"line.separator":"\n"}[t]};var Ll=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof ll&&arguments[1]instanceof ll){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2];this.x=u,this.y=l,this.w=c}else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3],g=h.y-p.y,m=p.x-h.x,y=h.x*p.y-p.x*h.y,v=d.y-f.y,x=f.x-d.x,_=d.x*f.y-f.x*d.y;this.x=m*_-x*y,this.y=v*y-g*_,this.w=g*x-v*m}};Ll.prototype.getY=function(){var t=this.y/this.w;if(rl.isNaN(t)||rl.isInfinite(t))throw new Al;return t},Ll.prototype.getX=function(){var t=this.x/this.w;if(rl.isNaN(t)||rl.isInfinite(t))throw new Al;return t},Ll.prototype.getCoordinate=function(){var t=new ll;return t.x=this.getX(),t.y=this.getY(),t},Ll.prototype.interfaces_=function(){return[]},Ll.prototype.getClass=function(){return Ll},Ll.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=n.y-r.y,u=r.x-n.x,l=n.x*r.y-r.x*n.y,c=i*u-a*o,h=(o*l-u*s)/c,p=(a*s-i*l)/c;if(rl.isNaN(h)||rl.isInfinite(h)||rl.isNaN(p)||rl.isInfinite(p))throw new Al;return new ll(h,p)};var Il=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof ll){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],u=arguments[3];this.init(o,s,a,u)}},Rl={serialVersionUID:{configurable:!0}};Il.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Il.prototype.equals=function(t){if(!(t instanceof Il))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},Il.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Il;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Il(e,r,n,i)},Il.prototype.isNull=function(){return this._maxx<this._minx},Il.prototype.getMaxX=function(){return this._maxx},Il.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof ll){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Il){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}},Il.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Il){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof ll){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},Il.prototype.getMinY=function(){return this._miny},Il.prototype.getMinX=function(){return this._minx},Il.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof ll){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Il){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},Il.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Il.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Il.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},Il.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Il.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Il.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Il.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Il.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Il.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Il.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Il){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof ll){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},Il.prototype.centre=function(){return this.isNull()?null:new ll((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Il.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof ll){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Il){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},Il.prototype.getMaxY=function(){return this._maxy},Il.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},Il.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+ll.hashCode(this._minx))+ll.hashCode(this._maxx))+ll.hashCode(this._miny))+ll.hashCode(this._maxy)},Il.prototype.interfaces_=function(){return[ol,ul]},Il.prototype.getClass=function(){return Il},Il.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),u=Math.max(o.x,s.x),l=Math.min(r.x,i.x),c=Math.max(r.x,i.x);return!(l>u)&&!(c<a)&&(a=Math.min(o.y,s.y),u=Math.max(o.y,s.y),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y),!(l>u)&&!(c<a))}},Rl.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Il,Rl);var Nl={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ol=function(t){this.geometryFactory=t||new xh};Ol.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Nl.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=Nl.emptyTypeStr.exec(t))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Fl[n]&&(e=Fl[n].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Ol.prototype.write=function(t){return this.extractGeometry(t)},Ol.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Dl[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+Dl[e].apply(this,[t])+")"};var Dl={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Dl.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Dl.point.apply(this,[t._geometries[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Dl.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Dl.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Dl.linestring.apply(this,[t._geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Dl.linestring.apply(this,[t._shell])+")");for(var n=0,r=t._holes.length;n<r;++n)e.push("("+Dl.linestring.apply(this,[t._holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Dl.polygon.apply(this,[t._geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push(this.extractGeometry(t._geometries[n]));return e.join(",")}},Fl={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(Nl.spaces);return this.geometryFactory.createPoint(new ll(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Nl.trimParens,"$1"),r.push(Fl.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(r)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Nl.spaces),r.push(new ll(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Nl.spaces),r.push(new ll(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var n=t.trim().split(Nl.parenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Nl.trimParens,"$1"),r.push(Fl.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(r)},polygon:function(t){var e,n,r;if(void 0===t)return this.geometryFactory.createPolygon();for(var i,o=t.trim().split(Nl.parenComma),s=[],a=0,u=o.length;a<u;++a)e=o[a].replace(Nl.trimParens,"$1"),n=Fl.linestring.apply(this,[e]),r=this.geometryFactory.createLinearRing(n._points),0===a?i=r:s.push(r);return this.geometryFactory.createPolygon(i,s)},multipolygon:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var n=t.trim().split(Nl.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Nl.trimParens,"$1"),r.push(Fl.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=e.length;r<i;++r)n.push(this.read(e[r]));return this.geometryFactory.createGeometryCollection(n)}},kl=function(t){this.parser=new Ol(t)};kl.prototype.write=function(t){return this.parser.write(t)},kl.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Bl=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),zl=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bl),Gl=function(){};Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl},Gl.shouldNeverReachHere=function(){if(0===arguments.length)Gl.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new zl("Should never reach here"+(null!==t?": "+t:""))}},Gl.isTrue=function(){var t;if(1===arguments.length)Gl.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new zl:new zl(t)},Gl.equals=function(){var t,e,n;if(2===arguments.length)Gl.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],n=arguments[2],!(e=arguments[1]).equals(t)))throw new zl("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var Ul=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new ll,this._intPt[1]=new ll,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Vl={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Ul.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},Ul.prototype.getTopologySummary=function(){var t=new vl;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},Ul.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)},Ul.prototype.getIntersectionNum=function(){return this._result},Ul.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},Ul.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Ul.prototype.setPrecisionModel=function(t){this._precisionModel=t},Ul.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],n=0;n<this._result;n++)if(!t._intPt[n].equals2D(t._inputLines[e][0])&&!t._intPt[n].equals2D(t._inputLines[e][1]))return!0;return!1}},Ul.prototype.getIntersection=function(t){return this._intPt[t]},Ul.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Ul.prototype.hasIntersection=function(){return this._result!==Ul.NO_INTERSECTION},Ul.prototype.getEdgeDistance=function(t,e){return Ul.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},Ul.prototype.isCollinear=function(){return this._result===Ul.COLLINEAR_INTERSECTION},Ul.prototype.toString=function(){return kl.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+kl.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Ul.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},Ul.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},Ul.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},Ul.prototype.interfaces_=function(){return[]},Ul.prototype.getClass=function(){return Ul},Ul.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=r>i?r:i;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=r>i?s:a)||t.equals(e)||(o=Math.max(s,a))}return Gl.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},Ul.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return Gl.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Vl.DONT_INTERSECT.get=function(){return 0},Vl.DO_INTERSECT.get=function(){return 1},Vl.COLLINEAR.get=function(){return 2},Vl.NO_INTERSECTION.get=function(){return 0},Vl.POINT_INTERSECTION.get=function(){return 1},Vl.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Ul,Vl);var Hl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Il(this._inputLines[0][0],this._inputLines[0][1]),n=new Il(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,Il.intersects(n,r,e)&&0===ql.orientationIndex(n,r,e)&&0===ql.orientationIndex(r,n,e))return this._isProper=!0,(e.equals(n)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,r,i){i.x=this.smallestInAbsValue(t.x,e.x,n.x,r.x),i.y=this.smallestInAbsValue(t.y,e.y,n.y,r.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=Ll.intersection(t,n,r,i)}catch(a){if(!(a instanceof Al))throw a;o=e.nearestEndpoint(t,n,r,i)}return o},e.prototype.intersection=function(t,n,r,i){var o=this.intersectionWithNormalization(t,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new ll(e.nearestEndpoint(t,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,r){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},e.prototype.checkDD=function(t,e,n,r,i){var o=Ml.intersection(t,e,n,r),s=this.isInSegmentEnvelopes(o);Pl.out.println("DD in env = "+s+"  --------------------- "+o),i.distance(o)>1e-4&&Pl.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,r){var i=new ll(t),o=new ll(e),s=new ll(n),a=new ll(r),u=new ll;this.normalizeToEnvCentre(i,o,s,a,u);var l=this.safeHCoordinateIntersection(i,o,s,a);return l.x+=u.x,l.y+=u.y,l},e.prototype.computeCollinearIntersection=function(e,n,r,i){var o=Il.intersects(e,n,r),s=Il.intersects(e,n,i),a=Il.intersects(r,i,e),u=Il.intersects(r,i,n);return o&&s?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):a&&u?(this._intPt[0]=e,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||s||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&u?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&u?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,r,i){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,l=n.x<r.x?n.x:r.x,c=n.y<r.y?n.y:r.y,h=n.x>r.x?n.x:r.x,p=n.y>r.y?n.y:r.y,d=((o>l?o:l)+(a<h?a:h))/2,f=((s>c?s:c)+(u<p?u:p))/2;i.x=d,i.y=f,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.computeIntersect=function(e,n,r,i){if(this._isProper=!1,!Il.intersects(e,n,r,i))return t.NO_INTERSECTION;var o=ql.orientationIndex(e,n,r),s=ql.orientationIndex(e,n,i);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=ql.orientationIndex(r,i,e),u=ql.orientationIndex(r,i,n);return a>0&&u>0||a<0&&u<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===u?this.computeCollinearIntersection(e,n,r,i):(0===o||0===s||0===a||0===u?(this._isProper=!1,e.equals2D(r)||e.equals2D(i)?this._intPt[0]=e:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new ll(r):0===s?this._intPt[0]=new ll(i):0===a?this._intPt[0]=new ll(e):0===u&&(this._intPt[0]=new ll(n))):(this._isProper=!0,this._intPt[0]=this.intersection(e,n,r,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,r){var i=t,o=ql.distancePointLine(t,n,r),s=ql.distancePointLine(e,n,r);return s<o&&(o=s,i=e),(s=ql.distancePointLine(n,t,e))<o&&(o=s,i=n),(s=ql.distancePointLine(r,t,e))<o&&(o=s,i=r),i},e}(Ul),jl=function(){};jl.prototype.interfaces_=function(){return[]},jl.prototype.getClass=function(){return jl},jl.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,s=n.y-e.y;return jl.signOfDet2x2(r,i,o,s)},jl.signOfDet2x2=function(t,e,n,r){var i=null,o=null,s=null;if(i=1,0===t||0===r)return 0===e||0===n?0:e>0?n>0?-i:i:n>0?i:-i;if(0===e||0===n)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0){if(!(n>0))return i;if(!(t<=n))return i}else{if(n>0)return-i;if(!(t>=n))return-i;i=-i,t=-t,n=-n}for(;;){if((r-=(s=Math.floor(n/t))*e)<0)return-i;if(r>e)return i;if(t>(n-=s*t)+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if((e-=(s=Math.floor(t/n))*r)<0)return i;if(e>r)return-i;if(n>(t-=s*n)+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var Wl=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Wl.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,u=jl.signOfDet2x2(i,o,s,a);if(0===u)return this._isPointOnSegment=!0,null;a<o&&(u=-u),u>0&&this._crossingCount++}},Wl.prototype.isPointInPolygon=function(){return this.getLocation()!==dl.EXTERIOR},Wl.prototype.getLocation=function(){return this._isPointOnSegment?dl.BOUNDARY:this._crossingCount%2==1?dl.INTERIOR:dl.EXTERIOR},Wl.prototype.isOnSegment=function(){return this._isPointOnSegment},Wl.prototype.interfaces_=function(){return[]},Wl.prototype.getClass=function(){return Wl},Wl.locatePointInRing=function(){if(arguments[0]instanceof ll&&gl(arguments[1],Sl)){for(var t=arguments[0],e=arguments[1],n=new Wl(t),r=new ll,i=new ll,o=1;o<e.size();o++)if(e.getCoordinate(o,r),e.getCoordinate(o-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof ll&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],u=new Wl(s),l=1;l<a.length;l++){var c=a[l],h=a[l-1];if(u.countSegment(c,h),u.isOnSegment())return u.getLocation()}return u.getLocation()}};var ql=function(){},Yl={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};ql.prototype.interfaces_=function(){return[]},ql.prototype.getClass=function(){return ql},ql.orientationIndex=function(t,e,n){return Ml.orientationIndex(t,e,n)},ql.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y,s=t[r-1].y;e+=i*(s-o)}return e/2}if(gl(arguments[0],Sl)){var a=arguments[0],u=a.size();if(u<3)return 0;var l=new ll,c=new ll,h=new ll;a.getCoordinate(0,c),a.getCoordinate(1,h);var p=c.x;h.x-=p;for(var d=0,f=1;f<u-1;f++)l.y=c.y,c.x=h.x,c.y=h.y,a.getCoordinate(f+1,h),h.x-=p,d+=c.x*(l.y-h.y);return d/2}},ql.distanceLineLine=function(t,e,n,r){if(t.equals(e))return ql.distancePointLine(t,n,r);if(n.equals(r))return ql.distancePointLine(r,t,e);var i=!1;if(Il.intersects(t,e,n,r)){var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(0===o)i=!0;else{var s=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),a=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,u=s/o;(u<0||u>1||a<0||a>1)&&(i=!0)}}else i=!0;return i?ml.min(ql.distancePointLine(t,n,r),ql.distancePointLine(e,n,r),ql.distancePointLine(n,t,e),ql.distancePointLine(r,t,e)):0},ql.isPointInRing=function(t,e){return ql.locatePointInRing(t,e)!==dl.EXTERIOR},ql.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new ll;t.getCoordinate(0,r);for(var i=r.x,o=r.y,s=1;s<e;s++){t.getCoordinate(s,r);var a=r.x,u=r.y,l=a-i,c=u-o;n+=Math.sqrt(l*l+c*c),i=a,o=u}return n},ql.isCCW=function(t){var e=t.length-1;if(e<3)throw new nl("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var s=r;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(n)&&s!==r);var a=r;do{a=(a+1)%e}while(t[a].equals2D(n)&&a!==r);var u=t[s],l=t[a];if(u.equals2D(n)||l.equals2D(n)||u.equals2D(l))return!1;var c=ql.computeOrientation(u,n,l),h=!1;return h=0===c?u.x>l.x:c>0,h},ql.locatePointInRing=function(t,e){return Wl.locatePointInRing(t,e)},ql.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)},ql.computeOrientation=function(t,e,n){return ql.orientationIndex(t,e,n)},ql.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new nl("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=ql.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var u=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),l=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/u;if(l<=0)return o.distance(s);if(l>=1)return o.distance(a);var c=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/u;return Math.abs(c)*Math.sqrt(u)}},ql.isOnLine=function(t,e){for(var n=new Hl,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1},Yl.CLOCKWISE.get=function(){return-1},Yl.RIGHT.get=function(){return ql.CLOCKWISE},Yl.COUNTERCLOCKWISE.get=function(){return 1},Yl.LEFT.get=function(){return ql.COUNTERCLOCKWISE},Yl.COLLINEAR.get=function(){return 0},Yl.STRAIGHT.get=function(){return ql.COLLINEAR},Object.defineProperties(ql,Yl);var Xl=function(){};Xl.prototype.filter=function(t){},Xl.prototype.interfaces_=function(){return[]},Xl.prototype.getClass=function(){return Xl};var Zl=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Kl={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Zl.prototype.isGeometryCollection=function(){return this.getSortIndex()===Zl.SORTINDEX_GEOMETRYCOLLECTION},Zl.prototype.getFactory=function(){return this._factory},Zl.prototype.getGeometryN=function(t){return this},Zl.prototype.getArea=function(){return 0},Zl.prototype.isRectangle=function(){return!1},Zl.prototype.equals=function(){if(arguments[0]instanceof Zl){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Zl))return!1;var n=e;return this.equalsExact(n)}},Zl.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},Zl.prototype.geometryChanged=function(){this.apply(Zl.geometryChangedFilter)},Zl.prototype.geometryChangedAction=function(){this._envelope=null},Zl.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},Zl.prototype.getLength=function(){return 0},Zl.prototype.getNumGeometries=function(){return 1},Zl.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},Zl.prototype.getUserData=function(){return this._userData},Zl.prototype.getSRID=function(){return this._SRID},Zl.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Zl.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Zl.SORTINDEX_GEOMETRYCOLLECTION)throw new nl("This method does not support GeometryCollection arguments")},Zl.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},Zl.prototype.norm=function(){var t=this.copy();return t.normalize(),t},Zl.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Zl.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Il(this._envelope)},Zl.prototype.setSRID=function(t){this._SRID=t},Zl.prototype.setUserData=function(t){this._userData=t},Zl.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),s=i.compareTo(o);if(0!==s)return s}return n.hasNext()?1:r.hasNext()?-1:0},Zl.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Zl.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Zl.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Zl.SORTINDEX_MULTIPOINT||this.getSortIndex()===Zl.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Zl.SORTINDEX_MULTIPOLYGON},Zl.prototype.interfaces_=function(){return[sl,ol,ul]},Zl.prototype.getClass=function(){return Zl},Zl.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},Zl.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},Kl.serialVersionUID.get=function(){return 0x799ea46522854c00},Kl.SORTINDEX_POINT.get=function(){return 0},Kl.SORTINDEX_MULTIPOINT.get=function(){return 1},Kl.SORTINDEX_LINESTRING.get=function(){return 2},Kl.SORTINDEX_LINEARRING.get=function(){return 3},Kl.SORTINDEX_MULTILINESTRING.get=function(){return 4},Kl.SORTINDEX_POLYGON.get=function(){return 5},Kl.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Kl.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Kl.geometryChangedFilter.get=function(){return Jl},Object.defineProperties(Zl,Kl);var Jl=function(){};Jl.interfaces_=function(){return[Xl]},Jl.filter=function(t){t.geometryChangedAction()};var Ql=function(){};Ql.prototype.filter=function(t){},Ql.prototype.interfaces_=function(){return[]},Ql.prototype.getClass=function(){return Ql};var $l=function(){},tc={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};$l.prototype.isInBoundary=function(t){},$l.prototype.interfaces_=function(){return[]},$l.prototype.getClass=function(){return $l},tc.Mod2BoundaryNodeRule.get=function(){return ec},tc.EndPointBoundaryNodeRule.get=function(){return nc},tc.MultiValentEndPointBoundaryNodeRule.get=function(){return rc},tc.MonoValentEndPointBoundaryNodeRule.get=function(){return ic},tc.MOD2_BOUNDARY_RULE.get=function(){return new ec},tc.ENDPOINT_BOUNDARY_RULE.get=function(){return new nc},tc.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new rc},tc.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ic},tc.OGC_SFS_BOUNDARY_RULE.get=function(){return $l.MOD2_BOUNDARY_RULE},Object.defineProperties($l,tc);var ec=function(){};ec.prototype.isInBoundary=function(t){return t%2==1},ec.prototype.interfaces_=function(){return[$l]},ec.prototype.getClass=function(){return ec};var nc=function(){};nc.prototype.isInBoundary=function(t){return t>0},nc.prototype.interfaces_=function(){return[$l]},nc.prototype.getClass=function(){return nc};var rc=function(){};rc.prototype.isInBoundary=function(t){return t>1},rc.prototype.interfaces_=function(){return[$l]},rc.prototype.getClass=function(){return rc};var ic=function(){};ic.prototype.isInBoundary=function(t){return 1===t},ic.prototype.interfaces_=function(){return[$l]},ic.prototype.getClass=function(){return ic};var oc=function(){};function sc(t){this.message=t||""}oc.prototype.add=function(){},oc.prototype.addAll=function(){},oc.prototype.isEmpty=function(){},oc.prototype.iterator=function(){},oc.prototype.size=function(){},oc.prototype.toArray=function(){},oc.prototype.remove=function(){},sc.prototype=new Error,sc.prototype.name="IndexOutOfBoundsException";var ac=function(){};ac.prototype.hasNext=function(){},ac.prototype.next=function(){},ac.prototype.remove=function(){};var uc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(oc);function lc(t){this.message=t||""}lc.prototype=new Error,lc.prototype.name="NoSuchElementException";var cc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,oc]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new hc(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new sc;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},e}(uc),hc=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new lc;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(ac),pc=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){var e=this;if(2===arguments.length){for(var n=arguments[0],r=arguments[1],i=!1,o=n.iterator();o.hasNext();)e.add(o.next(),r),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=0;n<this.size();n++)e.add(n,this.get(n).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length){var n=arguments[0];t.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var r=arguments[0],i=arguments[1];return this.add(r,i,!0),!0}if(arguments[0]instanceof ll&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var a=this.get(this.size()-1);if(a.equals2D(o))return null}t.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var u=arguments[0],l=arguments[1];return this.add(u,l),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var c=arguments[0],h=arguments[1],p=arguments[2];if(p)for(var d=0;d<c.length;d++)e.add(c[d],h);else for(var f=c.length-1;f>=0;f--)e.add(c[f],h);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof ll){var g=arguments[0],m=arguments[1],y=arguments[2];if(!y){var v=this.size();if(v>0){if(g>0){var x=this.get(g-1);if(x.equals2D(m))return null}if(g<v){var _=this.get(g);if(_.equals2D(m))return null}}}t.prototype.add.call(this,g,m)}}else if(4===arguments.length){var b=arguments[0],w=arguments[1],M=arguments[2],E=arguments[3],S=1;M>E&&(S=-1);for(var T=M;T!==E;T+=S)e.add(b[T],w);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new ll(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(cc),dc=function(){},fc={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};fc.ForwardComparator.get=function(){return gc},fc.BidirectionalComparator.get=function(){return mc},fc.coordArrayType.get=function(){return new Array(0).fill(null)},dc.prototype.interfaces_=function(){return[]},dc.prototype.getClass=function(){return dc},dc.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},dc.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(dc.indexOf(r,e)<0)return r}return null},dc.scroll=function(t,e){var n=dc.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Pl.arraycopy(t,n,r,0,t.length-n),Pl.arraycopy(t,0,r,t.length-n,n),Pl.arraycopy(r,0,t,0,t.length)},dc.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],i[s]))return!1;return!0}},dc.intersection=function(t,e){for(var n=new pc,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()},dc.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},dc.removeRepeatedPoints=function(t){return dc.hasRepeatedPoints(t)?new pc(t,!1).toCoordinateArray():t},dc.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}},dc.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(r[i++]=t[o]);return r},dc.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new ll(t[n]);return e}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],u=0;u<a;u++)o[s+u]=new ll(r[i+u])},dc.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(0!==r.compareTo(i))return!1}return!0},dc.envelope=function(t){for(var e=new Il,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},dc.toCoordinateArray=function(t){return t.toArray(dc.coordArrayType)},dc.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},dc.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},dc.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(0!==r)return r}return 1},dc.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(0!==r)return r;n++}return n<e.length?-1:n<t.length?1:0},dc.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},dc.extract=function(t,e,n){e=ml.clamp(e,0,t.length);var r=(n=ml.clamp(n,-1,t.length))-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,s=e;s<=n;s++)i[o++]=t[s];return i},Object.defineProperties(dc,fc);var gc=function(){};gc.prototype.compare=function(t,e){return dc.compare(t,e)},gc.prototype.interfaces_=function(){return[al]},gc.prototype.getClass=function(){return gc};var mc=function(){};mc.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=dc.compare(n,r);return dc.isEqualReversed(n,r)?0:i},mc.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=dc.increasingDirection(n),o=dc.increasingDirection(r),s=i>0?0:n.length-1,a=o>0?0:n.length-1,u=0;u<n.length;u++){var l=n[s].compareTo(r[a]);if(0!==l)return l;s+=i,a+=o}return 0},mc.prototype.interfaces_=function(){return[al]},mc.prototype.getClass=function(){return mc};var yc=function(){};yc.prototype.get=function(){},yc.prototype.put=function(){},yc.prototype.size=function(){},yc.prototype.values=function(){},yc.prototype.entrySet=function(){};var vc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yc);function xc(t){this.message=t||""}function _c(){}xc.prototype=new Error,xc.prototype.name="OperationNotSupported",_c.prototype=new oc,_c.prototype.contains=function(){};var bc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new wc(this)},e}(_c),wc=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new lc;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new xc},e}(ac);function Mc(t){return null===t?0:t.color}function Ec(t){return null===t?null:t.parent}function Sc(t,e){null!==t&&(t.color=e)}function Tc(t){return null===t?null:t.left}function Cc(t){return null===t?null:t.right}function Ac(){this.root_=null,this.size_=0}Ac.prototype=new vc,Ac.prototype.get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},Ac.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=t.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var s={key:t,left:null,right:null,value:e,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},Ac.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(Ec(t)===Tc(Ec(Ec(t)))){var n=Cc(Ec(Ec(t)));1===Mc(n)?(Sc(Ec(t),0),Sc(n,0),Sc(Ec(Ec(t)),1),t=Ec(Ec(t))):(t===Cc(Ec(t))&&(t=Ec(t),e.rotateLeft(t)),Sc(Ec(t),0),Sc(Ec(Ec(t)),1),e.rotateRight(Ec(Ec(t))))}else{var r=Tc(Ec(Ec(t)));1===Mc(r)?(Sc(Ec(t),0),Sc(r,0),Sc(Ec(Ec(t)),1),t=Ec(Ec(t))):(t===Tc(Ec(t))&&(t=Ec(t),e.rotateRight(t)),Sc(Ec(t),0),Sc(Ec(Ec(t)),1),e.rotateLeft(Ec(Ec(t))))}this.root_.color=0},Ac.prototype.values=function(){var t=new cc,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Ac.successor(e));)t.add(e.value);return t},Ac.prototype.entrySet=function(){var t=new bc,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Ac.successor(e));)t.add(e);return t},Ac.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},Ac.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},Ac.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},Ac.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,r=t;null!==n&&r===n.right;)r=n,n=n.parent;return n},Ac.prototype.size=function(){return this.size_};var Pc=function(){};function Lc(){}function Ic(){this.array_=[],arguments[0]instanceof oc&&this.addAll(arguments[0])}Pc.prototype.interfaces_=function(){return[]},Pc.prototype.getClass=function(){return Pc},Lc.prototype=new _c,Ic.prototype=new Lc,Ic.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},Ic.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},Ic.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},Ic.prototype.remove=function(t){throw new xc},Ic.prototype.size=function(){return this.array_.length},Ic.prototype.isEmpty=function(){return 0===this.array_.length},Ic.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},Ic.prototype.iterator=function(){return new Rc(this)};var Rc=function(t){this.treeSet_=t,this.position_=0};Rc.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new lc;return this.treeSet_.array_[this.position_++]},Rc.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Rc.prototype.remove=function(){throw new xc};var Nc=function(){};Nc.sort=function(){var t,e,n,r,i=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(t,e){return n.compare(t,e)},i.sort(r);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(t,e){return n.compare(t,e)},e.sort(r),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Nc.asList=function(t){for(var e=new cc,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Oc=function(){},Dc={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Dc.P.get=function(){return 0},Dc.L.get=function(){return 1},Dc.A.get=function(){return 2},Dc.FALSE.get=function(){return-1},Dc.TRUE.get=function(){return-2},Dc.DONTCARE.get=function(){return-3},Dc.SYM_FALSE.get=function(){return"F"},Dc.SYM_TRUE.get=function(){return"T"},Dc.SYM_DONTCARE.get=function(){return"*"},Dc.SYM_P.get=function(){return"0"},Dc.SYM_L.get=function(){return"1"},Dc.SYM_A.get=function(){return"2"},Oc.prototype.interfaces_=function(){return[]},Oc.prototype.getClass=function(){return Oc},Oc.toDimensionSymbol=function(t){switch(t){case Oc.FALSE:return Oc.SYM_FALSE;case Oc.TRUE:return Oc.SYM_TRUE;case Oc.DONTCARE:return Oc.SYM_DONTCARE;case Oc.P:return Oc.SYM_P;case Oc.L:return Oc.SYM_L;case Oc.A:return Oc.SYM_A}throw new nl("Unknown dimension value: "+t)},Oc.toDimensionValue=function(t){switch(_l.toUpperCase(t)){case Oc.SYM_FALSE:return Oc.FALSE;case Oc.SYM_TRUE:return Oc.TRUE;case Oc.SYM_DONTCARE:return Oc.DONTCARE;case Oc.SYM_P:return Oc.P;case Oc.SYM_L:return Oc.L;case Oc.SYM_A:return Oc.A}throw new nl("Unknown dimension symbol: "+t)},Object.defineProperties(Oc,Dc);var Fc=function(){};Fc.prototype.filter=function(t){},Fc.prototype.interfaces_=function(){return[]},Fc.prototype.getClass=function(){return Fc};var kc=function(){};kc.prototype.filter=function(t,e){},kc.prototype.isDone=function(){},kc.prototype.isGeometryChanged=function(){},kc.prototype.interfaces_=function(){return[]},kc.prototype.getClass=function(){return kc};var Bc=function(t){function e(e,n){if(t.call(this,n),this._geometries=e||[],t.hasNullElements(this._geometries))throw new nl("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new Il,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)t[++e]=r[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._geometries.length!==i._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!e._geometries[o].equalsExact(i._geometries[o],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Nc.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Oc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Oc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new Ic(Nc.asList(this._geometries)),r=new Ic(Nc.asList(e._geometries));return this.compare(n,r)}if(2===arguments.length){for(var i=arguments[0],o=arguments[1],s=i,a=this.getNumGeometries(),u=s.getNumGeometries(),l=0;l<a&&l<u;){var c=t.getGeometryN(l),h=s.getGeometryN(l),p=c.compareToSameClass(h,o);if(0!==p)return p;l++}return l<a?1:l<u?-1:0}},e.prototype.apply=function(){var t=this;if(gl(arguments[0],Ql))for(var e=arguments[0],n=0;n<this._geometries.length;n++)t._geometries[n].apply(e);else if(gl(arguments[0],kc)){var r=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(t._geometries[i].apply(r),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(gl(arguments[0],Fc)){var o=arguments[0];o.filter(this);for(var s=0;s<this._geometries.length;s++)t._geometries[s].apply(o)}else if(gl(arguments[0],Xl)){var a=arguments[0];a.filter(this);for(var u=0;u<this._geometries.length;u++)t._geometries[u].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Gl.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)e._geometries[n]=this._geometries[n].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}(Zl),zc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Zl.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Oc.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[t-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Gc(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Pc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(Bc),Gc=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=$l.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Gc.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Gc.prototype.getBoundary=function(){return this._geom instanceof Jc?this.boundaryLineString(this._geom):this._geom instanceof zc?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Gc.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Gc.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Gc.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new cc;this._endpointMap=new Ac;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);0!==i.getNumPoints()&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var s=o.next(),a=s.getValue().count;e._bnRule.isInBoundary(a)&&n.add(s.getKey())}return dc.toCoordinateArray(n)},Gc.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Uc,this._endpointMap.put(t,e)),e.count++},Gc.prototype.interfaces_=function(){return[]},Gc.prototype.getClass=function(){return Gc},Gc.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new Gc(t);return e.getBoundary()}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=new Gc(n,r);return i.getBoundary()}};var Uc=function(){this.count=null};function Vc(){}function Hc(){}Uc.prototype.interfaces_=function(){return[]},Uc.prototype.getClass=function(){return Uc};var jc=function(){};function Wc(){}function qc(){}function Yc(){}var Xc=function(){},Zc={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Xc.prototype.interfaces_=function(){return[]},Xc.prototype.getClass=function(){return Xc},Xc.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)},Xc.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new Wc,n=new Vc(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o="",s=new Hc(Xc.getStackTrace(r)),a=new Yc(s),u=0;u<i;u++)try{o+=a.readLine()+Xc.NEWLINE}catch(t){if(!(t instanceof qc))throw t;Gl.shouldNeverReachHere()}return o}},Xc.split=function(t,e){for(var n=e.length,r=new cc,i=""+t,o=i.indexOf(e);o>=0;){var s=i.substring(0,o);r.add(s),o=(i=i.substring(o+n)).indexOf(e)}i.length>0&&r.add(i);for(var a=new Array(r.size()).fill(null),u=0;u<a.length;u++)a[u]=r.get(u);return a},Xc.toString=function(){if(1===arguments.length){var t=arguments[0];return Xc.SIMPLE_ORDINATE_FORMAT.format(t)}},Xc.spaces=function(t){return Xc.chars(" ",t)},Zc.NEWLINE.get=function(){return Pl.getProperty("line.separator")},Zc.SIMPLE_ORDINATE_FORMAT.get=function(){return new jc("0.#")},Object.defineProperties(Xc,Zc);var Kc=function(){};Kc.prototype.interfaces_=function(){return[]},Kc.prototype.getClass=function(){return Kc},Kc.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))},Kc.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,Sl.X)===t.getOrdinate(e-1,Sl.X)&&t.getOrdinate(0,Sl.Y)===t.getOrdinate(e-1,Sl.Y)},Kc.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var s=t.getOrdinate(i,o),a=e.getOrdinate(i,o);if(t.getOrdinate(i,o)!==e.getOrdinate(i,o)&&(!rl.isNaN(s)||!rl.isNaN(a)))return!1}return!0},Kc.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(Kc.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)Kc.copy(e,i-1,r,o,1);return r},Kc.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)Kc.swap(t,r,e-r)},Kc.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}},Kc.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)Kc.copyCoord(t,e+o,n,r+o)},Kc.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),r=new vl;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(Xc.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}},Kc.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?Kc.createClosedRing(t,e,4):e.getOrdinate(0,Sl.X)===e.getOrdinate(n-1,Sl.X)&&e.getOrdinate(0,Sl.Y)===e.getOrdinate(n-1,Sl.Y)?e:Kc.createClosedRing(t,e,n+1)},Kc.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();Kc.copy(e,0,r,0,i);for(var o=i;o<n;o++)Kc.copy(e,0,r,o,1);return r};var Jc=function(t){function e(e,n){t.call(this,n),this._points=null,this.init(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Il:this._points.expandEnvelope(new Il)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._points.size()!==i._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!e.equal(e._points.getCoordinate(o),i._points.getCoordinate(o),r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this._points.size()/2);e++){var n=t._points.size()-1-e;if(!t._points.getCoordinate(e).equals(t._points.getCoordinate(n)))return t._points.getCoordinate(e).compareTo(t._points.getCoordinate(n))>0&&Kc.reverse(t._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Oc.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return ql.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Kc.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=e,r=0,i=0;r<this._points.size()&&i<n._points.size();){var o=t._points.getCoordinate(r).compareTo(n._points.getCoordinate(i));if(0!==o)return o;r++,i++}return r<this._points.size()?1:i<n._points.size()?-1:0}if(2===arguments.length){var s=arguments[0],a=arguments[1],u=s;return a.compare(this._points,u._points)}},e.prototype.apply=function(){var t=this;if(gl(arguments[0],Ql))for(var e=arguments[0],n=0;n<this._points.size();n++)e.filter(t._points.getCoordinate(n));else if(gl(arguments[0],kc)){var r=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(r.filter(t._points,i),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(gl(arguments[0],Fc)){var o=arguments[0];o.filter(this)}else if(gl(arguments[0],Xl)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return new Gc(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new nl("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Pc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Zl),Qc=function(){};Qc.prototype.interfaces_=function(){return[]},Qc.prototype.getClass=function(){return Qc};var $c=function(t){function e(e,n){t.call(this,n),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Il;var t=new Il;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Oc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=n;return r.compare(this._coordinates,i._coordinates)}},e.prototype.apply=function(){if(gl(arguments[0],Ql)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(gl(arguments[0],kc)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(gl(arguments[0],Fc)){var n=arguments[0];n.filter(this)}else if(gl(arguments[0],Xl)){var r=arguments[0];r.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Gl.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Qc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}(Zl),th=function(){};th.prototype.interfaces_=function(){return[]},th.prototype.getClass=function(){return th};var eh=function(t){function e(e,n,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new nl("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new nl("shell is empty but holes are not");this._shell=e,this._holes=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(ql.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(ql.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var r=t.getX(n);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var i=t.getY(n);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var u=t.getX(a),l=t.getY(a);if(u!==o===(l!==s))return!1;o=u,s=l}return!0},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n,o=this._shell,s=i._shell;if(!o.equalsExact(s,r))return!1;if(this._holes.length!==i._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!e._holes[a].equalsExact(i._holes[a],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var t=this;if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)t.normalize(t._holes[e],!1);Nc.sort(this._holes)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];if(n.isEmpty())return null;var i=new Array(n.getCoordinates().length-1).fill(null);Pl.arraycopy(n.getCoordinates(),0,i,0,i.length);var o=dc.minCoordinate(n.getCoordinates());dc.scroll(i,o),Pl.arraycopy(i,0,n.getCoordinates(),0,i.length),n.getCoordinates()[i.length]=i[0],ql.isCCW(n.getCoordinates())===r&&dc.reverse(n.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this._shell,r=e._shell;return n.compareToSameClass(r)}if(2===arguments.length){var i=arguments[0],o=arguments[1],s=i,a=this._shell,u=s._shell,l=a.compareToSameClass(u,o);if(0!==l)return l;for(var c=this.getNumInteriorRing(),h=s.getNumInteriorRing(),p=0;p<c&&p<h;){var d=t.getInteriorRingN(p),f=s.getInteriorRingN(p),g=d.compareToSameClass(f,o);if(0!==g)return g;p++}return p<c?1:p<h?-1:0}},e.prototype.apply=function(t){var e=this;if(gl(t,Ql)){this._shell.apply(t);for(var n=0;n<this._holes.length;n++)e._holes[n].apply(t)}else if(gl(t,kc)){if(this._shell.apply(t),!t.isDone())for(var r=0;r<this._holes.length&&(e._holes[r].apply(t),!t.isDone());r++);t.isGeometryChanged()&&this.geometryChanged()}else if(gl(t,Fc))t.filter(this);else if(gl(t,Xl)){t.filter(this),this._shell.apply(t);for(var i=0;i<this._holes.length;i++)e._holes[i].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)e._holes[n]=this._holes[n].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<n.length;r++)n[r]=this._holes[r].copy();return new e(t,n,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Zl),nh=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Zl.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Oc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Qc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(Bc),rh=function(t){function e(e,n){e instanceof ll&&n instanceof xh&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Zl.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Oc.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Kc.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new nl("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new nl("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Jc),ih=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Zl.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new cc,e=0;e<this._geometries.length;e++)for(var n=this._geometries[e].getBoundary(),r=0;r<n.getNumGeometries();r++)t.add(n.getGeometryN(r));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Bc),oh=function(t){this._factory=t||null,this._isUserDataCopied=!1},sh={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};oh.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},oh.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},oh.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Bc?this.editGeometryCollection(t,e):t instanceof eh?this.editPolygon(t,e):t instanceof $c||t instanceof Jc?e.edit(t,this._factory):(Gl.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},oh.prototype.editGeometryCollection=function(t,e){for(var n=e.edit(t,this._factory),r=new cc,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),e);null===o||o.isEmpty()||r.add(o)}return n.getClass()===nh?this._factory.createMultiPoint(r.toArray([])):n.getClass()===zc?this._factory.createMultiLineString(r.toArray([])):n.getClass()===ih?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},oh.prototype.editPolygon=function(t,e){var n=e.edit(t,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),e);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new cc,o=0;o<n.getNumInteriorRing();o++){var s=this.edit(n.getInteriorRingN(o),e);null===s||s.isEmpty()||i.add(s)}return this._factory.createPolygon(r,i.toArray([]))},oh.prototype.interfaces_=function(){return[]},oh.prototype.getClass=function(){return oh},oh.GeometryEditorOperation=function(){},sh.NoOpGeometryOperation.get=function(){return ah},sh.CoordinateOperation.get=function(){return uh},sh.CoordinateSequenceOperation.get=function(){return lh},Object.defineProperties(oh,sh);var ah=function(){};ah.prototype.edit=function(t,e){return t},ah.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},ah.prototype.getClass=function(){return ah};var uh=function(){};uh.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof rh?e.createLinearRing(n):t instanceof Jc?e.createLineString(n):t instanceof $c?n.length>0?e.createPoint(n[0]):e.createPoint():t},uh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},uh.prototype.getClass=function(){return uh};var lh=function(){};lh.prototype.edit=function(t,e){return t instanceof rh?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Jc?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof $c?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},lh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},lh.prototype.getClass=function(){return lh};var ch=function(){var t=this;if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new ll}else if(gl(arguments[0],Sl)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1];this._coordinates=o,this._dimension=s,null===o&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],u=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=u;for(var l=0;l<a;l++)t._coordinates[l]=new ll}},hh={serialVersionUID:{configurable:!0}};ch.prototype.setOrdinate=function(t,e,n){switch(e){case Sl.X:this._coordinates[t].x=n;break;case Sl.Y:this._coordinates[t].y=n;break;case Sl.Z:this._coordinates[t].z=n;break;default:throw new nl("invalid ordinateIndex")}},ch.prototype.size=function(){return this._coordinates.length},ch.prototype.getOrdinate=function(t,e){switch(e){case Sl.X:return this._coordinates[t].x;case Sl.Y:return this._coordinates[t].y;case Sl.Z:return this._coordinates[t].z}return rl.NaN},ch.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},ch.prototype.getCoordinateCopy=function(t){return new ll(this._coordinates[t])},ch.prototype.getDimension=function(){return this._dimension},ch.prototype.getX=function(t){return this._coordinates[t].x},ch.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new ch(t,this._dimension)},ch.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},ch.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new ch(t,this._dimension)},ch.prototype.toString=function(){if(this._coordinates.length>0){var t=new vl(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},ch.prototype.getY=function(t){return this._coordinates[t].y},ch.prototype.toCoordinateArray=function(){return this._coordinates},ch.prototype.interfaces_=function(){return[Sl,ul]},ch.prototype.getClass=function(){return ch},hh.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ch,hh);var ph=function(){},dh={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ph.prototype.readResolve=function(){return ph.instance()},ph.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new ch(t)}if(gl(arguments[0],Sl)){var e=arguments[0];return new ch(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new ch(n):new ch(n,r)}},ph.prototype.interfaces_=function(){return[pl,ul]},ph.prototype.getClass=function(){return ph},ph.instance=function(){return ph.instanceObject},dh.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},dh.instanceObject.get=function(){return new ph},Object.defineProperties(ph,dh);var fh=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new cc,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new bc;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(yc),gh=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof yh){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},mh={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};gh.prototype.equals=function(t){if(!(t instanceof gh))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},gh.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new xl(n).compareTo(new xl(r))},gh.prototype.getScale=function(){return this._scale},gh.prototype.isFloating=function(){return this._modelType===gh.FLOATING||this._modelType===gh.FLOATING_SINGLE},gh.prototype.getType=function(){return this._modelType},gh.prototype.toString=function(){var t="UNKNOWN";return this._modelType===gh.FLOATING?t="Floating":this._modelType===gh.FLOATING_SINGLE?t="Floating-Single":this._modelType===gh.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},gh.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return rl.isNaN(t)||this._modelType===gh.FLOATING_SINGLE?t:this._modelType===gh.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof ll){var e=arguments[0];if(this._modelType===gh.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},gh.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===gh.FLOATING?t=16:this._modelType===gh.FLOATING_SINGLE?t=6:this._modelType===gh.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},gh.prototype.setScale=function(t){this._scale=Math.abs(t)},gh.prototype.interfaces_=function(){return[ul,ol]},gh.prototype.getClass=function(){return gh},gh.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},mh.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},mh.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(gh,mh);var yh=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},vh={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};yh.prototype.readResolve=function(){return yh.nameToTypeMap.get(this._name)},yh.prototype.toString=function(){return this._name},yh.prototype.interfaces_=function(){return[ul]},yh.prototype.getClass=function(){return yh},vh.serialVersionUID.get=function(){return-552860263173159e4},vh.nameToTypeMap.get=function(){return new fh},Object.defineProperties(yh,vh),gh.Type=yh,gh.FIXED=new yh("FIXED"),gh.FLOATING=new yh("FLOATING"),gh.FLOATING_SINGLE=new yh("FLOATING SINGLE");var xh=function t(){this._precisionModel=new gh,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?gl(arguments[0],pl)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof gh&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},_h={serialVersionUID:{configurable:!0}};xh.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new ll(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new ll(t.getMinX(),t.getMinY()),new ll(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new ll(t.getMinX(),t.getMinY()),new ll(t.getMinX(),t.getMaxY()),new ll(t.getMaxX(),t.getMaxY()),new ll(t.getMaxX(),t.getMinY()),new ll(t.getMinX(),t.getMinY())]),null)},xh.prototype.createLineString=function(t){return t?t instanceof Array?new Jc(this.getCoordinateSequenceFactory().create(t),this):gl(t,Sl)?new Jc(t,this):void 0:new Jc(this.getCoordinateSequenceFactory().create([]),this)},xh.prototype.createMultiLineString=function(){if(0===arguments.length)return new zc(null,this);if(1===arguments.length){var t=arguments[0];return new zc(t,this)}},xh.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),s=o.getClass();null===e&&(e=s),s!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(xh.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof eh)return this.createMultiPolygon(xh.toPolygonArray(t));if(a instanceof Jc)return this.createMultiLineString(xh.toLineStringArray(t));if(a instanceof $c)return this.createMultiPoint(xh.toPointArray(t));Gl.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},xh.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},xh.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof ll){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(gl(arguments[0],Sl)){var e=arguments[0];return new $c(e,this)}}},xh.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},xh.prototype.createPolygon=function(){if(0===arguments.length)return new eh(null,null,this);if(1===arguments.length){if(gl(arguments[0],Sl)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof rh){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return new eh(r,i,this)}},xh.prototype.getSRID=function(){return this._SRID},xh.prototype.createGeometryCollection=function(){if(0===arguments.length)return new Bc(null,this);if(1===arguments.length){var t=arguments[0];return new Bc(t,this)}},xh.prototype.createGeometry=function(t){return new oh(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},xh.prototype.getPrecisionModel=function(){return this._precisionModel},xh.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(gl(arguments[0],Sl)){var e=arguments[0];return new rh(e,this)}}},xh.prototype.createMultiPolygon=function(){if(0===arguments.length)return new ih(null,this);if(1===arguments.length){var t=arguments[0];return new ih(t,this)}},xh.prototype.createMultiPoint=function(){var t=this;if(0===arguments.length)return new nh(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new nh(e,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(gl(arguments[0],Sl)){var r=arguments[0];if(null===r)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),o=0;o<r.size();o++){var s=t.getCoordinateSequenceFactory().create(1,r.getDimension());Kc.copy(r,o,s,0,1),i[o]=t.createPoint(s)}return this.createMultiPoint(i)}}},xh.prototype.interfaces_=function(){return[ul]},xh.prototype.getClass=function(){return xh},xh.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.getDefaultCoordinateSequenceFactory=function(){return ph.instance()},xh.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},xh.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},_h.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(xh,_h);var bh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],wh=function(t){this.geometryFactory=t||new xh};wh.prototype.read=function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!Mh[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==bh.indexOf(n)?Mh[n].apply(this,[e.coordinates]):"GeometryCollection"===n?Mh[n].apply(this,[e.geometries]):Mh[n].apply(this,[e])},wh.prototype.write=function(t){var e=t.getGeometryType();if(!Eh[e])throw new Error("Geometry is not supported");return Eh[e].apply(this,[t])};var Mh={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!Mh[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Mh.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new ll(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new ll(t[0],t[1]),new ll(t[2],t[1]),new ll(t[2],t[3]),new ll(t[0],t[3]),new ll(t[0],t[1])])},Point:function(t){var e=new ll(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Mh.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Mh.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Mh.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Mh.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),r=[],i=1;i<t.length;++i){var o=t[i],s=Mh.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(Mh.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},Eh={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Eh.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.Point.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),r=0;r<n.length;++r){var i=n[r];e.push(Eh.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.LineString.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=Eh.LineString.apply(this,[t._shell]);e.push(n.coordinates);for(var r=0;r<t._holes.length;++r){var i=t._holes[r],o=Eh.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.Polygon.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=r.getGeometryType();e.push(Eh[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:e}}},Sh=function(t){this.geometryFactory=t||new xh,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new wh(this.geometryFactory)};Sh.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===gh.FIXED&&this.reducePrecision(e),e},Sh.prototype.reducePrecision=function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])};var Th=function(){this.parser=new wh(this.geometryFactory)};Th.prototype.write=function(t){return this.parser.write(t)};var Ch=function(){},Ah={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Ph(t){this.message=t||""}function Lh(){this.array_=[]}Ch.prototype.interfaces_=function(){return[]},Ch.prototype.getClass=function(){return Ch},Ch.opposite=function(t){return t===Ch.LEFT?Ch.RIGHT:t===Ch.RIGHT?Ch.LEFT:t},Ah.ON.get=function(){return 0},Ah.LEFT.get=function(){return 1},Ah.RIGHT.get=function(){return 2},Object.defineProperties(Ch,Ah),Ph.prototype=new Error,Ph.prototype.name="EmptyStackException",Lh.prototype=new uc,Lh.prototype.add=function(t){return this.array_.push(t),!0},Lh.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Lh.prototype.push=function(t){return this.array_.push(t),t},Lh.prototype.pop=function(t){if(0===this.array_.length)throw new Ph;return this.array_.pop()},Lh.prototype.peek=function(){if(0===this.array_.length)throw new Ph;return this.array_[this.array_.length-1]},Lh.prototype.empty=function(){return 0===this.array_.length},Lh.prototype.isEmpty=function(){return this.empty()},Lh.prototype.search=function(t){return this.array_.indexOf(t)},Lh.prototype.size=function(){return this.array_.length},Lh.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t};var Ih=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ih.prototype.getCoordinate=function(){return this._minCoord},Ih.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},Ih.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();Gl.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=ql.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===ql.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===ql.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Ih.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var r=Ch.LEFT;return n[e].y<n[e+1].y&&(r=Ch.RIGHT),r},Ih.prototype.getEdge=function(){return this._orientedDe},Ih.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(null===e._minCoord||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])},Ih.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ih.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}Gl.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ch.LEFT&&(this._orientedDe=this._minDe.getSym())},Ih.prototype.interfaces_=function(){return[]},Ih.prototype.getClass=function(){return Ih};var Rh=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new ll(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Bl),Nh=function(){this.array_=[]};Nh.prototype.addLast=function(t){this.array_.push(t)},Nh.prototype.removeFirst=function(){return this.array_.shift()},Nh.prototype.isEmpty=function(){return 0===this.array_.length};var Oh=function(){this._finder=null,this._dirEdgeList=new cc,this._nodes=new cc,this._rightMostCoord=null,this._env=null,this._finder=new Ih};Oh.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Oh.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Oh.prototype.computeNodeDepth=function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(null===e)throw new Rh("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Oh.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ch.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Oh.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Oh.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ch.RIGHT)>=1&&e.getDepth(Ch.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Oh.prototype.computeDepths=function(t){var e=new bc,n=new Nh,r=t.getNode();for(n.addLast(r),e.add(r),t.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(n.addLast(a),e.add(a))}}}},Oh.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Oh.prototype.getEnvelope=function(){if(null===this._env){for(var t=new Il,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)t.expandToInclude(n[r]);this._env=t}return this._env},Oh.prototype.addReachable=function(t){var e=new Lh;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},Oh.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ch.LEFT,t.getDepth(Ch.RIGHT)),e.setDepth(Ch.RIGHT,t.getDepth(Ch.LEFT))},Oh.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||e.push(i)}},Oh.prototype.getNodes=function(){return this._nodes},Oh.prototype.getDirectedEdges=function(){return this._dirEdgeList},Oh.prototype.interfaces_=function(){return[ol]},Oh.prototype.getClass=function(){return Oh};var Dh=function t(){var e=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[Ch.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],u=arguments[2];this.init(3),this.location[Ch.ON]=s,this.location[Ch.LEFT]=a,this.location[Ch.RIGHT]=u}};Dh.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Dh.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==dl.NONE)return!1;return!0},Dh.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===dl.NONE&&(this.location[e]=t)},Dh.prototype.isLine=function(){return 1===this.location.length},Dh.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ch.ON]=this.location[Ch.ON],e[Ch.LEFT]=dl.NONE,e[Ch.RIGHT]=dl.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===dl.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},Dh.prototype.getLocations=function(){return this.location},Dh.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ch.LEFT];this.location[Ch.LEFT]=this.location[Ch.RIGHT],this.location[Ch.RIGHT]=t},Dh.prototype.toString=function(){var t=new vl;return this.location.length>1&&t.append(dl.toLocationSymbol(this.location[Ch.LEFT])),t.append(dl.toLocationSymbol(this.location[Ch.ON])),this.location.length>1&&t.append(dl.toLocationSymbol(this.location[Ch.RIGHT])),t.toString()},Dh.prototype.setLocations=function(t,e,n){this.location[Ch.ON]=t,this.location[Ch.LEFT]=e,this.location[Ch.RIGHT]=n},Dh.prototype.get=function(t){return t<this.location.length?this.location[t]:dl.NONE},Dh.prototype.isArea=function(){return this.location.length>1},Dh.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===dl.NONE)return!0;return!1},Dh.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ch.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},Dh.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(dl.NONE)},Dh.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Dh.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Dh.prototype.interfaces_=function(){return[]},Dh.prototype.getClass=function(){return Dh};var Fh=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Dh(e),this.elt[1]=new Dh(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Dh(n.elt[0]),this.elt[1]=new Dh(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Dh(dl.NONE),this.elt[1]=new Dh(dl.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Dh(o,s,a),this.elt[1]=new Dh(o,s,a)}else if(4===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Dh(dl.NONE,dl.NONE,dl.NONE),this.elt[1]=new Dh(dl.NONE,dl.NONE,dl.NONE),this.elt[u].setLocations(l,c,h)}};Fh.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Fh.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Fh.prototype.isNull=function(t){return this.elt[t].isNull()},Fh.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},Fh.prototype.isLine=function(t){return this.elt[t].isLine()},Fh.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)null===e.elt[n]&&null!==t.elt[n]?e.elt[n]=new Dh(t.elt[n]):e.elt[n].merge(t.elt[n])},Fh.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Fh.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ch.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},Fh.prototype.toString=function(){var t=new vl;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Fh.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Fh.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Fh.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ch.ON,e)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},Fh.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Fh.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Fh.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Dh(this.elt[t].location[0]))},Fh.prototype.interfaces_=function(){return[]},Fh.prototype.getClass=function(){return Fh},Fh.toLineLabel=function(t){for(var e=new Fh(dl.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var kh=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new cc,this._pts=new cc,this._label=new Fh(dl.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new cc,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};kh.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=ql.isCCW(this._ring.getCoordinates())},kh.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},kh.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(null===n)throw new Rh("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Rh("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();Gl.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)},kh.prototype.getLinearRing=function(){return this._ring},kh.prototype.getCoordinate=function(t){return this._pts.get(t)},kh.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode().getEdges().getOutgoingDegree(t);n>t._maxNodeDegree&&(t._maxNodeDegree=n),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},kh.prototype.addPoints=function(t,e,n){var r=t.getCoordinates();if(e){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;n&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},kh.prototype.isHole=function(){return this._isHole},kh.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},kh.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!ql.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},kh.prototype.addHole=function(t){this._holes.add(t)},kh.prototype.isShell=function(){return null===this._shell},kh.prototype.getLabel=function(){return this._label},kh.prototype.getEdges=function(){return this._edges},kh.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},kh.prototype.getShell=function(){return this._shell},kh.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=e.getLocation(n,Ch.RIGHT);if(r===dl.NONE)return null;if(this._label.getLocation(n)===dl.NONE)return this._label.setLocation(n,r),null}},kh.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},kh.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)e[n]=this._holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},kh.prototype.interfaces_=function(){return[]},kh.prototype.getClass=function(){return kh};var Bh=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kh),zh=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new cc,e=this._startDe;do{if(null===e.getMinEdgeRing()){var n=new Bh(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kh),Gh=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Gh.prototype.setVisited=function(t){this._isVisited=t},Gh.prototype.setInResult=function(t){this._isInResult=t},Gh.prototype.isCovered=function(){return this._isCovered},Gh.prototype.isCoveredSet=function(){return this._isCoveredSet},Gh.prototype.setLabel=function(t){this._label=t},Gh.prototype.getLabel=function(){return this._label},Gh.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Gh.prototype.updateIM=function(t){Gl.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Gh.prototype.isInResult=function(){return this._isInResult},Gh.prototype.isVisited=function(){return this._isVisited},Gh.prototype.interfaces_=function(){return[]},Gh.prototype.getClass=function(){return Gh};var Uh=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],n=arguments[1];this._coord=e,this._edges=n,this._label=new Fh(0,dl.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=dl.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);n!==dl.BOUNDARY&&(n=r)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this._label?this._label=new Fh(e,n):this._label.setLocation(e,n)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof Fh)for(var r=arguments[0],i=0;i<2;i++){var o=t.computeMergedLocation(r,i),s=t._label.getLocation(i);s===dl.NONE&&t._label.setLocation(i,o)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=dl.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;switch(e){case dl.BOUNDARY:n=dl.INTERIOR;break;case dl.INTERIOR:default:n=dl.BOUNDARY}this._label.setLocation(t,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Gh),Vh=function(){this.nodeMap=new Ac,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Vh.prototype.find=function(t){return this.nodeMap.get(t)},Vh.prototype.addNode=function(){if(arguments[0]instanceof ll){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Uh){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},Vh.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Vh.prototype.iterator=function(){return this.nodeMap.values().iterator()},Vh.prototype.values=function(){return this.nodeMap.values()},Vh.prototype.getBoundaryNodes=function(t){for(var e=new cc,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===dl.BOUNDARY&&e.add(r)}return e},Vh.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Vh.prototype.interfaces_=function(){return[]},Vh.prototype.getClass=function(){return Vh};var Hh=function(){},jh={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Hh.prototype.interfaces_=function(){return[]},Hh.prototype.getClass=function(){return Hh},Hh.isNorthern=function(t){return t===Hh.NE||t===Hh.NW},Hh.isOpposite=function(t,e){return t!==e&&2===(t-e+4)%4},Hh.commonHalfPlane=function(t,e){if(t===e)return t;if(2===(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n},Hh.isInHalfPlane=function(t,e){return e===Hh.SE?t===Hh.SE||t===Hh.SW:t===e||t===e+1},Hh.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new nl("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Hh.NE:Hh.SE:e>=0?Hh.NW:Hh.SW}if(arguments[0]instanceof ll&&arguments[1]instanceof ll){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new nl("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Hh.NE:Hh.SE:r.y>=n.y?Hh.NW:Hh.SW}},jh.NE.get=function(){return 0},jh.NW.get=function(){return 1},jh.SW.get=function(){return 2},jh.SE.get=function(){return 3},Object.defineProperties(Hh,jh);var Wh=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],u=arguments[3];this._edge=o,this.init(s,a),this._label=u}};Wh.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:ql.computeOrientation(t._p0,t._p1,this._p1)},Wh.prototype.getDy=function(){return this._dy},Wh.prototype.getCoordinate=function(){return this._p0},Wh.prototype.setNode=function(t){this._node=t},Wh.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Wh.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Wh.prototype.getDirectedCoordinate=function(){return this._p1},Wh.prototype.getDx=function(){return this._dx},Wh.prototype.getLabel=function(){return this._label},Wh.prototype.getEdge=function(){return this._edge},Wh.prototype.getQuadrant=function(){return this._quadrant},Wh.prototype.getNode=function(){return this._node},Wh.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Wh.prototype.computeLabel=function(t){},Wh.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Hh.quadrant(this._dx,this._dy),Gl.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Wh.prototype.interfaces_=function(){return[ol]},Wh.prototype.getClass=function(){return Wh};var qh=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Fh(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Rh("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,n=0;n<2;n++)t._label.isArea(n)&&t._label.getLocation(n,Ch.LEFT)===dl.INTERIOR&&t._label.getLocation(n,Ch.RIGHT)===dl.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ch.LEFT]+"/"+this._depth[Ch.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,dl.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,dl.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;t===Ch.LEFT&&(r=-1);var i=Ch.opposite(t),o=e+n*r;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===dl.EXTERIOR&&e===dl.INTERIOR?1:t===dl.INTERIOR&&e===dl.EXTERIOR?-1:0},e}(Wh),Yh=function(){};Yh.prototype.createNode=function(t){return new Uh(t,null)},Yh.prototype.interfaces_=function(){return[]},Yh.prototype.getClass=function(){return Yh};var Xh=function(){if(this._edges=new cc,this._nodes=null,this._edgeEndList=new cc,0===arguments.length)this._nodes=new Vh(new Yh);else if(1===arguments.length){var t=arguments[0];this._nodes=new Vh(t)}};Xh.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var n=this._edges.get(e);n.print(t),n.eiList.print(t)}},Xh.prototype.find=function(t){return this._nodes.find(t)},Xh.prototype.addNode=function(){if(arguments[0]instanceof Uh){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof ll){var e=arguments[0];return this._nodes.addNode(e)}},Xh.prototype.getNodeIterator=function(){return this._nodes.iterator()},Xh.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Xh.prototype.debugPrintln=function(t){Pl.out.println(t)},Xh.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(t)===dl.BOUNDARY},Xh.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Xh.prototype.matchInSameDirection=function(t,e,n,r){return!!t.equals(n)&&ql.computeOrientation(t,e,r)===ql.COLLINEAR&&Hh.quadrant(t,e)===Hh.quadrant(n,r)},Xh.prototype.getEdgeEnds=function(){return this._edgeEndList},Xh.prototype.debugPrint=function(t){Pl.out.print(t)},Xh.prototype.getEdgeIterator=function(){return this._edges.iterator()},Xh.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(n.matchInSameDirection(t,e,o[0],o[1]))return i;if(n.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return i}return null},Xh.prototype.insertEdge=function(t){this._edges.add(t)},Xh.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Xh.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new qh(r,!0),o=new qh(r,!1);i.setSym(o),o.setSym(i),e.add(i),e.add(o)}},Xh.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Xh.prototype.getNodes=function(){return this._nodes.values()},Xh.prototype.findEdge=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return r}return null},Xh.prototype.interfaces_=function(){return[]},Xh.prototype.getClass=function(){return Xh},Xh.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var Zh=function(){this._geometryFactory=null,this._shellList=new cc;var t=arguments[0];this._geometryFactory=t};Zh.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}},Zh.prototype.computePolygons=function(t){for(var e=new cc,n=t.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);e.add(r)}return e},Zh.prototype.placeFreeHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,t);if(null===i)throw new Rh("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},Zh.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=new cc,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):n.addAll(s)}else r.add(o)}return r},Zh.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},Zh.prototype.buildMaximalEdgeRings=function(t){for(var e=new cc,n=t.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new zh(r,this._geometryFactory);e.add(i),i.setInResult()}}return e},Zh.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}},Zh.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Zh.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var u=a.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(r)&&ql.isPointInRing(i,l.getCoordinates())&&(h=!0),h&&(null===o||s.contains(c))&&(o=u)}return o},Zh.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return Gl.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},Zh.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Xh.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new cc,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},Zh.prototype.interfaces_=function(){return[]},Zh.prototype.getClass=function(){return Zh};var Kh=function(){};Kh.prototype.getBounds=function(){},Kh.prototype.interfaces_=function(){return[]},Kh.prototype.getClass=function(){return Kh};var Jh=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Jh.prototype.getItem=function(){return this._item},Jh.prototype.getBounds=function(){return this._bounds},Jh.prototype.interfaces_=function(){return[Kh,ul]},Jh.prototype.getClass=function(){return Jh};var Qh=function(){this._size=null,this._items=null,this._size=0,this._items=new cc,this._items.add(null)};Qh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Qh.prototype.size=function(){return this._size},Qh.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);2*t<=this._size&&((n=2*t)!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)},Qh.prototype.clear=function(){this._size=0,this._items.clear()},Qh.prototype.isEmpty=function(){return 0===this._size},Qh.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Qh.prototype.interfaces_=function(){return[]},Qh.prototype.getClass=function(){return Qh};var $h=function(){};$h.prototype.visitItem=function(t){},$h.prototype.interfaces_=function(){return[]},$h.prototype.getClass=function(){return $h};var tp=function(){};tp.prototype.insert=function(t,e){},tp.prototype.remove=function(t,e){},tp.prototype.query=function(){},tp.prototype.interfaces_=function(){return[]},tp.prototype.getClass=function(){return tp};var ep=function(){if(this._childBoundables=new cc,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},np={serialVersionUID:{configurable:!0}};ep.prototype.getLevel=function(){return this._level},ep.prototype.size=function(){return this._childBoundables.size()},ep.prototype.getChildBoundables=function(){return this._childBoundables},ep.prototype.addChildBoundable=function(t){Gl.isTrue(null===this._bounds),this._childBoundables.add(t)},ep.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},ep.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},ep.prototype.interfaces_=function(){return[Kh,ul]},ep.prototype.getClass=function(){return ep},np.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(ep,np);var rp=function(){};rp.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},rp.min=function(t){return rp.sort(t),t.get(0)},rp.sort=function(t,e){var n=t.toArray();e?Nc.sort(n,e):Nc.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},rp.singletonList=function(t){var e=new cc;return e.add(t),e};var ip=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};ip.prototype.expandToQueue=function(t,e){var n=ip.isComposite(this._boundable1),r=ip.isComposite(this._boundable2);if(n&&r)return ip.area(this._boundable1)>ip.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new nl("neither boundable is composite")},ip.prototype.isLeaves=function(){return!(ip.isComposite(this._boundable1)||ip.isComposite(this._boundable2))},ip.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ip.prototype.expand=function(t,e,n,r){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),s=new ip(o,e,this._itemDistance);s.getDistance()<r&&n.add(s)}},ip.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ip.prototype.getDistance=function(){return this._distance},ip.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ip.prototype.interfaces_=function(){return[ol]},ip.prototype.getClass=function(){return ip},ip.area=function(t){return t.getBounds().getArea()},ip.isComposite=function(t){return t instanceof ep};var op=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new cc,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var n=arguments[0];Gl.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},sp={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};op.prototype.getNodeCapacity=function(){return this._nodeCapacity},op.prototype.lastNode=function(t){return t.get(t.size()-1)},op.prototype.size=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof ep?n+=t.size(i):i instanceof Jh&&(n+=1)}return n}},op.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Jh&&i.getItem()===e&&(n=i)}return null!==n&&(t.getChildBoundables().remove(n),!0)},op.prototype.itemsTree=function(){var t=this;if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new cc:e}if(1===arguments.length){for(var n=arguments[0],r=new cc,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof ep){var s=t.itemsTree(o);null!==s&&r.add(s)}else o instanceof Jh?r.add(o.getItem()):Gl.shouldNeverReachHere()}return r.size()<=0?null:r}},op.prototype.insert=function(t,e){Gl.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Jh(t,e))},op.prototype.boundablesAtLevel=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new cc;return this.boundablesAtLevel(e,this._root,n),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(Gl.isTrue(r>-2),i.getLevel()===r)return o.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof ep?t.boundablesAtLevel(r,a,o):(Gl.isTrue(a instanceof Jh),-1===r&&o.add(a))}return null}},op.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var n=new cc;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}if(2===arguments.length){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(3===arguments.length)if(gl(arguments[2],$h)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var o=arguments[0],s=arguments[1],a=arguments[2],u=s.getChildBoundables(),l=0;l<u.size();l++){var c=u.get(l);t.getIntersectsOp().intersects(c.getBounds(),o)&&(c instanceof ep?t.query(o,c,a):c instanceof Jh?a.visitItem(c.getItem()):Gl.shouldNeverReachHere())}else if(gl(arguments[2],uc)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var h=arguments[0],p=arguments[1],d=arguments[2],f=p.getChildBoundables(),g=0;g<f.size();g++){var m=f.get(g);t.getIntersectsOp().intersects(m.getBounds(),h)&&(m instanceof ep?t.query(h,m,d):m instanceof Jh?d.add(m.getItem()):Gl.shouldNeverReachHere())}},op.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},op.prototype.getRoot=function(){return this.build(),this._root},op.prototype.remove=function(){var t=this;if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,n)}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=this.removeItem(i,o);if(s)return!0;for(var a=null,u=i.getChildBoundables().iterator();u.hasNext();){var l=u.next();if(t.getIntersectsOp().intersects(l.getBounds(),r)&&l instanceof ep&&(s=t.remove(r,l,o))){a=l;break}}return null!==a&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),s}},op.prototype.createHigherLevels=function(t,e){Gl.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},op.prototype.depth=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof ep){var o=t.depth(i);o>n&&(n=o)}}return n+1}},op.prototype.createParentBoundables=function(t,e){var n=this;Gl.isTrue(!t.isEmpty());var r=new cc;r.add(this.createNode(e));var i=new cc(t);rp.sort(i,this.getComparator());for(var o=i.iterator();o.hasNext();){var s=o.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(s)}return r},op.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},op.prototype.interfaces_=function(){return[ul]},op.prototype.getClass=function(){return op},op.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},sp.IntersectsOp.get=function(){return ap},sp.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},sp.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(op,sp);var ap=function(){},up=function(){};up.prototype.distance=function(t,e){},up.prototype.interfaces_=function(){return[]},up.prototype.getClass=function(){return up};var lp=function(t){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,t.call(this,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){Gl.isTrue(t.length>0);for(var n=new cc,r=0;r<t.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return n},e.prototype.createNode=function(t){return new cp(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){r[o]=new cc;for(var s=0;i.hasNext()&&s<n;){var a=i.next();r[o].add(a),s++}}return r},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];t.prototype.query.call(this,n,r)}else if(3===arguments.length)if(gl(arguments[2],$h)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var i=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,i,o,s)}else if(gl(arguments[2],uc)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var a=arguments[0],u=arguments[1],l=arguments[2];t.prototype.query.call(this,a,u,l)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return t.prototype.remove.call(this,e,n)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,n){Gl.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new cc(t);rp.sort(i,e.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,n)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(gl(arguments[0],up)){var t=arguments[0],n=new ip(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof ip){var r=arguments[0];return this.nearestNeighbour(r,rl.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&gl(arguments[1],up)){var i=arguments[0],o=arguments[1],s=new ip(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof ip&&"number"==typeof arguments[1]){var a=arguments[0],u=arguments[1],l=u,c=null,h=new Qh;for(h.add(a);!h.isEmpty()&&l>0;){var p=h.poll(),d=p.getDistance();if(d>=l)break;p.isLeaves()?(l=d,c=p):p.expandToQueue(h,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var f=arguments[0],g=arguments[1],m=arguments[2],y=new Jh(f,g),v=new ip(this.getRoot(),y,m);return this.nearestNeighbour(v)[0]}},e.prototype.interfaces_=function(){return[tp,ul]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return cp},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[al]},compare:function(n,r){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[al]},compare:function(n,r){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(op),cp=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new Il(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ep),hp=function(){};hp.prototype.interfaces_=function(){return[]},hp.prototype.getClass=function(){return hp},hp.relativeSign=function(t,e){return t<e?-1:t>e?1:0},hp.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=hp.relativeSign(e.x,n.x),i=hp.relativeSign(e.y,n.y);switch(t){case 0:return hp.compareValue(r,i);case 1:return hp.compareValue(i,r);case 2:return hp.compareValue(i,-r);case 3:return hp.compareValue(-r,i);case 4:return hp.compareValue(-r,-i);case 5:return hp.compareValue(-i,-r);case 6:return hp.compareValue(-i,r);case 7:return hp.compareValue(r,-i)}return Gl.shouldNeverReachHere("invalid octant value"),0},hp.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var pp=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new ll(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};pp.prototype.getCoordinate=function(){return this.coord},pp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},pp.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:hp.compare(this._segmentOctant,this.coord,e.coord)},pp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},pp.prototype.isInterior=function(){return this._isInterior},pp.prototype.interfaces_=function(){return[ol]},pp.prototype.getClass=function(){return pp};var dp=function(){this._nodeMap=new Ac,this._edge=null;var t=arguments[0];this._edge=t};dp.prototype.getSplitCoordinates=function(){var t=new pc;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next();this.addEdgeCoordinates(n,r,t),n=r}return t.toCoordinateArray()},dp.prototype.addCollapsedNodes=function(){var t=new cc;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}},dp.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},dp.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var n=this._edge.getCoordinate(e),r=this._edge.getCoordinate(e+2);n.equals2D(r)&&t.add(new xl(e+1))}},dp.prototype.addEdgeCoordinates=function(t,e,n){var r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);n.add(new ll(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new ll(e.coord))},dp.prototype.iterator=function(){return this._nodeMap.values().iterator()},dp.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},dp.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(n[0]=t.segmentIndex+1,!0)},dp.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,e)&&t.add(new xl(e[0])),r=i}},dp.prototype.getEdge=function(){return this._edge},dp.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},dp.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new ll(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return i&&(o[s]=new ll(e.coord)),new yp(o,this._edge.getData())},dp.prototype.add=function(t,e){var n=new pp(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return null!==r?(Gl.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},dp.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new Bl("bad split edge start point at "+n);var r=t.get(t.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(e[e.length-1]))throw new Bl("bad split edge end point at "+i)},dp.prototype.interfaces_=function(){return[]},dp.prototype.getClass=function(){return dp};var fp=function(){};fp.prototype.interfaces_=function(){return[]},fp.prototype.getClass=function(){return fp},fp.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new nl("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof ll&&arguments[1]instanceof ll){var i=arguments[0],o=arguments[1],s=o.x-i.x,a=o.y-i.y;if(0===s&&0===a)throw new nl("Cannot compute the octant for two identical points "+i);return fp.octant(s,a)}};var gp=function(){};gp.prototype.getCoordinates=function(){},gp.prototype.size=function(){},gp.prototype.getCoordinate=function(t){},gp.prototype.isClosed=function(){},gp.prototype.setData=function(t){},gp.prototype.getData=function(){},gp.prototype.interfaces_=function(){return[]},gp.prototype.getClass=function(){return gp};var mp=function(){};mp.prototype.addIntersection=function(t,e){},mp.prototype.interfaces_=function(){return[gp]},mp.prototype.getClass=function(){return mp};var yp=function(){this._nodeList=new dp(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};yp.prototype.getCoordinates=function(){return this._pts},yp.prototype.size=function(){return this._pts.length},yp.prototype.getCoordinate=function(t){return this._pts[t]},yp.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},yp.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},yp.prototype.setData=function(t){this._data=t},yp.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:fp.octant(t,e)},yp.prototype.getData=function(){return this._data},yp.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[3],o=new ll(n.getIntersection(i));this.addIntersection(o,r)}},yp.prototype.toString=function(){return kl.toLineString(new ch(this._pts))},yp.prototype.getNodeList=function(){return this._nodeList},yp.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}return this._nodeList.add(t,n)},yp.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},yp.prototype.interfaces_=function(){return[mp]},yp.prototype.getClass=function(){return yp},yp.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new cc;return yp.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();o.getNodeList().addSplitEdges(r)}};var vp=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new ll,this.p1=new ll;else if(1===arguments.length){var t=arguments[0];this.p0=new ll(t.p0),this.p1=new ll(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new ll(e,n),this.p1=new ll(r,i)}},xp={serialVersionUID:{configurable:!0}};vp.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},vp.prototype.orientationIndex=function(){if(arguments[0]instanceof vp){var t=arguments[0],e=ql.orientationIndex(this.p0,this.p1,t.p0),n=ql.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof ll){var r=arguments[0];return ql.orientationIndex(this.p0,this.p1,r)}},vp.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},vp.prototype.isVertical=function(){return this.p0.x===this.p1.x},vp.prototype.equals=function(t){if(!(t instanceof vp))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},vp.prototype.intersection=function(t){var e=new Hl;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},vp.prototype.project=function(){if(arguments[0]instanceof ll){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new ll(t);var e=this.projectionFactor(t),n=new ll;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof vp){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var s=this.project(r.p0);i<0&&(s=this.p0),i>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new vp(s,a)}},vp.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},vp.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},vp.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},vp.prototype.distancePerpendicular=function(t){return ql.distancePointLinePerpendicular(t,this.p0,this.p1)},vp.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},vp.prototype.midPoint=function(){return vp.midPoint(this.p0,this.p1)},vp.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;return r<=0?rl.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},vp.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=rl.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var s=this.closestPoint(t.p1);(i=s.distance(t.p1))<r&&(r=i,n[0]=s,n[1]=t.p1);var a=t.closestPoint(this.p0);(i=a.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=a);var u=t.closestPoint(this.p1);return(i=u.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=u),n},vp.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},vp.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},vp.prototype.getLength=function(){return this.p0.distance(this.p1)},vp.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},vp.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},vp.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},vp.prototype.lineIntersection=function(t){try{return Ll.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof Al))throw t}return null},vp.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},vp.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(i*i+o*o),a=0,u=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*i/s,u=e*o/s}return new ll(n-u,r+a)},vp.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},vp.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||rl.isNaN(e))&&(e=1),e},vp.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},vp.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},vp.prototype.distance=function(){if(arguments[0]instanceof vp){var t=arguments[0];return ql.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof ll){var e=arguments[0];return ql.distancePointLine(e,this.p0,this.p1)}},vp.prototype.pointAlong=function(t){var e=new ll;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},vp.prototype.hashCode=function(){var t=rl.doubleToLongBits(this.p0.x);t^=31*rl.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=rl.doubleToLongBits(this.p1.x);return n^=31*rl.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},vp.prototype.interfaces_=function(){return[ol,ul]},vp.prototype.getClass=function(){return vp},vp.midPoint=function(t,e){return new ll((t.x+e.x)/2,(t.y+e.y)/2)},xp.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(vp,xp);var _p=function(){this.tempEnv1=new Il,this.tempEnv2=new Il,this._overlapSeg1=new vp,this._overlapSeg2=new vp};_p.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},_p.prototype.interfaces_=function(){return[]},_p.prototype.getClass=function(){return _p};var bp=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};bp.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},bp.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var s=Math.trunc((e+n)/2);e<s&&this.computeSelect(t,e,s,r),s<n&&this.computeSelect(t,s,n,r)},bp.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t},bp.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},bp.prototype.setId=function(t){this._id=t},bp.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},bp.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Il(t,e)}return this._env},bp.prototype.getEndIndex=function(){return this._end},bp.prototype.getStartIndex=function(){return this._start},bp.prototype.getContext=function(){return this._context},bp.prototype.getId=function(){return this._id},bp.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var s=this._pts[t],a=this._pts[e],u=n._pts[r],l=n._pts[i];if(e-t==1&&i-r==1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(u,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((t+e)/2),h=Math.trunc((r+i)/2);t<c&&(r<h&&this.computeOverlapsInternal(t,c,n,r,h,o),h<i&&this.computeOverlapsInternal(t,c,n,h,i,o)),c<e&&(r<h&&this.computeOverlapsInternal(c,e,n,r,h,o),h<i&&this.computeOverlapsInternal(c,e,n,h,i,o))},bp.prototype.interfaces_=function(){return[]},bp.prototype.getClass=function(){return bp};var wp=function(){};wp.prototype.interfaces_=function(){return[]},wp.prototype.getClass=function(){return wp},wp.getChainStartIndices=function(t){var e=0,n=new cc;n.add(new xl(e));do{var r=wp.findChainEnd(t,e);n.add(new xl(r)),e=r}while(e<t.length-1);return wp.toIntArray(n)},wp.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Hh.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])&&Hh.quadrant(t[i-1],t[i])!==r)break;i++}return i-1},wp.getChains=function(){if(1===arguments.length){var t=arguments[0];return wp.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=new cc,i=wp.getChainStartIndices(e),o=0;o<i.length-1;o++){var s=new bp(e,i[o],i[o+1],n);r.add(s)}return r}},wp.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Mp=function(){};Mp.prototype.computeNodes=function(t){},Mp.prototype.getNodedSubstrings=function(){},Mp.prototype.interfaces_=function(){return[]},Mp.prototype.getClass=function(){return Mp};var Ep=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};Ep.prototype.setSegmentIntersector=function(t){this._segInt=t},Ep.prototype.interfaces_=function(){return[Mp]},Ep.prototype.getClass=function(){return Ep};var Sp=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new cc,this._index=new lp,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=this,n=wp.getChains(t.getCoordinates(),t).iterator();n.hasNext();){var r=n.next();r.setId(e._idCounter++),e._index.insert(r.getEnvelope(),r),e._monoChains.add(r)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new Tp(this._segInt),n=this._monoChains.iterator();n.hasNext();)for(var r=n.next(),i=t._index.query(r.getEnvelope()).iterator();i.hasNext();){var o=i.next();if(o.getId()>r.getId()&&(r.computeOverlaps(o,e),t._nOverlaps++),t._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return Tp},Object.defineProperties(e,n),e}(Ep),Tp=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=e.getContext(),s=r.getContext();this._si.processIntersections(o,n,s,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(_p),Cp=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Ap={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Cp.prototype.getEndCapStyle=function(){return this._endCapStyle},Cp.prototype.isSingleSided=function(){return this._isSingleSided},Cp.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Cp.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Cp.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Cp.JOIN_ROUND&&(this._quadrantSegments=Cp.DEFAULT_QUADRANT_SEGMENTS)},Cp.prototype.getJoinStyle=function(){return this._joinStyle},Cp.prototype.setJoinStyle=function(t){this._joinStyle=t},Cp.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Cp.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Cp.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Cp.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Cp.prototype.getMitreLimit=function(){return this._mitreLimit},Cp.prototype.setMitreLimit=function(t){this._mitreLimit=t},Cp.prototype.setSingleSided=function(t){this._isSingleSided=t},Cp.prototype.interfaces_=function(){return[]},Cp.prototype.getClass=function(){return Cp},Cp.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Ap.CAP_ROUND.get=function(){return 1},Ap.CAP_FLAT.get=function(){return 2},Ap.CAP_SQUARE.get=function(){return 3},Ap.JOIN_ROUND.get=function(){return 1},Ap.JOIN_MITRE.get=function(){return 2},Ap.JOIN_BEVEL.get=function(){return 3},Ap.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Ap.DEFAULT_MITRE_LIMIT.get=function(){return 5},Ap.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Cp,Ap);var Pp=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ql.COUNTERCLOCKWISE,this._inputLine=t||null},Lp={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Pp.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[n];return!!this.isConcave(i,o,s)&&!!this.isShallow(i,o,s,r)&&this.isShallowSampled(i,o,t,n,r)},Pp.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var o=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=Pp.DELETE,o=!0,i=!0),e=o?r:n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i},Pp.prototype.isShallowConcavity=function(t,e,n,r){return ql.computeOrientation(t,e,n)===this._angleOrientation&&ql.distancePointLine(e,t,n)<r},Pp.prototype.isShallowSampled=function(t,e,n,r,i){var o=Math.trunc((r-n)/Pp.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=n;s<r;s+=o)if(!this.isShallow(t,e,this._inputLine[s],i))return!1;return!0},Pp.prototype.isConcave=function(t,e,n){var r=ql.computeOrientation(t,e,n)===this._angleOrientation;return r},Pp.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=ql.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Pp.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Pp.DELETE;)e++;return e},Pp.prototype.isShallow=function(t,e,n,r){return ql.distancePointLine(e,t,n)<r},Pp.prototype.collapseLine=function(){for(var t=new pc,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Pp.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Pp.prototype.interfaces_=function(){return[]},Pp.prototype.getClass=function(){return Pp},Pp.simplify=function(t,e){return new Pp(t).simplify(e)},Lp.INIT.get=function(){return 0},Lp.DELETE.get=function(){return 1},Lp.KEEP.get=function(){return 1},Lp.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Pp,Lp);var Ip=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new cc},Rp={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ip.prototype.getCoordinates=function(){return this._ptList.toArray(Ip.COORDINATE_ARRAY_TYPE)},Ip.prototype.setPrecisionModel=function(t){this._precisionModel=t},Ip.prototype.addPt=function(t){var e=new ll(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Ip.prototype.revere=function(){},Ip.prototype.addPts=function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var r=t.length-1;r>=0;r--)this.addPt(t[r])},Ip.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Ip.prototype.toString=function(){return(new xh).createLineString(this.getCoordinates()).toString()},Ip.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new ll(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Ip.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Ip.prototype.interfaces_=function(){return[]},Ip.prototype.getClass=function(){return Ip},Rp.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ip,Rp);var Np=function(){},Op={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Np.prototype.interfaces_=function(){return[]},Np.prototype.getClass=function(){return Np},Np.toDegrees=function(t){return 180*t/Math.PI},Np.normalize=function(t){for(;t>Math.PI;)t-=Np.PI_TIMES_2;for(;t<=-Math.PI;)t+=Np.PI_TIMES_2;return t},Np.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}},Np.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)>0},Np.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0},Np.interiorAngle=function(t,e,n){var r=Np.angle(e,t),i=Np.angle(e,n);return Math.abs(i-r)},Np.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Np.PI_TIMES_2;t>=Np.PI_TIMES_2&&(t=0)}else{for(;t>=Np.PI_TIMES_2;)t-=Np.PI_TIMES_2;t<0&&(t=0)}return t},Np.angleBetween=function(t,e,n){var r=Np.angle(e,t),i=Np.angle(e,n);return Np.diff(r,i)},Np.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},Np.toRadians=function(t){return t*Math.PI/180},Np.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Np.COUNTERCLOCKWISE:n<0?Np.CLOCKWISE:Np.NONE},Np.angleBetweenOriented=function(t,e,n){var r=Np.angle(e,t),i=Np.angle(e,n)-r;return i<=-Math.PI?i+Np.PI_TIMES_2:i>Math.PI?i-Np.PI_TIMES_2:i},Op.PI_TIMES_2.get=function(){return 2*Math.PI},Op.PI_OVER_2.get=function(){return Math.PI/2},Op.PI_OVER_4.get=function(){return Math.PI/4},Op.COUNTERCLOCKWISE.get=function(){return ql.COUNTERCLOCKWISE},Op.CLOCKWISE.get=function(){return ql.CLOCKWISE},Op.NONE.get=function(){return ql.COLLINEAR},Object.defineProperties(Np,Op);var Dp=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new vp,this._seg1=new vp,this._offset0=new vp,this._offset1=new vp,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new Hl,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Cp.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Fp={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Dp.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=ql.computeOrientation(this._s0,this._s1,this._s2),r=n===ql.CLOCKWISE&&this._side===Ch.LEFT||n===ql.COUNTERCLOCKWISE&&this._side===Ch.RIGHT;0===n?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},Dp.prototype.addLineEndCap=function(t,e){var n=new vp(t,e),r=new vp;this.computeOffsetSegment(n,Ch.LEFT,this._distance,r);var i=new vp;this.computeOffsetSegment(n,Ch.RIGHT,this._distance,i);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Cp.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,ql.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Cp.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Cp.CAP_SQUARE:var u=new ll;u.x=Math.abs(this._distance)*Math.cos(a),u.y=Math.abs(this._distance)*Math.sin(a);var l=new ll(r.p1.x+u.x,r.p1.y+u.y),c=new ll(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(l),this._segList.addPt(c)}},Dp.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Dp.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=Ll.intersection(e.p0,e.p1,n.p0,n.p1),(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof Al))throw t;o=new ll(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())},Dp.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),u=n.x-t.x,l=n.y-t.y,c=Math.atan2(l,u);r===ql.CLOCKWISE?a<=c&&(a+=2*Math.PI):a>=c&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,c,r,i),this._segList.addPt(n)},Dp.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Dp.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Cp.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Cp.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Dp.prototype.createSquare=function(t){this._segList.addPt(new ll(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new ll(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new ll(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new ll(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Dp.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Dp.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Dp.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Dp.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},Dp.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=Np.angle(i,this._seg0.p0),s=Np.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,a=Np.normalize(o+s),u=Np.normalize(a+Math.PI),l=r*n,c=n-l*Math.abs(Math.sin(s)),h=i.x+l*Math.cos(u),p=i.y+l*Math.sin(u),d=new ll(h,p),f=new vp(i,d),g=f.pointAlongOffset(1,c),m=f.pointAlongOffset(1,-c);this._side===Ch.LEFT?(this._segList.addPt(g),this._segList.addPt(m)):(this._segList.addPt(m),this._segList.addPt(g))},Dp.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===Ch.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),u=i*n*o/a,l=i*n*s/a;r.p0.x=t.p0.x-l,r.p0.y=t.p0.y+u,r.p1.x=t.p1.x-l,r.p1.y=t.p1.y+u},Dp.prototype.addFilletArc=function(t,e,n,r,i){var o=r===ql.CLOCKWISE?-1:1,s=Math.abs(e-n),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var u=s/a,l=0,c=new ll;l<s;){var h=e+o*l;c.x=t.x+i*Math.cos(h),c.y=t.y+i*Math.sin(h),this._segList.addPt(c),l+=u}},Dp.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Dp.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new ll((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new ll((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Dp.prototype.createCircle=function(t){var e=new ll(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Dp.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Dp.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ip,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Dp.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Dp.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Cp.JOIN_BEVEL||this._bufParams.getJoinStyle()===Cp.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,ql.CLOCKWISE,this._distance))},Dp.prototype.closeRing=function(){this._segList.closeRing()},Dp.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Dp.prototype.interfaces_=function(){return[]},Dp.prototype.getClass=function(){return Dp},Fp.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Fp.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Fp.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Fp.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Dp,Fp);var kp=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};kp.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&dc.reverse(o),o},kp.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=Pp.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ch.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{n.addSegments(t,!1);var a=Pp.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],Ch.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(a[l],!0)}n.addLastSegment(),n.closeRing()},kp.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===Ch.RIGHT&&(r=-r);var i=Pp.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var s=1;s<=o;s++){var a=1!==s;n.addNextSegment(i[s],a)}n.closeRing()},kp.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=Pp.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],Ch.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var s=Pp.simplify(t,-n),a=s.length-1;e.initSideSegments(s[a],s[a-1],Ch.LEFT);for(var u=a-2;u>=0;u--)e.addNextSegment(s[u],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},kp.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Cp.CAP_ROUND:e.createCircle(t);break;case Cp.CAP_SQUARE:e.createSquare(t)}},kp.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},kp.prototype.getBufferParameters=function(){return this._bufParams},kp.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},kp.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return kp.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},kp.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=Pp.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ch.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{var a=Pp.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],Ch.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(a[l],!0)}n.addLastSegment()},kp.prototype.getSegGen=function(t){return new Dp(this._precisionModel,this._bufParams,t)},kp.prototype.interfaces_=function(){return[]},kp.prototype.getClass=function(){return kp},kp.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new ll(t[n]);return e};var Bp=function(){this._subgraphs=null,this._seg=new vp,this._cga=new ql;var t=arguments[0];this._subgraphs=t},zp={DepthSegment:{configurable:!0}};Bp.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=new cc,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),o=i.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}if(3===arguments.length)if(gl(arguments[2],uc)&&arguments[0]instanceof ll&&arguments[1]instanceof qh)for(var s=arguments[0],a=arguments[1],u=arguments[2],l=a.getEdge().getCoordinates(),c=0;c<l.length-1;c++){t._seg.p0=l[c],t._seg.p1=l[c+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var h=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(h<s.x)&&!(t._seg.isHorizontal()||s.y<t._seg.p0.y||s.y>t._seg.p1.y||ql.computeOrientation(t._seg.p0,t._seg.p1,s)===ql.RIGHT)){var p=a.getDepth(Ch.LEFT);t._seg.p0.equals(l[c])||(p=a.getDepth(Ch.RIGHT));var d=new Gp(t._seg,p);u.add(d)}}else if(gl(arguments[2],uc)&&arguments[0]instanceof ll&&gl(arguments[1],uc))for(var f=arguments[0],g=arguments[1],m=arguments[2],y=g.iterator();y.hasNext();){var v=y.next();v.isForward()&&t.findStabbedSegments(f,v,m)}},Bp.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:rp.min(e)._leftDepth},Bp.prototype.interfaces_=function(){return[]},Bp.prototype.getClass=function(){return Bp},zp.DepthSegment.get=function(){return Gp},Object.defineProperties(Bp,zp);var Gp=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new vp(t),this._leftDepth=e};Gp.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n||0!==(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(e._upwardSeg)},Gp.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Gp.prototype.toString=function(){return this._upwardSeg.toString()},Gp.prototype.interfaces_=function(){return[ol]},Gp.prototype.getClass=function(){return Gp};var Up=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};Up.prototype.area=function(){return Up.area(this.p0,this.p1,this.p2)},Up.prototype.signedArea=function(){return Up.signedArea(this.p0,this.p1,this.p2)},Up.prototype.interpolateZ=function(t){if(null===t)throw new nl("Supplied point is null.");return Up.interpolateZ(t,this.p0,this.p1,this.p2)},Up.prototype.longestSideLength=function(){return Up.longestSideLength(this.p0,this.p1,this.p2)},Up.prototype.isAcute=function(){return Up.isAcute(this.p0,this.p1,this.p2)},Up.prototype.circumcentre=function(){return Up.circumcentre(this.p0,this.p1,this.p2)},Up.prototype.area3D=function(){return Up.area3D(this.p0,this.p1,this.p2)},Up.prototype.centroid=function(){return Up.centroid(this.p0,this.p1,this.p2)},Up.prototype.inCentre=function(){return Up.inCentre(this.p0,this.p1,this.p2)},Up.prototype.interfaces_=function(){return[]},Up.prototype.getClass=function(){return Up},Up.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},Up.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},Up.det=function(t,e,n,r){return t*r-e*n},Up.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,s=n.x-i,a=r.x-i,u=n.y-o,l=r.y-o,c=s*l-a*u,h=t.x-i,p=t.y-o,d=(l*h-a*p)/c,f=(-u*h+s*p)/c;return e.z+d*(n.z-e.z)+f*(r.z-e.z)},Up.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),s=r;return i>s&&(s=i),o>s&&(s=o),s},Up.isAcute=function(t,e,n){return!!Np.isAcute(t,e,n)&&!!Np.isAcute(e,n,t)&&!!Np.isAcute(n,t,e)},Up.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,s=t.y-i,a=e.x-r,u=e.y-i,l=2*Up.det(o,s,a,u),c=Up.det(s,o*o+s*s,u,a*a+u*u),h=Up.det(o,o*o+s*s,a,a*a+u*u);return new ll(r-c/l,i+h/l)},Up.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Ll(t.x+n/2,t.y+r/2,1),o=new Ll(t.x-r+n/2,t.y+n+r/2,1);return new Ll(i,o)},Up.angleBisector=function(t,e,n){var r=e.distance(t),i=r/(r+e.distance(n)),o=n.x-t.x,s=n.y-t.y;return new ll(t.x+i*o,t.y+i*s)},Up.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,s=n.x-t.x,a=n.y-t.y,u=n.z-t.z,l=i*u-o*a,c=o*s-r*u,h=r*a-i*s,p=l*l+c*c+h*h,d=Math.sqrt(p)/2;return d},Up.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new ll(r,i)},Up.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),s=r+i+o,a=(r*t.x+i*e.x+o*n.x)/s,u=(r*t.y+i*e.y+o*n.y)/s;return new ll(a,u)};var Vp=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new cc;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Vp.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,dl.EXTERIOR,dl.INTERIOR)},Vp.prototype.addPolygon=function(t){var e=this,n=this._distance,r=Ch.LEFT;this._distance<0&&(n=-this._distance,r=Ch.RIGHT);var i=t.getExteriorRing(),o=dc.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,n,r,dl.EXTERIOR,dl.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var a=t.getInteriorRingN(s),u=dc.removeRepeatedPoints(a.getCoordinates());e._distance>0&&e.isErodedCompletely(a,-e._distance)||e.addPolygonRing(u,n,Ch.opposite(r),dl.INTERIOR,dl.EXTERIOR)}},Vp.prototype.isTriangleErodedCompletely=function(t,e){var n=new Up(t[0],t[1],t[2]),r=n.inCentre();return ql.distancePointLine(r,n.p0,n.p1)<Math.abs(e)},Vp.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=dc.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,dl.EXTERIOR,dl.INTERIOR)},Vp.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var r=new yp(t,new Fh(0,dl.BOUNDARY,e,n));this._curveList.add(r)},Vp.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Vp.prototype.addPolygonRing=function(t,e,n,r,i){if(0===e&&t.length<rh.MINIMUM_VALID_SIZE)return null;var o=r,s=i;t.length>=rh.MINIMUM_VALID_SIZE&&ql.isCCW(t)&&(o=i,s=r,n=Ch.opposite(n));var a=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(a,o,s)},Vp.prototype.add=function(t){if(t.isEmpty())return null;t instanceof eh?this.addPolygon(t):t instanceof Jc?this.addLineString(t):t instanceof $c?this.addPoint(t):(t instanceof nh||t instanceof zc||t instanceof ih||t instanceof Bc)&&this.addCollection(t)},Vp.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i},Vp.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},Vp.prototype.interfaces_=function(){return[]},Vp.prototype.getClass=function(){return Vp};var Hp=function(){};Hp.prototype.locate=function(t){},Hp.prototype.interfaces_=function(){return[]},Hp.prototype.getClass=function(){return Hp};var jp=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};jp.prototype.next=function(){if(this._atStart)return this._atStart=!1,jp.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new lc;var t=this._parent.getGeometryN(this._index++);return t instanceof Bc?(this._subcollectionIterator=new jp(t),this._subcollectionIterator.next()):t},jp.prototype.remove=function(){throw new Error(this.getClass().getName())},jp.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},jp.prototype.interfaces_=function(){return[ac]},jp.prototype.getClass=function(){return jp},jp.isAtomic=function(t){return!(t instanceof Bc)};var Wp=function(){this._geom=null;var t=arguments[0];this._geom=t};Wp.prototype.locate=function(t){return Wp.locate(t,this._geom)},Wp.prototype.interfaces_=function(){return[Hp]},Wp.prototype.getClass=function(){return Wp},Wp.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&ql.isPointInRing(t,e.getCoordinates())},Wp.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!Wp.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(Wp.isPointInRing(t,i))return!1}return!0},Wp.containsPoint=function(t,e){if(e instanceof eh)return Wp.containsPointInPolygon(t,e);if(e instanceof Bc)for(var n=new jp(e);n.hasNext();){var r=n.next();if(r!==e&&Wp.containsPoint(t,r))return!0}return!1},Wp.locate=function(t,e){return e.isEmpty()?dl.EXTERIOR:Wp.containsPoint(t,e)?dl.INTERIOR:dl.EXTERIOR};var qp=function(){this._edgeMap=new Ac,this._edgeList=null,this._ptInAreaLocation=[dl.NONE,dl.NONE]};qp.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},qp.prototype.propagateSideLabels=function(t){for(var e=dl.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(t)&&r.getLocation(t,Ch.LEFT)!==dl.NONE&&(e=r.getLocation(t,Ch.LEFT))}if(e===dl.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Ch.ON)===dl.NONE&&a.setLocation(t,Ch.ON,i),a.isArea(t)){var u=a.getLocation(t,Ch.LEFT),l=a.getLocation(t,Ch.RIGHT);if(l!==dl.NONE){if(l!==i)throw new Rh("side location conflict",s.getCoordinate());u===dl.NONE&&Gl.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=u}else Gl.isTrue(a.getLocation(t,Ch.LEFT)===dl.NONE,"found single null side"),a.setLocation(t,Ch.RIGHT,i),a.setLocation(t,Ch.LEFT,i)}}},qp.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},qp.prototype.print=function(t){Pl.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},qp.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},qp.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel().getLocation(t,Ch.LEFT);Gl.isTrue(r!==dl.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();Gl.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Ch.LEFT),u=s.getLocation(t,Ch.RIGHT);if(a===u)return!1;if(u!==i)return!1;i=a}return!0},qp.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},qp.prototype.iterator=function(){return this.getEdges().iterator()},qp.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new cc(this._edgeMap.values())),this._edgeList},qp.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===dl.NONE&&(this._ptInAreaLocation[t]=Wp.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},qp.prototype.toString=function(){var t=new vl;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},qp.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},qp.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===dl.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),u=0;u<2;u++)if(a.isAnyNull(u)){var l=dl.NONE;if(e[u])l=dl.EXTERIOR;else{var c=s.getCoordinate();l=this.getLocation(u,c,t)}a.setAllLocationsIfNull(u,l)}},qp.prototype.getDegree=function(){return this._edgeMap.size()},qp.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},qp.prototype.interfaces_=function(){return[]},qp.prototype.getClass=function(){return qp};var Yp=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,n=null,r=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var o=t._resultAreaEdgeList.get(i),s=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),r){case t._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;n=s,r=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!o.isInResult())continue;n.setNext(o),r=t._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(null===e)throw new Rh("no outgoing dirEdge found",this.getCoordinate());Gl.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),n.setNext(e)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var r=t.get(e-1),i=n.getQuadrant(),o=r.getQuadrant();return Hh.isNorthern(i)&&Hh.isNorthern(o)?n:Hh.isNorthern(i)||Hh.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(Gl.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){Pl.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new cc;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=r}e.setNext(t)},e.prototype.computeDepths=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this.findIndex(e),r=e.getDepth(Ch.LEFT),i=e.getDepth(Ch.RIGHT),o=this.computeDepths(n+1,this._edgeList.size(),r),s=this.computeDepths(0,n,o);if(s!==i)throw new Rh("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var a=arguments[0],u=arguments[1],l=arguments[2],c=l,h=a;h<u;h++){var p=t._edgeList.get(h);p.setEdgeDepths(Ch.RIGHT,c),c=p.getDepth(Ch.LEFT)}return c}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,n=null,r=null,i=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var s=e._resultAreaEdgeList.get(o),a=s.getSym();switch(null===n&&s.getEdgeRing()===t&&(n=s),i){case e._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;r=a,i=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;r.setNextMin(s),i=e._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(Gl.isTrue(null!==n,"found null for first outgoing dirEdge"),Gl.isTrue(n.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(n))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var n=e.next();n.isInResult()&&t++}return t}if(1===arguments.length){for(var r=arguments[0],i=0,o=this.iterator();o.hasNext();){var s=o.next();s.getEdgeRing()===r&&i++}return i}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=dl.NONE,e=this.iterator();e.hasNext();){var n=e.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=dl.INTERIOR;break}if(r.isInResult()){t=dl.EXTERIOR;break}}}if(t===dl.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===dl.INTERIOR):(s.isInResult()&&(i=dl.EXTERIOR),a.isInResult()&&(i=dl.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Fh(dl.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),i=0;i<2;i++){var o=r.getLocation(i);o!==dl.INTERIOR&&o!==dl.BOUNDARY||this._label.setLocation(i,dl.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qp),Xp=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Uh(t,new Yp)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Yh),Zp=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Zp.prototype.compareTo=function(t){var e=t;return Zp.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Zp.prototype.interfaces_=function(){return[ol]},Zp.prototype.getClass=function(){return Zp},Zp.orientation=function(t){return 1===dc.increasingDirection(t)},Zp.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,s=e?t.length:-1,a=r?n.length:-1,u=e?0:t.length-1,l=r?0:n.length-1;;){var c=t[u].compareTo(n[l]);if(0!==c)return c;var h=(u+=i)===s,p=(l+=o)===a;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var Kp=function(){this._edges=new cc,this._ocaMap=new Ac};Kp.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var n=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&t.print(","),t.print(r[i].x+" "+r[i].y);t.println(")")}t.print(")  ")},Kp.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Kp.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Kp.prototype.iterator=function(){return this._edges.iterator()},Kp.prototype.getEdges=function(){return this._edges},Kp.prototype.get=function(t){return this._edges.get(t)},Kp.prototype.findEqualEdge=function(t){var e=new Zp(t.getCoordinates());return this._ocaMap.get(e)},Kp.prototype.add=function(t){this._edges.add(t);var e=new Zp(t.getCoordinates());this._ocaMap.put(e,t)},Kp.prototype.interfaces_=function(){return[]},Kp.prototype.getClass=function(){return Kp};var Jp=function(){};Jp.prototype.processIntersections=function(t,e,n,r){},Jp.prototype.isDone=function(){},Jp.prototype.interfaces_=function(){return[]},Jp.prototype.getClass=function(){return Jp};var Qp=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Qp.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(Qp.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},Qp.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Qp.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Qp.prototype.getLineIntersector=function(){return this._li},Qp.prototype.hasProperIntersection=function(){return this._hasProper},Qp.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Qp.prototype.hasIntersection=function(){return this._hasIntersection},Qp.prototype.isDone=function(){return!1},Qp.prototype.hasInteriorIntersection=function(){return this._hasInterior},Qp.prototype.interfaces_=function(){return[Jp]},Qp.prototype.getClass=function(){return Qp},Qp.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var $p=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new ll(t),this.segmentIndex=e,this.dist=n};$p.prototype.getSegmentIndex=function(){return this.segmentIndex},$p.prototype.getCoordinate=function(){return this.coord},$p.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},$p.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},$p.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},$p.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},$p.prototype.getDistance=function(){return this.dist},$p.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},$p.prototype.interfaces_=function(){return[ol]},$p.prototype.getClass=function(){return $p};var td=function(){this._nodeMap=new Ac,this.edge=null;var t=arguments[0];this.edge=t};td.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},td.prototype.iterator=function(){return this._nodeMap.values().iterator()},td.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},td.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},td.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new ll(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return i&&(o[s]=e.coord),new od(o,new Fh(this.edge._label))},td.prototype.add=function(t,e,n){var r=new $p(t,e,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},td.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},td.prototype.interfaces_=function(){return[]},td.prototype.getClass=function(){return td};var ed=function(){};ed.prototype.getChainStartIndices=function(t){var e=0,n=new cc;n.add(new xl(e));do{var r=this.findChainEnd(t,e);n.add(new xl(r)),e=r}while(e<t.length-1);return ed.toIntArray(n)},ed.prototype.findChainEnd=function(t,e){for(var n=Hh.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){if(Hh.quadrant(t[r-1],t[r])!==n)break;r++}return r-1},ed.prototype.interfaces_=function(){return[]},ed.prototype.getClass=function(){return ed},ed.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var nd=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Il,this.env2=new Il;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new ed;this.startIndex=e.getChainStartIndices(this.pts)};nd.prototype.getCoordinates=function(){return this.pts},nd.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},nd.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},nd.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=arguments[4],l=arguments[5],c=this.pts[i],h=this.pts[o],p=s.pts[a],d=s.pts[u];if(o-i==1&&u-a==1)return l.addIntersections(this.e,i,s.e,a),null;if(this.env1.init(c,h),this.env2.init(p,d),!this.env1.intersects(this.env2))return null;var f=Math.trunc((i+o)/2),g=Math.trunc((a+u)/2);i<f&&(a<g&&this.computeIntersectsForChain(i,f,s,a,g,l),g<u&&this.computeIntersectsForChain(i,f,s,g,u,l)),f<o&&(a<g&&this.computeIntersectsForChain(f,o,s,a,g,l),g<u&&this.computeIntersectsForChain(f,o,s,g,u,l))}},nd.prototype.getStartIndexes=function(){return this.startIndex},nd.prototype.computeIntersects=function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(n,t,r,e)},nd.prototype.interfaces_=function(){return[]},nd.prototype.getClass=function(){return nd};var rd=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._depth[e][n]=t.NULL_VALUE},id={NULL_VALUE:{configurable:!0}};rd.prototype.getDepth=function(t,e){return this._depth[t][e]},rd.prototype.setDepth=function(t,e,n){this._depth[t][e]=n},rd.prototype.isNull=function(){var t=this;if(0===arguments.length){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==rd.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===rd.NULL_VALUE}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._depth[i][o]===rd.NULL_VALUE}},rd.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}},rd.prototype.getDelta=function(t){return this._depth[t][Ch.RIGHT]-this._depth[t][Ch.LEFT]},rd.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?dl.EXTERIOR:dl.INTERIOR},rd.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},rd.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);i!==dl.EXTERIOR&&i!==dl.INTERIOR||(t.isNull(n,r)?t._depth[n][r]=rd.depthAtLocation(i):t._depth[n][r]+=rd.depthAtLocation(i))}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];a===dl.INTERIOR&&this._depth[o][s]++}},rd.prototype.interfaces_=function(){return[]},rd.prototype.getClass=function(){return rd},rd.depthAtLocation=function(t){return t===dl.EXTERIOR?0:t===dl.INTERIOR?1:rd.NULL_VALUE},id.NULL_VALUE.get=function(){return-1},Object.defineProperties(rd,id);var od=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new td(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new rd,this._depthDelta=0,1===arguments.length){var n=arguments[0];e.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Fh.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,i=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(r=!1),this.pts[s].equals2D(n.pts[--o])||(i=!1),!r&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new nd(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new Il;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,n,r){var i=new ll(t.getIntersection(r)),o=e,s=t.getEdgeDistance(n,r),a=o+1;if(a<this.pts.length){var u=this.pts[a];i.equals2D(u)&&(o=a,s=0)}this.eiList.add(i,o,s)},e.prototype.toString=function(){var t=new vl;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,Ch.ON),e.getLocation(1,Ch.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,Ch.LEFT),e.getLocation(1,Ch.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,Ch.RIGHT),e.getLocation(1,Ch.RIGHT),2))},e}(Gh),sd=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Kp,this._bufParams=t||null};sd.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},sd.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new Fh(t.getLabel())).flip(),n.merge(r);var i=sd.depthDelta(r),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(sd.depthDelta(t.getLabel()))},sd.prototype.buildSubgraphs=function(t,e){for(var n=new cc,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),s=new Bp(n).getDepth(o);i.computeDepth(s),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},sd.prototype.createSubgraphs=function(t){for(var e=new cc,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Oh;i.create(r),e.add(i)}}return rp.sort(e,rp.reverseOrder()),e},sd.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},sd.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new Sp,n=new Hl;return n.setPrecisionModel(t),e.setSegmentIntersector(new Qp(n)),e},sd.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new kp(n,this._bufParams),i=new Vp(t,e,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Xh(new Xp),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new Zh(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},sd.prototype.computeNodedEdges=function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=i.getData(),a=new od(i.getCoordinates(),new Fh(s));this.insertUniqueEdge(a)}}},sd.prototype.setNoder=function(t){this._workingNoder=t},sd.prototype.interfaces_=function(){return[]},sd.prototype.getClass=function(){return sd},sd.depthDelta=function(t){var e=t.getLocation(0,Ch.LEFT),n=t.getLocation(0,Ch.RIGHT);return e===dl.INTERIOR&&n===dl.EXTERIOR?1:e===dl.EXTERIOR&&n===dl.INTERIOR?-1:0},sd.convertSegStrings=function(t){for(var e=new xh,n=new cc;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var ad=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};ad.prototype.rescale=function(){var t=this;if(gl(arguments[0],oc))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],o=0;o<i.length;o++)i[o].x=i[o].x/t._scaleFactor+t._offsetX,i[o].y=i[o].y/t._scaleFactor+t._offsetY;2===i.length&&i[0].equals2D(i[1])&&Pl.out.println(i)}},ad.prototype.scale=function(){var t=this;if(gl(arguments[0],oc)){for(var e=arguments[0],n=new cc,r=e.iterator();r.hasNext();){var i=r.next();n.add(new yp(t.scale(i.getCoordinates()),i.getData()))}return n}if(arguments[0]instanceof Array){for(var o=arguments[0],s=new Array(o.length).fill(null),a=0;a<o.length;a++)s[a]=new ll(Math.round((o[a].x-t._offsetX)*t._scaleFactor),Math.round((o[a].y-t._offsetY)*t._scaleFactor),o[a].z);var u=dc.removeRepeatedPoints(s);return u}},ad.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},ad.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},ad.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},ad.prototype.interfaces_=function(){return[Mp]},ad.prototype.getClass=function(){return ad};var ud=function(){this._li=new Hl,this._segStrings=null;var t=arguments[0];this._segStrings=t},ld={fact:{configurable:!0}};ud.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=o.iterator();s.hasNext();)for(var a=s.next(),u=a.getCoordinates(),l=1;l<u.length-1;l++)if(u[l].equals(i))throw new Bl("found endpt/interior pt intersection at index "+l+" :pt "+i)},ud.prototype.checkInteriorIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(2===arguments.length)for(var o=arguments[0],s=arguments[1],a=o.getCoordinates(),u=s.getCoordinates(),l=0;l<a.length-1;l++)for(var c=0;c<u.length-1;c++)t.checkInteriorIntersections(o,l,s,c);else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3];if(h===d&&p===f)return null;var g=h.getCoordinates()[p],m=h.getCoordinates()[p+1],y=d.getCoordinates()[f],v=d.getCoordinates()[f+1];if(this._li.computeIntersection(g,m,y,v),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,g,m)||this.hasInteriorIntersection(this._li,y,v)))throw new Bl("found non-noded intersection at "+g+"-"+m+" and "+y+"-"+v)}},ud.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},ud.prototype.checkCollapses=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(1===arguments.length)for(var r=arguments[0],i=r.getCoordinates(),o=0;o<i.length-2;o++)t.checkCollapse(i[o],i[o+1],i[o+2])},ud.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!i.equals(e)&&!i.equals(n))return!0}return!1},ud.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new Bl("found non-noded collapse at "+ud.fact.createLineString([t,e,n]))},ud.prototype.interfaces_=function(){return[]},ud.prototype.getClass=function(){return ud},ld.fact.get=function(){return new xh},Object.defineProperties(ud,ld);var cd=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new nl("Scale factor must be non-zero");1!==e&&(this._pt=new ll(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new ll,this._p1Scaled=new ll),this.initCorners(this._pt)},hd={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};cd.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return Gl.isTrue(!(s&&a),"Found bad envelope test"),a},cd.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new ll(this._maxx,this._maxy),this._corner[1]=new ll(this._minx,this._maxy),this._corner[2]=new ll(this._minx,this._miny),this._corner[3]=new ll(this._maxx,this._miny)},cd.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},cd.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},cd.prototype.getCoordinate=function(){return this._originalPt},cd.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},cd.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=cd.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Il(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},cd.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},cd.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!n||!r)||!!t.equals(this._pt)||!!e.equals(this._pt))))},cd.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(n,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},cd.prototype.interfaces_=function(){return[]},cd.prototype.getClass=function(){return cd},hd.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(cd,hd);var pd=function(){this.tempEnv1=new Il,this.selectedSegment=new vp};pd.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},pd.prototype.interfaces_=function(){return[]},pd.prototype.getClass=function(){return pd};var dd=function(){this._index=null;var t=arguments[0];this._index=t},fd={HotPixelSnapAction:{configurable:!0}};dd.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new gd(e,n,r);return this._index.query(i,{interfaces_:function(){return[$h]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},dd.prototype.interfaces_=function(){return[]},dd.prototype.getClass=function(){return dd},fd.HotPixelSnapAction.get=function(){return gd},Object.defineProperties(dd,fd);var gd=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=n,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],n=arguments[1],r=e.getContext();if(null!==this._parentEdge&&r===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pd),md=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new cc};md.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}},md.prototype.isDone=function(){return!1},md.prototype.getInteriorIntersections=function(){return this._interiorIntersections},md.prototype.interfaces_=function(){return[Jp]},md.prototype.getClass=function(){return md};var yd=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Hl,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};yd.prototype.checkCorrectness=function(t){var e=yp.getNodedSubstrings(t),n=new ud(e);try{n.checkValid()}catch(t){if(!(t instanceof Cl))throw t;t.printStackTrace()}},yd.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},yd.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},yd.prototype.findInteriorIntersections=function(t,e){var n=new md(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},yd.prototype.computeVertexSnaps=function(){var t=this;if(gl(arguments[0],oc))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof yp)for(var i=arguments[0],o=i.getCoordinates(),s=0;s<o.length;s++){var a=new cd(o[s],t._scaleFactor,t._li),u=t._pointSnapper.snap(a,i,s);u&&i.addIntersection(o[s],s)}},yd.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Sp,this._pointSnapper=new dd(this._noder.getIndex()),this.snapRound(t,this._li)},yd.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new cd(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}},yd.prototype.interfaces_=function(){return[Mp]},yd.prototype.getClass=function(){return yd};var vd=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Cp,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},xd={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};vd.prototype.bufferFixedPrecision=function(t){var e=new ad(new yd(new gh(1)),t.getScale()),n=new sd(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},vd.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=vd.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Rh))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=vd.precisionScaleFactor(this._argGeom,this._distance,n),i=new gh(r);this.bufferFixedPrecision(i)}},vd.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===gh.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},vd.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},vd.prototype.bufferOriginalPrecision=function(){try{var t=new sd(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Bl))throw t;this._saveException=t}},vd.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},vd.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},vd.prototype.interfaces_=function(){return[]},vd.prototype.getClass=function(){return vd},vd.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new vd(t),r=n.getResultGeometry(e);return r}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Zl&&"number"==typeof arguments[1]){var i=arguments[0],o=arguments[1],s=arguments[2],a=new vd(i);a.setQuadrantSegments(s);var u=a.getResultGeometry(o);return u}if(arguments[2]instanceof Cp&&arguments[0]instanceof Zl&&"number"==typeof arguments[1]){var l=arguments[0],c=arguments[1],h=arguments[2],p=new vd(l,h),d=p.getResultGeometry(c);return d}}else if(4===arguments.length){var f=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],v=new vd(f);v.setQuadrantSegments(m),v.setEndCapStyle(y);var x=v.getResultGeometry(g);return x}},vd.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=ml.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},xd.CAP_ROUND.get=function(){return Cp.CAP_ROUND},xd.CAP_BUTT.get=function(){return Cp.CAP_FLAT},xd.CAP_FLAT.get=function(){return Cp.CAP_FLAT},xd.CAP_SQUARE.get=function(){return Cp.CAP_SQUARE},xd.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(vd,xd);var _d=function(){this._pt=[new ll,new ll],this._distance=rl.NaN,this._isNull=!0};_d.prototype.getCoordinates=function(){return this._pt},_d.prototype.getCoordinate=function(t){return this._pt[t]},_d.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},_d.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},_d.prototype.getDistance=function(){return this._distance},_d.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},_d.prototype.interfaces_=function(){return[]},_d.prototype.getClass=function(){return _d};var bd=function(){};bd.prototype.interfaces_=function(){return[]},bd.prototype.getClass=function(){return bd},bd.computeDistance=function(){if(arguments[2]instanceof _d&&arguments[0]instanceof Jc&&arguments[1]instanceof ll)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new vp,o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var s=i.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof _d&&arguments[0]instanceof eh&&arguments[1]instanceof ll){var a=arguments[0],u=arguments[1],l=arguments[2];bd.computeDistance(a.getExteriorRing(),u,l);for(var c=0;c<a.getNumInteriorRing();c++)bd.computeDistance(a.getInteriorRingN(c),u,l)}else if(arguments[2]instanceof _d&&arguments[0]instanceof Zl&&arguments[1]instanceof ll){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Jc)bd.computeDistance(h,p,d);else if(h instanceof eh)bd.computeDistance(h,p,d);else if(h instanceof Bc)for(var f=h,g=0;g<f.getNumGeometries();g++){var m=f.getGeometryN(g);bd.computeDistance(m,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof _d&&arguments[0]instanceof vp&&arguments[1]instanceof ll){var y=arguments[0],v=arguments[1],x=arguments[2],_=y.closestPoint(v);x.setMinimum(_,v)}};var wd=function(t){this._maxPtDist=new _d,this._inputGeom=t||null},Md={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};wd.prototype.computeMaxMidpointDistance=function(t){var e=new Sd(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},wd.prototype.computeMaxVertexDistance=function(t){var e=new Ed(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},wd.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},wd.prototype.getDistancePoints=function(){return this._maxPtDist},wd.prototype.interfaces_=function(){return[]},wd.prototype.getClass=function(){return wd},Md.MaxPointDistanceFilter.get=function(){return Ed},Md.MaxMidpointDistanceFilter.get=function(){return Sd},Object.defineProperties(wd,Md);var Ed=function(t){this._maxPtDist=new _d,this._minPtDist=new _d,this._geom=t||null};Ed.prototype.filter=function(t){this._minPtDist.initialize(),bd.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ed.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ed.prototype.interfaces_=function(){return[Ql]},Ed.prototype.getClass=function(){return Ed};var Sd=function(t){this._maxPtDist=new _d,this._minPtDist=new _d,this._geom=t||null};Sd.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new ll((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),bd.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Sd.prototype.isDone=function(){return!1},Sd.prototype.isGeometryChanged=function(){return!1},Sd.prototype.getMaxPointDistance=function(){return this._maxPtDist},Sd.prototype.interfaces_=function(){return[kc]},Sd.prototype.getClass=function(){return Sd};var Td=function(t){this._comps=t||null};Td.prototype.filter=function(t){t instanceof eh&&this._comps.add(t)},Td.prototype.interfaces_=function(){return[Fc]},Td.prototype.getClass=function(){return Td},Td.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Td.getPolygons(t,new cc)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof eh?n.add(e):e instanceof Bc&&e.apply(new Td(n)),n}};var Cd=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Cd.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof rh){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Jc&&this._lines.add(t)},Cd.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Cd.prototype.interfaces_=function(){return[Xl]},Cd.prototype.getClass=function(){return Cd},Cd.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Cd.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Cd.getLines(e,n))}},Cd.getLines=function(){if(1===arguments.length){var t=arguments[0];return Cd.getLines(t,!1)}if(2===arguments.length){if(gl(arguments[0],oc)&&gl(arguments[1],oc)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();Cd.getLines(i,n)}return n}if(arguments[0]instanceof Zl&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new cc;return o.apply(new Cd(a,s)),a}if(arguments[0]instanceof Zl&&gl(arguments[1],oc)){var u=arguments[0],l=arguments[1];return u instanceof Jc?l.add(u):u.apply(new Cd(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&gl(arguments[0],oc)&&gl(arguments[1],oc)){for(var c=arguments[0],h=arguments[1],p=arguments[2],d=c.iterator();d.hasNext();){var f=d.next();Cd.getLines(f,h,p)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Zl&&gl(arguments[1],oc)){var g=arguments[0],m=arguments[1],y=arguments[2];return g.apply(new Cd(m,y)),m}}};var Ad=function(){if(this._boundaryRule=$l.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new nl("Rule must be non-null");this._boundaryRule=t}};Ad.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof ll&&arguments[1]instanceof eh){var e=arguments[0],n=arguments[1];if(n.isEmpty())return dl.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===dl.EXTERIOR)return dl.EXTERIOR;if(i===dl.BOUNDARY)return dl.BOUNDARY;for(var o=0;o<n.getNumInteriorRing();o++){var s=n.getInteriorRingN(o),a=t.locateInPolygonRing(e,s);if(a===dl.INTERIOR)return dl.EXTERIOR;if(a===dl.BOUNDARY)return dl.BOUNDARY}return dl.INTERIOR}if(arguments[0]instanceof ll&&arguments[1]instanceof Jc){var u=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(u))return dl.EXTERIOR;var c=l.getCoordinates();return l.isClosed()||!u.equals(c[0])&&!u.equals(c[c.length-1])?ql.isOnLine(u,c)?dl.INTERIOR:dl.EXTERIOR:dl.BOUNDARY}if(arguments[0]instanceof ll&&arguments[1]instanceof $c){var h=arguments[0],p=arguments[1],d=p.getCoordinate();return d.equals2D(h)?dl.INTERIOR:dl.EXTERIOR}},Ad.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?ql.locatePointInRing(t,e.getCoordinates()):dl.EXTERIOR},Ad.prototype.intersects=function(t,e){return this.locate(t,e)!==dl.EXTERIOR},Ad.prototype.updateLocationInfo=function(t){t===dl.INTERIOR&&(this._isIn=!0),t===dl.BOUNDARY&&this._numBoundaries++},Ad.prototype.computeLocation=function(t,e){var n=this;if(e instanceof $c&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Jc)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof eh)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof zc)for(var r=e,i=0;i<r.getNumGeometries();i++){var o=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,o))}else if(e instanceof ih)for(var s=e,a=0;a<s.getNumGeometries();a++){var u=s.getGeometryN(a);n.updateLocationInfo(n.locateInternal(t,u))}else if(e instanceof Bc)for(var l=new jp(e);l.hasNext();){var c=l.next();c!==e&&n.computeLocation(t,c)}},Ad.prototype.locate=function(t,e){return e.isEmpty()?dl.EXTERIOR:e instanceof Jc||e instanceof eh?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?dl.BOUNDARY:this._numBoundaries>0||this._isIn?dl.INTERIOR:dl.EXTERIOR)},Ad.prototype.interfaces_=function(){return[]},Ad.prototype.getClass=function(){return Ad};var Pd=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},Ld={INSIDE_AREA:{configurable:!0}};Pd.prototype.isInsideArea=function(){return this._segIndex===Pd.INSIDE_AREA},Pd.prototype.getCoordinate=function(){return this._pt},Pd.prototype.getGeometryComponent=function(){return this._component},Pd.prototype.getSegmentIndex=function(){return this._segIndex},Pd.prototype.interfaces_=function(){return[]},Pd.prototype.getClass=function(){return Pd},Ld.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Pd,Ld);var Id=function(t){this._pts=t||null};Id.prototype.filter=function(t){t instanceof $c&&this._pts.add(t)},Id.prototype.interfaces_=function(){return[Fc]},Id.prototype.getClass=function(){return Id},Id.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof $c?rp.singletonList(t):Id.getPoints(t,new cc)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof $c?n.add(e):e instanceof Bc&&e.apply(new Id(n)),n}};var Rd=function(){this._locations=null;var t=arguments[0];this._locations=t};Rd.prototype.filter=function(t){(t instanceof $c||t instanceof Jc||t instanceof eh)&&this._locations.add(new Pd(t,0,t.getCoordinate()))},Rd.prototype.interfaces_=function(){return[Fc]},Rd.prototype.getClass=function(){return Rd},Rd.getLocations=function(t){var e=new cc;return t.apply(new Rd(e)),e};var Nd=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ad,this._minDistanceLocation=null,this._minDistance=rl.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Nd.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=1-n,o=Td.getPolygons(this._geom[n]);if(o.size()>0){var s=Rd.getLocations(this._geom[i]);if(this.computeContainmentDistance(s,o,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&gl(arguments[0],uc)&&gl(arguments[1],uc)){for(var a=arguments[0],u=arguments[1],l=arguments[2],c=0;c<a.size();c++)for(var h=a.get(c),p=0;p<u.size();p++)if(t.computeContainmentDistance(h,u.get(p),l),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Pd&&arguments[1]instanceof eh){var d=arguments[0],f=arguments[1],g=arguments[2],m=d.getCoordinate();if(dl.EXTERIOR!==this._ptLocator.locate(m,f))return this._minDistance=0,g[0]=d,g[1]=new Pd(f,m),null}},Nd.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(r.computeMinDistance(o,a,n),r._minDistance<=r._terminateDistance)return null}},Nd.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Cd.getLines(this._geom[0]),n=Cd.getLines(this._geom[1]),r=Id.getPoints(this._geom[0]),i=Id.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),void this.updateMinDistance(t,!1))))},Nd.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Nd.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Nd.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Nd.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof $c){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),o=n.getCoordinate(),s=0;s<i.length-1;s++){var a=ql.distancePointLine(o,i[s],i[s+1]);if(a<t._minDistance){t._minDistance=a;var u=new vp(i[s],i[s+1]),l=u.closestPoint(o);r[0]=new Pd(e,s,l),r[1]=new Pd(n,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof Jc){var c=arguments[0],h=arguments[1],p=arguments[2];if(c.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var d=c.getCoordinates(),f=h.getCoordinates(),g=0;g<d.length-1;g++)for(var m=0;m<f.length-1;m++){var y=ql.distanceLineLine(d[g],d[g+1],f[m],f[m+1]);if(y<t._minDistance){t._minDistance=y;var v=new vp(d[g],d[g+1]),x=new vp(f[m],f[m+1]),_=v.closestPoints(x);p[0]=new Pd(c,g,_[0]),p[1]=new Pd(h,m,_[1])}if(t._minDistance<=t._terminateDistance)return null}}},Nd.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s),u=o.getCoordinate().distance(a.getCoordinate());if(u<r._minDistance&&(r._minDistance=u,n[0]=new Pd(o,0,o.getCoordinate()),n[1]=new Pd(a,0,a.getCoordinate())),r._minDistance<=r._terminateDistance)return null}},Nd.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new nl("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Nd.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),s=0;s<e.size();s++){var a=e.get(s);if(r.computeMinDistance(o,a,n),r._minDistance<=r._terminateDistance)return null}},Nd.prototype.interfaces_=function(){return[]},Nd.prototype.getClass=function(){return Nd},Nd.distance=function(t,e){return new Nd(t,e).distance()},Nd.isWithinDistance=function(t,e,n){return new Nd(t,e,n).distance()<=n},Nd.nearestPoints=function(t,e){return new Nd(t,e).nearestPoints()};var Od=function(){this._pt=[new ll,new ll],this._distance=rl.NaN,this._isNull=!0};Od.prototype.getCoordinates=function(){return this._pt},Od.prototype.getCoordinate=function(t){return this._pt[t]},Od.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},Od.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},Od.prototype.toString=function(){return kl.toLineString(this._pt[0],this._pt[1])},Od.prototype.getDistance=function(){return this._distance},Od.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},Od.prototype.interfaces_=function(){return[]},Od.prototype.getClass=function(){return Od};var Dd=function(){};Dd.prototype.interfaces_=function(){return[]},Dd.prototype.getClass=function(){return Dd},Dd.computeDistance=function(){if(arguments[2]instanceof Od&&arguments[0]instanceof Jc&&arguments[1]instanceof ll)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new vp,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var s=r.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof Od&&arguments[0]instanceof eh&&arguments[1]instanceof ll){var a=arguments[0],u=arguments[1],l=arguments[2];Dd.computeDistance(a.getExteriorRing(),u,l);for(var c=0;c<a.getNumInteriorRing();c++)Dd.computeDistance(a.getInteriorRingN(c),u,l)}else if(arguments[2]instanceof Od&&arguments[0]instanceof Zl&&arguments[1]instanceof ll){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Jc)Dd.computeDistance(h,p,d);else if(h instanceof eh)Dd.computeDistance(h,p,d);else if(h instanceof Bc)for(var f=h,g=0;g<f.getNumGeometries();g++){var m=f.getGeometryN(g);Dd.computeDistance(m,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Od&&arguments[0]instanceof vp&&arguments[1]instanceof ll){var y=arguments[0],v=arguments[1],x=arguments[2],_=y.closestPoint(v);x.setMinimum(_,v)}};var Fd=function(){this._g0=null,this._g1=null,this._ptDist=new Od,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},kd={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Fd.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Fd.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new nl("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Fd.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Fd.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Fd.prototype.computeOrientedDistance=function(t,e,n){var r=new Bd(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new zd(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}},Fd.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Fd.prototype.interfaces_=function(){return[]},Fd.prototype.getClass=function(){return Fd},Fd.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new Fd(t,e);return n.distance()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=new Fd(r,i);return s.setDensifyFraction(o),s.distance()}},kd.MaxPointDistanceFilter.get=function(){return Bd},kd.MaxDensifiedByFractionDistanceFilter.get=function(){return zd},Object.defineProperties(Fd,kd);var Bd=function(){this._maxPtDist=new Od,this._minPtDist=new Od,this._euclideanDist=new Dd,this._geom=null;var t=arguments[0];this._geom=t};Bd.prototype.filter=function(t){this._minPtDist.initialize(),Dd.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Bd.prototype.getMaxPointDistance=function(){return this._maxPtDist},Bd.prototype.interfaces_=function(){return[Ql]},Bd.prototype.getClass=function(){return Bd};var zd=function(){this._maxPtDist=new Od,this._minPtDist=new Od,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};zd.prototype.filter=function(t,e){var n=this;if(0===e)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),o=(i.x-r.x)/this._numSubSegs,s=(i.y-r.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var u=r.x+a*o,l=r.y+a*s,c=new ll(u,l);n._minPtDist.initialize(),Dd.computeDistance(n._geom,c,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}},zd.prototype.isDone=function(){return!1},zd.prototype.isGeometryChanged=function(){return!1},zd.prototype.getMaxPointDistance=function(){return this._maxPtDist},zd.prototype.interfaces_=function(){return[kc]},zd.prototype.getClass=function(){return zd};var Gd=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},Ud={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Gd.prototype.checkMaximumDistance=function(t,e,n){var r=new Fd(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+kl.toLineString(i[0],i[1])+")"}},Gd.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Gd.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Gd.VERBOSE&&Pl.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Gd.prototype.checkNegativeValid=function(){if(!(this._input instanceof eh||this._input instanceof ih||this._input instanceof Bc))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Gd.prototype.getErrorIndicator=function(){return this._errorIndicator},Gd.prototype.checkMinimumDistance=function(t,e,n){var r=new Nd(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+kl.toLineString(i[0],i[1])+" )"}},Gd.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Gd.prototype.getErrorLocation=function(){return this._errorLocation},Gd.prototype.getPolygonLines=function(t){for(var e=new cc,n=new Cd(e),r=Td.getPolygons(t).iterator();r.hasNext();)r.next().apply(n);return t.getFactory().buildGeometry(e)},Gd.prototype.getErrorMessage=function(){return this._errMsg},Gd.prototype.interfaces_=function(){return[]},Gd.prototype.getClass=function(){return Gd},Ud.VERBOSE.get=function(){return!1},Ud.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Gd,Ud);var Vd=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},Hd={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Vd.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Vd.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Vd.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Il(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Il(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},Vd.prototype.checkDistance=function(){var t=new Gd(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Vd.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Vd.prototype.checkPolygonal=function(){this._result instanceof eh||this._result instanceof ih||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Vd.prototype.getErrorIndicator=function(){return this._errorIndicator},Vd.prototype.getErrorLocation=function(){return this._errorLocation},Vd.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Vd.prototype.report=function(t){if(!Vd.VERBOSE)return null;Pl.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Vd.prototype.getErrorMessage=function(){return this._errorMsg},Vd.prototype.interfaces_=function(){return[]},Vd.prototype.getClass=function(){return Vd},Vd.isValidMsg=function(t,e,n){var r=new Vd(t,e,n);return r.isValid()?null:r.getErrorMessage()},Vd.isValid=function(t,e,n){return!!new Vd(t,e,n).isValid()},Hd.VERBOSE.get=function(){return!1},Hd.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Vd,Hd);var jd=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};jd.prototype.getCoordinates=function(){return this._pts},jd.prototype.size=function(){return this._pts.length},jd.prototype.getCoordinate=function(t){return this._pts[t]},jd.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},jd.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:fp.octant(this.getCoordinate(t),this.getCoordinate(t+1))},jd.prototype.setData=function(t){this._data=t},jd.prototype.getData=function(){return this._data},jd.prototype.toString=function(){return kl.toLineString(new ch(this._pts))},jd.prototype.interfaces_=function(){return[gp]},jd.prototype.getClass=function(){return jd};var Wd=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new cc,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Wd.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Wd.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Wd.prototype.getIntersectionSegments=function(){return this._intSegments},Wd.prototype.count=function(){return this._intersectionCount},Wd.prototype.getIntersections=function(){return this._intersections},Wd.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Wd.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Wd.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,r))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Wd.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Wd.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Wd.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Wd.prototype.interfaces_=function(){return[Jp]},Wd.prototype.getClass=function(){return Wd},Wd.createAllIntersectionsFinder=function(t){var e=new Wd(t);return e.setFindAllIntersections(!0),e},Wd.createAnyIntersectionFinder=function(t){return new Wd(t)},Wd.createIntersectionCounter=function(t){var e=new Wd(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var qd=function(){this._li=new Hl,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};qd.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},qd.prototype.getIntersections=function(){return this._segInt.getIntersections()},qd.prototype.isValid=function(){return this.execute(),this._isValid},qd.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},qd.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Wd(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Sp;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},qd.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Rh(this.getErrorMessage(),this._segInt.getInteriorIntersection())},qd.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+kl.toLineString(t[0],t[1])+" and "+kl.toLineString(t[2],t[3])},qd.prototype.interfaces_=function(){return[]},qd.prototype.getClass=function(){return qd},qd.computeIntersections=function(t){var e=new qd(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Yd=function t(){this._nv=null;var e=arguments[0];this._nv=new qd(t.toSegmentStrings(e))};Yd.prototype.checkValid=function(){this._nv.checkValid()},Yd.prototype.interfaces_=function(){return[]},Yd.prototype.getClass=function(){return Yd},Yd.toSegmentStrings=function(t){for(var e=new cc,n=t.iterator();n.hasNext();){var r=n.next();e.add(new jd(r.getCoordinates(),r))}return e},Yd.checkValid=function(t){new Yd(t).checkValid()};var Xd=function(t){this._mapOp=t};Xd.prototype.map=function(t){for(var e=new cc,n=0;n<t.getNumGeometries();n++){var r=this._mapOp.map(t.getGeometryN(n));r.isEmpty()||e.add(r)}return t.getFactory().createGeometryCollection(xh.toGeometryArray(e))},Xd.prototype.interfaces_=function(){return[]},Xd.prototype.getClass=function(){return Xd},Xd.map=function(t,e){return new Xd(e).map(t)};var Zd=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new cc,this._resultLineList=new cc;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};Zd.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}},Zd.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},Zd.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Zd.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Lf.isResultOfOp(r,e)||i.isCovered()||(n.add(i),t.setVisitedEdge(!0)))},Zd.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),r=n.getEdge();if(n.isLineEdge()&&!r.isCoveredSet()){var i=this._op.isCoveredByA(n.getCoordinate());r.setCovered(i)}}},Zd.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Zd.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var n=e.next(),r=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(r),n.setInResult(!0)}},Zd.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(Gl.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Lf.isResultOfOp(r,e)&&e===Lf.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},Zd.prototype.interfaces_=function(){return[]},Zd.prototype.getClass=function(){return Zd};var Kd=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new cc;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Kd.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},Kd.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(0===n.getEdges().getDegree()||t===Lf.INTERSECTION)){var r=n.getLabel();Lf.isResultOfOp(r,t)&&this.filterCoveredNodeToPoint(n)}}},Kd.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Kd.prototype.interfaces_=function(){return[]},Kd.prototype.getClass=function(){return Kd};var Jd=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Jd.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Jd.prototype.transformPolygon=function(t,e){var n=!0,r=this.transformLinearRing(t.getExteriorRing(),t);null!==r&&r instanceof rh&&!r.isEmpty()||(n=!1);for(var i=new cc,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof rh||(n=!1),i.add(s))}if(n)return this._factory.createPolygon(r,i.toArray([]));var a=new cc;return null!==r&&a.add(r),a.addAll(i),this._factory.buildGeometry(a)},Jd.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Jd.prototype.getInputGeometry=function(){return this._inputGeom},Jd.prototype.transformMultiLineString=function(t,e){for(var n=new cc,r=0;r<t.getNumGeometries();r++){var i=this.transformLineString(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.transformCoordinates=function(t,e){return this.copy(t)},Jd.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Jd.prototype.transformMultiPoint=function(t,e){for(var n=new cc,r=0;r<t.getNumGeometries();r++){var i=this.transformPoint(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.transformMultiPolygon=function(t,e){for(var n=new cc,r=0;r<t.getNumGeometries();r++){var i=this.transformPolygon(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.copy=function(t){return t.copy()},Jd.prototype.transformGeometryCollection=function(t,e){for(var n=new cc,r=0;r<t.getNumGeometries();r++){var i=this.transform(t.getGeometryN(r));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||n.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(xh.toGeometryArray(n)):this._factory.buildGeometry(n)},Jd.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof $c)return this.transformPoint(t,null);if(t instanceof nh)return this.transformMultiPoint(t,null);if(t instanceof rh)return this.transformLinearRing(t,null);if(t instanceof Jc)return this.transformLineString(t,null);if(t instanceof zc)return this.transformMultiLineString(t,null);if(t instanceof eh)return this.transformPolygon(t,null);if(t instanceof ih)return this.transformMultiPolygon(t,null);if(t instanceof Bc)return this.transformGeometryCollection(t,null);throw new nl("Unknown Geometry subtype: "+t.getClass().getName())},Jd.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},Jd.prototype.interfaces_=function(){return[]},Jd.prototype.getClass=function(){return Jd};var Qd=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new vp,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Jc&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Qd.prototype.snapVertices=function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),r=0;r<n;r++){var i=t.get(r),o=this.findSnapForVertex(i,e);null!==o&&(t.set(r,new ll(o)),0===r&&this._isClosed&&t.set(t.size()-1,new ll(o)))}},Qd.prototype.findSnapForVertex=function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null},Qd.prototype.snapTo=function(t){var e=new pc(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Qd.prototype.snapSegments=function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var r=0;r<n;r++){var i=e[r],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new ll(i),!1)}},Qd.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=rl.MAX_VALUE,i=-1,o=0;o<e.size()-1;o++){if(n._seg.p0=e.get(o),n._seg.p1=e.get(o+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var s=n._seg.distance(t);s<n._snapTolerance&&s<r&&(r=s,i=o)}return i},Qd.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Qd.prototype.interfaces_=function(){return[]},Qd.prototype.getClass=function(){return Qd},Qd.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var $d=function(t){this._srcGeom=t||null},tf={SNAP_PRECISION_FACTOR:{configurable:!0}};$d.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new ef(e,n).transform(this._srcGeom)},$d.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new ef(t,n,!0).transform(this._srcGeom),i=r;return e&&gl(i,th)&&(i=r.buffer(0)),i},$d.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},$d.prototype.extractTargetCoordinates=function(t){for(var e=new Ic,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))},$d.prototype.computeMinimumSegmentLength=function(t){for(var e=rl.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},$d.prototype.interfaces_=function(){return[]},$d.prototype.getClass=function(){return $d},$d.snap=function(t,e,n){var r=new Array(2).fill(null),i=new $d(t);r[0]=i.snapTo(e,n);var o=new $d(e);return r[1]=o.snapTo(r[0],n),r},$d.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=$d.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===gh.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min($d.computeOverlaySnapTolerance(i),$d.computeOverlaySnapTolerance(o))}},$d.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*$d.SNAP_PRECISION_FACTOR},$d.snapToSelf=function(t,e,n){return new $d(t).snapToSelf(e,n)},tf.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties($d,tf);var ef=function(t){function e(e,n,r){t.call(this),this._snapTolerance=e||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var n=new Qd(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Jd),nf=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};nf.prototype.getCommon=function(){return rl.longBitsToDouble(this._commonBits)},nf.prototype.add=function(t){var e=rl.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=nf.signExpBits(this._commonBits),this._isFirst=!1,null):nf.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=nf.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=nf.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},nf.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=rl.longBitsToDouble(t),n=rl.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),o=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return o}},nf.prototype.interfaces_=function(){return[]},nf.prototype.getClass=function(){return nf},nf.getBit=function(t,e){return 0!=(t&1<<e)?1:0},nf.signExpBits=function(t){return t>>52},nf.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},nf.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(nf.getBit(t,r)!==nf.getBit(e,r))return n;n++}return 52};var rf=function(){this._commonCoord=null,this._ccFilter=new sf},of={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};rf.prototype.addCommonBits=function(t){var e=new af(this._commonCoord);t.apply(e),t.geometryChanged()},rf.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new ll(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new af(e);return t.apply(n),t.geometryChanged(),t},rf.prototype.getCommonCoordinate=function(){return this._commonCoord},rf.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},rf.prototype.interfaces_=function(){return[]},rf.prototype.getClass=function(){return rf},of.CommonCoordinateFilter.get=function(){return sf},of.Translater.get=function(){return af},Object.defineProperties(rf,of);var sf=function(){this._commonBitsX=new nf,this._commonBitsY=new nf};sf.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},sf.prototype.getCommonCoordinate=function(){return new ll(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},sf.prototype.interfaces_=function(){return[Ql]},sf.prototype.getClass=function(){return sf};var af=function(){this.trans=null;var t=arguments[0];this.trans=t};af.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)},af.prototype.isDone=function(){return!1},af.prototype.isGeometryChanged=function(){return!0},af.prototype.interfaces_=function(){return[kc]},af.prototype.getClass=function(){return af};var uf=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};uf.prototype.selfSnap=function(t){return new $d(t).snapTo(t,this._snapTolerance)},uf.prototype.removeCommonBits=function(t){this._cbr=new rf,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},uf.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},uf.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=Lf.overlayOp(e[0],e[1],t);return this.prepareResult(n)},uf.prototype.checkValid=function(t){t.isValid()||Pl.out.println("Snapped geometry is invalid")},uf.prototype.computeSnapTolerance=function(){this._snapTolerance=$d.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},uf.prototype.snap=function(t){var e=this.removeCommonBits(t);return $d.snap(e[0],e[1],this._snapTolerance)},uf.prototype.interfaces_=function(){return[]},uf.prototype.getClass=function(){return uf},uf.overlayOp=function(t,e,n){return new uf(t,e).getResultGeometry(n)},uf.union=function(t,e){return uf.overlayOp(t,e,Lf.UNION)},uf.intersection=function(t,e){return uf.overlayOp(t,e,Lf.INTERSECTION)},uf.symDifference=function(t,e){return uf.overlayOp(t,e,Lf.SYMDIFFERENCE)},uf.difference=function(t,e){return uf.overlayOp(t,e,Lf.DIFFERENCE)};var lf=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};lf.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=Lf.overlayOp(this._geom[0],this._geom[1],t),n=!0}catch(t){if(!(t instanceof Bl))throw t;r=t}if(!n)try{e=uf.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Bl?r:t}return e},lf.prototype.interfaces_=function(){return[]},lf.prototype.getClass=function(){return lf},lf.overlayOp=function(t,e,n){return new lf(t,e).getResultGeometry(n)},lf.union=function(t,e){return lf.overlayOp(t,e,Lf.UNION)},lf.intersection=function(t,e){return lf.overlayOp(t,e,Lf.INTERSECTION)},lf.symDifference=function(t,e){return lf.overlayOp(t,e,Lf.SYMDIFFERENCE)},lf.difference=function(t,e){return lf.overlayOp(t,e,Lf.DIFFERENCE)};var cf=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};cf.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},cf.prototype.interfaces_=function(){return[]},cf.prototype.getClass=function(){return cf};var hf=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},pf={INSERT:{configurable:!0},DELETE:{configurable:!0}};hf.prototype.isDelete=function(){return this._eventType===hf.DELETE},hf.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},hf.prototype.getObject=function(){return this._obj},hf.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},hf.prototype.getInsertEvent=function(){return this._insertEvent},hf.prototype.isInsert=function(){return this._eventType===hf.INSERT},hf.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},hf.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},hf.prototype.interfaces_=function(){return[ol]},hf.prototype.getClass=function(){return hf},pf.INSERT.get=function(){return 1},pf.DELETE.get=function(){return 2},Object.defineProperties(hf,pf);var df=function(){};df.prototype.interfaces_=function(){return[]},df.prototype.getClass=function(){return df};var ff=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};ff.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(ff.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},ff.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ff.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ff.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ff.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next().getCoordinate();if(t.isIntersection(r))return!0}return!1},ff.prototype.hasProperIntersection=function(){return this._hasProper},ff.prototype.hasIntersection=function(){return this._hasIntersection},ff.prototype.isDone=function(){return this._isDone},ff.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},ff.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ff.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ff.prototype.interfaces_=function(){return[]},ff.prototype.getClass=function(){return ff},ff.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var gf=function(t){function e(){t.call(this),this.events=new cc,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){rp.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var r=t.events.get(n);if(r.isInsert()&&t.processOverlaps(n,r.getDeleteEventIndex(),r,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ff&&gl(arguments[0],uc)&&gl(arguments[1],uc)){var i=arguments[0],o=arguments[1],s=arguments[2];this.addEdges(i,i),this.addEdges(o,o),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&gl(arguments[0],uc)&&arguments[1]instanceof ff){var a=arguments[0],u=arguments[1],l=arguments[2];l?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(u)}},e.prototype.addEdge=function(t,e){for(var n=t.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new cf(n,i),s=new hf(e,n.getMinX(i),o);this.events.add(s),this.events.add(new hf(n.getMaxX(i),s))}},e.prototype.processOverlaps=function(t,e,n,r){for(var i=n.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();n.isSameLabel(s)||(i.computeIntersections(a,r),this.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.addEdge(r,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=i.iterator();s.hasNext();){var a=s.next();t.addEdge(a,o)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(df),mf=function(){this._min=rl.POSITIVE_INFINITY,this._max=rl.NEGATIVE_INFINITY},yf={NodeComparator:{configurable:!0}};mf.prototype.getMin=function(){return this._min},mf.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},mf.prototype.getMax=function(){return this._max},mf.prototype.toString=function(){return kl.toLineString(new ll(this._min,0),new ll(this._max,0))},mf.prototype.interfaces_=function(){return[]},mf.prototype.getClass=function(){return mf},yf.NodeComparator.get=function(){return vf},Object.defineProperties(mf,yf);var vf=function(){};vf.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},vf.prototype.interfaces_=function(){return[al]},vf.prototype.getClass=function(){return vf};var xf=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._min=e,this._max=n,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(mf),_f=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],n=arguments[1];this._node1=e,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(mf),bf=function(){this._leaves=new cc,this._root=null,this._level=0};bf.prototype.buildTree=function(){rp.sort(this._leaves,new mf.NodeComparator);for(var t=this._leaves,e=null,n=new cc;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},bf.prototype.insert=function(t,e,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new xf(t,e,n))},bf.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)},bf.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},bf.prototype.printNode=function(t){Pl.out.println(kl.toLineString(new ll(t._min,this._level),new ll(t._max,this._level)))},bf.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},bf.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(r);else{var i=new _f(t.get(n),t.get(n+1));e.add(i)}}},bf.prototype.interfaces_=function(){return[]},bf.prototype.getClass=function(){return bf};var wf=function(){this._items=new cc};wf.prototype.visitItem=function(t){this._items.add(t)},wf.prototype.getItems=function(){return this._items},wf.prototype.interfaces_=function(){return[$h]},wf.prototype.getClass=function(){return wf};var Mf=function(){this._index=null;var t=arguments[0];if(!gl(t,th))throw new nl("Argument must be Polygonal");this._index=new Tf(t)},Ef={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Mf.prototype.locate=function(t){var e=new Wl(t),n=new Sf(e);return this._index.query(t.y,t.y,n),e.getLocation()},Mf.prototype.interfaces_=function(){return[Hp]},Mf.prototype.getClass=function(){return Mf},Ef.SegmentVisitor.get=function(){return Sf},Ef.IntervalIndexedGeometry.get=function(){return Tf},Object.defineProperties(Mf,Ef);var Sf=function(){this._counter=null;var t=arguments[0];this._counter=t};Sf.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},Sf.prototype.interfaces_=function(){return[$h]},Sf.prototype.getClass=function(){return Sf};var Tf=function(){this._index=new bf;var t=arguments[0];this.init(t)};Tf.prototype.init=function(t){for(var e=Cd.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},Tf.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var n=new vp(t[e-1],t[e]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},Tf.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new wf;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},Tf.prototype.interfaces_=function(){return[]},Tf.prototype.getClass=function(){return Tf};var Cf=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new fh,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ad,2===arguments.length){var e=arguments[0],n=arguments[1],r=$l.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var r=this._nodes.addNode(n).getLabel(),i=1;r.getLocation(t,Ch.ON)===dl.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);r.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new ff(n,!0,!1);o.setIsDoneIfProperInt(i);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof rh||this._parentGeom instanceof eh||this._parentGeom instanceof ih,u=r||!a;return s.computeIntersections(this._edges,o,u),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,n){var r=new ff(e,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof $c){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this._argIndex,e,dl.INTERIOR)}else if(arguments[0]instanceof ll){var n=arguments[0];this.insertPoint(this._argIndex,n,dl.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),dl.EXTERIOR,dl.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,dl.INTERIOR,dl.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],dl.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],dl.BOUNDARY)},e.prototype.addLineString=function(t){var e=dc.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new od(e,new Fh(this._argIndex,dl.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),Gl.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,r=t.iterator();r.hasNext();){var i=r.next();e[n++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===dl.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var r=dc.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=e,o=n;ql.isCCW(r)&&(i=n,o=e);var s=new od(r,new Fh(this._argIndex,dl.BOUNDARY,i,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],dl.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var r=this._nodes.addNode(e),i=r.getLabel();null===i?r._label=new Fh(t,n):i.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new gf},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var n=e.next(),r=n.getLabel().getLocation(t),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,r)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ih&&(this._useBoundaryDeterminationRule=!1),e instanceof eh)this.addPolygon(e);else if(e instanceof Jc)this.addLineString(e);else if(e instanceof $c)this.addPoint(e);else if(e instanceof nh)this.addCollection(e);else if(e instanceof zc)this.addCollection(e);else if(e instanceof ih)this.addCollection(e);else{if(!(e instanceof Bc))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},e.prototype.locate=function(t){return gl(this._parentGeom,th)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Mf(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?dl.BOUNDARY:dl.INTERIOR},e}(Xh),Af=function(){if(this._li=new Hl,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Cf(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=$l.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Cf(0,e,r),this._arg[1]=new Cf(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Cf(0,i,s),this._arg[1]=new Cf(1,o,s)}};Af.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Af.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Af.prototype.interfaces_=function(){return[]},Af.prototype.getClass=function(){return Af};var Pf=function(){};Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf},Pf.map=function(){if(arguments[0]instanceof Zl&&gl(arguments[1],Pf.MapOp)){for(var t=arguments[0],e=arguments[1],n=new cc,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));null!==i&&n.add(i)}return t.getFactory().buildGeometry(n)}if(gl(arguments[0],oc)&&gl(arguments[1],Pf.MapOp)){for(var o=arguments[0],s=arguments[1],a=new cc,u=o.iterator();u.hasNext();){var l=u.next(),c=s.map(l);null!==c&&a.add(c)}return a}},Pf.MapOp=function(){};var Lf=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n),this._ptLocator=new Ad,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Kp,this._resultPolyList=new cc,this._resultLineList=new cc,this._resultPointList=new cc,this._graph=new Xh(new Xp),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new Fh(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,n,r,i){var o=new cc;return o.addAll(t),o.addAll(n),o.addAll(r),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(t,r)!==dl.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new cc,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new cc;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Yd.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Zh(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new Zd(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var i=new Kd(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Ch.RIGHT),i.getLocation(1,Ch.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(Gl.isTrue(!r.isNull(i,Ch.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,Ch.LEFT,r.getLocation(i,Ch.LEFT)),Gl.isTrue(!r.isNull(i,Ch.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,Ch.RIGHT,r.getLocation(i,Ch.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Af);Lf.overlayOp=function(t,e,n){return new Lf(t,e).getResultGeometry(n)},Lf.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Lf.createEmptyResult(Lf.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Xd.map(t,{interfaces_:function(){return[Pf.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),lf.overlayOp(t,e,Lf.INTERSECTION)},Lf.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Lf.createEmptyResult(Lf.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),lf.overlayOp(t,e,Lf.SYMDIFFERENCE)},Lf.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case Lf.INTERSECTION:o=Math.min(r,i);break;case Lf.UNION:o=Math.max(r,i);break;case Lf.DIFFERENCE:o=r;break;case Lf.SYMDIFFERENCE:o=Math.max(r,i)}return o},Lf.createEmptyResult=function(t,e,n,r){var i=null;switch(Lf.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},Lf.difference=function(t,e){return t.isEmpty()?Lf.createEmptyResult(Lf.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),lf.overlayOp(t,e,Lf.DIFFERENCE))},Lf.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return Lf.isResultOfOp(n,r,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];switch(i===dl.BOUNDARY&&(i=dl.INTERIOR),o===dl.BOUNDARY&&(o=dl.INTERIOR),s){case Lf.INTERSECTION:return i===dl.INTERIOR&&o===dl.INTERIOR;case Lf.UNION:return i===dl.INTERIOR||o===dl.INTERIOR;case Lf.DIFFERENCE:return i===dl.INTERIOR&&o!==dl.INTERIOR;case Lf.SYMDIFFERENCE:return i===dl.INTERIOR&&o!==dl.INTERIOR||i!==dl.INTERIOR&&o===dl.INTERIOR}return!1}},Lf.INTERSECTION=1,Lf.UNION=2,Lf.DIFFERENCE=3,Lf.SYMDIFFERENCE=4;var If=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ad,this._seg=new vp;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};If.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n).getCoordinateSequence(),i=0;i<r.size()-1;i++)if(r.getCoordinate(i,e._seg.p0),r.getCoordinate(i+1,e._seg.p1),e._seg.distance(t)<=e._boundaryDistanceTolerance)return!0;return!1},If.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?dl.BOUNDARY:this._ptLocator.locate(t,this._g)},If.prototype.extractLinework=function(t){var e=new Rf;t.apply(e);var n=e.getLinework(),r=xh.toLineStringArray(n);return t.getFactory().createMultiLineString(r)},If.prototype.interfaces_=function(){return[]},If.prototype.getClass=function(){return If};var Rf=function(){this._linework=null,this._linework=new cc};Rf.prototype.getLinework=function(){return this._linework},Rf.prototype.filter=function(t){if(t instanceof eh){var e=t;this._linework.add(e.getExteriorRing());for(var n=0;n<e.getNumInteriorRing();n++)this._linework.add(e.getInteriorRingN(n))}},Rf.prototype.interfaces_=function(){return[Fc]},Rf.prototype.getClass=function(){return Rf};var Nf=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Nf.prototype.extractPoints=function(t,e,n){for(var r=t.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],e,n)},Nf.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Nf.prototype.getPoints=function(t){for(var e=new cc,n=Cd.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,t,e)}return e},Nf.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,s=Math.sqrt(i*i+o*o),a=n*i/s,u=n*o/s,l=(e.x+t.x)/2,c=(e.y+t.y)/2;if(this._doLeft){var h=new ll(l-u,c+a);r.add(h)}if(this._doRight){var p=new ll(l+u,c-a);r.add(p)}},Nf.prototype.interfaces_=function(){return[]},Nf.prototype.getClass=function(){return Nf};var Of=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new cc;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new If(this._geom[0],this._boundaryDistanceTolerance),new If(this._geom[1],this._boundaryDistanceTolerance),new If(this._geom[2],this._boundaryDistanceTolerance)]},Df={TOLERANCE:{configurable:!0}};Of.prototype.reportResult=function(t,e,n){Pl.out.println("Overlay result invalid - A:"+dl.toLocationSymbol(e[0])+" B:"+dl.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+dl.toLocationSymbol(e[2]))},Of.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e},Of.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),!!Of.hasLocation(this._location,dl.BOUNDARY)||this.isValidResult(i,this._location)}},Of.prototype.addTestPts=function(t){var e=new Nf(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Of.prototype.isValidResult=function(t,e){var n=Lf.isResultOfOp(e[0],e[1],t),r=!(n^e[2]===dl.INTERIOR);return r||this.reportResult(t,e,n),r},Of.prototype.getInvalidLocation=function(){return this._invalidLocation},Of.prototype.interfaces_=function(){return[]},Of.prototype.getClass=function(){return Of},Of.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},Of.computeBoundaryDistanceTolerance=function(t,e){return Math.min($d.computeSizeBasedSnapTolerance(t),$d.computeSizeBasedSnapTolerance(e))},Of.isValid=function(t,e,n,r){return new Of(t,e,r).isValid(n)},Df.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Of,Df);var Ff=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Ff.prototype.extractElements=function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);this._skipEmpty&&r.isEmpty()||e.add(r)}},Ff.prototype.combine=function(){for(var t=new cc,e=this._inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Ff.prototype.interfaces_=function(){return[]},Ff.prototype.getClass=function(){return Ff},Ff.combine=function(){if(1===arguments.length){var t=arguments[0],e=new Ff(t);return e.combine()}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=new Ff(Ff.createList(n,r));return i.combine()}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],u=new Ff(Ff.createList(o,s,a));return u.combine()}},Ff.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Ff.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new cc;return n.add(t),n.add(e),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=new cc;return s.add(r),s.add(i),s.add(o),s}};var kf=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new cc)},Bf={STRTREE_NODE_CAPACITY:{configurable:!0}};kf.prototype.reduceToGeometries=function(t){for(var e=new cc,n=t.iterator();n.hasNext();){var r=n.next(),i=null;gl(r,uc)?i=this.unionTree(r):r instanceof Zl&&(i=r),e.add(i)}return e},kf.prototype.extractByEnvelope=function(t,e,n){for(var r=new cc,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},kf.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r))return Ff.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,i)},kf.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new lp(kf.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},kf.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=kf.getGeometry(e,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(kf.getGeometry(e,n),kf.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),s=this.binaryUnion(e,n,o),a=this.binaryUnion(e,o,r);return this.unionSafe(s,a)}},kf.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e=null===e?r.copy():e.union(r)}return e},kf.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},kf.prototype.unionActual=function(t,e){return kf.restrictToPolygons(t.union(e))},kf.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},kf.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new cc,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),s=this.unionActual(i,o);return r.add(s),Ff.combine(r)},kf.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}if(2===arguments.length){var i=arguments[0],o=arguments[1],s=i.getFactory(),a=s.createGeometryCollection([i,o]),u=a.buffer(0);return u}},kf.prototype.interfaces_=function(){return[]},kf.prototype.getClass=function(){return kf},kf.restrictToPolygons=function(t){if(gl(t,th))return t;var e=Td.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(xh.toPolygonArray(e))},kf.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},kf.union=function(t){return new kf(t).union()},Bf.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(kf,Bf);var zf=function(){};function Gf(){return new Uf}function Uf(){this.reset()}zf.prototype.interfaces_=function(){return[]},zf.prototype.getClass=function(){return zf},zf.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Lf.createEmptyResult(Lf.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),lf.overlayOp(t,e,Lf.UNION)},Uf.prototype={constructor:Uf,reset:function(){this.s=this.t=0},add:function(t){Hf(Vf,t,this.t),Hf(this,Vf.s,this.s),this.s?this.t+=Vf.t:this.s=Vf.t},valueOf:function(){return this.s}};var Vf=new Uf;function Hf(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var jf=1e-6,Wf=Math.PI,qf=Wf/2,Yf=Wf/4,Xf=2*Wf,Zf=180/Wf,Kf=Wf/180,Jf=Math.abs,Qf=Math.atan,$f=Math.atan2,tg=Math.cos,eg=Math.sin,ng=Math.sqrt;function rg(t){return t>1?0:t<-1?Wf:Math.acos(t)}function ig(t){return t>1?qf:t<-1?-qf:Math.asin(t)}function og(){}function sg(t,e){t&&cg.hasOwnProperty(t.type)&&cg[t.type](t,e)}var ag,ug,lg={Feature:function(t,e){sg(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)sg(n[r].geometry,e)}},cg={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){hg(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hg(n[r],e,0)},Polygon:function(t,e){pg(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)pg(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)sg(n[r],e)}};function hg(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function pg(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)hg(t[n],e,1);e.polygonEnd()}function dg(t){return[$f(t[1],t[0]),ig(t[2])]}function fg(t){var e=t[0],n=t[1],r=tg(n);return[r*tg(e),r*eg(e),eg(n)]}function gg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mg(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function yg(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function vg(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function xg(t){var e=ng(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function _g(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function bg(t,e){return[t>Wf?t-Xf:t<-Wf?t+Xf:t,e]}function wg(t){return function(e,n){return[(e+=t)>Wf?e-Xf:e<-Wf?e+Xf:e,n]}}function Mg(t){var e=wg(t);return e.invert=wg(-t),e}function Eg(t,e){var n=tg(t),r=eg(t),i=tg(e),o=eg(e);function s(t,e){var s=tg(e),a=tg(t)*s,u=eg(t)*s,l=eg(e),c=l*n+a*r;return[$f(u*i-c*o,a*n-l*r),ig(c*i+u*o)]}return s.invert=function(t,e){var s=tg(e),a=tg(t)*s,u=eg(t)*s,l=eg(e),c=l*i-u*o;return[$f(u*i+l*o,a*n+c*r),ig(c*n-a*r)]},s}function Sg(t,e){(e=fg(e))[0]-=t,xg(e);var n=rg(-e[1]);return((-e[2]<0?-n:n)+Xf-jf)%Xf}function Tg(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:og,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Cg(t,e){return Jf(t[0]-e[0])<jf&&Jf(t[1]-e[1])<jf}function Ag(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Pg(t,e,n,r,i){var o,s,a=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],s=t[e];if(Cg(r,s)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else a.push(n=new Ag(r,t,null,!0)),u.push(n.o=new Ag(r,null,n,!1)),a.push(n=new Ag(s,t,null,!1)),u.push(n.o=new Ag(s,null,n,!0))}})),a.length){for(u.sort(e),Lg(a),Lg(u),o=0,s=u.length;o<s;++o)u[o].e=n=!n;for(var l,c,h=a[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;l=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(o=0,s=l.length;o<s;++o)i.point((c=l[o])[0],c[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d)for(l=p.p.z,o=l.length-1;o>=0;--o)i.point((c=l[o])[0],c[1]);else r(p.x,p.p.x,-1,i);p=p.p}l=(p=p.o).z,d=!d}while(!p.v);i.lineEnd()}}}function Lg(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Ig(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Rg(t){for(var e,n,r,i=t.length,o=-1,s=0;++o<i;)s+=t[o].length;for(n=new Array(s);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--s]=r[e];return n}Gf(),Gf(),Gf(),bg.invert=bg,1===(ag=Ig).length&&(ug=ag,ag=function(t,e){return Ig(ug(t),e)});var Ng=1e9,Og=-Ng;function Dg(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,a,l){var c=0,h=0;if(null==i||(c=s(i,a))!==(h=s(o,a))||u(i,o)<0^a>0)do{l.point(0===c||3===c?t:n,c>1?r:e)}while((c=(c+a+4)%4)!==h);else l.point(o[0],o[1])}function s(r,i){return Jf(r[0]-t)<jf?i>0?0:3:Jf(r[0]-n)<jf?i>0?2:1:Jf(r[1]-e)<jf?i>0?1:0:i>0?3:2}function a(t,e){return u(t.x,e.x)}function u(t,e){var n=s(t,1),r=s(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){var u,l,c,h,p,d,f,g,m,y,v,x=s,_=Tg(),b={point:w,lineStart:function(){b.point=M,l&&l.push(c=[]),y=!0,m=!1,f=g=NaN},lineEnd:function(){u&&(M(h,p),d&&m&&_.rejoin(),u.push(_.result())),b.point=w,m&&x.lineEnd()},polygonStart:function(){x=_,u=[],l=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=l.length;n<i;++n)for(var o,s,a=l[n],u=1,c=a.length,h=a[0],p=h[0],d=h[1];u<c;++u)o=p,s=d,p=(h=a[u])[0],d=h[1],s<=r?d>r&&(p-o)*(r-s)>(d-s)*(t-o)&&++e:d<=r&&(p-o)*(r-s)<(d-s)*(t-o)&&--e;return e}(),n=v&&e,i=(u=Rg(u)).length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),i&&Pg(u,a,e,o,s),s.polygonEnd()),x=s,u=l=c=null}};function w(t,e){i(t,e)&&x.point(t,e)}function M(o,s){var a=i(o,s);if(l&&c.push([o,s]),y)h=o,p=s,d=a,y=!1,a&&(x.lineStart(),x.point(o,s));else if(a&&m)x.point(o,s);else{var u=[f=Math.max(Og,Math.min(Ng,f)),g=Math.max(Og,Math.min(Ng,g))],_=[o=Math.max(Og,Math.min(Ng,o)),s=Math.max(Og,Math.min(Ng,s))];!function(t,e,n,r,i,o){var s,a=t[0],u=t[1],l=0,c=1,h=e[0]-a,p=e[1]-u;if(s=n-a,h||!(s>0)){if(s/=h,h<0){if(s<l)return;s<c&&(c=s)}else if(h>0){if(s>c)return;s>l&&(l=s)}if(s=i-a,h||!(s<0)){if(s/=h,h<0){if(s>c)return;s>l&&(l=s)}else if(h>0){if(s<l)return;s<c&&(c=s)}if(s=r-u,p||!(s>0)){if(s/=p,p<0){if(s<l)return;s<c&&(c=s)}else if(p>0){if(s>c)return;s>l&&(l=s)}if(s=o-u,p||!(s<0)){if(s/=p,p<0){if(s>c)return;s>l&&(l=s)}else if(p>0){if(s<l)return;s<c&&(c=s)}return l>0&&(t[0]=a+l*h,t[1]=u+l*p),c<1&&(e[0]=a+c*h,e[1]=u+c*p),!0}}}}}(u,_,t,e,n,r)?a&&(x.lineStart(),x.point(o,s),v=!1):(m||(x.lineStart(),x.point(u[0],u[1])),x.point(_[0],_[1]),a||x.lineEnd(),v=!1)}f=o,g=s,m=a}return b}}var Fg=Gf();function kg(t){return t}Gf(),Gf(),Gf();var Bg=1/0,zg=Bg,Gg=-Bg,Ug=Gg,Vg={point:function(t,e){t<Bg&&(Bg=t),t>Gg&&(Gg=t),e<zg&&(zg=e),e>Ug&&(Ug=e)},lineStart:og,lineEnd:og,polygonStart:og,polygonEnd:og,result:function(){var t=[[Bg,zg],[Gg,Ug]];return Gg=Ug=-(zg=Bg=1/0),t}};function Hg(t,e,n,r){return function(i,o){var s,a,u,l=e(o),c=i.invert(r[0],r[1]),h=Tg(),p=e(h),d=!1,f={point:g,lineStart:y,lineEnd:v,polygonStart:function(){f.point=x,f.lineStart=_,f.lineEnd=b,a=[],s=[]},polygonEnd:function(){f.point=g,f.lineStart=y,f.lineEnd=v,a=Rg(a);var t=function(t,e){var n=e[0],r=e[1],i=[eg(n),-tg(n),0],o=0,s=0;Fg.reset();for(var a=0,u=t.length;a<u;++a)if(c=(l=t[a]).length)for(var l,c,h=l[c-1],p=h[0],d=h[1]/2+Yf,f=eg(d),g=tg(d),m=0;m<c;++m,p=v,f=_,g=b,h=y){var y=l[m],v=y[0],x=y[1]/2+Yf,_=eg(x),b=tg(x),w=v-p,M=w>=0?1:-1,E=M*w,S=E>Wf,T=f*_;if(Fg.add($f(T*M*eg(E),g*b+T*tg(E))),o+=S?w+M*Xf:w,S^p>=n^v>=n){var C=mg(fg(h),fg(y));xg(C);var A=mg(i,C);xg(A);var P=(S^w>=0?-1:1)*ig(A[2]);(r>P||r===P&&(C[0]||C[1]))&&(s+=S^w>=0?1:-1)}}return(o<-1e-6||o<jf&&Fg<-1e-6)^1&s}(s,c);a.length?(d||(o.polygonStart(),d=!0),Pg(a,Wg,t,n,o)):t&&(d||(o.polygonStart(),d=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),d&&(o.polygonEnd(),d=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function g(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function m(t,e){var n=i(t,e);l.point(n[0],n[1])}function y(){f.point=m,l.lineStart()}function v(){f.point=g,l.lineEnd()}function x(t,e){u.push([t,e]);var n=i(t,e);p.point(n[0],n[1])}function _(){p.lineStart(),u=[]}function b(){x(u[0][0],u[0][1]),p.lineEnd();var t,e,n,r,i=p.clean(),l=h.result(),c=l.length;if(u.pop(),s.push(u),u=null,c)if(1&i){if((e=(n=l[0]).length-1)>0){for(d||(o.polygonStart(),d=!0),o.lineStart(),t=0;t<e;++t)o.point((r=n[t])[0],r[1]);o.lineEnd()}}else c>1&&2&i&&l.push(l.pop().concat(l.shift())),a.push(l.filter(jg))}return f}}function jg(t){return t.length>1}function Wg(t,e){return((t=t.x)[0]<0?t[1]-qf-jf:qf-t[1])-((e=e.x)[0]<0?e[1]-qf-jf:qf-e[1])}Gf();var qg=Hg((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Wf:-Wf,u=Jf(o-n);Jf(u-Wf)<jf?(t.point(n,r=(r+s)/2>0?qf:-qf),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),e=0):i!==a&&u>=Wf&&(Jf(n-i)<jf&&(n-=i*jf),Jf(o-a)<jf&&(o-=a*jf),r=function(t,e,n,r){var i,o,s=eg(t-n);return Jf(s)>jf?Qf((eg(e)*(o=tg(r))*eg(n)-eg(r)*(i=tg(e))*eg(t))/(i*o*s)):(e+r)/2}(n,r,o,s),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),e=0),t.point(n=o,r=s),i=a},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)i=n*qf,r.point(-Wf,i),r.point(0,i),r.point(Wf,i),r.point(Wf,0),r.point(Wf,-i),r.point(0,-i),r.point(-Wf,-i),r.point(-Wf,0),r.point(-Wf,i);else if(Jf(t[0]-e[0])>jf){var o=t[0]<e[0]?Wf:-Wf;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}),[-Wf,-qf]);function Yg(t,e){var n=tg(t),r=n>0,i=Jf(n)>jf;function o(t,e){return tg(t)*tg(e)>n}function s(t,e,r){var i=[1,0,0],o=mg(fg(t),fg(e)),s=gg(o,o),a=o[0],u=s-a*a;if(!u)return!r&&t;var l=n*s/u,c=-n*a/u,h=mg(i,o),p=vg(i,l);yg(p,vg(o,c));var d=h,f=gg(p,d),g=gg(d,d),m=f*f-g*(gg(p,p)-1);if(!(m<0)){var y=ng(m),v=vg(d,(-f-y)/g);if(yg(v,p),v=dg(v),!r)return v;var x,_=t[0],b=e[0],w=t[1],M=e[1];b<_&&(x=_,_=b,b=x);var E=b-_,S=Jf(E-Wf)<jf;if(!S&&M<w&&(x=w,w=M,M=x),S||E<jf?S?w+M>0^v[1]<(Jf(v[0]-_)<jf?w:M):w<=v[1]&&v[1]<=M:E>Wf^(_<=v[0]&&v[0]<=b)){var T=vg(d,(-f+y)/g);return yg(T,p),[v,dg(T)]}}}function a(e,n){var i=r?t:Wf-t,o=0;return e<-i?o|=1:e>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return Hg(o,(function(t){var e,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(h,p){var d,f=[h,p],g=o(h,p),m=r?g?0:a(h,p):g?a(h+(h<0?Wf:-Wf),p):0;if(!e&&(l=u=g)&&t.lineStart(),g!==u&&(!(d=s(e,f))||Cg(e,d)||Cg(f,d))&&(f[0]+=jf,f[1]+=jf,g=o(f[0],f[1])),g!==u)c=0,g?(t.lineStart(),d=s(f,e),t.point(d[0],d[1])):(d=s(e,f),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(i&&e&&r^g){var y;m&n||!(y=s(f,e,!0))||(c=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!g||e&&Cg(e,f)||t.point(f[0],f[1]),e=f,u=g,n=m},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return c|(l&&u)<<1}}}),(function(n,r,i,o){!function(t,e,n,r,i,o){if(n){var s=tg(e),a=eg(e),u=r*n;null==i?(i=e+r*Xf,o=e-u/2):(i=Sg(s,i),o=Sg(s,o),(r>0?i<o:i>o)&&(i+=r*Xf));for(var l,c=i;r>0?c>o:c<o;c-=u)l=dg([s,-a*tg(c),-a*eg(c)]),t.point(l[0],l[1])}}(o,t,e,i,n,r)}),r?[0,-t]:[-Wf,t-Wf])}function Xg(t){return function(e){var n=new Zg;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Zg(){}function Kg(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&lg.hasOwnProperty(t.type)?lg[t.type](t,e):sg(t,e)}(n,t.stream(Vg));var s=Vg.result(),a=Math.min(r/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),u=+e[0][0]+(r-a*(s[1][0]+s[0][0]))/2,l=+e[0][1]+(i-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([u,l])}Zg.prototype={constructor:Zg,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Jg=tg(30*Kf);function Qg(t,e){return+e?function(t,e){function n(r,i,o,s,a,u,l,c,h,p,d,f,g,m){var y=l-r,v=c-i,x=y*y+v*v;if(x>4*e&&g--){var _=s+p,b=a+d,w=u+f,M=ng(_*_+b*b+w*w),E=ig(w/=M),S=Jf(Jf(w)-1)<jf||Jf(o-h)<jf?(o+h)/2:$f(b,_),T=t(S,E),C=T[0],A=T[1],P=C-r,L=A-i,I=v*P-y*L;(I*I/x>e||Jf((y*P+v*L)/x-.5)>.3||s*p+a*d+u*f<Jg)&&(n(r,i,o,s,a,u,C,A,S,_/=M,b/=M,w,g,m),m.point(C,A),n(C,A,S,_,b,w,l,c,h,p,d,f,g,m))}}return function(e){var r,i,o,s,a,u,l,c,h,p,d,f,g={point:m,lineStart:y,lineEnd:x,polygonStart:function(){e.polygonStart(),g.lineStart=_},polygonEnd:function(){e.polygonEnd(),g.lineStart=y}};function m(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){c=NaN,g.point=v,e.lineStart()}function v(r,i){var o=fg([r,i]),s=t(r,i);n(c,h,l,p,d,f,c=s[0],h=s[1],l=r,p=o[0],d=o[1],f=o[2],16,e),e.point(c,h)}function x(){g.point=m,e.lineEnd()}function _(){y(),g.point=b,g.lineEnd=w}function b(t,e){v(r=t,e),i=c,o=h,s=p,a=d,u=f,g.point=v}function w(){n(c,h,l,p,d,f,i,o,r,s,a,u,16,e),g.lineEnd=x,x()}return g}}(t,e):function(t){return Xg({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var $g=Xg({point:function(t,e){this.stream.point(t*Kf,e*Kf)}});function tm(t){return function(t){var e,n,r,i,o,s,a,u,l,c,h=150,p=480,d=250,f=0,g=0,m=0,y=0,v=0,x=null,_=qg,b=null,w=kg,M=.5,E=Qg(C,M);function S(t){return[(t=o(t[0]*Kf,t[1]*Kf))[0]*h+n,r-t[1]*h]}function T(t){return(t=o.invert((t[0]-n)/h,(r-t[1])/h))&&[t[0]*Zf,t[1]*Zf]}function C(t,i){return[(t=e(t,i))[0]*h+n,r-t[1]*h]}function A(){o=_g(i=function(t,e,n){return(t%=Xf)?e||n?_g(Mg(t),Eg(e,n)):Mg(t):e||n?Eg(e,n):bg}(m,y,v),e);var t=e(f,g);return n=p-t[0]*h,r=d+t[1]*h,P()}function P(){return l=c=null,S}return S.stream=function(t){return l&&c===t?l:l=$g(_(i,E(w(c=t))))},S.clipAngle=function(t){return arguments.length?(_=+t?Yg(x=t*Kf,6*Kf):(x=null,qg),P()):x*Zf},S.clipExtent=function(t){return arguments.length?(w=null==t?(b=s=a=u=null,kg):Dg(b=+t[0][0],s=+t[0][1],a=+t[1][0],u=+t[1][1]),P()):null==b?null:[[b,s],[a,u]]},S.scale=function(t){return arguments.length?(h=+t,A()):h},S.translate=function(t){return arguments.length?(p=+t[0],d=+t[1],A()):[p,d]},S.center=function(t){return arguments.length?(f=t[0]%360*Kf,g=t[1]%360*Kf,A()):[f*Zf,g*Zf]},S.rotate=function(t){return arguments.length?(m=t[0]%360*Kf,y=t[1]%360*Kf,v=t.length>2?t[2]%360*Kf:0,A()):[m*Zf,y*Zf,v*Zf]},S.precision=function(t){return arguments.length?(E=Qg(C,M=t*t),P()):ng(M)},S.fitExtent=function(t,e){return Kg(S,t,e)},S.fitSize=function(t,e){return function(t,e,n){return Kg(t,[[0,0],e],n)}(S,t,e)},function(){return e=t.apply(this,arguments),S.invert=e.invert&&T,A()}}((function(){return t}))()}var em=function(t){return function(e,n){var r=tg(e),i=tg(n),o=t(r*i);return[o*i*eg(e),o*eg(n)]}}((function(t){return(t=rg(t))&&t/eg(t)}));function nm(){return tm(em).scale(79.4188).clipAngle(179.999)}function rm(t,e,r,i){var o=t.properties||{},a="Feature"===t.type?t.geometry:t;if("GeometryCollection"===a.type){var u=[];return G(t,(function(t){var n=rm(t,e,r,i);n&&u.push(n)})),f(u)}var l=function(t){var e=bn(t).geometry.coordinates,r=[-e[0],-e[1]];return nm().rotate(r).scale(n)}(a),c={type:a.type,coordinates:om(a.coordinates,l)},h=(new Sh).read(c),p=_(b(e,r),"meters"),d=vd.bufferOp(h,p,i);if(!im((d=(new Th).write(d)).coordinates))return s({type:d.type,coordinates:sm(d.coordinates,l)},o)}function im(t){return Array.isArray(t[0])?im(t[0]):isNaN(t[0])}function om(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return om(t,e)}))}function sm(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return sm(t,e)}))}function am(t,e,n){void 0===n&&(n={});var r=it(t),i=it(e),o=tl.intersection(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?c(o[0],n.properties):y(o,n.properties)}function um(t,e,n){void 0===n&&(n={});var r=JSON.stringify(n.properties||{}),i=t[0],o=t[1],s=t[2],a=t[3],u=(o+a)/2,l=(i+s)/2,c=2*e/_e([i,u],[s,u],n)*(s-i),h=2*e/_e([l,o],[l,a],n)*(a-o),p=c/2,d=2*p,g=Math.sqrt(3)/2*h,m=s-i,y=a-o,v=3/4*d,x=g,_=(m-d)/(d-p/2),b=Math.floor(_),w=(b*v-p/2-m)/2-p/2+v/2,M=Math.floor((y-g)/g),E=(y-M*g)/2,S=M*g-y>g/2;S&&(E-=g/4);for(var T=[],C=[],A=0;A<6;A++){var P=2*Math.PI/6*A;T.push(Math.cos(P)),C.push(Math.sin(P))}for(var L=[],I=0;I<=b;I++)for(var R=0;R<=M;R++){var N=I%2==1;if((0!==R||!N)&&(0!==R||!S)){var O=I*v+i-w,D=R*x+o+E;if(N&&(D-=g/2),!0===n.triangles)cm([O,D],c/2,h/2,JSON.parse(r),T,C).forEach((function(t){n.mask?am(n.mask,t)&&L.push(t):L.push(t)}));else{var F=lm([O,D],c/2,h/2,JSON.parse(r),T,C);n.mask?am(n.mask,F)&&L.push(F):L.push(F)}}}return f(L)}function lm(t,e,n,r,i,o){for(var s=[],a=0;a<6;a++){var u=t[0]+e*i[a],l=t[1]+n*o[a];s.push([u,l])}return s.push(s[0].slice()),c([s],r)}function cm(t,e,n,r,i,o){for(var s=[],a=0;a<6;a++){var u=[];u.push(t),u.push([t[0]+e*i[a],t[1]+n*o[a]]),u.push([t[0]+e*i[(a+1)%6],t[1]+n*o[(a+1)%6]]),u.push(t),s.push(c([u],r))}return s}function hm(t){return y(t)}function pm(t){return c(t&&t.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]])}function dm(t,e,n){return void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});for(var i=[],o=t[0],s=t[1],a=t[2],u=t[3],l=e/_e([o,s],[a,s],r)*(a-o),h=n/_e([o,s],[o,u],r)*(u-s),p=a-o,d=u-s,g=Math.floor(p/l),m=Math.floor(d/h),y=(d-m*h)/2,v=o+(p-g*l)/2,x=0;x<g;x++){for(var _=s+y,b=0;b<m;b++){var w=c([[[v,_],[v,_+h],[v+l,_+h],[v+l,_],[v,_]]],r.properties);r.mask?Ps(r.mask,w)&&i.push(w):i.push(w),_+=h}v+=l}return f(i)}(t,e,e,n)}function fm(t,e,n){void 0===n&&(n={});for(var r=[],i=e/_e([t[0],t[1]],[t[2],t[1]],n)*(t[2]-t[0]),o=e/_e([t[0],t[1]],[t[0],t[3]],n)*(t[3]-t[1]),s=0,a=t[0];a<=t[2];){for(var u=0,l=t[1];l<=t[3];){var h=null,p=null;s%2==0&&u%2==0?(h=c([[[a,l],[a,l+o],[a+i,l],[a,l]]],n.properties),p=c([[[a,l+o],[a+i,l+o],[a+i,l],[a,l+o]]],n.properties)):s%2==0&&u%2==1?(h=c([[[a,l],[a+i,l+o],[a+i,l],[a,l]]],n.properties),p=c([[[a,l],[a,l+o],[a+i,l+o],[a,l]]],n.properties)):u%2==0&&s%2==1?(h=c([[[a,l],[a,l+o],[a+i,l+o],[a,l]]],n.properties),p=c([[[a,l],[a+i,l+o],[a+i,l],[a,l]]],n.properties)):u%2==1&&s%2==1&&(h=c([[[a,l],[a,l+o],[a+i,l],[a,l]]],n.properties),p=c([[[a,l+o],[a+i,l+o],[a+i,l],[a,l+o]]],n.properties)),n.mask?(am(n.mask,h)&&r.push(h),am(n.mask,p)&&r.push(p)):(r.push(h),r.push(p)),l+=o,u++}s++,a+=i}return f(r)}em.invert=function(t){return function(e,n){var r=ng(e*e+n*n),i=t(r),o=eg(i),s=tg(i);return[$f(e*o,r*s),ig(r&&n*o/r)]}}((function(t){return t})),e.along=function(t,e,n){void 0===n&&(n={});for(var r=it(t).coordinates,i=0,o=0;o<r.length&&!(e>=i&&o===r.length-1);o++){if(i>=e){var s=e-i;if(s){var a=_n(r[o],r[o-1])-180;return vn(r[o],s,a,n)}return u(r[o])}i+=_e(r[o],r[o+1],n)}return u(r[r.length-1])},e.angle=function(t,e,n,r){if(void 0===r&&(r={}),!P(r))throw new Error("options is invalid");if(!t)throw new Error("startPoint is required");if(!e)throw new Error("midPoint is required");if(!n)throw new Error("endPoint is required");var i=t,o=e,s=n,a=M(!0!==r.mercator?_n(i,o):Ui(i,o)),u=M(!0!==r.mercator?_n(s,o):Ui(s,o)),l=Math.abs(a-u);return!0===r.explementary?360-l:l},e.applyFilter=lu,e.area=Hr,e.areaFactors=o,e.bbox=J,e.bboxClip=function(t,e){var n=it(t),r=n.type,i="Feature"===t.type?t.properties:{},o=n.coordinates;switch(r){case"LineString":case"MultiLineString":var s=[];return"LineString"===r&&(o=[o]),o.forEach((function(t){!function(t,e,n){var r,i,o,s,a,u=t.length,l=Ni(t[0],e),c=[];for(n||(n=[]),r=1;r<u;r++){for(s=t[r-1],i=o=Ni(a=t[r],e);;){if(!(l|i)){c.push(s),i!==o?(c.push(a),r<u-1&&(n.push(c),c=[])):r===u-1&&c.push(a);break}if(l&i)break;l?l=Ni(s=Ri(s,a,l,e),e):i=Ni(a=Ri(s,a,i,e),e)}l=o}c.length&&n.push(c)}(t,e,s)})),1===s.length?p(s[0],i):g(s,i);case"Polygon":return c(Oi(o,e),i);case"MultiPolygon":return y(o.map((function(t){return Oi(t,e)})),i);default:throw new Error("geometry "+r+" not supported")}},e.bboxPolygon=gn,e.bearing=_n,e.bearingToAngle=M,e.bearingToAzimuth=M,e.bezier=fn,e.bezierSpline=fn,e.booleanClockwise=Yi,e.booleanContains=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type,s=n.coordinates,a=r.coordinates;switch(i){case"Point":switch(o){case"Point":return vs(s,a);default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"Point":return function(t,e){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(vs(t.coordinates[n],e.coordinates)){r=!0;break}return r}(n,r);case"MultiPoint":return function(t,e){for(var n=0,r=e.coordinates;n<r.length;n++){for(var i=r[n],o=!1,s=0,a=t.coordinates;s<a.length;s++)if(vs(i,a[s])){o=!0;break}if(!o)return!1}return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return Zr(r,n,{ignoreEndVertices:!0});case"LineString":return function(t,e){for(var n=!1,r=0,i=e.coordinates;r<i.length;r++){var o=i[r];if(Zr({type:"Point",coordinates:o},t,{ignoreEndVertices:!0})&&(n=!0),!Zr({type:"Point",coordinates:o},t,{ignoreEndVertices:!1}))return!1}return n}(n,r);case"MultiPoint":return function(t,e){for(var n=!1,r=0,i=e.coordinates;r<i.length;r++){var o=i[r];if(Zr(o,t,{ignoreEndVertices:!0})&&(n=!0),!Zr(o,t))return!1}return!!n}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return ye(r,n,{ignoreBoundary:!0});case"LineString":return function(t,e){var n=!1,r=0,i=J(t),o=J(e);if(!ys(i,o))return!1;for(;r<e.coordinates.length-1;r++)if(ye({type:"Point",coordinates:xs(e.coordinates[r],e.coordinates[r+1])},t,{ignoreBoundary:!0})){n=!0;break}return n}(n,r);case"Polygon":return function(t,e){if("Feature"===t.type&&null===t.geometry)return!1;if("Feature"===e.type&&null===e.geometry)return!1;var n=J(t),r=J(e);if(!ys(n,r))return!1;for(var i=it(e).coordinates,o=0,s=i;o<s.length;o++)for(var a=0,u=s[o];a<u.length;a++)if(!ye(u[a],t))return!1;return!0}(n,r);case"MultiPoint":return function(t,e){for(var n=0,r=e.coordinates;n<r.length;n++)if(!ye(r[n],t,{ignoreBoundary:!0}))return!1;return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanCrosses=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;switch(i){case"MultiPoint":switch(o){case"LineString":return _s(n,r);case"Polygon":return ws(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"MultiPoint":return _s(r,n);case"LineString":return function(t,e){if(Rr(t,e).features.length>0)for(var n=0;n<t.coordinates.length-1;n++)for(var r=0;r<e.coordinates.length-1;r++){var i=!0;if(0!==r&&r!==e.coordinates.length-2||(i=!1),Ms(t.coordinates[n],t.coordinates[n+1],e.coordinates[r],i))return!0}return!1}(n,r);case"Polygon":return bs(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"MultiPoint":return ws(r,n);case"LineString":return bs(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanDisjoint=ds,e.booleanEqual=function(t,e){return it(t).type===it(e).type&&new As({precision:6}).compare(en(t),en(e))},e.booleanIntersects=Ps,e.booleanOverlap=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;if("MultiPoint"===i&&"MultiPoint"!==o||("LineString"===i||"MultiLineString"===i)&&"LineString"!==o&&"MultiLineString"!==o||("Polygon"===i||"MultiPolygon"===i)&&"Polygon"!==o&&"MultiPolygon"!==o)throw new Error("features must be of the same type");if("Point"===i)throw new Error("Point geometry not supported");if(new As({precision:6}).compare(t,e))return!1;var s=0;switch(i){case"MultiPoint":for(var a=0;a<n.coordinates.length;a++)for(var u=0;u<r.coordinates.length;u++){var l=n.coordinates[a],c=r.coordinates[u];if(l[0]===c[0]&&l[1]===c[1])return!0}return!1;case"LineString":case"MultiLineString":j(t,(function(t){j(e,(function(e){Bi(t,e).features.length&&s++}))}));break;case"Polygon":case"MultiPolygon":j(t,(function(t){j(e,(function(e){Rr(t,e).features.length&&s++}))}))}return s>0},e.booleanParallel=function(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==js(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==js(e,"line2"))throw new Error("line2 must be a LineString");for(var n=Jn(en(t)).features,r=Jn(en(e)).features,i=0;i<n.length;i++){var o=n[i].geometry.coordinates;if(!r[i])break;if(!Hs(o,r[i].geometry.coordinates))return!1}return!0},e.booleanPointInPolygon=ye,e.booleanPointOnLine=Zr,e.booleanWithin=Jr,e.buffer=function(t,e,n){var r=(n=n||{}).units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return G(t,(function(t){var n=rm(t,e,r,i);n&&o.push(n)})),f(o);case"FeatureCollection":return k(t,(function(t){var n=rm(t,e,r,i);n&&k(n,(function(t){t&&o.push(t)}))})),f(o)}return rm(t,e,r,i)},e.center=bn,e.centerMean=ka,e.centerMedian=function(t,e){if(void 0===e&&(e={}),!P(e=e||{}))throw new Error("options is invalid");var n=e.counter||10;if(!A(n))throw new Error("counter must be a number");var r=e.weight,i=ka(t,{weight:e.weight}),o=f([]);k(t,(function(t){var e;o.features.push(wn(t,{properties:{weight:null===(e=t.properties)||void 0===e?void 0:e[r]}}))}));var s={tolerance:e.tolerance,medianCandidates:[]};return Ba(i.geometry.coordinates,[0,0],o,s,n)},e.centerOfMass=function t(e,n){switch(void 0===n&&(n={}),ot(e)){case"Point":return u(Q(e),n.properties);case"Polygon":var r=[];N(e,(function(t){r.push(t)}));var i,o,s,a,l,c,h,p,d=wn(e,{properties:n.properties}),f=d.geometry.coordinates,g=0,m=0,y=0,v=r.map((function(t){return[t[0]-f[0],t[1]-f[1]]}));for(i=0;i<r.length-1;i++)a=(o=v[i])[0],c=o[1],l=(s=v[i+1])[0],y+=p=a*(h=s[1])-l*c,g+=(a+l)*p,m+=(c+h)*p;if(0===y)return d;var x=1/(.5*y*6);return u([f[0]+x*g,f[1]+x*m],n.properties);default:var _=me(e);return _?t(_,{properties:n.properties}):wn(e,{properties:n.properties})}},e.centroid=wn,e.circle=xn,e.cleanCoords=en,e.clone=Se,e.clusterEach=su,e.clusterReduce=au,e.clusters=pu,e.clustersDbscan=function(t,e,n){void 0===n&&(n={}),!0!==n.mutate&&(t=Se(t)),n.minPoints=n.minPoints||3;var r=new Os.DBSCAN,i=r.run(z(t),T(e,n.units),n.minPoints,_e),o=-1;return i.forEach((function(e){o++,e.forEach((function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster=o,n.properties.dbscan="core"}))})),r.noise.forEach((function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster?n.properties.dbscan="edge":n.properties.dbscan="noise"})),t},e.clustersKmeans=function(t,e){void 0===e&&(e={});var n=t.features.length;e.numberOfClusters=e.numberOfClusters||Math.round(Math.sqrt(n/2)),e.numberOfClusters>n&&(e.numberOfClusters=n),!0!==e.mutate&&(t=Se(t));var r=z(t),i=r.slice(0,e.numberOfClusters),o=Vs(r,e.numberOfClusters,i),s={};return o.centroids.forEach((function(t,e){s[e]=t})),k(t,(function(t,e){var n=o.idxs[e];t.properties.cluster=n,t.properties.centroid=s[n]})),t},e.collect=function(t,e,n,r){var i=Tt(6),o=e.features.map((function(t){var e;return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:null===(e=t.properties)||void 0===e?void 0:e[n]}}));return i.load(o),t.features.forEach((function(t){t.properties||(t.properties={});var e=J(t),n=i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),o=[];n.forEach((function(e){ye([e.minX,e.minY],t)&&o.push(e.property)})),t.properties[r]=o})),t},e.collectionOf=rt,e.combine=function(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return k(t,(function(t){var n,r,i,o;switch(null===(o=t.geometry)||void 0===o?void 0:o.type){case"Point":e.MultiPoint.coordinates.push(t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"MultiPoint":(n=e.MultiPoint.coordinates).push.apply(n,t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"LineString":e.MultiLineString.coordinates.push(t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"MultiLineString":(r=e.MultiLineString.coordinates).push.apply(r,t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties);break;case"MultiPolygon":(i=e.MultiPolygon.coordinates).push.apply(i,t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties)}})),f(Object.keys(e).filter((function(t){return e[t].coordinates.length})).sort().map((function(t){return s({type:t,coordinates:e[t].coordinates},{collectedProperties:e[t].properties})})))},e.concave=function(t,e){void 0===e&&(e={});var n=e.maxEdge||1/0,r=be(function(t){var e=[],n={};return k(t,(function(t){if(t.geometry){var r=t.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(n,r)||(e.push(t),n[r]=!0)}})),f(e)}(t));if(r.features=r.features.filter((function(t){var r=t.geometry.coordinates[0][0],i=t.geometry.coordinates[0][1],o=t.geometry.coordinates[0][2],s=_e(r,i,e),a=_e(i,o,e),u=_e(r,o,e);return s<=n&&a<=n&&u<=n})),r.features.length<1)return null;var i=tn(r);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),s(i)},e.containsNumber=tt,e.convertArea=C,e.convertDistance=T,e.convertLength=T,e.convex=me,e.coordAll=z,e.coordEach=N,e.coordReduce=O,e.createBins=uu,e.degrees2radians=S,e.degreesToRadians=S,e.destination=vn,e.difference=function(t,e){var n=it(t),r=it(e),i=t.properties||{},o=tl.difference(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?c(o[0],i):y(o,i)},e.dissolve=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.propertyName;rt(t,"Polygon","dissolve");var r=[];if(!e.propertyName)return ri(y(tl.union.apply(null,t.features.map((function(t){return t.geometry.coordinates})))));var i={};k(t,(function(t){Object.prototype.hasOwnProperty.call(i,t.properties[n])||(i[t.properties[n]]=[]),i[t.properties[n]].push(t)}));for(var o=Object.keys(i),s=0;s<o.length;s++){var a=y(tl.union.apply(null,i[o[s]].map((function(t){return t.geometry.coordinates}))));a.properties[n]=o[s],r.push(a)}return ri(f(r))},e.distance=_e,e.distanceToDegrees=w,e.distanceToRadians=b,e.distanceWeight=Ha,e.earthRadius=n,e.ellipse=Da,e.envelope=mn,e.explode=Mn,e.factors=r,e.feature=s,e.featureCollection=f,e.featureEach=k,e.featureOf=nt,e.featureReduce=B,e.filterProperties=hu,e.findPoint=Z,e.findSegment=X,e.flatten=ri,e.flattenEach=V,e.flattenReduce=H,e.flip=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if(!t)throw new Error("geojson is required");return!1!==n&&void 0!==n||(t=Se(t)),N(t,(function(t){var e=t[0],n=t[1];t[0]=n,t[1]=e})),t},e.geojsonType=et,e.geomEach=G,e.geomReduce=U,e.geometry=a,e.geometryCollection=v,e.getCluster=ou,e.getCoord=Q,e.getCoords=$,e.getGeom=it,e.getType=ot,e.greatCircle=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.npoints,o=n.offset;return t=Q(t),e=Q(e),r=r||{},i=i||100,o=o||10,new vi({x:t[0],y:t[1]},{x:e[0],y:e[1]},r).Arc(i,{offset:o}).json()},e.helpers=R,e.hexGrid=um,e.inside=ye,e.interpolate=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.gridType,i=n.property,o=n.weight;if(!t)throw new Error("points is required");if(rt(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==o&&"number"!=typeof o)throw new Error("weight must be a number");i=i||"elevation",r=r||"square",o=o||1;var s,a=J(t);switch(r){case"point":case"points":s=ei(a,e,n);break;case"square":case"squares":s=dm(a,e,n);break;case"hex":case"hexes":s=um(a,e,n);break;case"triangle":case"triangles":s=fm(a,e,n);break;default:throw new Error("invalid gridType")}var u=[];return k(s,(function(e){var s=0,a=0;k(t,(function(t){var u,l=_e("point"===r?e:wn(e),t,n);if(void 0!==i&&(u=t.properties[i]),void 0===u&&(u=t.geometry.coordinates[2]),void 0===u)throw new Error("zValue is missing");0===l&&(s=u);var c=1/Math.pow(l,o);a+=c,s+=c*u}));var l=Se(e);l.properties[i]=s/a,u.push(l)})),f(u)},e.intersect=am,e.invariant=st,e.isNumber=A,e.isObject=P,e.isobands=function(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(rt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!P(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var s=Ji(t,{zProperty:r,flip:!0}),a=function(t,e,n){for(var r=[],i=1;i<e.length;i++){var o=+e[i-1],s=+e[i],a=Jo(Ko(to(t,o,s-o))),u={};u.groupedRings=a,u[n]=o+"-"+s,r.push(u)}return r}(s,e,r);return f((a=function(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,l=e.length-1,c=i/u,h=o/l,p=function(t){t[0]=t[0]*c+s,t[1]=t[1]*h+a};return t.forEach((function(t){t.groupedRings.forEach((function(t){t.forEach((function(t){t.forEach(p)}))}))})),t}(a,s,t)).map((function(t,e){if(o[e]&&!P(o[e]))throw new Error("Each mappedProperty is required to be an Object");var n=ht({},i,o[e]);return n[r]=t[r],y(t.groupedRings,n)})))},e.isolines=function(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(rt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!P(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var s=xt(t,{zProperty:r,flip:!0});return f(function(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,l=e.length-1,c=i/u,h=o/l,p=function(t){t[0]=t[0]*c+s,t[1]=t[1]*h+a};return t.forEach((function(t){N(t,p)})),t}(function(t,e,n,r,i){for(var o=[],s=1;s<e.length;s++){var a=+e[s],u=ht({},r,i[s]);u[n]=a;var l=g(ft(t,a),u);o.push(l)}return o}(s,e,r,i,o),s,t))},e.kinks=function(t){var e,n,r={type:"FeatureCollection",features:[]};if("LineString"===(n="Feature"===t.type?t.geometry:t).type)e=[n.coordinates];else if("MultiLineString"===n.type)e=n.coordinates;else if("MultiPolygon"===n.type)e=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=n.coordinates}return e.forEach((function(t){e.forEach((function(e){for(var n=0;n<t.length-1;n++)for(var i=n;i<e.length-1;i++){if(t===e){if(1===Math.abs(n-i))continue;if(0===n&&i===t.length-2&&t[n][0]===t[t.length-1][0]&&t[n][1]===t[t.length-1][1])continue}var o=zr(t[n][0],t[n][1],t[n+1][0],t[n+1][1],e[i][0],e[i][1],e[i+1][0],e[i+1][1]);o&&r.features.push(u([o[0],o[1]]))}}))})),r},e.length=Yr,e.lengthToDegrees=w,e.lengthToRadians=b,e.lineArc=Mi,e.lineChunk=function(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.units,i=n.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return V(t,(function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),function(t,e,n,r){var i=Yr(t,{units:n});if(i<=e)return r(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++)r(Xr(t,e*s,e*(s+1),{units:n}),s)}(t,e,r,(function(t){o.push(t)}))})),f(o)},e.lineDistance=Yr,e.lineEach=q,e.lineIntersect=Rr,e.lineOffset=function(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var i=ot(t),o=t.properties;switch(i){case"LineString":return ss(t,e,r);case"MultiLineString":var s=[];return V(t,(function(t){s.push(ss(t,e,r).geometry.coordinates)})),g(s,o);default:throw new Error("geometry "+i+" is not supported")}},e.lineOverlap=Bi,e.lineReduce=Y,e.lineSegment=Jn,e.lineSlice=function(t,e,n){var r=$(n);if("LineString"!==ot(n))throw new Error("line must be a LineString");for(var i,o=Or(n,t),s=Or(n,e),a=[(i=o.properties.index<=s.properties.index?[o,s]:[s,o])[0].geometry.coordinates],u=i[0].properties.index+1;u<i[1].properties.index+1;u++)a.push(r[u]);return a.push(i[1].geometry.coordinates),p(a,n.properties)},e.lineSliceAlong=Xr,e.lineSplit=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=ot(t),r=ot(e);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=ni(e,{precision:7});switch(r){case"Point":return _i(t,i);case"MultiPoint":return xi(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return xi(t,Rr(t,i))}},e.lineString=p,e.lineStringToPolygon=Ai,e.lineStrings=d,e.lineToPolygon=Ai,e.mask=function(t,e){var n,r=pm(e),i=null;return i="FeatureCollection"===t.type?hm(2===(n=t).features.length?tl.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):tl.union.apply(tl,n.features.map((function(t){return t.geometry.coordinates})))):hm(tl.union(t.geometry.coordinates)),i.geometry.coordinates.forEach((function(t){r.geometry.coordinates.push(t[0])})),r},e.meta=K,e.midpoint=function(t,e){return vn(t,_e(t,e)/2,_n(t,e))},e.moranIndex=function(t,e){var n=e.inputField,r=e.threshold||1e5,i=e.p||2,o=e.binary||!1,s=Ha(t,{alpha:e.alpha||-1,binary:o,p:i,standardization:e.standardization||!0,threshold:r}),a=[];k(t,(function(t){var e=t.properties||{};a.push(e[n])}));for(var u=ja(a),l=function(t){for(var e=ja(t),n=0,r=0,i=t;r<i.length;r++){var o=i[r];n+=Math.pow(o-e,2)}return n/t.length}(a),c=0,h=0,p=0,d=0,f=s.length,g=0;g<f;g++){for(var m=0,y=0;y<f;y++)c+=s[g][y]*(a[g]-u)*(a[y]-u),h+=s[g][y],p+=Math.pow(s[g][y]+s[y][g],2),m+=s[g][y]+s[y][g];d+=Math.pow(m,2)}var v=c/h/l,x=-1/(f-1),_=(f*f*(p*=.5)-f*d+h*h*3)/((f-1)*(f+1)*(h*h))-x*x,b=Math.sqrt(_);return{expectedMoranIndex:x,moranIndex:v,stdNorm:b,zNorm:(v-x)/b}},e.multiLineString=g,e.multiPoint=m,e.multiPolygon=y,e.nearest=Kn,e.nearestPoint=Kn,e.nearestPointOnLine=Or,e.nearestPointToLine=function(t,e,n){void 0===n&&(n={});var r=n.units,i=n.properties||{},o=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return G(t,(function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})})),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter((function(t){return"Point"===t.geometry.type})),t;default:throw new Error("points must be a Point Collection")}}(t);if(!o.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==ot(e))throw new Error("line must be a LineString");var s=1/0,a=null;return k(o,(function(t){var n=Fr(t,e,{units:r});n<s&&(s=n,a=t)})),a&&(a.properties=ht({dist:s},a.properties,i)),a},e.planepoint=function(t,e){var n=Q(t),r=it(e).coordinates[0];if(r.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=e.properties||{},o=i.a,s=i.b,a=i.c,u=n[0],l=n[1],c=r[0][0],h=r[0][1],p=void 0!==o?o:r[0][2],d=r[1][0],f=r[1][1],g=void 0!==s?s:r[1][2],m=r[2][0],y=r[2][1],v=void 0!==a?a:r[2][2];return(v*(u-c)*(l-f)+p*(u-d)*(l-y)+g*(u-m)*(l-h)-g*(u-c)*(l-y)-v*(u-d)*(l-h)-p*(u-m)*(l-f))/((u-c)*(l-f)+(u-d)*(l-y)+(u-m)*(l-h)-(u-c)*(l-y)-(u-d)*(l-h)-(u-m)*(l-f))},e.point=u,e.pointGrid=ei,e.pointOnFeature=Gr,e.pointOnLine=Or,e.pointOnSurface=Gr,e.pointToLineDistance=Fr,e.points=l,e.pointsWithinPolygon=xe,e.polygon=c,e.polygonSmooth=function(t,e){var n=[],r=e.iterations||1;if(!t)throw new Error("inputPolys is required");return G(t,(function(t,e,i){var o,s,a;switch(t.type){case"Polygon":o=[[]];for(var u=0;u<r;u++)a=[[]],s=t,u>0&&(s=c(o).geometry),Ga(s,a),o=a.slice(0);n.push(c(o,i));break;case"MultiPolygon":o=[[[]]];for(var l=0;l<r;l++)a=[[[]]],s=t,l>0&&(s=y(o).geometry),Ua(s,a),o=a.slice(0);n.push(y(o,i));break;default:throw new Error("geometry is invalid, must be Polygon or MultiPolygon")}})),f(n)},e.polygonTangents=function(t,e){var n,r,i,o,s=$(t),a=$(e),l=J(e),c=0,h=null;switch(s[0]>l[0]&&s[0]<l[2]&&s[1]>l[1]&&s[1]<l[3]&&(c=(h=Kn(t,Mn(e))).properties.featureIndex),ot(e)){case"Polygon":n=a[0][c],r=a[0][0],null!==h&&h.geometry.coordinates[1]<s[1]&&(r=a[0][c]),o=qi(a[0][0],a[0][a[0].length-1],s);var p=ji(a[0],s,o,i,n,r);n=p[0],r=p[1];break;case"MultiPolygon":for(var d=0,g=0,m=0,y=0;y<a[0].length;y++){d=y;for(var v=!1,x=0;x<a[0][y].length;x++){if(g=x,m===c){v=!0;break}m++}if(v)break}n=a[0][d][g],r=a[0][d][g],o=qi(a[0][0][0],a[0][0][a[0][0].length-1],s),a.forEach((function(t){var e=ji(t[0],s,o,i,n,r);n=e[0],r=e[1]}))}return f([u(n),u(r)])},e.polygonToLine=Si,e.polygonToLineString=Si,e.polygonize=function(t){var e=ps.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var n=[],r=[];return e.getEdgeRings().filter((function(t){return t.isValid()})).forEach((function(t){t.isHole()?n.push(t):r.push(t)})),n.forEach((function(t){hs.findEdgeRingContaining(t,r)&&r.push(t)})),f(r.map((function(t){return t.toPolygon()})))},e.polygons=h,e.projection=Ka,e.propEach=D,e.propReduce=F,e.propertiesContainsFilter=cu,e.radians2degrees=E,e.radiansToDegrees=E,e.radiansToDistance=_,e.radiansToLength=_,e.random=iu,e.randomLineString=eu,e.randomPoint=$a,e.randomPolygon=tu,e.randomPosition=Qa,e.rewind=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.reverse||!1,r=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof n)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(t=Se(t));var i=[];switch(t.type){case"GeometryCollection":return G(t,(function(t){Xi(t,n)})),t;case"FeatureCollection":return k(t,(function(t){k(Xi(t,n),(function(t){i.push(t)}))})),f(i)}return Xi(t,n)},e.rhumbBearing=Ui,e.rhumbDestination=Hi,e.rhumbDistance=Dr,e.round=x,e.sample=function(t,e){if(!t)throw new Error("featurecollection is required");if(null==e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return f(function(t,e){for(var n,r,i=t.slice(0),o=t.length,s=o-e;o-- >s;)n=i[r=Math.floor((o+1)*Math.random())],i[r]=i[o],i[o]=n;return i.slice(s)}(t.features,e))},e.sector=function(t,e,n,r,i){if(!P(i=i||{}))throw new Error("options is invalid");var o=i.properties;if(!t)throw new Error("center is required");if(null==n)throw new Error("bearing1 is required");if(null==r)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(Gi(n)===Gi(r))return xn(t,e,i);var s=$(t),a=Mi(t,e,n,r,i),u=[[s]];return N(a,(function(t){u[0].push(t)})),u[0].push(s),c(u,o)},e.segmentEach=j,e.segmentReduce=W,e.shortestPath=function(t,e,n){if(!P(n=n||{}))throw new Error("options is invalid");var r=n.resolution,i=n.minDistance,o=n.obstacles||f([]);if(!t)throw new Error("start is required");if(!e)throw new Error("end is required");if(r&&!A(r)||r<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var a=Q(t),l=Q(e);switch(t=u(a),e=u(l),ot(o)){case"FeatureCollection":if(0===o.features.length)return p([a,l]);break;case"Polygon":o=f([s(it(o))]);break;default:throw new Error("invalid obstacles")}var c=o;c.features.push(t),c.features.push(e);var h=J(es(gn(J(c)),1.15));r||(r=_e([h[0],h[1]],[h[2],h[1]],n)/100),c.features.pop(),c.features.pop();for(var d=h[0],g=h[1],m=h[2],y=h[3],v=r/_e([d,g],[m,g],n)*(m-d),x=r/_e([d,g],[d,y],n)*(y-g),_=m-d,b=y-g,w=Math.floor(_/v),M=Math.floor(b/x),E=(_-w*v)/2,S=[],T=[],C=[],L=[],I=1/0,R=1/0,N=y-(b-M*x)/2,O=0;N>=g;){for(var D=[],F=[],k=d+E,B=0;k<=m;){var z=u([k,N]),G=Ks(z,o);D.push(G?0:1),F.push(k+"|"+N);var U=_e(z,t);!G&&U<I&&(I=U,C={x:B,y:O});var V=_e(z,e);!G&&V<R&&(R=V,L={x:B,y:O}),k+=v,B++}T.push(D),S.push(F),N-=x,O++}var H=new Ys(T,{diagonal:!0}),j=H.grid[C.y][C.x],W=H.grid[L.y][L.x],q=qs.search(H,j,W),Y=[a];return q.forEach((function(t){var e=S[t.x][t.y].split("|");Y.push([+e[0],+e[1]])})),Y.push(l),en(p(Y))},e.simplify=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=void 0!==e.tolerance?e.tolerance:1,r=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(t=Se(t)),G(t,(function(t){!function(t,e,n){var r=t.type;if("Point"===r||"MultiPoint"===r)return t;en(t,!0);var i=t.coordinates;switch(r){case"LineString":t.coordinates=cn(i,e,n);break;case"MultiLineString":t.coordinates=i.map((function(t){return cn(t,e,n)}));break;case"Polygon":t.coordinates=hn(i,e,n);break;case"MultiPolygon":t.coordinates=i.map((function(t){return hn(t,e,n)}))}}(t,n,r)})),t},e.square=yn,e.squareGrid=dm,e.standardDeviationalEllipse=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.steps||64,r=e.weight,i=e.properties||{};if(!A(n))throw new Error("steps must be a number");if(!P(i))throw new Error("properties must be a number");var o=z(t).length,s=ka(t,{weight:r}),a=0,u=0,l=0;k(t,(function(t){var e=t.properties[r]||1,n=za($(t),$(s));a+=Math.pow(n.x,2)*e,u+=Math.pow(n.y,2)*e,l+=n.x*n.y*e}));var c=a-u,h=Math.sqrt(Math.pow(c,2)+4*Math.pow(l,2)),p=2*l,d=Math.atan((c+h)/p),g=180*d/Math.PI,m=0,y=0,v=0;k(t,(function(t){var e=t.properties[r]||1,n=za($(t),$(s));m+=Math.pow(n.x*Math.cos(d)-n.y*Math.sin(d),2)*e,y+=Math.pow(n.x*Math.sin(d)+n.y*Math.cos(d),2)*e,v+=e}));var x=Math.sqrt(2*m/v),_=Math.sqrt(2*y/v),b=Da(s,x,_,{units:"degrees",angle:g,steps:n,properties:i}),w=xe(t,f([b])),M={meanCenterCoordinates:$(s),semiMajorAxis:x,semiMinorAxis:_,numberOfFeatures:o,angle:g,percentageWithinEllipse:100*z(w).length/o};return b.properties.standardDeviationalEllipse=M,b},e.tag=function(t,e,n,r){return t=Se(t),e=Se(e),k(t,(function(t){t.properties||(t.properties={}),k(e,(function(e){void 0===t.properties[r]&&ye(t,e)&&(t.properties[r]=e.properties[n])}))})),t},e.tesselate=function(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=Zn(t.geometry.coordinates):t.geometry.coordinates.forEach((function(t){e.features=e.features.concat(Zn(t))})),e},e.tin=be,e.toMercator=Wa,e.toWgs84=qa,e.transformRotate=ts,e.transformScale=es,e.transformTranslate=function(t,e,n,r){if(!P(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.zTranslation,s=r.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(null==n||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n+=180),!1!==s&&void 0!==s||(t=Se(t)),N(t,(function(t){var r=$(Hi(t,e,n,{units:i}));t[0]=r[0],t[1]=r[1],o&&3===t.length&&(t[2]+=o)})),t},e.triangleGrid=fm,e.truncate=ni,e.union=function(t,e,n){void 0===n&&(n={});var r=it(t),i=it(e),o=tl.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?c(o[0],n.properties):y(o,n.properties)},e.unitsFactors=i,e.unkinkPolygon=function(t){var e=[];return V(t,(function(t){"Polygon"===t.geometry.type&&k(si(t),(function(n){e.push(c(n.geometry.coordinates,t.properties))}))})),f(e)},e.validateBBox=L,e.validateId=I,e.voronoi=function(t,e){if(!P(e=e||{}))throw new Error("options is invalid");var n=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(n))throw new Error("bbox is invalid");return rt(t,"Point","points"),f(function(){var t=Qs,e=$s,n=null;function r(r){return new Na(r.map((function(n,i){var o=[Math.round(t(n,i,r)/La)*La,Math.round(e(n,i,r)/La)*La];return o.index=i,o.data=n,o})),n)}return r.polygons=function(t){return r(t).polygons()},r.links=function(t){return r(t).links()},r.triangles=function(t){return r(t).triangles()},r.x=function(e){return arguments.length?(t="function"==typeof e?e:Js(+e),r):t},r.y=function(t){return arguments.length?(e="function"==typeof t?t:Js(+t),r):e},r.extent=function(t){return arguments.length?(n=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],r):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},r.size=function(t){return arguments.length?(n=null==t?null:[[0,0],[+t[0],+t[1]]],r):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},r}().x((function(t){return t.geometry.coordinates[0]})).y((function(t){return t.geometry.coordinates[1]})).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(t.features).map(Oa))},e.within=xe,Object.defineProperty(e,"__esModule",{value:!0})}))}).call(this,n("4362"))},"5bc4":function(t,e){function n(t){t=t.replace(/,/g," ").replace(/-/g," - ").replace(/-\s+/g,"-").replace(/([a-zA-Z])/g," $1 ");var e,n,r,i,o,s,a=t.replace(/([a-zA-Z])\s?/g,"|$1").split("|"),u=a.length,l=[],c=0,h=0,p=0,d=0,f=0,g=0,m=0,y=0,v="";for(e=1;e<u;e++)if(n=a[e],r=n.substring(0,1),i=r.toLowerCase(),l=n.replace(r,"").trim().split(" "),l=l.filter((function(t){return""!==t})).map(parseFloat),o=l.length,"m"===i){if(v+="M ","m"===r?(p+=l[0],d+=l[1]):(p=l[0],d=l[1]),c=p,h=d,v+=p+" "+d+" ",o>2)for(s=0;s<o;s+=2)"m"===r?(p+=l[s],d+=l[s+1]):(p=l[s],d=l[s+1]),v+=["L",p,d,""].join(" ")}else if("l"===i)for(s=0;s<o;s+=2)"l"===r?(p+=l[s],d+=l[s+1]):(p=l[s],d=l[s+1]),v+=["L",p,d,""].join(" ");else if("h"===i)for(s=0;s<o;s++)"h"===r?p+=l[s]:p=l[s],v+=["L",p,d,""].join(" ");else if("v"===i)for(s=0;s<o;s++)"v"===r?d+=l[s]:d=l[s],v+=["L",p,d,""].join(" ");else if("q"===i)for(s=0;s<o;s+=4)"q"===r?(f=p+l[s],g=d+l[s+1],p+=l[s+2],d+=l[s+3]):(f=l[s],g=l[s+1],p=l[s+2],d=l[s+3]),v+=["Q",f,g,p,d,""].join(" ");else if("t"===i)for(s=0;s<o;s+=2)f=p+(p-f),g=d+(d-g),"t"===r?(p+=l[s],d+=l[s+1]):(p=l[s],d=l[s+1]),v+=["Q",f,g,p,d,""].join(" ");else if("c"===i)for(s=0;s<o;s+=6)"c"===r?(f=p+l[s],g=d+l[s+1],m=p+l[s+2],y=d+l[s+3],p+=l[s+4],d+=l[s+5]):(f=l[s],g=l[s+1],m=l[s+2],y=l[s+3],p=l[s+4],d=l[s+5]),v+=["C",f,g,m,y,p,d,""].join(" ");else if("s"===i)for(s=0;s<o;s+=4)f=p+(p-m),g=d+(d-y),"s"===r?(m=p+l[s],y=d+l[s+1],p+=l[s+2],d+=l[s+3]):(m=l[s],y=l[s+1],p=l[s+2],d=l[s+3]),v+=["C",f,g,m,y,p,d,""].join(" ");else"z"===i&&(v+="Z ",p=c,d=h);return v.trim()}t.exports=n},"5d5a":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("d777"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.cornerRadius(),n=this.width(),r=this.height();if(t.beginPath(),e){var i=0,o=0,s=0,a=0;"number"===typeof e?i=o=s=a=Math.min(e,n/2,r/2):(i=Math.min(e[0],n/2,r/2),o=Math.min(e[1],n/2,r/2),a=Math.min(e[2],n/2,r/2),s=Math.min(e[3],n/2,r/2)),t.moveTo(i,0),t.lineTo(n-o,0),t.arc(n-o,o,o,3*Math.PI/2,0,!1),t.lineTo(n,r-a),t.arc(n-a,r-a,a,0,Math.PI/2,!1),t.lineTo(s,r),t.arc(s,r-s,s,Math.PI/2,Math.PI,!1),t.lineTo(0,i),t.arc(i,i,i,Math.PI,3*Math.PI/2,!1)}else t.rect(0,0,n,r);t.closePath(),t.fillStrokeShape(this)},e}(s.Shape);e.Rect=u,u.prototype.className="Rect",a._registerNode(u),o.Factory.addGetterSetter(u,"cornerRadius",0),i.Collection.mapMethods(u)},6929:function(t,e,n){"use strict";var r=n("1ab9"),i=n("bb15"),o=[].slice,s=["keyword","gray","hex"],a={};Object.keys(i).forEach((function(t){a[o.call(i[t].labels).sort().join("")]=t}));var u={};function l(t,e){if(!(this instanceof l))return new l(t,e);if(e&&e in s&&(e=null),e&&!(e in i))throw new Error("Unknown model: "+e);var n,c;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof l)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"===typeof t){var h=r.get(t);if(null===h)throw new Error("Unable to parse color from string: "+t);this.model=h.model,c=i[this.model].channels,this.color=h.value.slice(0,c),this.valpha="number"===typeof h.value[c]?h.value[c]:1}else if(t.length){this.model=e||"rgb",c=i[this.model].channels;var p=o.call(t,0,c);this.color=g(p,c),this.valpha="number"===typeof t[c]?t[c]:1}else if("number"===typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var d=Object.keys(t);"alpha"in t&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0);var f=d.sort().join("");if(!(f in a))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=a[f];var m=i[this.model].labels,y=[];for(n=0;n<m.length;n++)y.push(t[m[n]]);this.color=g(y)}if(u[this.model])for(c=i[this.model].channels,n=0;n<c;n++){var v=u[this.model][n];v&&(this.color[n]=v(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function c(t,e){return Number(t.toFixed(e))}function h(t){return function(e){return c(e,t)}}function p(t,e,n){return t=Array.isArray(t)?t:[t],t.forEach((function(t){(u[t]||(u[t]=[]))[e]=n})),t=t[0],function(r){var i;return arguments.length?(n&&(r=n(r)),i=this[t](),i.color[e]=r,i):(i=this[t]().color[e],n&&(i=n(i)),i)}}function d(t){return function(e){return Math.max(0,Math.min(t,e))}}function f(t){return Array.isArray(t)?t:[t]}function g(t,e){for(var n=0;n<e;n++)"number"!==typeof t[n]&&(t[n]=0);return t}l.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in r.to?this:this.rgb();e=e.round("number"===typeof t?t:1);var n=1===e.valpha?e.color:e.color.concat(this.valpha);return r.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"===typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return r.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=i[this.model].channels,n=i[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new l(this.color.map(h(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new l(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:p("rgb",0,d(255)),green:p("rgb",1,d(255)),blue:p("rgb",2,d(255)),hue:p(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:p("hsl",1,d(100)),lightness:p("hsl",2,d(100)),saturationv:p("hsv",1,d(100)),value:p("hsv",2,d(100)),chroma:p("hcg",1,d(100)),gray:p("hcg",2,d(100)),white:p("hwb",1,d(100)),wblack:p("hwb",2,d(100)),cyan:p("cmyk",0,d(100)),magenta:p("cmyk",1,d(100)),yellow:p("cmyk",2,d(100)),black:p("cmyk",3,d(100)),x:p("xyz",0,d(100)),y:p("xyz",1,d(100)),z:p("xyz",2,d(100)),l:p("lab",0,d(100)),a:p("lab",1),b:p("lab",2),keyword:function(t){return arguments.length?new l(t):i[this.model].keyword(this.color)},hex:function(t){return arguments.length?new l(t):r.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return l.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n+t)%360,n=n<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),r=this.rgb(),i=void 0===e?.5:e,o=2*i-1,s=n.alpha()-r.alpha(),a=((o*s===-1?o:(o+s)/(1+o*s))+1)/2,u=1-a;return l.rgb(a*n.red()+u*r.red(),a*n.green()+u*r.green(),a*n.blue()+u*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(i).forEach((function(t){if(-1===s.indexOf(t)){var e=i[t].channels;l.prototype[t]=function(){if(this.model===t)return new l(this);if(arguments.length)return new l(arguments,t);var n="number"===typeof arguments[e]?e:this.valpha;return new l(f(i[this.model][t].raw(this.color)).concat(n),t)},l[t]=function(n){return"number"===typeof n&&(n=g(o.call(arguments),e)),new l(n,t)}}})),t.exports=l},"6b7e":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.Brighten=function(t){var e,n=255*this.brightness(),r=t.data,i=r.length;for(e=0;e<i;e+=4)r[e]+=n,r[e+1]+=n,r[e+2]+=n},r.Factory.addGetterSetter(i.Node,"brightness",0,o.getNumberValidator(),r.Factory.afterSetFilter)},"6bed":function(t,e,n){"use strict";n("e660")},"769d":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Sepia=function(t){var e,n,r,i,o=t.data,s=o.length;for(e=0;e<s;e+=4)n=o[e+0],r=o[e+1],i=o[e+2],o[e+0]=Math.min(255,.393*n+.769*r+.189*i),o[e+1]=Math.min(255,.349*n+.686*r+.168*i),o[e+2]=Math.min(255,.272*n+.534*r+.131*i)}},"78a2":function(t,e,n){(function(e,n){t.exports=n()})(0,(function(){"use strict";function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(n){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){t(n,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))}))}return n}
/*!
   * isobject <https://github.com/jonschlinkert/isobject>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   */var r=function(t){return null!=t&&"object"===typeof t&&!1===Array.isArray(t)};function i(t){return!0===r(t)&&"[object Object]"===Object.prototype.toString.call(t)}var o=function(t){var e,n;return!1!==i(t)&&(e=t.constructor,"function"===typeof e&&(n=e.prototype,!1!==i(n)&&!1!==n.hasOwnProperty("isPrototypeOf")))},s={}.toString,a=Array.isArray||function(t){return"[object Array]"==s.call(t)},u=function(t){return null!=t&&"object"===typeof t&&!1===a(t)},l=function(t,e){if(null===t||void 0===t)return!1;if("boolean"===typeof t)return!0;if("number"===typeof t)return 0!==t||!0!==e;if(void 0!==t.length)return 0!==t.length;for(var n in t)if(t.hasOwnProperty(n))return!0;return!1},c=function(t,e,n,r,i){if(!h(t)||!e)return t;if(e=p(e),n&&(e+="."+p(n)),r&&(e+="."+p(r)),i&&(e+="."+p(i)),e in t)return t[e];var o=e.split("."),s=o.length,a=-1;while(t&&++a<s){var u=o[a];while("\\"===u[u.length-1])u=u.slice(0,-1)+"."+o[++a];t=t[u]}return t};function h(t){return null!==t&&("object"===typeof t||"function"===typeof t)}function p(t){return t?Array.isArray(t)?t.join("."):t:""}var d=function(t,e,n){return u(t)?l(c(t,e),n):l(t,e)},f=function(t,e){if(!r(t))throw new TypeError("expected an object.");if(t.hasOwnProperty(e))return delete t[e],!0;if(d(t,e)){var n=e.split("."),i=n.pop();while(n.length&&"\\"===n[n.length-1].slice(-1))i=n.pop().slice(0,-1)+"."+i;while(n.length)t=t[e=n.shift()];return delete t[i]}return!0},g=function t(e,n){if("undefined"===typeof e)return{};if(Array.isArray(e)){for(var r=0;r<e.length;r++)e[r]=t(e[r],n);return e}if(!o(e))return e;if("string"===typeof n&&(n=[n]),!Array.isArray(n))return e;for(var i=0;i<n.length;i++)f(e,n[i]);for(var s in e)e.hasOwnProperty(s)&&(e[s]=t(e[s],n));return e},m=function(t){return null!=t&&(y(t)||v(t)||!!t._isBuffer)};function y(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function v(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&y(t.slice(0,0))}var x=Object.prototype.toString,_=function(t){if("undefined"===typeof t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"===typeof t||t instanceof String)return"string";if("number"===typeof t||t instanceof Number)return"number";if("function"===typeof t||t instanceof Function)return"function";if("undefined"!==typeof Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=x.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"[object Error]"===e?"error":m(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"};function b(t,e){return e={exports:{}},t(e,e.exports),e.exports}var w=b((function(t){(function(){function e(t,e){if("function"!==typeof e)return t;var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[e(r,t[r])||r]=t[r]);return n}t.exports?t.exports=e:window.rename=e})()})),M=function t(e,n){var r=_(e);if("object"!==r&&"array"!==r)throw new Error("expected an object");var i=[];for(var o in"object"===r&&(e=w(e,n),i={}),e)if(e.hasOwnProperty(o)){var s=e[o];"object"===_(s)||"array"===_(s)?i[o]=t(s,n):i[o]=s}return i},E=b((function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},o.prototype.listeners=function(t,e){var r=n?n+t:t,i=this._events[r];if(e)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var o=0,s=i.length,a=new Array(s);o<s;o++)a[o]=i[o].fn;return a},o.prototype.emit=function(t,e,r,i,o,s){var a=n?n+t:t;if(!this._events[a])return!1;var u,l,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,s),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,i);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},o.prototype.on=function(t,e,r){var o=new i(e,r||this),s=n?n+t:t;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):(this._events[s]=o,this._eventsCount++),this},o.prototype.once=function(t,e,r){var o=new i(e,r||this,!0),s=n?n+t:t;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):(this._events[s]=o,this._eventsCount++),this},o.prototype.removeListener=function(t,e,i,o){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return 0===--this._eventsCount?this._events=new r:delete this._events[s],this;var a=this._events[s];if(a.fn)a.fn!==e||o&&!a.once||i&&a.context!==i||(0===--this._eventsCount?this._events=new r:delete this._events[s]);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==e||o&&!a[u].once||i&&a[u].context!==i)&&l.push(a[u]);l.length?this._events[s]=1===l.length?l[0]:l:0===--this._eventsCount?this._events=new r:delete this._events[s]}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&(0===--this._eventsCount?this._events=new r:delete this._events[e])):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=n,o.EventEmitter=o,t.exports=o}));function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var T=function(){},C={data:"state-data",cdata:"state-cdata",tagBegin:"state-tag-begin",tagName:"state-tag-name",tagEnd:"state-tag-end",attributeNameStart:"state-attribute-name-start",attributeName:"state-attribute-name",attributeNameEnd:"state-attribute-name-end",attributeValueBegin:"state-attribute-value-begin",attributeValue:"state-attribute-value"},A={lt:"action-lt",gt:"action-gt",space:"action-space",equal:"action-equal",quote:"action-quote",slash:"action-slash",char:"action-char",error:"action-error"},P={text:"text",openTag:"open-tag",closeTag:"close-tag",attributeName:"attribute-name",attributeValue:"attribute-value"},L={" ":A.space,"\t":A.space,"\n":A.space,"\r":A.space,"<":A.lt,">":A.gt,'"':A.quote,"'":A.quote,"=":A.equal,"/":A.slash},I=function(t){return L[t]||A.char},R=function(t){var e,n,r,i,o,s,a,u,l,c;t=Object.assign({debug:!1},t);var h=new E,p=C.data,d="",f="",g="",m="",y="",v="",x=function(e,n){if("?"!==f[0]&&"!"!==f[0]){var r={type:e,value:n};t.debug&&console.log("emit:",r),h.emit("data",r)}};h.stateMachine=(c={},S(c,C.data,(e={},S(e,A.lt,(function(){d.trim()&&x(P.text,d),f="",y=!1,p=C.tagBegin})),S(e,A.char,(function(t){d+=t})),e)),S(c,C.cdata,S({},A.char,(function(t){d+=t,"]]>"===d.substr(-3)&&(x(P.text,d.slice(0,-3)),d="",p=C.data)}))),S(c,C.tagBegin,(n={},S(n,A.space,T),S(n,A.char,(function(t){f=t,p=C.tagName})),S(n,A.slash,(function(){f="",y=!0})),n)),S(c,C.tagName,(r={},S(r,A.space,(function(){y?p=C.tagEnd:(p=C.attributeNameStart,x(P.openTag,f))})),S(r,A.gt,(function(){x(y?P.closeTag:P.openTag,f),d="",p=C.data})),S(r,A.slash,(function(){p=C.tagEnd,x(P.openTag,f)})),S(r,A.char,(function(t){f+=t,"![CDATA["===f&&(p=C.cdata,d="",f="")})),r)),S(c,C.tagEnd,(i={},S(i,A.gt,(function(){x(P.closeTag,f),d="",p=C.data})),S(i,A.char,T),i)),S(c,C.attributeNameStart,(o={},S(o,A.char,(function(t){g=t,p=C.attributeName})),S(o,A.gt,(function(){d="",p=C.data})),S(o,A.space,T),S(o,A.slash,(function(){y=!0,p=C.tagEnd})),o)),S(c,C.attributeName,(s={},S(s,A.space,(function(){p=C.attributeNameEnd})),S(s,A.equal,(function(){x(P.attributeName,g),p=C.attributeValueBegin})),S(s,A.gt,(function(){m="",x(P.attributeName,g),x(P.attributeValue,m),d="",p=C.data})),S(s,A.slash,(function(){y=!0,m="",x(P.attributeName,g),x(P.attributeValue,m),p=C.tagEnd})),S(s,A.char,(function(t){g+=t})),s)),S(c,C.attributeNameEnd,(a={},S(a,A.space,T),S(a,A.equal,(function(){x(P.attributeName,g),p=C.attributeValueBegin})),S(a,A.gt,(function(){m="",x(P.attributeName,g),x(P.attributeValue,m),d="",p=C.data})),S(a,A.char,(function(t){m="",x(P.attributeName,g),x(P.attributeValue,m),g=t,p=C.attributeName})),a)),S(c,C.attributeValueBegin,(u={},S(u,A.space,T),S(u,A.quote,(function(t){v=t,m="",p=C.attributeValue})),S(u,A.gt,(function(){m="",x(P.attributeValue,m),d="",p=C.data})),S(u,A.char,(function(t){v="",m=t,p=C.attributeValue})),u)),S(c,C.attributeValue,(l={},S(l,A.space,(function(t){v?m+=t:(x(P.attributeValue,m),p=C.attributeNameStart)})),S(l,A.quote,(function(t){v===t?(x(P.attributeValue,m),p=C.attributeNameStart):m+=t})),S(l,A.gt,(function(t){v?m+=t:(x(P.attributeValue,m),d="",p=C.data)})),S(l,A.slash,(function(t){v?m+=t:(x(P.attributeValue,m),y=!0,p=C.tagEnd)})),S(l,A.char,(function(t){m+=t})),l)),c);var _=function(e){t.debug&&console.log(p,e);var n=h.stateMachine[p],r=n[I(e)]||n[A.error]||n[A.char];r(e)};return h.write=function(t){for(var e=t.length,n=0;n<e;n++)_(t[n])},h},N={State:C,Action:A,Type:P,create:R},O=N.Type,D={element:"element",text:"text"},F=function(t){return Object.assign({name:"",type:D.element,value:"",parent:null,attributes:{},children:[]},t)},k=function(t){t=Object.assign({stream:!1,parentNodes:!0,doneEvent:"done",tagPrefix:"tag:",emitTopLevelOnly:!1,debug:!1},t);var e=void 0,n=void 0,r=void 0,i=void 0,o=new E,s=function(s){switch(s.type){case O.openTag:if(null===r)r=n,r.name=s.value;else{var a=F({name:s.value,parent:r});r.children.push(a),r=a}break;case O.closeTag:var u=r.parent;if(t.parentNodes||(r.parent=null),r.name!==s.value)break;t.stream&&u===n&&(n.children=[],r.parent=null),t.emitTopLevelOnly&&u!==n||(o.emit(t.tagPrefix+r.name,r),o.emit("tag",r.name,r)),r===n&&(e.removeAllListeners("data"),o.emit(t.doneEvent,r),n=null),r=u;break;case O.text:r&&r.children.push(F({type:D.text,value:s.value,parent:t.parentNodes?r:null}));break;case O.attributeName:i=s.value,r.attributes[i]="";break;case O.attributeValue:r.attributes[i]=s.value;break}};return o.reset=function(){e=N.create({debug:t.debug}),e.on("data",s),n=F(),r=null,i="",o.parse=e.write},o.reset(),o},B=function(t,e){e=Object.assign({},e,{stream:!1,tagPrefix:":"});var n=k(e),r=void 0;return n.on("done",(function(t){r=t})),n.parse(t),r},z={parseSync:B,create:k,NodeType:D},G=z.parseSync,U=function(t){var e=G(t,{parentNodes:!1}),n="root"===e.name&&e.children.length>1,r=n?e.children.reduce((function(t,e){var n=e.name;return!!t||"svg"===n}),!1):"svg"===e.children[0].name;if(r)return n?e:e.children[0];throw Error("nothing to parse")},V=function(t){return t.replace(/<[\/]{0,1}(\!?DOCTYPE|\??xml)[^><]*>/gi,"")},H=function(t){return"<root>".concat(t,"</root>")},j=function(t){return g(t,["parent"])},W=function(t){return M(t,(function(t){return Y(t)?t:q(t)}))},q=function(t){return t.replace(/[-|:]([a-z])/gi,(function(t,e){return e.toUpperCase()}))},Y=function(t){return/^(data|aria)(-\w+)/.test(t)},X=function(t){if(t){var e=String(t);return/[&<>]/.test(e)?"<![CDATA[".concat(e.replace(/]]>/,"]]]]><![CDATA[>"),"]]>"):e}return""},Z=function(t){return String(t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},K=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.transformNode,i=void 0===r?function(t){return t}:r,o=e.camelcase,s=void 0!==o&&o,a=function(t){var e=V(t);return H(e)},u=function(t){return"root"===t.name?t.children:t},l=function(t){var e,r=function t(e){var r=e.children;return"root"===e.name?r.map(t):n(n({},i(e)),r&&r.length>0?{children:r.map(t)}:{})};return e=j(t),e=r(e),s&&(e=W(e)),e};return u(l(U(a(t))))};function J(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new Promise((function(t,n){try{var r=K.apply(void 0,e);t(r)}catch(i){n(i)}}))}var Q=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.transformAttr,i=void 0===r?function(t,e,n){return"".concat(t,'="').concat(n(e),'"')}:r,o=n.selfClose,s=void 0===o||o;if(Array.isArray(e))return e.map((function(e){return t(e,{transformAttr:i,selfClose:s})})).join("");if("text"===e.type)return X(e.value);var a="";for(var u in e.attributes){var l=i(u,e.attributes[u],Z,e.name);a+=l?" ".concat(l):""}return e.children.length||!s?"<".concat(e.name).concat(a,">").concat(t(e.children,{transformAttr:i,selfClose:s}),"</").concat(e.name,">"):"<".concat(e.name).concat(a,"/>")},$=Object.assign({},{parse:J,parseSync:K,stringify:Q});return $}))},"7cc1":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Solarize=function(t){var e=t.data,n=t.width,r=t.height,i=4*n,o=r;do{var s=(o-1)*i,a=n;do{var u=s+4*(a-1),l=e[u],c=e[u+1],h=e[u+2];l>127&&(l=255-l),c>127&&(c=255-c),h>127&&(h=255-h),e[u]=l,e[u+1]=c,e[u+2]=h}while(--a)}while(--o)}},"7d2a":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=new Map,o=void 0!==r.Konva._global["PointerEvent"];function s(t){return i.get(t)}function a(t){return{evt:t,pointerId:t.pointerId}}function u(t,e){return i.get(t)===e}function l(t,e){c(t);var n=e.getStage();n&&(i.set(t,e),o&&e._fire("gotpointercapture",a(new PointerEvent("gotpointercapture"))))}function c(t,e){var n=i.get(t);if(n){var r=n.getStage();r&&r.content,i.delete(t),o&&n._fire("lostpointercapture",a(new PointerEvent("lostpointercapture")))}}e.getCapturedShape=s,e.createEvent=a,e.hasPointerCapture=u,e.setPointerCapture=l,e.releaseCapture=c},8603:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("d777"),u=n("4546"),l=n("d777"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e=a.Konva.getAngle(this.angle()),n=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,n),t.arc(0,0,this.innerRadius(),e,0,!n),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.outerRadius()},e.prototype.getHeight=function(){return 2*this.outerRadius()},e.prototype.setWidth=function(t){this.outerRadius(t/2)},e.prototype.setHeight=function(t){this.outerRadius(t/2)},e}(s.Shape);e.Arc=c,c.prototype._centroid=!0,c.prototype.className="Arc",c.prototype._attrsAffectingSize=["innerRadius","outerRadius"],l._registerNode(c),o.Factory.addGetterSetter(c,"innerRadius",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"outerRadius",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"angle",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clockwise",!1,u.getBooleanValidator()),i.Collection.mapMethods(c)},8673:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAArpJREFUSEu1lktoE1EUhv8zyfSVhY+KFQqFUoV2KViQ2KaZNmIfiVLF4sqNiC7ERUEsKIovcCddiNSNS0GKj5pE05nGTPqymrXFhehGlLYEF622yeQeSWqCbdJ0kqZ3NXD////O5d575hJMjlfa+xpZxBoFcXXSQhIWSKbZbodj3kwE5RM917TqcpYvMXAGQGMOLYPoE4if2iTxUFGUXxvl5QQNRSJybXSpH4QBADvNVAwgSiTdW4q2DPb1UWK9JwukaTPVy7wyDLDTJGCtjKHaZNG3fnVrQIHA5N64FJ8CqKEoyD8TEWYthtzS2WmPpnMyIL/fXy7KbEEw7FuBZIIJwSqLOKYoipE6POkJr6rfB3C1FJBMBtFNt8txOwMaUcfrJIjPACpKCgIWySoO9CjKz9SKfGr4EYMvlhiSiiOJHvR0OPppaCgi1zYszYFNH+PC6mHMf5wM7iO/OnFYIDFdmLswNVmtB+m1GjpPoMeFWQtTC+az5FX1awDu5rAaEpMTxmLETKwhVzZLkEIALDn0V8irhW+A+VbWJGGR/9hqPJ5Dv82AAoGALS5VJBtsZZaeMUA+LXSZmQY3CPsKYBYgzg/j5OltAlCfWyddIJ823sks3pipumgNcTs9U9UdVShbAGAtOii/cYV32XanLqxX1X0AurcFRHjhdrWdXO0MY7qDBfRtADETH/G4nNOZpupTwy8ZfKKkMKJht8txOtNUkx8jqlonoewDgJoSwX6wJDd7Ouzf14BSezWm2yEQBFC+RdgyWSRnT3vrTDon61fuHw23CeJhAHuKgRFoTrLSqS6ldeJ/f87HSUDX640YPWFwWyEwIgrG4olzvV3Kt/W+vM8t76h+nAjXGWjeBDgD0B33UUfymuQceUFpx9t3U/sTwnCC0cRi9QEJCclLPhuPGaHe7o4vm638Lzbk6jQVPh9tAAAAAElFTkSuQmCC"},"89c1":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Invert=function(t){var e,n=t.data,r=n.length;for(e=0;e<r;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2]}},"89dd":function(t,e,n){var r=n("1aeb");t.exports=function(t,e){Array.isArray(e)||(e=[]),t.length>0&&e.push(r([0,0],t[0]));for(var n=0;n<t.length-1;n++){var i=t[n],o=t[n+1],s=i[0],a=i[1],u=o[0],l=o[1],c=[.75*s+.25*u,.75*a+.25*l],h=[.25*s+.75*u,.25*a+.75*l];e.push(c),e.push(h)}return t.length>1&&e.push(r([0,0],t[t.length-1])),e}},"8c18":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("d777"),u=function(t){function e(n){var r=t.call(this,n)||this;r.dataArray=[],r.pathLength=0,r.dataArray=e.parsePathData(r.data()),r.pathLength=0;for(var i=0;i<r.dataArray.length;++i)r.pathLength+=r.dataArray[i].pathLength;return r.on("dataChange.konva",(function(){this.dataArray=e.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength})),r}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.dataArray;t.beginPath();for(var n=!1,r=0;r<e.length;r++){var i=e[r].command,o=e[r].points;switch(i){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var s=o[0],a=o[1],u=o[2],l=o[3],c=o[4],h=o[5],p=o[6],d=o[7],f=u>l?u:l,g=u>l?1:u/l,m=u>l?l/u:1;t.translate(s,a),t.rotate(p),t.scale(g,m),t.arc(0,0,f,c,c+h,1-d),t.scale(1/g,1/m),t.rotate(-p),t.translate(-s,-a);break;case"z":n=!0,t.closePath();break}}n||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)},e.prototype.getSelfRect=function(){var t=[];this.dataArray.forEach((function(n){if("A"===n.command){var r=n.points[4],i=n.points[5],o=n.points[4]+i,s=Math.PI/180;if(Math.abs(r-o)<s&&(s=Math.abs(r-o)),i<0)for(var a=r-s;a>o;a-=s){var u=e.getPointOnEllipticalArc(n.points[0],n.points[1],n.points[2],n.points[3],a,0);t.push(u.x,u.y)}else for(a=r+s;a<o;a+=s){u=e.getPointOnEllipticalArc(n.points[0],n.points[1],n.points[2],n.points[3],a,0);t.push(u.x,u.y)}}else if("C"===n.command)for(a=0;a<=1;a+=.01){u=e.getPointOnCubicBezier(a,n.start.x,n.start.y,n.points[0],n.points[1],n.points[2],n.points[3],n.points[4],n.points[5]);t.push(u.x,u.y)}else t=t.concat(n.points)}));for(var n,r,i=t[0],o=t[0],s=t[1],a=t[1],u=0;u<t.length/2;u++)n=t[2*u],r=t[2*u+1],isNaN(n)||(i=Math.min(i,n),o=Math.max(o,n)),isNaN(r)||(s=Math.min(s,r),a=Math.max(a,r));return{x:Math.round(i),y:Math.round(s),width:Math.round(o-i),height:Math.round(a-s)}},e.prototype.getLength=function(){return this.pathLength},e.prototype.getPointAtLength=function(t){var n,r=0,i=this.dataArray.length;if(!i)return null;while(r<i&&t>this.dataArray[r].pathLength)t-=this.dataArray[r].pathLength,++r;if(r===i)return n=this.dataArray[r-1].points.slice(-2),{x:n[0],y:n[1]};if(t<.01)return n=this.dataArray[r].points.slice(0,2),{x:n[0],y:n[1]};var o=this.dataArray[r],s=o.points;switch(o.command){case"L":return e.getPointOnLine(t,o.start.x,o.start.y,s[0],s[1]);case"C":return e.getPointOnCubicBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return e.getPointOnQuadraticBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3]);case"A":var a=s[0],u=s[1],l=s[2],c=s[3],h=s[4],p=s[5],d=s[6];return h+=p*t/o.pathLength,e.getPointOnEllipticalArc(a,u,l,c,h,d)}return null},e.getLineLength=function(t,e,n,r){return Math.sqrt((n-t)*(n-t)+(r-e)*(r-e))},e.getPointOnLine=function(t,e,n,r,i,o,s){void 0===o&&(o=e),void 0===s&&(s=n);var a=(i-n)/(r-e+1e-8),u=Math.sqrt(t*t/(1+a*a));r<e&&(u*=-1);var l,c=a*u;if(r===e)l={x:o,y:s+c};else if((s-n)/(o-e+1e-8)===a)l={x:o+u,y:s+c};else{var h,p,d=this.getLineLength(e,n,r,i);if(d<1e-8)return;var f=(o-e)*(r-e)+(s-n)*(i-n);f/=d*d,h=e+f*(r-e),p=n+f*(i-n);var g=this.getLineLength(o,s,h,p),m=Math.sqrt(t*t-g*g);u=Math.sqrt(m*m/(1+a*a)),r<e&&(u*=-1),c=a*u,l={x:h+u,y:p+c}}return l},e.getPointOnCubicBezier=function(t,e,n,r,i,o,s,a,u){function l(t){return t*t*t}function c(t){return 3*t*t*(1-t)}function h(t){return 3*t*(1-t)*(1-t)}function p(t){return(1-t)*(1-t)*(1-t)}var d=a*l(t)+o*c(t)+r*h(t)+e*p(t),f=u*l(t)+s*c(t)+i*h(t)+n*p(t);return{x:d,y:f}},e.getPointOnQuadraticBezier=function(t,e,n,r,i,o,s){function a(t){return t*t}function u(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}var c=o*a(t)+r*u(t)+e*l(t),h=s*a(t)+i*u(t)+n*l(t);return{x:c,y:h}},e.getPointOnEllipticalArc=function(t,e,n,r,i,o){var s=Math.cos(o),a=Math.sin(o),u={x:n*Math.cos(i),y:r*Math.sin(i)};return{x:t+(u.x*s-u.y*a),y:e+(u.x*a+u.y*s)}},e.parsePathData=function(t){if(!t)return[];var e=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)e=e.replace(new RegExp(n[r],"g"),"|"+n[r]);var i,o=e.split("|"),s=[],a=[],u=0,l=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(r=1;r<o.length;r++){var h=o[r],p=h.charAt(0);h=h.slice(1),a.length=0;while(i=c.exec(h))a.push(i[0]);for(var d=[],f=0,g=a.length;f<g;f++){var m=parseFloat(a[f]);isNaN(m)?d.push(0):d.push(m)}while(d.length>0){if(isNaN(d[0]))break;var y,v,x,_,b,w,M,E,S,T,C=null,A=[],P=u,L=l;switch(p){case"l":u+=d.shift(),l+=d.shift(),C="L",A.push(u,l);break;case"L":u=d.shift(),l=d.shift(),A.push(u,l);break;case"m":var I=d.shift(),R=d.shift();if(u+=I,l+=R,C="M",s.length>2&&"z"===s[s.length-1].command)for(var N=s.length-2;N>=0;N--)if("M"===s[N].command){u=s[N].points[0]+I,l=s[N].points[1]+R;break}A.push(u,l),p="l";break;case"M":u=d.shift(),l=d.shift(),C="M",A.push(u,l),p="L";break;case"h":u+=d.shift(),C="L",A.push(u,l);break;case"H":u=d.shift(),C="L",A.push(u,l);break;case"v":l+=d.shift(),C="L",A.push(u,l);break;case"V":l=d.shift(),C="L",A.push(u,l);break;case"C":A.push(d.shift(),d.shift(),d.shift(),d.shift()),u=d.shift(),l=d.shift(),A.push(u,l);break;case"c":A.push(u+d.shift(),l+d.shift(),u+d.shift(),l+d.shift()),u+=d.shift(),l+=d.shift(),C="C",A.push(u,l);break;case"S":v=u,x=l,y=s[s.length-1],"C"===y.command&&(v=u+(u-y.points[2]),x=l+(l-y.points[3])),A.push(v,x,d.shift(),d.shift()),u=d.shift(),l=d.shift(),C="C",A.push(u,l);break;case"s":v=u,x=l,y=s[s.length-1],"C"===y.command&&(v=u+(u-y.points[2]),x=l+(l-y.points[3])),A.push(v,x,u+d.shift(),l+d.shift()),u+=d.shift(),l+=d.shift(),C="C",A.push(u,l);break;case"Q":A.push(d.shift(),d.shift()),u=d.shift(),l=d.shift(),A.push(u,l);break;case"q":A.push(u+d.shift(),l+d.shift()),u+=d.shift(),l+=d.shift(),C="Q",A.push(u,l);break;case"T":v=u,x=l,y=s[s.length-1],"Q"===y.command&&(v=u+(u-y.points[0]),x=l+(l-y.points[1])),u=d.shift(),l=d.shift(),C="Q",A.push(v,x,u,l);break;case"t":v=u,x=l,y=s[s.length-1],"Q"===y.command&&(v=u+(u-y.points[0]),x=l+(l-y.points[1])),u+=d.shift(),l+=d.shift(),C="Q",A.push(v,x,u,l);break;case"A":_=d.shift(),b=d.shift(),w=d.shift(),M=d.shift(),E=d.shift(),S=u,T=l,u=d.shift(),l=d.shift(),C="A",A=this.convertEndpointToCenterParameterization(S,T,u,l,M,E,_,b,w);break;case"a":_=d.shift(),b=d.shift(),w=d.shift(),M=d.shift(),E=d.shift(),S=u,T=l,u+=d.shift(),l+=d.shift(),C="A",A=this.convertEndpointToCenterParameterization(S,T,u,l,M,E,_,b,w);break}s.push({command:C||p,points:A,start:{x:P,y:L},pathLength:this.calcLength(P,L,C||p,A)})}"z"!==p&&"Z"!==p||s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},e.calcLength=function(t,n,r,i){var o,s,a,u,l=e;switch(r){case"L":return l.getLineLength(t,n,i[0],i[1]);case"C":for(o=0,s=l.getPointOnCubicBezier(0,t,n,i[0],i[1],i[2],i[3],i[4],i[5]),u=.01;u<=1;u+=.01)a=l.getPointOnCubicBezier(u,t,n,i[0],i[1],i[2],i[3],i[4],i[5]),o+=l.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case"Q":for(o=0,s=l.getPointOnQuadraticBezier(0,t,n,i[0],i[1],i[2],i[3]),u=.01;u<=1;u+=.01)a=l.getPointOnQuadraticBezier(u,t,n,i[0],i[1],i[2],i[3]),o+=l.getLineLength(s.x,s.y,a.x,a.y),s=a;return o;case"A":o=0;var c=i[4],h=i[5],p=i[4]+h,d=Math.PI/180;if(Math.abs(c-p)<d&&(d=Math.abs(c-p)),s=l.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),h<0)for(u=c-d;u>p;u-=d)a=l.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),o+=l.getLineLength(s.x,s.y,a.x,a.y),s=a;else for(u=c+d;u<p;u+=d)a=l.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),o+=l.getLineLength(s.x,s.y,a.x,a.y),s=a;return a=l.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],p,0),o+=l.getLineLength(s.x,s.y,a.x,a.y),o}return 0},e.convertEndpointToCenterParameterization=function(t,e,n,r,i,o,s,a,u){var l=u*(Math.PI/180),c=Math.cos(l)*(t-n)/2+Math.sin(l)*(e-r)/2,h=-1*Math.sin(l)*(t-n)/2+Math.cos(l)*(e-r)/2,p=c*c/(s*s)+h*h/(a*a);p>1&&(s*=Math.sqrt(p),a*=Math.sqrt(p));var d=Math.sqrt((s*s*(a*a)-s*s*(h*h)-a*a*(c*c))/(s*s*(h*h)+a*a*(c*c)));i===o&&(d*=-1),isNaN(d)&&(d=0);var f=d*s*h/a,g=d*-a*c/s,m=(t+n)/2+Math.cos(l)*f-Math.sin(l)*g,y=(e+r)/2+Math.sin(l)*f+Math.cos(l)*g,v=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},x=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(v(t)*v(e))},_=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(x(t,e))},b=_([1,0],[(c-f)/s,(h-g)/a]),w=[(c-f)/s,(h-g)/a],M=[(-1*c-f)/s,(-1*h-g)/a],E=_(w,M);return x(w,M)<=-1&&(E=Math.PI),x(w,M)>=1&&(E=0),0===o&&E>0&&(E-=2*Math.PI),1===o&&E<0&&(E+=2*Math.PI),[m,y,s,a,b,E,l,o]},e}(s.Shape);e.Path=u,u.prototype.className="Path",u.prototype._attrsAffectingSize=["data"],a._registerNode(u),o.Factory.addGetterSetter(u,"data"),i.Collection.mapMethods(u)},"8e84":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.RGB=function(t){var e,n,r=t.data,i=r.length,o=this.red(),s=this.green(),a=this.blue();for(e=0;e<i;e+=4)n=(.34*r[e]+.5*r[e+1]+.16*r[e+2])/255,r[e]=n*o,r[e+1]=n*s,r[e+2]=n*a,r[e+3]=r[e+3]},r.Factory.addGetterSetter(i.Node,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),r.Factory.addGetterSetter(i.Node,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),r.Factory.addGetterSetter(i.Node,"blue",0,o.RGBComponent,r.Factory.afterSetFilter)},"926b":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");r.Factory.addGetterSetter(i.Node,"hue",0,o.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"saturation",0,o.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"luminance",0,o.getNumberValidator(),r.Factory.afterSetFilter),e.HSL=function(t){var e,n,r,i,o,s=t.data,a=s.length,u=1,l=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,h=127*this.luminance(),p=u*l*Math.cos(c*Math.PI/180),d=u*l*Math.sin(c*Math.PI/180),f=.299*u+.701*p+.167*d,g=.587*u-.587*p+.33*d,m=.114*u-.114*p-.497*d,y=.299*u-.299*p-.328*d,v=.587*u+.413*p+.035*d,x=.114*u-.114*p+.293*d,_=.299*u-.3*p+1.25*d,b=.587*u-.586*p-1.05*d,w=.114*u+.886*p-.2*d;for(e=0;e<a;e+=4)n=s[e+0],r=s[e+1],i=s[e+2],o=s[e+3],s[e+0]=f*n+g*r+m*i+h,s[e+1]=y*n+v*r+x*i+h,s[e+2]=_*n+b*r+w*i+h,s[e+3]=o}},9470:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");function s(t,e,n){var r=4*(n*t.width+e),i=[];return i.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),i}function a(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function u(t){for(var e=[0,0,0],n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function l(t,e){var n=s(t,0,0),r=s(t,t.width-1,0),i=s(t,0,t.height-1),o=s(t,t.width-1,t.height-1),l=e||10;if(a(n,r)<l&&a(r,o)<l&&a(o,i)<l&&a(i,n)<l){for(var c=u([r,n,o,i]),h=[],p=0;p<t.width*t.height;p++){var d=a(c,[t.data[4*p],t.data[4*p+1],t.data[4*p+2]]);h[p]=d<l?0:255}return h}}function c(t,e){for(var n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}function h(t,e,n){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),s=[],a=0;a<n;a++)for(var u=0;u<e;u++){for(var l=a*e+u,c=0,h=0;h<i;h++)for(var p=0;p<i;p++){var d=a+h-o,f=u+p-o;if(d>=0&&d<n&&f>=0&&f<e){var g=d*e+f,m=r[h*i+p];c+=t[g]*m}}s[l]=2040===c?255:0}return s}function p(t,e,n){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),s=[],a=0;a<n;a++)for(var u=0;u<e;u++){for(var l=a*e+u,c=0,h=0;h<i;h++)for(var p=0;p<i;p++){var d=a+h-o,f=u+p-o;if(d>=0&&d<n&&f>=0&&f<e){var g=d*e+f,m=r[h*i+p];c+=t[g]*m}}s[l]=c>=1020?255:0}return s}function d(t,e,n){for(var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),s=[],a=0;a<n;a++)for(var u=0;u<e;u++){for(var l=a*e+u,c=0,h=0;h<i;h++)for(var p=0;p<i;p++){var d=a+h-o,f=u+p-o;if(d>=0&&d<n&&f>=0&&f<e){var g=d*e+f,m=r[h*i+p];c+=t[g]*m}}s[l]=c}return s}e.Mask=function(t){var e=this.threshold(),n=l(t,e);return n&&(n=h(n,t.width,t.height),n=p(n,t.width,t.height),n=d(n,t.width,t.height),c(t,n)),t},r.Factory.addGetterSetter(i.Node,"threshold",0,o.getNumberValidator(),r.Factory.afterSetFilter)},"96ee":function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("d777"),u=n("4546"),l=n("d777"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.radius(),0,a.Konva.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.radius()},e.prototype.getHeight=function(){return 2*this.radius()},e.prototype.setWidth=function(t){this.radius(t/2)},e.prototype.setHeight=function(t){this.radius(t/2)},e}(s.Shape);e.Wedge=c,c.prototype.className="Wedge",c.prototype._centroid=!0,c.prototype._attrsAffectingSize=["radius"],l._registerNode(c),o.Factory.addGetterSetter(c,"radius",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"angle",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clockwise",!1),o.Factory.backCompat(c,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),i.Collection.mapMethods(c)},"98be":function(t,e,n){"use strict";n("2630")},"9c8b":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAZCAYAAAAv3j5gAAAAAXNSR0IArs4c6QAAAvtJREFUSEu1lt1LFGEUxp8zs4qpQWo3kYLaF4FQF2Ika+u6u5ruuGbQEnjbH6AEQVdGZJeVl0VdRSAFqeyH4rhO65RYiETSx10l3piaF6JG7bwnZsvNj3VnspyrYd7nOb/zznk/DiHDc3diIqt4caUJBAXMVQyUAshjYJUI0wBPkpCjBflyX3V19WqmWJRukJkpOvL8IgvRBaAsU4DkGGEWkK7nyYl7brc7kU6/BRQKafsph54AVGsJ2CQg4I3kyG5pdJ/+tNm7ARQZ1o8yeADM5X8LWaefkyAHmnzO8fUxUqDBwbHChPzjJYDD/wBZs84LgapAg+vj2ocUKDIUH2KC7z9AfpcNU8uLs5XBYPD7rzICCMX0VhLiqU2IWWyHHS0T2pu9ru4kqLOzU6p0et4R+JilmajH76lpi8b0G8x81VqPeWNZLm9pcS5RWNW8gKRamsysCO1+r6s7MqwrzCJkxwPCJcXrekBhNX4bQLsd0w5BvYrXdZ7C6qgOsHPXQIwZpd5VQhE1Ps1ASfrdTA8NFqokSWyOs2FMNDe4P4RiYweJE+6UR/BJEC5vkyz7vWeyzF83D6AorShHKlRqahbtzDaiji4wuDCdNs8h9lJIjU/TNjMC0SMiDDNzckZgvFJ8rvdRTSsWhuRJbUaiEyy4I+OMQuoznUC7VyPCjOI1axQbvZUhmw1J7mTVMbiv2VfbStFYvE4IxOzUYSeg1D4y757I8OhbAMetYAQ8znWIthVD7mLmK1Z6AAvGHrmsxelcSp514ZF4AAb6bRjBDEEEyY4WoA7Fd+ZO6lA1XyJD8SgTGu0FsFYRMLV8oKgyWFHx5/Q2bb2ati/bkMeZbRyu1pw5IXAq7X1keqOxF4eESAwAOGIdK72CgS+SLAX8dTXmJZp6tvQMYV0voG+ih4H6HcBek5Q45/d4Pm/2pu2Ckgskpl+AEDdtXu2zxHQtN8u4b7sLWp+JpmmOFcNxlpkDIFQRcykD+Uj2dTTNQkxCkiIrXx39wWDmvu4nTwdRcsekjVgAAAAASUVORK5CYII="},"9cb8":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=function(){function t(){}return t.toCollection=function(e){var n,r=new t,i=e.length;for(n=0;n<i;n++)r.push(e[n]);return r},t._mapMethod=function(e){t.prototype[e]=function(){var t,n=this.length,r=[].slice.call(arguments);for(t=0;t<n;t++)this[t][e].apply(this[t],r);return this}},t.mapMethods=function(e){var n=e.prototype;for(var r in n)t._mapMethod(r)},t}();e.Collection=i,i.prototype=[],i.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},i.prototype.toArray=function(){var t,e=[],n=this.length;for(t=0;t<n;t++)e.push(this[t]);return e};var o=function(){function t(t){void 0===t&&(t=[1,0,0,1,0,0]),this.m=t&&t.slice()||[1,0,0,1,0,0]}return t.prototype.copy=function(){return new t(this.m)},t.prototype.point=function(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t.prototype.translate=function(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this},t.prototype.scale=function(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.m[0]*e+this.m[2]*n,i=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,s=this.m[1]*-n+this.m[3]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=o,this.m[3]=s,this},t.prototype.getTranslation=function(){return{x:this.m[4],y:this.m[5]}},t.prototype.skew=function(t,e){var n=this.m[0]+this.m[2]*e,r=this.m[1]+this.m[3]*e,i=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=o,this},t.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=s,this},t.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,r=-this.m[2]*t,i=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=s,this},t.prototype.getMatrix=function(){return this.m},t.prototype.setAbsolutePosition=function(t,e){var n=this.m[0],r=this.m[1],i=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],u=(n*(e-a)-r*(t-s))/(n*o-r*i),l=(t-s-i*u)/n;return this.translate(l,u)},t}();e.Transform=o;var s="[object Array]",a="[object Number]",u="[object String]",l="[object Boolean]",c=Math.PI/180,h=180/Math.PI,p="#",d="",f="0",g="Konva warning: ",m="Konva error: ",y="rgb(",v={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},x=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,_=[];e.Util={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject:function(t){return!!t&&t.constructor===Object},_isArray:function(t){return Object.prototype.toString.call(t)===s},_isNumber:function(t){return Object.prototype.toString.call(t)===a&&!isNaN(t)&&isFinite(t)},_isString:function(t){return Object.prototype.toString.call(t)===u},_isBoolean:function(t){return Object.prototype.toString.call(t)===l},isObject:function(t){return t instanceof Object},isValidSelector:function(t){if("string"!==typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:function(t){return 0===t?0:t>0?1:-1},requestAnimFrame:function(t){_.push(t),1===_.length&&requestAnimationFrame((function(){var t=_;_=[],t.forEach((function(t){t()}))}))},createCanvasElement:function(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(e){}return t},createImageElement:function(){return document.createElement("img")},_isInDocument:function(t){while(t=t.parentNode)if(t==document)return!0;return!1},_simplifyArray:function(t){var n,r,i=[],o=t.length,s=e.Util;for(n=0;n<o;n++)r=t[n],s._isNumber(r)?r=Math.round(1e3*r)/1e3:s._isString(r)||(r=r.toString()),i.push(r);return i},_urlToImage:function(t,e){var n=new r.glob.Image;n.onload=function(){e(n)},n.src=t},_rgbToHex:function(t,e,n){return((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace(p,d);var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor:function(){var t=(16777215*Math.random()<<0).toString(16);while(t.length<6)t=f+t;return p+t},get:function(t,e){return void 0===t?e:t},getRGB:function(t){var e;return t in v?(e=v[t],{r:e[0],g:e[1],b:e[2]}):t[0]===p?this._hexToRgb(t.substring(1)):t.substr(0,4)===y?(e=x.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(t){return t=t||"black",e.Util._namedColorToRBA(t)||e.Util._hex3ColorToRGBA(t)||e.Util._hex6ColorToRGBA(t)||e.Util._rgbColorToRGBA(t)||e.Util._rgbaColorToRGBA(t)||e.Util._hslColorToRGBA(t)},_namedColorToRBA:function(t){var e=v[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA:function(t){if(0===t.indexOf("rgb(")){t=t.match(/rgb\(([^)]+)\)/)[1];var e=t.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA:function(t){if(0===t.indexOf("rgba(")){t=t.match(/rgba\(([^)]+)\)/)[1];var e=t.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex6ColorToRGBA:function(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA:function(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),n=(e[0],e.slice(1)),r=Number(n[0])/360,i=Number(n[1])/100,o=Number(n[2])/100,s=void 0,a=void 0,u=void 0;if(0===i)return u=255*o,{r:Math.round(u),g:Math.round(u),b:Math.round(u),a:1};s=o<.5?o*(1+i):o+i-o*i;for(var l=2*o-s,c=[0,0,0],h=0;h<3;h++)a=r+1/3*-(h-1),a<0&&a++,a>1&&a--,u=6*a<1?l+6*(s-l)*a:2*a<1?s:3*a<2?l+(s-l)*(2/3-a)*6:l,c[h]=255*u;return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection:function(t,e){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)},cloneObject:function(t){var e={};for(var n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:function(t){return t.slice(0)},_degToRad:function(t){return t*c},_radToDeg:function(t){return t*h},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw:function(t){throw new Error(m+t)},error:function(t){console.error(m+t)},warn:function(t){r.Konva.showWarnings&&console.warn(g+t)},extend:function(t,e){function n(){this.constructor=t}n.prototype=e.prototype;var r=t.prototype;for(var i in t.prototype=new n,r)r.hasOwnProperty(i)&&(t.prototype[i]=r[i]);t.__super__=e.prototype,t.super=e},_getControlPoints:function(t,e,n,r,i,o,s){var a=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),u=Math.sqrt(Math.pow(i-n,2)+Math.pow(o-r,2)),l=s*a/(a+u),c=s*u/(a+u),h=n-l*(i-t),p=r-l*(o-e),d=n+c*(i-t),f=r+c*(o-e);return[h,p,d,f]},_expandPoints:function(t,n){var r,i,o=t.length,s=[];for(r=2;r<o-2;r+=2)i=e.Util._getControlPoints(t[r-2],t[r-1],t[r],t[r+1],t[r+2],t[r+3],n),s.push(i[0]),s.push(i[1]),s.push(t[r]),s.push(t[r+1]),s.push(i[2]),s.push(i[3]);return s},each:function(t,e){for(var n in t)e(n,t[n])},_inRange:function(t,e,n){return e<=t&&t<n},_getProjectionToSegment:function(t,e,n,r,i,o){var s,a,u,l=(t-n)*(t-n)+(e-r)*(e-r);if(0==l)s=t,a=e,u=(i-n)*(i-n)+(o-r)*(o-r);else{var c=((i-t)*(n-t)+(o-e)*(r-e))/l;c<0?(s=t,a=e,u=(t-i)*(t-i)+(e-o)*(e-o)):c>1?(s=n,a=r,u=(n-i)*(n-i)+(r-o)*(r-o)):(s=t+c*(n-t),a=e+c*(r-e),u=(s-i)*(s-i)+(a-o)*(a-o))}return[s,a,u]},_getProjectionToLine:function(t,n,r){var i=e.Util.cloneObject(t),o=Number.MAX_VALUE;return n.forEach((function(s,a){if(r||a!==n.length-1){var u=n[(a+1)%n.length],l=e.Util._getProjectionToSegment(s.x,s.y,u.x,u.y,t.x,t.y),c=l[0],h=l[1],p=l[2];p<o&&(i.x=c,i.y=h,o=p)}})),i},_prepareArrayForTween:function(t,n,r){var i,o=[],s=[];if(t.length>n.length){var a=n;n=t,t=a}for(i=0;i<t.length;i+=2)o.push({x:t[i],y:t[i+1]});for(i=0;i<n.length;i+=2)s.push({x:n[i],y:n[i+1]});var u=[];return s.forEach((function(t){var n=e.Util._getProjectionToLine(t,o,r);u.push(n.x),u.push(n.y)})),u},_prepareToStringify:function(t){var n;for(var r in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(r)&&t[r]&&"object"==typeof t[r])if(n=Object.getOwnPropertyDescriptor(t,r),t[r].visitedByCircularReferenceRemoval||e.Util._isElement(t[r])){if(!n.configurable)return null;delete t[r]}else if(null===e.Util._prepareToStringify(t[r])){if(!n.configurable)return null;delete t[r]}return delete t.visitedByCircularReferenceRemoval,t},_assign:function(t,e){for(var n in e)t[n]=e[n];return t},_getFirstPointerId:function(t){return t.touches?t.changedTouches[0].identifier:999}}},a279:function(t,e,n){var r=n("b753");function i(){for(var t={},e=Object.keys(r),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}function o(t){var e=i(),n=[t];e[t].distance=0;while(n.length)for(var o=n.pop(),s=Object.keys(r[o]),a=s.length,u=0;u<a;u++){var l=s[u],c=e[l];-1===c.distance&&(c.distance=e[o].distance+1,c.parent=o,n.unshift(l))}return e}function s(t,e){return function(n){return e(t(n))}}function a(t,e){var n=[e[t].parent,t],i=r[e[t].parent][t],o=e[t].parent;while(e[o].parent)n.unshift(e[o].parent),i=s(r[e[o].parent][o],i),o=e[o].parent;return i.conversion=n,i}t.exports=function(t){for(var e=o(t),n={},r=Object.keys(e),i=r.length,s=0;s<i;s++){var u=r[s],l=e[u];null!==l.parent&&(n[u]=a(u,e))}return n}},a34e:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("ed3d"),u=n("4546"),l=n("d777"),c=function(t){function e(e){var n=t.call(this,e)||this;return n._updated=!0,n.anim=new a.Animation((function(){var t=n._updated;return n._updated=!1,t})),n.on("animationChange.konva",(function(){this.frameIndex(0)})),n.on("frameIndexChange.konva",(function(){this._updated=!0})),n.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})),n}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[e],o=this.frameOffsets(),s=i[r+0],a=i[r+1],u=i[r+2],l=i[r+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,u,l),t.closePath(),t.fillStrokeShape(this)),c)if(o){var h=o[e],p=2*n;t.drawImage(c,s,a,u,l,h[p+0],h[p+1],u,l)}else t.drawImage(c,s,a,u,l,0,0,u,l)},e.prototype._hitFunc=function(t){var e=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[e],o=this.frameOffsets(),s=i[r+2],a=i[r+3];if(t.beginPath(),o){var u=o[e],l=2*n;t.rect(u[l+0],u[l+1],s,a)}else t.rect(0,0,s,a);t.closePath(),t.fillShape(this)},e.prototype._useBufferCanvas=function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},e.prototype._setInterval=function(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())},e.prototype.start=function(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}},e.prototype.stop=function(){this.anim.stop(),clearInterval(this.interval)},e.prototype.isRunning=function(){return this.anim.isRunning()},e.prototype._updateIndex=function(){var t=this.frameIndex(),e=this.animation(),n=this.animations(),r=n[e],i=r.length/4;t<i-1?this.frameIndex(t+1):this.frameIndex(0)},e}(s.Shape);e.Sprite=c,c.prototype.className="Sprite",l._registerNode(c),o.Factory.addGetterSetter(c,"animation"),o.Factory.addGetterSetter(c,"animations"),o.Factory.addGetterSetter(c,"frameOffsets"),o.Factory.addGetterSetter(c,"image"),o.Factory.addGetterSetter(c,"frameIndex",0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"frameRate",17,u.getNumberValidator()),o.Factory.backCompat(c,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),i.Collection.mapMethods(c)},aecf:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAAAXNSR0IArs4c6QAAA+hJREFUOBG1Vc9rXFUU/u6bH0nbtGknKUlHK9jYQAQFaVQQ/wQXk65ELLgqbuwukoWL7BRm3UUrCm5c2oF24UoUBVEmFltKbc0YYukYJpNMkyZO33v3h9+5d95kiKk7H7x59513zne/851z7igccLn6lUKS3K5YqytI9Kyztux0CqdNE9rWXaprI8+Xamr2aro/XO03xEuX5lycVq02U9BGQOCMAYzlWvt3bze2oZyZP/bujWuDGH1A5xaj+OeNTxg03w8miARbAkFAte2txa65NlDaVkcvvrGg1CKNQD5DT+oEMwNgdBYQCQobBLZic2n4JnbLmM7l7wTmQ/nxDOOfLs1Zk361x8AgOnoWpv0bg5O9lFNhGlIPGwnrbFOcH5//4ZqSAsTJrbtWp1N+d6aF4jiGX1uA211HfPMzmI3loGWPteiaAWdrMm2MnzAzkVSTuhGMOzMVcSi+cB5Iu1CFIxh69QMUzr4FOOWZOvGTtHsF8u+isbZT62umkrcmISAdxIl3dOQ5qOIobLxNEIriLPLPvI5o9Aye3PwSptXwfp7AgJ4Bw1ZyH1145WPuMib6iZPdacNuNaHyw1SYNUufhFvlkD/1MlRUpLZ/wCWJ9/cyEVhildFDebJi0+71F1yE3Ng0zKMHsM3byE+8ROAcYB2cc8hNzGB4ZBLxrRtkuxL6UpiKrtqW1e7XFx47bUf6oMUSlCoy1xxyJ1+EWf8d6lCJKZ8OoARmr1AKh2RlCcm97wXIa6qM3YmccU2OUs9IDYdGoQ5PQLfuwe5uIDp2mnr+zcBvYToPKckm7w702jL06q+ME3ah8U1qmnmkus60pwNlfoy7iAol5MvnPKP4/jcA9cqdnIZ+eCdUm3Ntdra44SOfqhRTgKljPS+DzsU7PYNnY+0a7OYq1zHQfewFTxs/AofGEB0uscrUs7vNNutp39NQGVNjY18sbN9v3XVJOiU7qeJxgJW0G3+GVhoomM9C+lFsnKC9KRGGtnEKEzORHEHKygwH2o5pmM0HvaCMgYhOOYRJQtYpjzIOgZWZFrs8efKoq0tpJAMtR5DlqSEBNunSiUCyAXvLBwyyFB8/0/wu1RY/Z6rlT//yx5gHFNATPILYa1UB8dr4MQwMfapiz9gQJFs7S7Bn318QDLn652F4BdrVN+dgkirTCPPdYxdAA1CPeYO2+fLngVkW/y9A+eCunCvIoPPwrPBwnSVA2SVMVf4CjKlzxGqTmKyJZhnQ//Y8kOHgbu7OYnF3dflt19paOvredXb2f1/9v4CnuQmYbm1+YdpbK/Q58zS/zN6vcmbY/3Ttzi+2vb2SbnSu7/920Ps/h1xamBnoO6EAAAAASUVORK5CYII="},b33b:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.RGBA=function(t){var e,n,r=t.data,i=r.length,o=this.red(),s=this.green(),a=this.blue(),u=this.alpha();for(e=0;e<i;e+=4)n=1-u,r[e]=o*u+r[e]*n,r[e+1]=s*u+r[e+1]*n,r[e+2]=a*u+r[e+2]*n},r.Factory.addGetterSetter(i.Node,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),r.Factory.addGetterSetter(i.Node,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),r.Factory.addGetterSetter(i.Node,"blue",0,o.RGBComponent,r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"alpha",1,(function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}))},b4ad:function(t,e,n){t.exports=n("2d16")},b753:function(t,e,n){var r=n("4f4d"),i={};for(var o in r)r.hasOwnProperty(o)&&(i[r[o]]=o);var s=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var a in s)if(s.hasOwnProperty(a)){if(!("channels"in s[a]))throw new Error("missing channels property: "+a);if(!("labels"in s[a]))throw new Error("missing channel labels property: "+a);if(s[a].labels.length!==s[a].channels)throw new Error("channel and label counts mismatch: "+a);var u=s[a].channels,l=s[a].labels;delete s[a].channels,delete s[a].labels,Object.defineProperty(s[a],"channels",{value:u}),Object.defineProperty(s[a],"labels",{value:l})}function c(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}s.rgb.hsl=function(t){var e,n,r,i=t[0]/255,o=t[1]/255,s=t[2]/255,a=Math.min(i,o,s),u=Math.max(i,o,s),l=u-a;return u===a?e=0:i===u?e=(o-s)/l:o===u?e=2+(s-i)/l:s===u&&(e=4+(i-o)/l),e=Math.min(60*e,360),e<0&&(e+=360),r=(a+u)/2,n=u===a?0:r<=.5?l/(u+a):l/(2-u-a),[e,100*n,100*r]},s.rgb.hsv=function(t){var e,n,r,i,o,s=t[0]/255,a=t[1]/255,u=t[2]/255,l=Math.max(s,a,u),c=l-Math.min(s,a,u),h=function(t){return(l-t)/6/c+.5};return 0===c?i=o=0:(o=c/l,e=h(s),n=h(a),r=h(u),s===l?i=r-n:a===l?i=1/3+e-r:u===l&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*o,100*l]},s.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2],i=s.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(n,r));return r=1-1/255*Math.max(e,Math.max(n,r)),[i,100*o,100*r]},s.rgb.cmyk=function(t){var e,n,r,i,o=t[0]/255,s=t[1]/255,a=t[2]/255;return i=Math.min(1-o,1-s,1-a),e=(1-o-i)/(1-i)||0,n=(1-s-i)/(1-i)||0,r=(1-a-i)/(1-i)||0,[100*e,100*n,100*r,100*i]},s.rgb.keyword=function(t){var e=i[t];if(e)return e;var n,o=1/0;for(var s in r)if(r.hasOwnProperty(s)){var a=r[s],u=c(t,a);u<o&&(o=u,n=s)}return n},s.keyword.rgb=function(t){return r[t]},s.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var i=.4124*e+.3576*n+.1805*r,o=.2126*e+.7152*n+.0722*r,s=.0193*e+.1192*n+.9505*r;return[100*i,100*o,100*s]},s.rgb.lab=function(t){var e,n,r,i=s.rgb.xyz(t),o=i[0],a=i[1],u=i[2];return o/=95.047,a/=100,u/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116,e=116*a-16,n=500*(o-a),r=200*(a-u),[e,n,r]},s.hsl.rgb=function(t){var e,n,r,i,o,s=t[0]/360,a=t[1]/100,u=t[2]/100;if(0===a)return o=255*u,[o,o,o];n=u<.5?u*(1+a):u+a-u*a,e=2*u-n,i=[0,0,0];for(var l=0;l<3;l++)r=s+1/3*-(l-1),r<0&&r++,r>1&&r--,o=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,i[l]=255*o;return i},s.hsl.hsv=function(t){var e,n,r=t[0],i=t[1]/100,o=t[2]/100,s=i,a=Math.max(o,.01);return o*=2,i*=o<=1?o:2-o,s*=a<=1?a:2-a,n=(o+i)/2,e=0===o?2*s/(a+s):2*i/(o+i),[r,100*e,100*n]},s.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,i=Math.floor(e)%6,o=e-Math.floor(e),s=255*r*(1-n),a=255*r*(1-n*o),u=255*r*(1-n*(1-o));switch(r*=255,i){case 0:return[r,u,s];case 1:return[a,r,s];case 2:return[s,r,u];case 3:return[s,a,r];case 4:return[u,s,r];case 5:return[r,s,a]}},s.hsv.hsl=function(t){var e,n,r,i=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return r=(2-o)*s,e=(2-o)*a,n=o*a,n/=e<=1?e:2-e,n=n||0,r/=2,[i,100*n,100*r]},s.hwb.rgb=function(t){var e,n,r,i,o,s,a,u=t[0]/360,l=t[1]/100,c=t[2]/100,h=l+c;switch(h>1&&(l/=h,c/=h),e=Math.floor(6*u),n=1-c,r=6*u-e,0!==(1&e)&&(r=1-r),i=l+r*(n-l),e){default:case 6:case 0:o=n,s=i,a=l;break;case 1:o=i,s=n,a=l;break;case 2:o=l,s=n,a=i;break;case 3:o=l,s=i,a=n;break;case 4:o=i,s=l,a=n;break;case 5:o=n,s=l,a=i;break}return[255*o,255*s,255*a]},s.cmyk.rgb=function(t){var e,n,r,i=t[0]/100,o=t[1]/100,s=t[2]/100,a=t[3]/100;return e=1-Math.min(1,i*(1-a)+a),n=1-Math.min(1,o*(1-a)+a),r=1-Math.min(1,s*(1-a)+a),[255*e,255*n,255*r]},s.xyz.rgb=function(t){var e,n,r,i=t[0]/100,o=t[1]/100,s=t[2]/100;return e=3.2406*i+-1.5372*o+-.4986*s,n=-.9689*i+1.8758*o+.0415*s,r=.0557*i+-.204*o+1.057*s,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,e=Math.min(Math.max(0,e),1),n=Math.min(Math.max(0,n),1),r=Math.min(Math.max(0,r),1),[255*e,255*n,255*r]},s.xyz.lab=function(t){var e,n,r,i=t[0],o=t[1],s=t[2];return i/=95.047,o/=100,s/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,e=116*o-16,n=500*(i-o),r=200*(o-s),[e,n,r]},s.lab.xyz=function(t){var e,n,r,i=t[0],o=t[1],s=t[2];n=(i+16)/116,e=o/500+n,r=n-s/200;var a=Math.pow(n,3),u=Math.pow(e,3),l=Math.pow(r,3);return n=a>.008856?a:(n-16/116)/7.787,e=u>.008856?u:(e-16/116)/7.787,r=l>.008856?l:(r-16/116)/7.787,e*=95.047,n*=100,r*=108.883,[e,n,r]},s.lab.lch=function(t){var e,n,r,i=t[0],o=t[1],s=t[2];return e=Math.atan2(s,o),n=360*e/2/Math.PI,n<0&&(n+=360),r=Math.sqrt(o*o+s*s),[i,r,n]},s.lch.lab=function(t){var e,n,r,i=t[0],o=t[1],s=t[2];return r=s/360*2*Math.PI,e=o*Math.cos(r),n=o*Math.sin(r),[i,e,n]},s.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],i=1 in arguments?arguments[1]:s.rgb.hsv(t)[2];if(i=Math.round(i/50),0===i)return 30;var o=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===i&&(o+=60),o},s.hsv.ansi16=function(t){return s.rgb.ansi16(s.hsv.rgb(t),t[2])},s.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];if(e===n&&n===r)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var i=16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5);return i},s.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var n=.5*(1+~~(t>50)),r=(1&e)*n*255,i=(e>>1&1)*n*255,o=(e>>2&1)*n*255;return[r,i,o]},s.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;t-=16;var r=Math.floor(t/36)/5*255,i=Math.floor((n=t%36)/6)/5*255,o=n%6/5*255;return[r,i,o]},s.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),n=e.toString(16).toUpperCase();return"000000".substring(n.length)+n},s.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16),i=r>>16&255,o=r>>8&255,s=255&r;return[i,o,s]},s.rgb.hcg=function(t){var e,n,r=t[0]/255,i=t[1]/255,o=t[2]/255,s=Math.max(Math.max(r,i),o),a=Math.min(Math.min(r,i),o),u=s-a;return e=u<1?a/(1-u):0,n=u<=0?0:s===r?(i-o)/u%6:s===i?2+(o-r)/u:4+(r-i)/u+4,n/=6,n%=1,[360*n,100*u,100*e]},s.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1,i=0;return r=n<.5?2*e*n:2*e*(1-n),r<1&&(i=(n-.5*r)/(1-r)),[t[0],100*r,100*i]},s.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},s.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var i=[0,0,0],o=e%1*6,s=o%1,a=1-s,u=0;switch(Math.floor(o)){case 0:i[0]=1,i[1]=s,i[2]=0;break;case 1:i[0]=a,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=s;break;case 3:i[0]=0,i[1]=a,i[2]=1;break;case 4:i[0]=s,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=a}return u=(1-n)*r,[255*(n*i[0]+u),255*(n*i[1]+u),255*(n*i[2]+u)]},s.hcg.hsv=function(t){var e=t[1]/100,n=t[2]/100,r=e+n*(1-e),i=0;return r>0&&(i=e/r),[t[0],100*i,100*r]},s.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100,r=n*(1-e)+.5*e,i=0;return r>0&&r<.5?i=e/(2*r):r>=.5&&r<1&&(i=e/(2*(1-r))),[t[0],100*i,100*r]},s.hcg.hwb=function(t){var e=t[1]/100,n=t[2]/100,r=e+n*(1-e);return[t[0],100*(r-e),100*(1-r)]},s.hwb.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1-n,i=r-e,o=0;return i<1&&(o=(r-i)/(1-i)),[t[0],100*i,100*o]},s.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},s.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},s.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},s.gray.hsl=s.gray.hsv=function(t){return[0,0,t[0]]},s.gray.hwb=function(t){return[0,100,t[0]]},s.gray.cmyk=function(t){return[0,0,0,t[0]]},s.gray.lab=function(t){return[t[0],0,0]},s.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=(e<<16)+(e<<8)+e,r=n.toString(16).toUpperCase();return"000000".substring(r.length)+r},s.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}},b77d:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAABJ5JREFUSA2VVm9MW1UUP+e2hTHYHLhsE6Pzg84tmQrug4nT4J8xlZHQLoPEbNFHKwZKcJoQhSyZzYwuM5ioLGVhQKvRmGCytmZOJvuwxX+ZiULUZG4fDA4DLNO5OQFL23c8540H7aUMuCHcd+79nd/v3vPOOa8ISxh+v78gkUgUi4vL5RoJBoP/LtYdbwbs7e11nDjxZRUAuQnhGSBanYFH/BMJvgDAaEXF9lhNTU0qYz/NmFfI8PnckKKDBLCR8VNMdloh/UwEI+KPCMUm4X18iMfYzGGiXxFVSyjUFZN9fcwRCgQCOUNDF4Ms4EPES0BwYMWK5R+1t7f/ozuL3dTUtPL69Yk9gLCfiNbyCbpyXQ5/Z2dnIh2fIWQEAsvg94t9fOoyFvlg9a2FjW1tbePpDvM9y/ubmIwfZrHn+bZnYP2dT4cDgf9svNN+sOahP7r4JmWsvi8c6n4rY28BYzoxDMPwXuCDvonMxS57bDeH/WB4vXV8mn0I6kg43N1iry91Hhwc+Kq0ZMs6AtNb+mDpyODAwI/CoeRfc3NzPphwQF5oTo56Sdb0QX3VRfS5Z4O+ns0WDg79eeG0uBlkCV2+crWeQ7YOHNiqv0Qhopj7dZhMXoYpOk9RzzmK7dyRTcBeEw6FqlU4hVvWLSE0aRe/wOFwd3fUBtszxarv5ZMFAKmPM6qFs7AITPM4Rd19dNyzycbpc0/P0YhwCrfsqfr6+jUE9BABZs1/oNQWi0Th2+iOHIIC5wY+3jtA+AQk6SeKeN6liLFKFxJbOIVbNNTUlClx51qD77OBGX0jYQiTso/ln17Dqmgz5MBmtk4y3V7Aa99R7Nm1uv80J4oGh46s3sXxtCpeB89n447IBb5hJSis4da0ESju07GznFSsiMw8ATiIJnSgZSN3uZsN5TzLNzP5r0iH2ZyiwTdSYwIwTXWbDrRs4raZZRBVOzgDGyGZlDqJc8J8osNmOdWYCA0LgPnu1oHz2RTZ9SREk4McssOcjZc4fOXoif6g42c51bDq6Tlyjq8+yvGp1IGWreA3aybaTpHqEs4yLoHkKRa4nVNoL9xS8gBWHfsmm+8NThwVDcUVTJzvnzFwq8/nWz/HYeX9Z7kzn+bT7wdIDPB+JdtBKMB7OBnex8cDVjbqftNcW4VbNKyCVejsEGAqBW/oDhbRGlcFoNrNYX4FnGoTuqONuC3yl45Nt20um3smowzD9yGfdDe3jqe4qk+lOy31mfvzNpPMk1yDH3ODfk78rRtZRMtzX+XuPZoyzd66urpFNc9sBxBf4RAuYE4bMyMUDgbHOCzy+2BZIpn62ut98REbtNjZMF54VHyFQ7gszmnnmdDZZLW1dQ/zt+QYn6iQv03v5eW5DnZ0dPxt72ebGxoaCicnE62ciS/z/hX22xkKHf02HTtHSDZra/13EMS7WaycAVe5N0QUqJjLpX7Jz8+3WtX4+HhxImFuNsGs4pL2cFWv4uzqR8j1hUJBqzYXFLIBHIpyDsNrLFTG6Z352bdBiEkWOsO1eCgc7uq3l/U56410kIQmHk+Wp8i8ix1mmrAD1VBurrN/odAK3//mcd3cx6xfRAAAAABJRU5ErkJggg=="},b8fa:function(t,e){t.exports=function(t){return!(!t||"string"===typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},bb15:function(t,e,n){var r=n("b753"),i=n("a279"),o={},s=Object.keys(r);function a(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function u(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"===typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}s.forEach((function(t){o[t]={},Object.defineProperty(o[t],"channels",{value:r[t].channels}),Object.defineProperty(o[t],"labels",{value:r[t].labels});var e=i(t),n=Object.keys(e);n.forEach((function(n){var r=e[n];o[t][n]=u(r),o[t][n].raw=a(r)}))})),t.exports=o},bbce:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.Noise=function(t){var e,n=255*this.noise(),r=t.data,i=r.length,o=n/2;for(e=0;e<i;e+=4)r[e+0]+=o-2*o*Math.random(),r[e+1]+=o-2*o*Math.random(),r[e+2]+=o-2*o*Math.random()},r.Factory.addGetterSetter(i.Node,"noise",.2,o.getNumberValidator(),r.Factory.afterSetFilter)},bcb1:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");function s(t,e,n,r,i){var o,s=n-e,a=i-r;return 0===s?r+a/2:0===a?r:(o=(t-e)/s,o=a*o+r,o)}e.Enhance=function(t){var e,n,r,i,o=t.data,a=o.length,u=o[0],l=u,c=o[1],h=c,p=o[2],d=p,f=this.enhance();if(0!==f){for(i=0;i<a;i+=4)e=o[i+0],e<u?u=e:e>l&&(l=e),n=o[i+1],n<c?c=n:n>h&&(h=n),r=o[i+2],r<p?p=r:r>d&&(d=r);var g,m,y,v,x,_,b,w,M;for(l===u&&(l=255,u=0),h===c&&(h=255,c=0),d===p&&(d=255,p=0),f>0?(m=l+f*(255-l),y=u-f*(u-0),x=h+f*(255-h),_=c-f*(c-0),w=d+f*(255-d),M=p-f*(p-0)):(g=.5*(l+u),m=l+f*(l-g),y=u+f*(u-g),v=.5*(h+c),x=h+f*(h-v),_=c+f*(c-v),b=.5*(d+p),w=d+f*(d-b),M=p+f*(p-b)),i=0;i<a;i+=4)o[i+0]=s(o[i+0],u,l,y,m),o[i+1]=s(o[i+1],c,h,_,x),o[i+2]=s(o[i+2],p,d,M,w)}},r.Factory.addGetterSetter(i.Node,"enhance",0,o.getNumberValidator(),r.Factory.afterSetFilter)},bdee:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],u=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function l(t,e){var n,r,i,o,l,c,h,p,d,f,g,m,y,v,x,_,b,w,M,E,S,T,C,A,P=t.data,L=t.width,I=t.height,R=e+e+1,N=L-1,O=I-1,D=e+1,F=D*(D+1)/2,k=new s,B=null,z=k,G=null,U=null,V=a[e],H=u[e];for(i=1;i<R;i++)z=z.next=new s,i===D&&(B=z);for(z.next=k,h=c=0,r=0;r<I;r++){for(_=b=w=M=p=d=f=g=0,m=D*(E=P[c]),y=D*(S=P[c+1]),v=D*(T=P[c+2]),x=D*(C=P[c+3]),p+=F*E,d+=F*S,f+=F*T,g+=F*C,z=k,i=0;i<D;i++)z.r=E,z.g=S,z.b=T,z.a=C,z=z.next;for(i=1;i<D;i++)o=c+((N<i?N:i)<<2),p+=(z.r=E=P[o])*(A=D-i),d+=(z.g=S=P[o+1])*A,f+=(z.b=T=P[o+2])*A,g+=(z.a=C=P[o+3])*A,_+=E,b+=S,w+=T,M+=C,z=z.next;for(G=k,U=B,n=0;n<L;n++)P[c+3]=C=g*V>>H,0!==C?(C=255/C,P[c]=(p*V>>H)*C,P[c+1]=(d*V>>H)*C,P[c+2]=(f*V>>H)*C):P[c]=P[c+1]=P[c+2]=0,p-=m,d-=y,f-=v,g-=x,m-=G.r,y-=G.g,v-=G.b,x-=G.a,o=h+((o=n+e+1)<N?o:N)<<2,_+=G.r=P[o],b+=G.g=P[o+1],w+=G.b=P[o+2],M+=G.a=P[o+3],p+=_,d+=b,f+=w,g+=M,G=G.next,m+=E=U.r,y+=S=U.g,v+=T=U.b,x+=C=U.a,_-=E,b-=S,w-=T,M-=C,U=U.next,c+=4;h+=L}for(n=0;n<L;n++){for(b=w=M=_=d=f=g=p=0,c=n<<2,m=D*(E=P[c]),y=D*(S=P[c+1]),v=D*(T=P[c+2]),x=D*(C=P[c+3]),p+=F*E,d+=F*S,f+=F*T,g+=F*C,z=k,i=0;i<D;i++)z.r=E,z.g=S,z.b=T,z.a=C,z=z.next;for(l=L,i=1;i<=e;i++)c=l+n<<2,p+=(z.r=E=P[c])*(A=D-i),d+=(z.g=S=P[c+1])*A,f+=(z.b=T=P[c+2])*A,g+=(z.a=C=P[c+3])*A,_+=E,b+=S,w+=T,M+=C,z=z.next,i<O&&(l+=L);for(c=n,G=k,U=B,r=0;r<I;r++)o=c<<2,P[o+3]=C=g*V>>H,C>0?(C=255/C,P[o]=(p*V>>H)*C,P[o+1]=(d*V>>H)*C,P[o+2]=(f*V>>H)*C):P[o]=P[o+1]=P[o+2]=0,p-=m,d-=y,f-=v,g-=x,m-=G.r,y-=G.g,v-=G.b,x-=G.a,o=n+((o=r+D)<O?o:O)*L<<2,p+=_+=G.r=P[o],d+=b+=G.g=P[o+1],f+=w+=G.b=P[o+2],g+=M+=G.a=P[o+3],G=G.next,m+=E=U.r,y+=S=U.g,v+=T=U.b,x+=C=U.a,_-=E,b-=S,w-=T,M-=C,U=U.next,c+=L}}e.Blur=function(t){var e=Math.round(this.blurRadius());e>0&&l(t,e)},r.Factory.addGetterSetter(i.Node,"blurRadius",0,o.getNumberValidator(),r.Factory.afterSetFilter)},bf11:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=2*Math.PI,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,l,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),l,0,!0),t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.outerRadius()},e.prototype.getHeight=function(){return 2*this.outerRadius()},e.prototype.setWidth=function(t){this.outerRadius(t/2)},e.prototype.setHeight=function(t){this.outerRadius(t/2)},e}(s.Shape);e.Ring=c,c.prototype.className="Ring",c.prototype._centroid=!0,c.prototype._attrsAffectingSize=["innerRadius","outerRadius"],u._registerNode(c),o.Factory.addGetterSetter(c,"innerRadius",0,a.getNumberValidator()),o.Factory.addGetterSetter(c,"outerRadius",0,a.getNumberValidator()),i.Collection.mapMethods(c)},c209:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAF6ADAAQAAAABAAAAFwAAAACm59GpAAACaUlEQVRIDbVUvWsUURD/zdu7qKCeMQY/QFJYBDQWWtlYqK2QJh4pxJR+IGhjZxkLSWWTxD9AvVyaCNaCf0Ea0dhoEXKCIEEJHN7m3vh7e7f79mU3IcVlYPfN52/mzc6s6HJ0G128BnCOz2BI8BOCB6KNaIOIgwNOy2MCcyDALoHirAMvIVlDxVwFosuArJY47EtVDm7kpUzFqzLd+YxIZ3dFEta3B5WDWx3PYqx4PlOSEbQRRRfJLeTVed590LLslsHvWFfM8y7PSj4o4Y08l/r2C20O12D/fqPu9E6fYuVujIzcxLHaIxyvPYHIDQatB4EiBBufczqpb/6BMc8Ce18oVm7MU6nHr/LO2qjeB+xipjNyi1V/TGVVFSxVP3FErqc6dxYrh7orhiT6NadYygM7vYiwceYxWxi0uNhLGLdUIUllHRr3dXKYWz0ZOlDq6gm+LZ8otRXBK4daQCe1988LG5A1ZV3Cq0/yd1EET3DDsCI4OiN0+R26fT9DucuH/vKeCd6EdkpiWLldYAF7VB5vf9HG0AwXKAHQZjQF23nbA3aQuinT3WXH5YkjPcF7Bd8wEBJnl1nspSxQZYJ8NZMFM5yea5lMJpkW2Ple27ylCJ7Y9KR30VOeJ9fr+7w272TXR3PoHg3BGLqYcnCFB1eE4EkmvQKsPHSsfqgNs9fJQiWm3KscXIQBKUkJOG1qZ3XlyHlsbc3xNqOpd/4smZbE7CsXVh6sRj9cUcO/zg9Kvj15ZPK7gOuYNo+O0iqI22M7YryYGzuv9Fw5uGIE2v5V2CUfty/O9ZwbeSDUMuwY/3gDT9ByuP8BUrmtCbg1G04AAAAASUVORK5CYII="},c239:function(t,e,n){},c527:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("d777"),s=",",a="(",u=")",l="([",c="])",h=";",p="()",d="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],g=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],m=100,y=function(){function t(t){this.canvas=t,this._context=t._canvas.getContext("2d"),o.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}return t.prototype.fillShape=function(t){t.fillEnabled()&&this._fill(t)},t.prototype._fill=function(t){},t.prototype.strokeShape=function(t){t.hasStroke()&&this._stroke(t)},t.prototype._stroke=function(t){},t.prototype.fillStrokeShape=function(t){this.fillShape(t),this.strokeShape(t)},t.prototype.getTrace=function(t){var e,n,r,o,f=this.traceArr,g=f.length,m="";for(e=0;e<g;e++)n=f[e],r=n.method,r?(o=n.args,m+=r,t?m+=p:i.Util._isArray(o[0])?m+=l+o.join(s)+c:m+=a+o.join(s)+u):(m+=n.property,t||(m+=d+n.val)),m+=h;return m},t.prototype.clearTrace=function(){this.traceArr=[]},t.prototype._trace=function(t){var e,n=this.traceArr;n.push(t),e=n.length,e>=m&&n.shift()},t.prototype.reset=function(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)},t.prototype.getCanvas=function(){return this.canvas},t.prototype.clear=function(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)},t.prototype._applyLineCap=function(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)},t.prototype._applyOpacity=function(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)},t.prototype._applyLineJoin=function(t){var e=t.getLineJoin();e&&this.setAttr("lineJoin",e)},t.prototype.setAttr=function(t,e){this._context[t]=e},t.prototype.arc=function(t,e,n,r,i,o){this._context.arc(t,e,n,r,i,o)},t.prototype.arcTo=function(t,e,n,r,i){this._context.arcTo(t,e,n,r,i)},t.prototype.beginPath=function(){this._context.beginPath()},t.prototype.bezierCurveTo=function(t,e,n,r,i,o){this._context.bezierCurveTo(t,e,n,r,i,o)},t.prototype.clearRect=function(t,e,n,r){this._context.clearRect(t,e,n,r)},t.prototype.clip=function(){this._context.clip()},t.prototype.closePath=function(){this._context.closePath()},t.prototype.createImageData=function(t,e){var n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0},t.prototype.createLinearGradient=function(t,e,n,r){return this._context.createLinearGradient(t,e,n,r)},t.prototype.createPattern=function(t,e){return this._context.createPattern(t,e)},t.prototype.createRadialGradient=function(t,e,n,r,i,o){return this._context.createRadialGradient(t,e,n,r,i,o)},t.prototype.drawImage=function(t,e,n,r,i,o,s,a,u){var l=arguments,c=this._context;3===l.length?c.drawImage(t,e,n):5===l.length?c.drawImage(t,e,n,r,i):9===l.length&&c.drawImage(t,e,n,r,i,o,s,a,u)},t.prototype.ellipse=function(t,e,n,r,i,o,s,a){this._context.ellipse(t,e,n,r,i,o,s,a)},t.prototype.isPointInPath=function(t,e){return this._context.isPointInPath(t,e)},t.prototype.fill=function(){this._context.fill()},t.prototype.fillRect=function(t,e,n,r){this._context.fillRect(t,e,n,r)},t.prototype.strokeRect=function(t,e,n,r){this._context.strokeRect(t,e,n,r)},t.prototype.fillText=function(t,e,n){this._context.fillText(t,e,n)},t.prototype.measureText=function(t){return this._context.measureText(t)},t.prototype.getImageData=function(t,e,n,r){return this._context.getImageData(t,e,n,r)},t.prototype.lineTo=function(t,e){this._context.lineTo(t,e)},t.prototype.moveTo=function(t,e){this._context.moveTo(t,e)},t.prototype.rect=function(t,e,n,r){this._context.rect(t,e,n,r)},t.prototype.putImageData=function(t,e,n){this._context.putImageData(t,e,n)},t.prototype.quadraticCurveTo=function(t,e,n,r){this._context.quadraticCurveTo(t,e,n,r)},t.prototype.restore=function(){this._context.restore()},t.prototype.rotate=function(t){this._context.rotate(t)},t.prototype.save=function(){this._context.save()},t.prototype.scale=function(t,e){this._context.scale(t,e)},t.prototype.setLineDash=function(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context["mozDash"]=t:"webkitLineDash"in this._context&&(this._context["webkitLineDash"]=t)},t.prototype.getLineDash=function(){return this._context.getLineDash()},t.prototype.setTransform=function(t,e,n,r,i,o){this._context.setTransform(t,e,n,r,i,o)},t.prototype.stroke=function(){this._context.stroke()},t.prototype.strokeText=function(t,e,n,r){this._context.strokeText(t,e,n,r)},t.prototype.transform=function(t,e,n,r,i,o){this._context.transform(t,e,n,r,i,o)},t.prototype.translate=function(t,e){this._context.translate(t,e)},t.prototype._enableTrace=function(){var t,e,n=this,r=f.length,o=i.Util._simplifyArray,s=this.setAttr,a=function(t){var r,i=n[t];n[t]=function(){return e=o(Array.prototype.slice.call(arguments,0)),r=i.apply(n,arguments),n._trace({method:t,args:e}),r}};for(t=0;t<r;t++)a(f[t]);n.setAttr=function(){s.apply(n,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}},t.prototype._applyGlobalCompositeOperation=function(t){var e=t.getGlobalCompositeOperation();"source-over"!==e&&this.setAttr("globalCompositeOperation",e)},t}();e.Context=y,g.forEach((function(t){Object.defineProperty(y.prototype,t,{get:function(){return this._context[t]},set:function(e){this._context[t]=e}})}));var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._fillColor=function(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)},e.prototype._fillPattern=function(t){var e=t.getFillPatternX(),n=t.getFillPatternY(),r=o.Konva.getAngle(t.getFillPatternRotation()),i=t.getFillPatternOffsetX(),s=t.getFillPatternOffsetY(),a=t.getFillPatternScaleX(),u=t.getFillPatternScaleY();(e||n)&&this.translate(e||0,n||0),r&&this.rotate(r),(a||u)&&this.scale(a,u),(i||s)&&this.translate(-1*i,-1*s),this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)},e.prototype._fillLinearGradient=function(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fillRadialGradient=function(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},e.prototype._fill=function(t){var e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)this._fillColor(t);else{var r=t.getFillPatternImage();if(r&&"pattern"===n)this._fillPattern(t);else{var i=t.getFillLinearGradientColorStops();if(i&&"linear-gradient"===n)this._fillLinearGradient(t);else{var o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):r?this._fillPattern(t):i?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}}}},e.prototype._strokeLinearGradient=function(t){var e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(e.x,e.y,n.x,n.y);if(r){for(var o=0;o<r.length;o+=2)i.addColorStop(r[o],r[o+1]);this.setAttr("strokeStyle",i)}},e.prototype._stroke=function(t){var e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var i=t.getStrokeLinearGradientColorStops();i?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}},e.prototype._applyShadow=function(t){var e=i.Util,n=e.get(t.getShadowRGBA(),"black"),r=e.get(t.getShadowBlur(),5),o=e.get(t.getShadowOffset(),{x:0,y:0}),s=t.getAbsoluteScale(),a=this.canvas.getPixelRatio(),u=s.x*a,l=s.y*a;this.setAttr("shadowColor",n),this.setAttr("shadowBlur",r*Math.min(Math.abs(u),Math.abs(l))),this.setAttr("shadowOffsetX",o.x*u),this.setAttr("shadowOffsetY",o.y*l)},e}(y);e.SceneContext=v;var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._fill=function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},e.prototype.strokeShape=function(t){t.hasHitStroke()&&this._stroke(t)},e.prototype._stroke=function(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t);var r=t.hitStrokeWidth(),i="auto"===r?t.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}},e}(y);e.HitContext=x},c742:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("4546");e.Contrast=function(t){var e,n=Math.pow((this.contrast()+100)/100,2),r=t.data,i=r.length,o=150,s=150,a=150;for(e=0;e<i;e+=4)o=r[e],s=r[e+1],a=r[e+2],o/=255,o-=.5,o*=n,o+=.5,o*=255,s/=255,s-=.5,s*=n,s+=.5,s*=255,a/=255,a-=.5,a*=n,a+=.5,a*=255,o=o<0?0:o>255?255:o,s=s<0?0:s>255?255:s,a=a<0?0:a>255?255:a,r[e]=o,r[e+1]=s,r[e+2]=a},r.Factory.addGetterSetter(i.Node,"contrast",0,o.getNumberValidator(),r.Factory.afterSetFilter)},c94b:function(t,e,n){},cb29:function(t,e,n){var r=n("23e7"),i=n("81d5"),o=n("44d2");r({target:"Array",proto:!0},{fill:i}),o("fill")},cf29:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Grayscale=function(t){var e,n,r=t.data,i=r.length;for(e=0;e<i;e+=4)n=.34*r[e]+.5*r[e+1]+.16*r[e+2],r[e]=n,r[e+1]=n,r[e+2]=n}},d488:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("4971"),a=n("fce6"),u=n("5d5a"),l=n("f35c"),c=n("d777"),h=n("4546"),p=n("d777"),d="tr-konva",f=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map((function(t){return t+"."+d})).join(" "),g="nodeRect",m=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"].map((function(t){return t+"."+d})).join(" "),y={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},v="ontouchstart"in c.Konva._global;function x(t,e,n){if("rotater"===t)return"crosshair";e+=i.Util._degToRad(y[t]||0),n&&(e*=-1);var r=(i.Util._radToDeg(e)%360+360)%360;return i.Util._inRange(r,337.5,360)||i.Util._inRange(r,0,22.5)?"ns-resize":i.Util._inRange(r,22.5,67.5)?"nesw-resize":i.Util._inRange(r,67.5,112.5)?"ew-resize":i.Util._inRange(r,112.5,157.5)?"nwse-resize":i.Util._inRange(r,157.5,202.5)?"ns-resize":i.Util._inRange(r,202.5,247.5)?"nesw-resize":i.Util._inRange(r,247.5,292.5)?"ew-resize":i.Util._inRange(r,292.5,337.5)?"nwse-resize":(i.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}var _=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],b=1e8,w=function(t){function e(e){var n=t.call(this,e)||this;return n._transforming=!1,n._createElements(),n._handleMouseMove=n._handleMouseMove.bind(n),n._handleMouseUp=n._handleMouseUp.bind(n),n.update=n.update.bind(n),n.on(f,n.update),n.getNode()&&n.update(),n}return r(e,t),e.prototype.attachTo=function(t){return this.setNode(t),this},e.prototype.setNode=function(t){var e=this;this._node&&this.detach(),this._node=t,this._resetTransformCache();var n=t._attrsAffectingSize.map((function(t){return t+"Change."+d})).join(" "),r=function(){e._resetTransformCache(),e._transforming||e.update()};t.on(n,r),t.on(m,r),t.on("xChange."+d+" yChange."+d,(function(){return e._resetTransformCache()}));var i=!!this.findOne(".top-left");return i&&this.update(),this},e.prototype.getNode=function(){return this._node},e.prototype.getActiveAnchor=function(){return this._movingAnchorName},e.prototype.detach=function(){this.getNode()&&(this.getNode().off("."+d),this._node=void 0),this._resetTransformCache()},e.prototype._resetTransformCache=function(){this._clearCache(g),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")},e.prototype._getNodeRect=function(){return this._getCache(g,this.__getNodeRect)},e.prototype.__getNodeRect=function(){var t=this.getNode();if(!t)return{x:-b,y:-b,width:0,height:0,rotation:0};t.parent&&this.parent&&t.parent!==this.parent&&i.Util.warn("Transformer and attached node have different parents. Konva does not support such case right now. Please move Transformer to the parent of attaching node.");var e=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=c.Konva.getAngle(t.rotation()),r=e.x*t.scaleX()-t.offsetX()*t.scaleX(),o=e.y*t.scaleY()-t.offsetY()*t.scaleY();return{x:t.x()+r*Math.cos(n)+o*Math.sin(-n),y:t.y()+o*Math.cos(n)+r*Math.sin(n),width:e.width*t.scaleX(),height:e.height*t.scaleY(),rotation:t.rotation()}},e.prototype.getX=function(){return this._getNodeRect().x},e.prototype.getY=function(){return this._getNodeRect().y},e.prototype.getRotation=function(){return this._getNodeRect().rotation},e.prototype.getWidth=function(){return this._getNodeRect().width},e.prototype.getHeight=function(){return this._getNodeRect().height},e.prototype._createElements=function(){this._createBack(),_.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")},e.prototype._createAnchor=function(t){var e=this,n=new u.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:v?10:"auto"}),r=this;n.on("mousedown touchstart",(function(t){r._handleMouseDown(t)})),n.on("dragstart",(function(t){t.cancelBubble=!0})),n.on("dragmove",(function(t){t.cancelBubble=!0})),n.on("dragend",(function(t){t.cancelBubble=!0})),n.on("mouseenter",(function(){var r=c.Konva.getAngle(e.getAbsoluteRotation()),i=e.getNode().getAbsoluteScale(),o=i.y*i.x<0,s=x(t,r,o);n.getStage().content.style.cursor=s,e._cursorChange=!0})),n.on("mouseout",(function(){n.getStage()&&n.getParent()&&(n.getStage().content.style.cursor="",e._cursorChange=!1)})),this.add(n)},e.prototype._createBack=function(){var t=new a.Shape({name:"back",width:0,height:0,listening:!1,sceneFunc:function(t){var e=this.getParent(),n=e.padding();t.beginPath(),t.rect(-n,-n,this.width()+2*n,this.height()+2*n),t.moveTo(this.width()/2,-n),e.rotateEnabled()&&t.lineTo(this.width()/2,-e.rotateAnchorOffset()*i.Util._sign(this.height())-n),t.fillStrokeShape(this)}});this.add(t)},e.prototype._handleMouseDown=function(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),n=e.width,r=e.height,i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));this.sin=Math.abs(r/i),this.cos=Math.abs(n/i),window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0),this._transforming=!0,this._fire("transformstart",{evt:t,target:this.getNode()}),this.getNode()._fire("transformstart",{evt:t,target:this.getNode()})},e.prototype._handleMouseMove=function(t){var e,n,r,o=this.findOne("."+this._movingAnchorName),s=o.getStage();s.setPointersPositions(t),o.setAbsolutePosition(s.getPointerPosition());var a=this.keepRatio()||t.shiftKey,u=this.padding();if("top-left"===this._movingAnchorName){if(a){r=Math.sqrt(Math.pow(this.findOne(".bottom-right").x()-o.x()-2*u,2)+Math.pow(this.findOne(".bottom-right").y()-o.y()-2*u,2));var l=this.findOne(".top-left").x()>this.findOne(".bottom-right").x()?-1:1,h=this.findOne(".top-left").y()>this.findOne(".bottom-right").y()?-1:1;e=r*this.cos*l,n=r*this.sin*h,this.findOne(".top-left").x(this.findOne(".bottom-right").x()-e-2*u),this.findOne(".top-left").y(this.findOne(".bottom-right").y()-n-2*u)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(o.y());else if("top-right"===this._movingAnchorName){if(a){r=Math.sqrt(Math.pow(o.x()-this.findOne(".bottom-left").x()-2*u,2)+Math.pow(this.findOne(".bottom-left").y()-o.y()-2*u,2));l=this.findOne(".top-right").x()<this.findOne(".top-left").x()?-1:1,h=this.findOne(".top-right").y()>this.findOne(".bottom-left").y()?-1:1;e=r*this.cos*l,n=r*this.sin*h,this.findOne(".top-right").x(e+u),this.findOne(".top-right").y(this.findOne(".bottom-left").y()-n-2*u)}var p=o.position();this.findOne(".top-left").y(p.y),this.findOne(".bottom-right").x(p.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(o.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(o.x());else if("bottom-left"===this._movingAnchorName){if(a){r=Math.sqrt(Math.pow(this.findOne(".top-right").x()-o.x()-2*u,2)+Math.pow(o.y()-this.findOne(".top-right").y()-2*u,2));l=this.findOne(".top-right").x()<this.findOne(".bottom-left").x()?-1:1,h=this.findOne(".bottom-right").y()<this.findOne(".top-left").y()?-1:1;e=r*this.cos*l,n=r*this.sin*h,this.findOne(".bottom-left").x(this.findOne(".top-right").x()-e-2*u),this.findOne(".bottom-left").y(n+u)}p=o.position(),this.findOne(".top-left").x(p.x),this.findOne(".bottom-right").y(p.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(o.y());else if("bottom-right"===this._movingAnchorName){if(a){r=Math.sqrt(Math.pow(this.findOne(".bottom-right").x()-u,2)+Math.pow(this.findOne(".bottom-right").y()-u,2));l=this.findOne(".top-left").x()>this.findOne(".bottom-right").x()?-1:1,h=this.findOne(".top-left").y()>this.findOne(".bottom-right").y()?-1:1;e=r*this.cos*l,n=r*this.sin*h,this.findOne(".bottom-right").x(e+u),this.findOne(".bottom-right").y(n+u)}}else if("rotater"===this._movingAnchorName){var d=this._getNodeRect();e=o.x()-d.width/2,n=-o.y()+d.height/2;var f=Math.atan2(-n,e)+Math.PI/2;d.height<0&&(f-=Math.PI);for(var g=c.Konva.getAngle(this.rotation()),m=i.Util._radToDeg(g)+i.Util._radToDeg(f),y=c.Konva.getAngle(this.getNode().rotation()),v=i.Util._degToRad(m),x=this.rotationSnaps(),_=c.Konva.getAngle(this.rotationSnapTolerance()),b=0;b<x.length;b++){var w=c.Konva.getAngle(x[b]),M=Math.abs(w-i.Util._degToRad(m))%(2*Math.PI);M<_&&(m=i.Util._radToDeg(w),v=i.Util._degToRad(m))}var E=u,S=u;this._fitNodeInto({rotation:c.Konva.angleDeg?m:i.Util._degToRad(m),x:d.x+(d.width/2+u)*(Math.cos(y)-Math.cos(v))+(d.height/2+u)*(Math.sin(-y)-Math.sin(-v))-(E*Math.cos(g)+S*Math.sin(-g)),y:d.y+(d.height/2+u)*(Math.cos(y)-Math.cos(v))+(d.width/2+u)*(Math.sin(y)-Math.sin(v))-(S*Math.cos(g)+E*Math.sin(g)),width:d.width+2*u,height:d.height+2*u},t)}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if("rotater"!==this._movingAnchorName){var T=this.centeredScaling()||t.altKey;if(T){var C=this.findOne(".top-left"),A=this.findOne(".bottom-right"),P=C.x()+u,L=C.y()+u,I=this.getWidth()-A.x()+u,R=this.getHeight()-A.y()+u;A.move({x:-P,y:-L}),C.move({x:I,y:R})}var N=this.findOne(".top-left").getAbsolutePosition(this.getParent());e=N.x,n=N.y;var O=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),D=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodeInto({x:e+this.offsetX(),y:n+this.offsetY(),width:O,height:D},t)}},e.prototype._handleMouseUp=function(t){this._removeEvents(t)},e.prototype._removeEvents=function(t){if(this._transforming){this._transforming=!1,window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0);var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&e.fire("transformend",{evt:t,target:e}),this._movingAnchorName=null}},e.prototype._fitNodeInto=function(t,e){var n=this.boundBoxFunc();if(n){var r=this._getNodeRect();t=n.call(this,r,t)}var i=this.getNode();void 0!==t.rotation&&this.getNode().rotation(t.rotation);var o=i.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=this.padding(),a=o.width?(t.width-2*s)/o.width:1,u=o.height?(t.height-2*s)/o.height:1,l=c.Konva.getAngle(i.rotation()),h=o.x*a-s-i.offsetX()*a,p=o.y*u-s-i.offsetY()*u;this.getNode().setAttrs({scaleX:a,scaleY:u,x:t.x-(h*Math.cos(l)+p*Math.sin(-l)),y:t.y-(p*Math.cos(l)+h*Math.sin(l))}),this._fire("transform",{evt:e,target:this.getNode()}),this.getNode()._fire("transform",{evt:e,target:this.getNode()}),this.update(),this.getLayer().batchDraw()},e.prototype.forceUpdate=function(){this._resetTransformCache(),this.update()},e.prototype.update=function(){var t=this,e=this._getNodeRect(),n=this.getNode(),r={x:1,y:1};n&&n.getParent()&&(r=n.getParent().getAbsoluteScale());var o={x:1/r.x,y:1/r.y},s=e.width,a=e.height,u=this.enabledAnchors(),l=this.resizeEnabled(),c=this.padding(),h=this.anchorSize();this.find("._anchor").each((function(e){return e.setAttrs({width:h,height:h,offsetX:h/2,offsetY:h/2,stroke:t.anchorStroke(),strokeWidth:t.anchorStrokeWidth(),fill:t.anchorFill(),cornerRadius:t.anchorCornerRadius()})})),this.findOne(".top-left").setAttrs({x:-c,y:-c,scale:o,visible:l&&u.indexOf("top-left")>=0}),this.findOne(".top-center").setAttrs({x:s/2,y:-c,scale:o,visible:l&&u.indexOf("top-center")>=0}),this.findOne(".top-right").setAttrs({x:s+c,y:-c,scale:o,visible:l&&u.indexOf("top-right")>=0}),this.findOne(".middle-left").setAttrs({x:-c,y:a/2,scale:o,visible:l&&u.indexOf("middle-left")>=0}),this.findOne(".middle-right").setAttrs({x:s+c,y:a/2,scale:o,visible:l&&u.indexOf("middle-right")>=0}),this.findOne(".bottom-left").setAttrs({x:-c,y:a+c,scale:o,visible:l&&u.indexOf("bottom-left")>=0}),this.findOne(".bottom-center").setAttrs({x:s/2,y:a+c,scale:o,visible:l&&u.indexOf("bottom-center")>=0}),this.findOne(".bottom-right").setAttrs({x:s+c,y:a+c,scale:o,visible:l&&u.indexOf("bottom-right")>=0});var p=-this.rotateAnchorOffset()*Math.abs(o.y);this.findOne(".rotater").setAttrs({x:s/2,y:p*i.Util._sign(a)-c,scale:o,visible:this.rotateEnabled()}),this.findOne(".back").setAttrs({width:s*r.x,height:a*r.y,scale:o,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash()})},e.prototype.isTransforming=function(){return this._transforming},e.prototype.stopTransform=function(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}},e.prototype.destroy=function(){return this.getStage()&&this._cursorChange&&(this.getStage().content.style.cursor=""),l.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this},e.prototype.toObject=function(){return s.Node.prototype.toObject.call(this)},e}(l.Group);function M(t){return t instanceof Array||i.Util.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach((function(t){-1===_.indexOf(t)&&i.Util.warn("Unknown anchor name: "+t+". Available names are: "+_.join(", "))})),t||[]}e.Transformer=w,w.prototype.className="Transformer",p._registerNode(w),o.Factory.addGetterSetter(w,"enabledAnchors",_,M),o.Factory.addGetterSetter(w,"resizeEnabled",!0),o.Factory.addGetterSetter(w,"anchorSize",10,h.getNumberValidator()),o.Factory.addGetterSetter(w,"rotateEnabled",!0),o.Factory.addGetterSetter(w,"rotationSnaps",[]),o.Factory.addGetterSetter(w,"rotateAnchorOffset",50,h.getNumberValidator()),o.Factory.addGetterSetter(w,"rotationSnapTolerance",5,h.getNumberValidator()),o.Factory.addGetterSetter(w,"borderEnabled",!0),o.Factory.addGetterSetter(w,"anchorStroke","rgb(0, 161, 255)"),o.Factory.addGetterSetter(w,"anchorStrokeWidth",1,h.getNumberValidator()),o.Factory.addGetterSetter(w,"anchorFill","white"),o.Factory.addGetterSetter(w,"anchorCornerRadius",0,h.getNumberValidator()),o.Factory.addGetterSetter(w,"borderStroke","rgb(0, 161, 255)"),o.Factory.addGetterSetter(w,"borderStrokeWidth",1,h.getNumberValidator()),o.Factory.addGetterSetter(w,"borderDash"),o.Factory.addGetterSetter(w,"keepRatio",!0),o.Factory.addGetterSetter(w,"centeredScaling",!1),o.Factory.addGetterSetter(w,"ignoreStroke",!1),o.Factory.addGetterSetter(w,"padding",0,h.getNumberValidator()),o.Factory.addGetterSetter(w,"node"),o.Factory.addGetterSetter(w,"boundBoxFunc"),o.Factory.backCompat(w,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),i.Collection.mapMethods(w)},d6af:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("ea61"),s=n("4971"),a=n("f0b4"),u=n("f655"),l=function(t){function e(e){var n=t.call(this,e)||this;return n.canvas=new u.SceneCanvas,n._waitingForDraw=!1,n.on("visibleChange",n._checkVisibility),n._checkVisibility(),n.on("imageSmoothingEnabledChange",n._checkSmooth),n._checkSmooth(),n}return r(e,t),e.prototype.createPNGStream=function(){var t=this.canvas._canvas;return t.createPNGStream()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getHitCanvas=function(){return this.hitCanvas},e.prototype.getContext=function(){return this.getCanvas().getContext()},e.prototype.clear=function(t){return this.getContext().clear(t),this},e.prototype.setZIndex=function(e){t.prototype.setZIndex.call(this,e);var n=this.getStage();return n&&(n.content.removeChild(this.getCanvas()._canvas),e<n.children.length-1?n.content.insertBefore(this.getCanvas()._canvas,n.children[e+1].getCanvas()._canvas):n.content.appendChild(this.getCanvas()._canvas)),this},e.prototype.moveToTop=function(){s.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas)),!0},e.prototype.moveUp=function(){var t=s.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return!!e&&(e.content.removeChild(this.getCanvas()._canvas),this.index<e.children.length-1?e.content.insertBefore(this.getCanvas()._canvas,e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas),!0)},e.prototype.moveDown=function(){if(s.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}return!0}return!1},e.prototype.moveToBottom=function(){if(s.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}return!0}return!1},e.prototype.getLayer=function(){return this},e.prototype.hitGraphEnabled=function(){return!0},e.prototype.remove=function(){var t=this.getCanvas()._canvas;return s.Node.prototype.remove.call(this),t&&t.parentNode&&i.Util._isInDocument(t)&&t.parentNode.removeChild(t),this},e.prototype.getStage=function(){return this.parent},e.prototype.setSize=function(t){var e=t.width,n=t.height;return this.canvas.setSize(e,n),this},e.prototype._toKonvaCanvas=function(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),s.Node.prototype._toKonvaCanvas.call(this,t)},e.prototype._checkVisibility=function(){var t=this.visible();this.canvas._canvas.style.display=t?"block":"none"},e.prototype._checkSmooth=function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()},e.prototype.getWidth=function(){if(this.parent)return this.parent.width()},e.prototype.setWidth=function(){i.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},e.prototype.getHeight=function(){if(this.parent)return this.parent.height()},e.prototype.setHeight=function(){i.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},e.prototype.getIntersection=function(t,e){return null},e.prototype.batchDraw=function(){var t=this;return this._waitingForDraw||(this._waitingForDraw=!0,i.Util.requestAnimFrame((function(){t.draw(),t._waitingForDraw=!1}))),this},e.prototype._applyTransform=function(t,e,n){var r=t.getAbsoluteTransform(n).getMatrix();e.transform(r[0],r[1],r[2],r[3],r[4],r[5])},e}(o.Container);e.BaseLayer=l,l.prototype.nodeType="BaseLayer",a.Factory.addGetterSetter(l,"imageSmoothingEnabled",!0),a.Factory.addGetterSetter(l,"clearBeforeDraw",!0),i.Collection.mapMethods(l)},d777:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=Math.PI/180;function r(){return"undefined"!==typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window))}var i=function(t){var e=t.indexOf("msie ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);var n=t.indexOf("trident/");if(n>0){var r=t.indexOf("rv:");return parseInt(t.substring(r+3,t.indexOf(".",r)),10)}var i=t.indexOf("edge/");return i>0&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)};e._parseUA=function(t){var e=t.toLowerCase(),n=/(chrome)[ /]([\w.]+)/.exec(e)||/(webkit)[ /]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),o=!!t.match(/IEMobile/i);return{browser:n[1]||"",version:n[2]||"0",isIE:i(e),mobile:r,ieMobile:o}},e.glob="undefined"!==typeof t?t:"undefined"!==typeof window?window:"undefined"!==typeof WorkerGlobalScope?self:{},e.Konva={_global:e.glob,version:"4.2.2",isBrowser:r(),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:function(t){return e.Konva.angleDeg?t*n:t},enableTrace:!1,_pointerEventsEnabled:!1,hitOnDragEnabled:!1,captureTouchEventsEnabled:!1,listenClickTap:!1,inDblClickWindow:!1,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return e.Konva["DD"].isDragging},isDragReady:function(){return!!e.Konva["DD"].node},UA:e._parseUA(e.glob.navigator&&e.glob.navigator.userAgent||""),document:e.glob.document,_injectGlobal:function(t){e.glob.Konva=t},_parseUA:e._parseUA},e._NODES_REGISTRY={},e._registerNode=function(t){e._NODES_REGISTRY[t.prototype.getClassName()]=t,e.Konva[t.prototype.getClassName()]=t}}).call(this,n("c8ba"))},d80b:function(t,e,n){(function(){"use strict";var e=Math.abs,r=Math.cos,i=Math.sin,o=Math.acos,s=Math.atan2,a=Math.sqrt,u=Math.pow,l=function(t){return t<0?-u(-t,1/3):u(t,1/3)},c=Math.PI,h=2*c,p=c/2,d=1e-6,f=Number.MAX_SAFE_INTEGER||9007199254740991,g=Number.MIN_SAFE_INTEGER||-9007199254740991,m={x:0,y:0,z:0},y={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){var n=e(t),r=n.x*n.x+n.y*n.y;return"undefined"!==typeof n.z&&(r+=n.z*n.z),a(r)},compute:function(t,e,n){if(0===t)return e[0];var r=e.length-1;if(1===t)return e[r];var i=e,o=1-t;if(0===r)return e[0];if(1===r)return p={x:o*i[0].x+t*i[1].x,y:o*i[0].y+t*i[1].y},n&&(p.z=o*i[0].z+t*i[1].z),p;if(r<4){var s,a,u,l=o*o,c=t*t,h=0;2===r?(i=[i[0],i[1],i[2],m],s=l,a=o*t*2,u=c):3===r&&(s=l*o,a=l*t*3,u=o*c*3,h=t*c);var p={x:s*i[0].x+a*i[1].x+u*i[2].x+h*i[3].x,y:s*i[0].y+a*i[1].y+u*i[2].y+h*i[3].y};return n&&(p.z=s*i[0].z+a*i[1].z+u*i[2].z+h*i[3].z),p}var d=JSON.parse(JSON.stringify(e));while(d.length>1){for(var f=0;f<d.length-1;f++)d[f]={x:d[f].x+(d[f+1].x-d[f].x)*t,y:d[f].y+(d[f+1].y-d[f].y)*t},"undefined"!==typeof d[f].z&&(d[f]=d[f].z+(d[f+1].z-d[f].z)*t);d.splice(d.length-1,1)}return d[0]},computeWithRatios:function(t,e,n,r){var i,o=1-t,s=n,a=e,u=s[0],l=s[1],c=s[2],h=s[3];return u*=o,l*=t,2===a.length?(i=u+l,{x:(u*a[0].x+l*a[1].x)/i,y:(u*a[0].y+l*a[1].y)/i,z:!!r&&(u*a[0].z+l*a[1].z)/i}):(u*=o,l*=2*o,c*=t*t,3===a.length?(i=u+l+c,{x:(u*a[0].x+l*a[1].x+c*a[2].x)/i,y:(u*a[0].y+l*a[1].y+c*a[2].y)/i,z:!!r&&(u*a[0].z+l*a[1].z+c*a[2].z)/i}):(u*=o,l*=1.5*o,c*=3*o,h*=t*t*t,4===a.length?(i=u+l+c+h,{x:(u*a[0].x+l*a[1].x+c*a[2].x+h*a[3].x)/i,y:(u*a[0].y+l*a[1].y+c*a[2].y+h*a[3].y)/i,z:!!r&&(u*a[0].z+l*a[1].z+c*a[2].z+h*a[3].z)/i}):void 0))},derive:function(t,e){for(var n=[],r=t,i=r.length,o=i-1;i>1;i--,o--){for(var s,a=[],u=0;u<o;u++)s={x:o*(r[u+1].x-r[u].x),y:o*(r[u+1].y-r[u].y)},e&&(s.z=o*(r[u+1].z-r[u].z)),a.push(s);n.push(a),r=a}return n},between:function(t,e,n){return e<=t&&t<=n||y.approximately(t,e)||y.approximately(t,n)},approximately:function(t,n,r){return e(t-n)<=(r||d)},length:function(t){var e,n,r=.5,i=0,o=y.Tvalues.length;for(e=0;e<o;e++)n=r*y.Tvalues[e]+r,i+=y.Cvalues[e]*y.arcfn(n,t);return r*i},map:function(t,e,n,r,i){var o=n-e,s=i-r,a=t-e,u=a/o;return r+s*u},lerp:function(t,e,n){var r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return e.z&&n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){var e=t.x+"/"+t.y;return"undefined"!==typeof t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(y.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-t.x,a=n.y-t.y,u=r*a-i*o,l=r*o+i*a;return s(u,l)},round:function(t,e){var n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){var n=t.x-e.x,r=t.y-e.y;return a(n*n+r*r)},closest:function(t,e){var n,r,i=u(2,63);return t.forEach((function(t,o){r=y.dist(e,t),r<i&&(i=r,n=o)})),{mdist:i,mpos:n}},abcratio:function(t,n){if(2!==n&&3!==n)return!1;if("undefined"===typeof t)t=.5;else if(0===t||1===t)return t;var r=u(t,n)+u(1-t,n),i=r-1;return e(i/r)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if("undefined"===typeof t)t=.5;else if(0===t||1===t)return t;var n=u(1-t,e),r=u(t,e)+n;return n/r},lli8:function(t,e,n,r,i,o,s,a){var u=(t*r-e*n)*(i-s)-(t-n)*(i*a-o*s),l=(t*r-e*n)*(o-a)-(e-r)*(i*a-o*s),c=(t-n)*(o-a)-(e-r)*(i-s);return 0!=c&&{x:u/c,y:l/c}},lli4:function(t,e,n,r){var i=t.x,o=t.y,s=e.x,a=e.y,u=n.x,l=n.y,c=r.x,h=r.y;return y.lli8(i,o,s,a,u,l,c,h)},lli:function(t,e){return y.lli4(t,t.c,e,e.c)},makeline:function(t,e){var r=n("2d16"),i=t.x,o=t.y,s=e.x,a=e.y,u=(s-i)/3,l=(a-o)/3;return new r(i,o,i+u,o+l,i+2*u,o+2*l,s,a)},findbbox:function(t){var e=f,n=f,r=g,i=g;return t.forEach((function(t){var o=t.bbox();e>o.x.min&&(e=o.x.min),n>o.y.min&&(n=o.y.min),r<o.x.max&&(r=o.x.max),i<o.y.max&&(i=o.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!y.bboxoverlap(e,r))return[];var o=[],s=[t.startcap,t.forward,t.back,t.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return s.forEach((function(e){e.virtual||a.forEach((function(r){if(!r.virtual){var s=e.intersects(r,i);s.length>0&&(s.c1=e,s.c2=r,s.s1=t,s.s2=n,o.push(s))}}))})),o},makeshape:function(t,e,n){var r=e.points.length,i=t.points.length,o=y.makeline(e.points[r-1],t.points[0]),s=y.makeline(t.points[i-1],e.points[0]),a={startcap:o,forward:t,back:e,endcap:s,bbox:y.findbbox([o,t,e,s])},u=y;return a.intersections=function(t){return u.shapeintersections(a,a.bbox,t,t.bbox,n)},a},getminmax:function(t,e,n){if(!n)return{min:0,max:0};var r,i,o=f,s=g;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(var a=0,u=n.length;a<u;a++)r=n[a],i=t.get(r),i[e]<o&&(o=i[e]),i[e]>s&&(s=i[e]);return{min:o,mid:(o+s)/2,max:s,size:s-o}},align:function(t,e){var n=e.p1.x,o=e.p1.y,a=-s(e.p2.y-o,e.p2.x-n),u=function(t){return{x:(t.x-n)*r(a)-(t.y-o)*i(a),y:(t.x-n)*i(a)+(t.y-o)*r(a)}};return t.map(u)},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};var n=t.length-1,i=y.align(t,e),s=function(t){return 0<=t&&t<=1};if(2===n){var u=i[0].y,c=i[1].y,p=i[2].y,d=u-2*c+p;if(0!==d){var f=-a(c*c-u*p),g=-u+c,m=-(f+g)/d,v=-(-f+g)/d;return[m,v].filter(s)}return c!==p&&0===d?[(2*c-p)/(2*c-2*p)].filter(s):[]}var x=i[0].y,_=i[1].y,b=i[2].y,w=i[3].y;d=3*_-x-3*b+w,u=3*x-6*_+3*b,c=-3*x+3*_,p=x;if(y.approximately(d,0)){if(y.approximately(u,0))return y.approximately(c,0)?[]:[-p/c].filter(s);var M=a(c*c-4*u*p),E=2*u;return[(M-c)/E,(-c-M)/E].filter(s)}u/=d,c/=d,p/=d;i=(3*c-u*u)/3;var S,T,C,A,P=i/3,L=(M=(2*u*u*u-9*u*c+27*p)/27,M/2),I=L*L+P*P*P;if(I<0){var R=-i/3,N=R*R*R,O=a(N),D=-M/(2*O),F=D<-1?-1:D>1?1:D,k=o(F),B=l(O),z=2*B;return T=z*r(k/3)-u/3,C=z*r((k+h)/3)-u/3,A=z*r((k+2*h)/3)-u/3,[T,C,A].filter(s)}if(0===I)return S=L<0?l(-L):-l(L),T=2*S-u/3,C=-S-u/3,[T,C].filter(s);var G=a(I);return S=l(-L+G),m=l(L+G),[S-m-u/3].filter(s)},droots:function(t){if(3===t.length){var e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){var o=-a(n*n-e*r),s=-e+n,u=-(o+s)/i,l=-(-o+s)/i;return[u,l]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}},curvature:function(t,n,r,i){var o,s,l,c,h=y.derive(n),p=h[0],d=h[1],f=0,g=0,m=y.compute(t,p),v=y.compute(t,d),x=m.x*m.x+m.y*m.y;if(r?(o=a(u(m.y*v.z-v.y*m.z,2)+u(m.z*v.x-v.z*m.x,2)+u(m.x*v.y-v.x*m.y,2)),s=u(x+m.z*m.z,1.5)):(o=m.x*v.y-m.y*v.x,s=u(x,1.5)),0===o||0===s)return{k:0,r:0};if(f=o/s,g=s/o,!i){var _=y.curvature(t-.001,n,r,!0).k,b=y.curvature(t+.001,n,r,!0).k;c=(b-f+(f-_))/2,l=(e(b-f)+e(f-_))/2}return{k:f,r:g,dk:c,adk:l}},inflections:function(t){if(t.length<4)return[];var e=y.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,o=e[3].x*e[2].y,s=18*(-3*n+2*r+3*i-o),a=18*(3*n-r-3*i),u=18*(i-n);if(y.approximately(s,0)){if(!y.approximately(a,0)){var l=-u/a;if(0<=l&&l<=1)return[l]}return[]}var c=a*a-4*s*u,h=Math.sqrt(c);o=2*s;return y.approximately(o,0)?[]:[(h-a)/o,-(a+h)/o].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,n){var r,i,o,s,a,u=["x","y"],l=u.length;for(r=0;r<l;r++)if(i=u[r],o=t[i].mid,s=n[i].mid,a=(t[i].size+n[i].size)/2,e(o-s)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){var r=t.bbox(),i=e.bbox(),o=1e5,s=n||.5;if(r.x.size+r.y.size<s&&i.x.size+i.y.size<s)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];var a=t.split(.5),u=e.split(.5),l=[{left:a.left,right:u.left},{left:a.left,right:u.right},{left:a.right,right:u.right},{left:a.right,right:u.left}];l=l.filter((function(t){return y.bboxoverlap(t.left.bbox(),t.right.bbox())}));var c=[];return 0===l.length||(l.forEach((function(t){c=c.concat(y.pairiteration(t.left,t.right,s))})),c=c.filter((function(t,e){return c.indexOf(t)===e}))),c},getccenter:function(t,e,n){var o,a=e.x-t.x,u=e.y-t.y,l=n.x-e.x,c=n.y-e.y,d=a*r(p)-u*i(p),f=a*i(p)+u*r(p),g=l*r(p)-c*i(p),m=l*i(p)+c*r(p),v=(t.x+e.x)/2,x=(t.y+e.y)/2,_=(e.x+n.x)/2,b=(e.y+n.y)/2,w=v+d,M=x+f,E=_+g,S=b+m,T=y.lli8(v,x,w,M,_,b,E,S),C=y.dist(T,t),A=s(t.y-T.y,t.x-T.x),P=s(e.y-T.y,e.x-T.x),L=s(n.y-T.y,n.x-T.x);return A<L?((A>P||P>L)&&(A+=h),A>L&&(o=L,L=A,A=o)):L<P&&P<A?(o=L,L=A,A=o):L+=h,T.s=A,T.e=L,T.r=C,T},numberSort:function(t,e){return t-e}};t.exports=y})()},da04:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("f35c"),u=n("4546"),l=n("d777"),c=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width"],h="Change.konva",p="none",d="up",f="right",g="down",m="left",y=c.length,v=function(t){function e(e){var n=t.call(this,e)||this;return n.on("add.konva",(function(t){this._addListeners(t.child),this._sync()})),n}return r(e,t),e.prototype.getText=function(){return this.find("Text")[0]},e.prototype.getTag=function(){return this.find("Tag")[0]},e.prototype._addListeners=function(t){var e,n=this,r=function(){n._sync()};for(e=0;e<y;e++)t.on(c[e]+h,r)},e.prototype.getWidth=function(){return this.getText().width()},e.prototype.getHeight=function(){return this.getText().height()},e.prototype._sync=function(){var t,e,n,r,i,o,s,a=this.getText(),u=this.getTag();if(a&&u){switch(t=a.width(),e=a.height(),n=u.pointerDirection(),r=u.pointerWidth(),s=u.pointerHeight(),i=0,o=0,n){case d:i=t/2,o=-1*s;break;case f:i=t+r,o=e/2;break;case g:i=t/2,o=e+s;break;case m:i=-1*r,o=e/2;break}u.setAttrs({x:-1*i,y:-1*o,width:t,height:e}),a.setAttrs({x:-1*i,y:-1*o})}},e}(a.Group);e.Label=v,v.prototype.className="Label",l._registerNode(v),i.Collection.mapMethods(v);var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.width(),n=this.height(),r=this.pointerDirection(),i=this.pointerWidth(),o=this.pointerHeight(),s=Math.min(this.cornerRadius(),e/2,n/2);t.beginPath(),s?t.moveTo(s,0):t.moveTo(0,0),r===d&&(t.lineTo((e-i)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+i)/2,0)),s?(t.lineTo(e-s,0),t.arc(e-s,s,s,3*Math.PI/2,0,!1)):t.lineTo(e,0),r===f&&(t.lineTo(e,(n-o)/2),t.lineTo(e+i,n/2),t.lineTo(e,(n+o)/2)),s?(t.lineTo(e,n-s),t.arc(e-s,n-s,s,0,Math.PI/2,!1)):t.lineTo(e,n),r===g&&(t.lineTo((e+i)/2,n),t.lineTo(e/2,n+o),t.lineTo((e-i)/2,n)),s?(t.lineTo(s,n),t.arc(s,n-s,s,Math.PI/2,Math.PI,!1)):t.lineTo(0,n),r===m&&(t.lineTo(0,(n+o)/2),t.lineTo(-1*i,n/2),t.lineTo(0,(n-o)/2)),s&&(t.lineTo(0,s),t.arc(s,s,s,Math.PI,3*Math.PI/2,!1)),t.closePath(),t.fillStrokeShape(this)},e.prototype.getSelfRect=function(){var t=0,e=0,n=this.pointerWidth(),r=this.pointerHeight(),i=this.pointerDirection(),o=this.width(),s=this.height();return i===d?(e-=r,s+=r):i===g?s+=r:i===m?(t-=1.5*n,o+=n):i===f&&(o+=1.5*n),{x:t,y:e,width:o,height:s}},e}(s.Shape);e.Tag=x,x.prototype.className="Tag",l._registerNode(x),o.Factory.addGetterSetter(x,"pointerDirection",p),o.Factory.addGetterSetter(x,"pointerWidth",0,u.getNumberValidator()),o.Factory.addGetterSetter(x,"pointerHeight",0,u.getNumberValidator()),o.Factory.addGetterSetter(x,"cornerRadius",0,u.getNumberValidator()),i.Collection.mapMethods(x)},dc17:function(t,e,n){(function(e,n){t.exports=n()})(0,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}
/**
   * splaytree v3.0.1
   * Fast Splay tree for Node and browser
   *
   * @author Alexander Milevski <info@w8r.name>
   * @license MIT
   * @preserve
   */var r=function e(n,r){t(this,e),this.next=null,this.key=n,this.data=r,this.left=null,this.right=null};function i(t,e){return t>e?1:t<e?-1:0}function o(t,e,n){var i=new r(null,null),o=i,s=i;while(1){var a=n(t,e.key);if(a<0){if(null===e.left)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,null===e.left)break}s.left=e,s=e,e=e.left}else{if(!(a>0))break;if(null===e.right)break;if(n(t,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,null===e.right)break}o.right=e,o=e,e=e.right}}return o.right=e.left,s.left=e.right,e.left=i.right,e.right=i.left,e}function s(t,e,n,i){var s=new r(t,e);if(null===n)return s.left=s.right=null,s;n=o(t,n,i);var a=i(t,n.key);return a<0?(s.left=n.left,s.right=n,n.left=null):a>=0&&(s.right=n.right,s.left=n,n.right=null),s}function a(t,e,n){var r=null,i=null;if(e){e=o(t,e,n);var s=n(e.key,t);0===s?(r=e.left,i=e.right):s<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function u(t,e,n){return null===e?t:(null===t||(e=o(t.key,e,n),e.left=t),e)}function l(t,e,n,r,i){if(t){r("".concat(e).concat(n?"└── ":"├── ").concat(i(t),"\n"));var o=e+(n?"    ":"│   ");t.left&&l(t.left,o,!1,r,i),t.right&&l(t.right,o,!0,r,i)}}var c=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;t(this,e),this._root=null,this._size=0,this._comparator=n}return n(e,[{key:"insert",value:function(t,e){return this._size++,this._root=s(t,e,this._root,this._comparator)}},{key:"add",value:function(t,e){var n=new r(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,s=o(t,this._root,i),a=i(t,s.key);return 0===a?this._root=s:(a<0?(n.left=s.left,n.right=s,s.left=null):a>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root}},{key:"remove",value:function(t){this._root=this._remove(t,this._root,this._comparator)}},{key:"_remove",value:function(t,e,n){var r;if(null===e)return null;e=o(t,e,n);var i=n(t,e.key);return 0===i?(null===e.left?r=e.right:(r=o(t,e.left,n),r.right=e.right),this._size--,r):e}},{key:"pop",value:function(){var t=this._root;if(t){while(t.left)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}},{key:"findStatic",value:function(t){var e=this._root,n=this._comparator;while(e){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}},{key:"find",value:function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}},{key:"contains",value:function(t){var e=this._root,n=this._comparator;while(e){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}},{key:"forEach",value:function(t,e){var n=this._root,r=[],i=!1;while(!i)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}},{key:"range",value:function(t,e,n,r){var i,o=[],s=this._comparator,a=this._root;while(0!==o.length||a)if(a)o.push(a),a=a.left;else{if(a=o.pop(),i=s(a.key,e),i>0)break;if(s(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this}},{key:"keys",value:function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t}},{key:"values",value:function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t}},{key:"min",value:function(){return this._root?this.minNode(this._root).key:null}},{key:"max",value:function(){return this._root?this.maxNode(this._root).key:null}},{key:"minNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)while(t.left)t=t.left;return t}},{key:"maxNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)while(t.right)t=t.right;return t}},{key:"at",value:function(t){var e=this._root,n=!1,r=0,i=[];while(!n)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}},{key:"next",value:function(t){var e=this._root,n=null;if(t.right){n=t.right;while(n.left)n=n.left;return n}var r=this._comparator;while(e){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}},{key:"prev",value:function(t){var e=this._root,n=null;if(null!==t.left){n=t.left;while(n.right)n=n.right;return n}var r=this._comparator;while(e){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}},{key:"clear",value:function(){return this._root=null,this._size=0,this}},{key:"toList",value:function(){return d(this._root)}},{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.length,i=this._comparator;if(n&&m(t,e,0,r-1,i),null===this._root)this._root=h(t,e,0,r),this._size=r;else{var o=g(this.toList(),p(t,e),i);r=this._size+r,this._root=f({head:o},0,r)}return this}},{key:"isEmpty",value:function(){return null===this._root}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t){return String(t.key)},e=[];return l(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")}},{key:"update",value:function(t,e,n){var r=this._comparator,i=a(t,this._root,r),o=i.left,l=i.right;r(t,e)<0?l=s(e,n,l,r):o=s(e,n,o,r),this._root=u(o,l,r)}},{key:"split",value:function(t){return a(t,this._root,this._comparator)}},{key:"size",get:function(){return this._size}},{key:"root",get:function(){return this._root}}]),e}();function h(t,e,n,i){var o=i-n;if(o>0){var s=n+Math.floor(o/2),a=t[s],u=e[s],l=new r(a,u);return l.left=h(t,e,n,s),l.right=h(t,e,s+1,i),l}return null}function p(t,e){for(var n=new r(null,null),i=n,o=0;o<t.length;o++)i=i.next=new r(t[o],e[o]);return i.next=null,n.next}function d(t){var e=t,n=[],i=!1,o=new r(null,null),s=o;while(!i)e?(n.push(e),e=e.left):n.length>0?(e=s=s.next=n.pop(),e=e.right):i=!0;return s.next=null,o.next}function f(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=f(t,e,i),s=t.head;return s.left=o,t.head=t.head.next,s.right=f(t,i+1,n),s}return null}function g(t,e,n){var i=new r(null,null),o=i,s=t,a=e;while(null!==s&&null!==a)n(s.key,a.key)<0?(o.next=s,s=s.next):(o.next=a,a=a.next),o=o.next;return null!==s?o.next=s:null!==a&&(o.next=a),i.next}function m(t,e,n,r,i){if(!(n>=r)){var o=t[n+r>>1],s=n-1,a=r+1;while(1){do{s++}while(i(t[s],o)<0);do{a--}while(i(t[a],o)>0);if(s>=a)break;var u=t[s];t[s]=t[a],t[a]=u,u=e[s],e[s]=e[a],e[a]=u}m(t,e,n,a,i),m(t,e,a+1,r,i)}}var y=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},v=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,o=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:o}}},x=Number.EPSILON;void 0===x&&(x=Math.pow(2,-52));var _=x*x,b=function(t,e){if(-x<t&&t<x&&-x<e&&e<x)return 0;var n=t-e;return n*n<_*t*e?0:t<e?-1:1},w=function(){function e(){t(this,e),this.reset()}return n(e,[{key:"reset",value:function(){this.xRounder=new M,this.yRounder=new M}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),e}(),M=function(){function e(){t(this,e),this.tree=new c,this.round(0)}return n(e,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===b(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===b(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),e}(),E=new w,S=function(t,e){return t.x*e.y-t.y*e.x},T=function(t,e){return t.x*e.x+t.y*e.y},C=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=S(r,i);return b(o,0)},A=function(t){return Math.sqrt(T(t,t))},P=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return S(i,r)/A(i)/A(r)},L=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return T(i,r)/A(i)/A(r)},I=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},R=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},N=function(t,e,n,r){if(0===e.x)return R(n,r,t.x);if(0===r.x)return R(t,e,n.x);if(0===e.y)return I(n,r,t.y);if(0===r.y)return I(t,e,n.y);var i=S(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=S(o,e)/i,a=S(o,r)/i,u=t.x+a*e.x,l=n.x+s*r.x,c=t.y+a*e.y,h=n.y+s*r.y,p=(u+l)/2,d=(c+h)/2;return{x:p,y:d}},O=function(){function e(n,r){t(this,e),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:F.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),n(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:P(e.point,t.point,i.point),cosine:L(e.point,t.point,i.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,a=n.get(e),u=a.sine,l=a.cosine;return o>=0&&u>=0?s<l?1:s>l?-1:0:o<0&&u<0?s<l?-1:s>l?1:0:u<o?-1:u>o?1:0}}}]),e}(),D=0,F=function(){function e(n,r,i,o){t(this,e),this.id=++D,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(e,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(a<s&&a<u)return 1;if(a>s&&a>u)return-1;var c=t.comparePoint(e.leftSE.point);if(c<0)return 1;if(c>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(s<a&&s<l)return-1;if(s>a&&s>l)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var d=t.comparePoint(e.rightSE.point);return d<0?1:d>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(i<o){var f=e.comparePoint(t.rightSE.point);if(0!==f)return f}if(i>o){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(i!==o){var m=u-s,y=i-n,v=l-a,x=o-r;if(m>y&&v<x)return 1;if(m<y&&v>x)return-1}return i>o?1:i<o||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),n(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,a=e.y+s*r.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=v(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,u=y(e,s)&&0===this.comparePoint(s),l=y(n,i)&&0===t.comparePoint(i),c=y(e,a)&&0===this.comparePoint(a),h=y(n,o)&&0===t.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?a:null;if(l)return c&&i.x===a.x&&i.y===a.y?null:i;if(u)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&c)return null;if(h)return o;if(c)return a;var p=N(i,this.vector(),s,t.vector());return null===p?null:y(r,p)?E.round(p.x,p.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new O(t,!0),o=new O(t,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var a=new e(i,s,this.rings.slice(),this.windings.slice());return O.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),O.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){var n=this,r=t;while(n.consumedBy)n=n.consumedBy;while(r.consumedBy)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var a=0,u=r.rings.length;a<u;a++){var l=r.rings[a],c=r.windings[a],h=n.rings.indexOf(l);-1===h?(n.rings.push(l),n.windings.push(c)):n.windings[h]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],a=this.windings[i],u=e.indexOf(s);-1===u?(e.push(s),n.push(a)):n[u]+=a}for(var l=[],c=[],h=0,p=e.length;h<p;h++)if(0!==n[h]){var d=e[h],f=d.poly;if(-1===c.indexOf(f))if(d.isExterior)l.push(f);else{-1===c.indexOf(f)&&c.push(f);var g=l.indexOf(d.poly);-1!==g&&l.splice(g,1)}}for(var m=0,y=l.length;m<y;m++){var v=l[m].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(W.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===W.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2===1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat(W.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var i,o,s,a=O.comparePoints(t,n);if(a<0)i=t,o=n,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,s=-1}var u=new O(i,!0),l=new O(o,!1);return new e(u,l,[r],[s])}}]),e}(),k=function(){function e(n,r,i){if(t(this,e),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!==typeof n[0][0]||"number"!==typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=E.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var s=o,a=1,u=n.length;a<u;a++){if("number"!==typeof n[a][0]||"number"!==typeof n[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=E.round(n[a][0],n[a][1]);l.x===s.x&&l.y===s.y||(this.segments.push(F.fromRing(s,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),s=l)}o.x===s.x&&o.y===s.y||this.segments.push(F.fromRing(s,o,this))}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),B=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new k(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var s=new k(n[i],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),z=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"===typeof n[0][0][0]&&(n=[n])}catch(a){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var s=new B(n[i],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),G=function(){function e(n){t(this,e),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){var s=null,a=o.leftSE,u=o.rightSE,l=[a],c=a.point,h=[];while(1){if(s=a,a=u,l.push(a),a.point===c)break;while(1){var p=a.getAvailableLinkedEvents();if(0===p.length){var d=l[0].point,f=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(f.x,", ").concat(f.y,"]."))}if(1===p.length){u=p[0].otherSE;break}for(var g=null,m=0,y=h.length;m<y;m++)if(h[m].point===a.point){g=m;break}if(null===g){h.push({index:l.length,point:a.point});var v=a.getLeftmostComparator(s);u=p.sort(v)[0].otherSE;break}var x=h.splice(g)[0],_=l.splice(x.index);_.unshift(_[0].otherSE),n.push(new e(_.reverse()))}}n.push(new e(l))}}return n}}]),n(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==C(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],a=e[1];0===C(s,t,a)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,c=this.isExteriorRing()?e.length:-1,h=[],p=l;p!=c;p+=u)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];O.compare(t,r)>0&&(t=r)}var i=t.segment.prevInResult(),o=i?i.prevInResult():null;while(1){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),U=function(){function e(n){t(this,e),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),e}(),V=function(){function e(n){t(this,e),this.rings=n,this.polys=this._composePolys(n)}return n(e,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new U(i));else{var o=i.enclosingRing();o.poly||e.push(new U(o)),o.poly.addInterior(i)}}return e}}]),e}(),H=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.compare;t(this,e),this.queue=n,this.tree=new c(r),this.segments=[]}return n(e,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");var i=r,o=r,s=void 0,a=void 0;while(void 0===s)i=this.tree.prev(i),null===i?s=null:void 0===i.key.consumedBy&&(s=i.key);while(void 0===a)o=this.tree.next(o),null===o?a=null:void 0===o.key.consumedBy&&(a=o.key);if(t.isLeft){var u=null;if(s){var l=s.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(u=l),!s.isAnEndpoint(l)))for(var c=this._splitSafely(s,l),h=0,p=c.length;h<p;h++)n.push(c[h])}var d=null;if(a){var f=a.getIntersection(e);if(null!==f&&(e.isAnEndpoint(f)||(d=f),!a.isAnEndpoint(f)))for(var g=this._splitSafely(a,f),m=0,y=g.length;m<y;m++)n.push(g[m])}if(null!==u||null!==d){var v=null;if(null===u)v=d;else if(null===d)v=u;else{var x=O.comparePoints(u,d);v=x<=0?u:d}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var _=e.split(v),b=0,w=_.length;b<w;b++)n.push(_[b])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var M=s.getIntersection(a);if(null!==M){if(!s.isAnEndpoint(M))for(var E=this._splitSafely(s,M),S=0,T=E.length;S<T;S++)n.push(E[S]);if(!a.isAnEndpoint(M))for(var C=this._splitSafely(a,M),A=0,P=C.length;A<P;A++)n.push(C[A])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),e}(),j=function(){function e(){t(this,e)}return n(e,[{key:"run",value:function(t,e,n){W.type=t,E.reset();for(var r=[new z(e,!0)],i=0,o=n.length;i<o;i++)r.push(new z(n[i],!1));if(W.numMultiPolys=r.length,"difference"===W.type){var s=r[0],a=1;while(a<r.length)null!==v(r[a].bbox,s.bbox)?a++:r.splice(a,1)}if("intersection"===W.type)for(var u=0,l=r.length;u<l;u++)for(var h=r[u],p=u+1,d=r.length;p<d;p++)if(null===v(h.bbox,r[p].bbox))return[];for(var f=new c(O.compare),g=0,m=r.length;g<m;g++)for(var y=r[g].getSweepEvents(),x=0,_=y.length;x<_;x++)f.insert(y[x]);var b=new H(f),w=f.size,M=f.pop();while(M){var S=M.key;if(f.size===w){var T=S.segment;throw new Error("Unable to pop() ".concat(S.isLeft?"left":"right"," SweepEvent ")+"[".concat(S.point.x,", ").concat(S.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}for(var C=b.process(S),A=0,P=C.length;A<P;A++){var L=C[A];void 0===L.consumedBy&&f.insert(L)}w=f.size,M=f.pop()}E.reset();var I=G.factory(b.segments),R=new V(I);return R.getGeom()}}]),e}(),W=new j,q=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return W.run("union",t,n)},Y=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return W.run("intersection",t,n)},X=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return W.run("xor",t,n)},Z=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return W.run("difference",t,n)},K={union:q,intersection:Y,xor:X,difference:Z};return K}))},de26:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAcCAYAAACQ0cTtAAAAAXNSR0IArs4c6QAABAlJREFUSEutVl1oHFUYPWd2l023KCa1NgWpaEXBBoUQxUCzs4k7aZudqJE2FBFBtCoI1ScRLPiP+iTiU8UiPpRAtK1ld6Pt7jLOpA/VrtEWpWD9RxpBaGzoxnZ/7iezycbs7K/R+zZ3znfO/b577r0f8S+GZVkdVxC8XkrFEH3+hVlc+e2RwcHL7VKwFXBqKrNZ/IFHoSGmlPSQ0CoxIlAgviGZgPCAaQz82IyvodiU46yXvLwggscBBFotCkAB4H4tiJdHwuE/6uHrisXTn/UTPAxBdxsiXsjvGtTYiDF40vujRmwq7dwvIhMCdKxCqBJymeDumBE+upKjSuzTjNNbLMk0iNB/EKqE5jRgYMTQv6pMLIvFs9kQ53JnAWz6H4TKFCR+Vn/NbxkdHV0of1eIkyl7nwCvVAvxBxE8wTxnAoGr8wVtfgOovoBgHckzReSHO0rrL5XWXAwhD11B3oWg07PYfaahv7YsdsSyrgkUtV8BXFVdY+6MGeFDgHBy8ttAR+dcN1GaIbgO5GkEObgw25kbH+/Ju3GJlP08gFc9YvNB5DcZhnGxnFk85eyhu6racZtp6GcTKWcakK2NyiuU90ajkT3xzPQYlTrsxfnoe2xHdOuBslgi7XwIkZ01VqV2ayw68F0ibc82OwYE7JihRxLH7XtBVDnQ5RSRj0aHI7uWMrPPEbjZKybkWL6Iz4M+cW+GZkfhp661gS1zucLTArxepwLnTEO/ZTGzlJMDpJ7dBRAF0NeGQ4sA/PVxXDCN8NolMbvQGNiGTGtI0TT0wKLYcfsCWGNZ99eMQM4TNJvyLV7IEwD6AdxUgxXMmcN6VyWzUwD6vKASecd90fCZRNq+UOf8LMMJnIwZen8iM70LSk3WWVjWNPQ7y2LJtP22CPY2dGPKPg9gY8PsCMuM6kON3AjIO6YR2bvkxukIoawaMlXqM7cNfZlM209BcBeAbgGGF3FSAniUwCVNk4933BM5kkydeFBQOljDQxkyoxGrLCYiTGacLAS9K4EEXowZ+ksr55Jp53sR2ewWxDT0qr1MpJ0JiOz2iH0di4Z7Scry3TiVsYeUQqYK6G48ZJLUZpRIXgM3COVZAD4I5jWNb5aU5DSNIaUkQlay/oeFSoZj2yIpd6bqiUmm7A8EeLi1k9tEEAfNqP5QBV0l9r5ldVxX1CwB7m6TrolncCrkV+HBFQ1RzUsdj1vXco3vEETCqxfkCa2AB0ZGqnuRuj1INpsNzP6Ze4uCJ8v70+Zwuy2S+xc2dj0z3rP47HgM15jpk7Rzu4K8IYLt3v31RAnAY34fn9s+NHC6EWPLvtENPGbbNxbyNAnpU8ANGso9ivvU/yJgFmCyVc9Y48Y2q7VqWFuZrZrdE/g3MUOQLD7IBN8AAAAASUVORK5CYII="},df50:function(t,e,n){"use strict";n("c239")},df93:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=n("9cb8");e.DD={get isDragging(){var t=!1;return e.DD._dragElements.forEach((function(e){"dragging"===e.dragStatus&&(t=!0)})),t},justDragged:!1,get node(){var t;return e.DD._dragElements.forEach((function(e){t=e.node})),t},_dragElements:new Map,_drag:function(t){e.DD._dragElements.forEach((function(e,n){var r=e.node,o=r.getStage();o.setPointersPositions(t),void 0===e.pointerId&&(e.pointerId=i.Util._getFirstPointerId(t));var s=o._changedPointerPositions.find((function(t){return t.id===e.pointerId}));if(s){if("dragging"!==e.dragStatus){var a=r.dragDistance(),u=Math.max(Math.abs(s.x-e.startPointerPos.x),Math.abs(s.y-e.startPointerPos.y));if(u<a)return;if(r.startDrag({evt:t}),!r.isDragging())return}r._setDragPosition(t,e),r.fire("dragmove",{type:"dragmove",target:r,evt:t},!0)}}))},_endDragBefore:function(t){e.DD._dragElements.forEach((function(n,i){var o=n.node,s=o.getStage();t&&s.setPointersPositions(t);var a=s._changedPointerPositions.find((function(t){return t.id===n.pointerId}));if(a){"dragging"!==n.dragStatus&&"stopped"!==n.dragStatus||(e.DD.justDragged=!0,r.Konva.listenClickTap=!1,n.dragStatus="stopped");var u=n.node.getLayer()||n.node instanceof r.Konva["Stage"]&&n.node;u&&u.draw()}}))},_endDragAfter:function(t){e.DD._dragElements.forEach((function(n,r){"stopped"===n.dragStatus&&n.node.fire("dragend",{type:"dragend",target:n.node,evt:t},!0),"dragging"!==n.dragStatus&&e.DD._dragElements.delete(r)}))}},r.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1))},e3af:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("fce6"),a=n("4546"),u=n("d777"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._sceneFunc=function(t){var e=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();t.beginPath(),t.moveTo(0,0-n);for(var i=1;i<2*r;i++){var o=i%2===0?n:e,s=o*Math.sin(i*Math.PI/r),a=-1*o*Math.cos(i*Math.PI/r);t.lineTo(s,a)}t.closePath(),t.fillStrokeShape(this)},e.prototype.getWidth=function(){return 2*this.outerRadius()},e.prototype.getHeight=function(){return 2*this.outerRadius()},e.prototype.setWidth=function(t){this.outerRadius(t/2)},e.prototype.setHeight=function(t){this.outerRadius(t/2)},e}(s.Shape);e.Star=l,l.prototype.className="Star",l.prototype._centroid=!0,l.prototype._attrsAffectingSize=["innerRadius","outerRadius"],u._registerNode(l),o.Factory.addGetterSetter(l,"numPoints",5,a.getNumberValidator()),o.Factory.addGetterSetter(l,"innerRadius",0,a.getNumberValidator()),o.Factory.addGetterSetter(l,"outerRadius",0,a.getNumberValidator()),i.Collection.mapMethods(l)},e4b0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("f0b4"),i=n("4971"),o=n("9cb8"),s=n("4546");e.Emboss=function(t){var e=10*this.embossStrength(),n=255*this.embossWhiteLevel(),r=this.embossDirection(),i=this.embossBlend(),s=0,a=0,u=t.data,l=t.width,c=t.height,h=4*l,p=c;switch(r){case"top-left":s=-1,a=-1;break;case"top":s=-1,a=0;break;case"top-right":s=-1,a=1;break;case"right":s=0,a=1;break;case"bottom-right":s=1,a=1;break;case"bottom":s=1,a=0;break;case"bottom-left":s=1,a=-1;break;case"left":s=0,a=-1;break;default:o.Util.error("Unknown emboss direction: "+r)}do{var d=(p-1)*h,f=s;p+f<1&&(f=0),p+f>c&&(f=0);var g=(p-1+f)*l*4,m=l;do{var y=d+4*(m-1),v=a;m+v<1&&(v=0),m+v>l&&(v=0);var x=g+4*(m-1+v),_=u[y]-u[x],b=u[y+1]-u[x+1],w=u[y+2]-u[x+2],M=_,E=M>0?M:-M,S=b>0?b:-b,T=w>0?w:-w;if(S>E&&(M=b),T>E&&(M=w),M*=e,i){var C=u[y]+M,A=u[y+1]+M,P=u[y+2]+M;u[y]=C>255?255:C<0?0:C,u[y+1]=A>255?255:A<0?0:A,u[y+2]=P>255?255:P<0?0:P}else{var L=n-M;L<0?L=0:L>255&&(L=255),u[y]=u[y+1]=u[y+2]=L}}while(--m)}while(--p)},r.Factory.addGetterSetter(i.Node,"embossStrength",.5,s.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"embossWhiteLevel",.5,s.getNumberValidator(),r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"embossDirection","top-left",null,r.Factory.afterSetFilter),r.Factory.addGetterSetter(i.Node,"embossBlend",!1,null,r.Factory.afterSetFilter)},e660:function(t,e,n){},ea61:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("4971"),a=n("df93"),u=n("4546"),l=n("d777"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=new i.Collection,e}return r(e,t),e.prototype.getChildren=function(t){if(!t)return this.children;var e=new i.Collection;return this.children.each((function(n){t(n)&&e.push(n)})),e},e.prototype.hasChildren=function(){return this.getChildren().length>0},e.prototype.removeChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.remove();return this.children=new i.Collection,this},e.prototype.destroyChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.destroy();return this.children=new i.Collection,this},e.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}var r=t[0];if(r.getParent())return r.moveTo(this),this;var i=this.children;return this._validateAdd(r),r._clearCaches(),r.index=i.length,r.parent=this,i.push(r),this._fire("add",{child:r}),this},e.prototype.destroy=function(){return this.hasChildren()&&this.destroyChildren(),t.prototype.destroy.call(this),this},e.prototype.find=function(t){return this._generalFind(t,!1)},e.prototype.get=function(t){return i.Util.warn("collection.get() method is deprecated. Please use collection.find() instead."),this.find(t)},e.prototype.findOne=function(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0},e.prototype._generalFind=function(t,e){var n=[];return this._descendants((function(r){var i=r._isMatch(t);return i&&n.push(r),!(!i||!e)})),i.Collection.toCollection(n)},e.prototype._descendants=function(t){for(var e=!1,n=0;n<this.children.length;n++){var r=this.children[n];if(e=t(r),e)return!0;if(r.hasChildren()&&(e=r._descendants(t),e))return!0}return!1},e.prototype.toObject=function(){var t=s.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),n=e.length,r=0;r<n;r++){var i=e[r];t.children.push(i.toObject())}return t},e.prototype._getDescendants=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];this.isAncestorOf(i)&&e.push(i)}return e},e.prototype.isAncestorOf=function(t){var e=t.getParent();while(e){if(e._id===this._id)return!0;e=e.getParent()}return!1},e.prototype.clone=function(t){var e=s.Node.prototype.clone.call(this,t);return this.getChildren().each((function(t){e.add(t.clone())})),e},e.prototype.getAllIntersections=function(t){var e=[];return this.find("Shape").each((function(n){n.isVisible()&&n.intersects(t)&&e.push(n)})),e},e.prototype._setChildrenIndices=function(){this.children.each((function(t,e){t.index=e}))},e.prototype.drawScene=function(t,e,n){var r=this.getLayer(),i=t||r&&r.getCanvas(),o=i&&i.getContext(),s=this._getCanvasCache(),a=s&&s.scene;return(this.isVisible()||n)&&(!n&&a?(o.save(),r._applyTransform(this,o,e),this._drawCachedSceneCanvas(o),o.restore()):this._drawChildren(i,"drawScene",e,!1,n,n)),this},e.prototype.drawHit=function(t,e,n){var r=this.getLayer(),i=t||r&&r.hitCanvas,o=i&&i.getContext(),s=this._getCanvasCache(),a=s&&s.hit;return(this.shouldDrawHit(i)||n)&&(!n&&a?(o.save(),r._applyTransform(this,o,e),this._drawCachedHitCanvas(o),o.restore()):this._drawChildren(i,"drawHit",e,!1,n,n)),this},e.prototype._drawChildren=function(t,e,n,r,i,o){var s,a,u=this.getLayer(),l=t&&t.getContext(),c=this.clipWidth(),h=this.clipHeight(),p=this.clipFunc(),d=c&&h||p;if(d&&u){l.save();var f=this.getAbsoluteTransform(n),g=f.getMatrix();l.transform(g[0],g[1],g[2],g[3],g[4],g[5]),l.beginPath(),p?p.call(this,l,this):(s=this.clipX(),a=this.clipY(),l.rect(s,a,c,h)),l.clip(),g=f.copy().invert().getMatrix(),l.transform(g[0],g[1],g[2],g[3],g[4],g[5])}var m="source-over"!==this.globalCompositeOperation()&&!o&&"drawScene"===e;m&&u&&(l.save(),l._applyGlobalCompositeOperation(this)),this.children.each((function(o){o[e](t,n,r,i)})),m&&u&&l.restore(),d&&u&&l.restore()},e.prototype.shouldDrawHit=function(t){if(t&&t.isCache)return!0;var e=this.getLayer(),n=!1;a.DD._dragElements.forEach((function(t){"dragging"===t.dragStatus&&t.node.getLayer()===e&&(n=!0)}));var r=!l.Konva.hitOnDragEnabled&&n;return e&&e.hitGraphEnabled()&&this.isVisible()&&!r},e.prototype.getClientRect=function(t){t=t||{};var e,n,r,i,o=t.skipTransform,s=t.relativeTo,a={x:1/0,y:1/0,width:0,height:0},u=this;this.children.each((function(o){if(o.visible()){var s=o.getClientRect({relativeTo:u,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===s.width&&0===s.height||(void 0===e?(e=s.x,n=s.y,r=s.x+s.width,i=s.y+s.height):(e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x+s.width),i=Math.max(i,s.y+s.height)))}}));for(var l=this.find("Shape"),c=!1,h=0;h<l.length;h++){var p=l[h];if(p._isVisible(this)){c=!0;break}}return a=c&&void 0!==e?{x:e,y:n,width:r-e,height:i-n}:{x:0,y:0,width:0,height:0},o?a:this._transformedRect(a,s)},e}(s.Node);e.Container=c,o.Factory.addComponentsGetterSetter(c,"clip",["x","y","width","height"]),o.Factory.addGetterSetter(c,"clipX",void 0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clipY",void 0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clipWidth",void 0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clipHeight",void 0,u.getNumberValidator()),o.Factory.addGetterSetter(c,"clipFunc"),i.Collection.mapMethods(c)},eba4:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("f0b4"),s=n("ea61"),a=n("d777"),u=n("f655"),l=n("df93"),c=n("d777"),h=n("7d2a"),p="Stage",d="string",f="px",g="mouseout",m="mouseleave",y="mouseover",v="mouseenter",x="mousemove",_="mousedown",b="mouseup",w="pointermove",M="pointerdown",E="pointerup",S="pointercancel",T="lostpointercapture",C="contextmenu",A="click",P="dblclick",L="touchstart",I="touchend",R="tap",N="dbltap",O="touchmove",D="wheel",F="contentMouseout",k="contentMouseover",B="contentMousemove",z="contentMousedown",G="contentMouseup",U="contentContextmenu",V="contentClick",H="contentDblclick",j="contentTouchstart",W="contentTouchend",q="contentDbltap",Y="contentTap",X="contentTouchmove",Z="contentWheel",K="relative",J="konvajs-content",Q="_",$="container",tt=5,et="",nt=[v,_,x,b,g,L,O,I,y,D,C,M,w,E,S,T],rt=nt.length;function it(t,e){t.content.addEventListener(e,(function(n){t[Q+e](n)}),!1)}var ot="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";function st(t){return void 0===t&&(t={}),(t.clipFunc||t.clipWidth||t.clipHeight)&&i.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}e.stages=[];var at=function(t){function n(n){var r=t.call(this,st(n))||this;return r._pointerPositions=[],r._changedPointerPositions=[],r._buildDOM(),r._bindContentEvents(),e.stages.push(r),r.on("widthChange.konva heightChange.konva",r._resizeDOM),r.on("visibleChange.konva",r._checkVisibility),r.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(function(){st(r.attrs)})),r._checkVisibility(),r}return r(n,t),n.prototype._validateAdd=function(t){var e="Layer"===t.getType(),n="FastLayer"===t.getType(),r=e||n;r||i.Util.throw("You may only add layers to the stage.")},n.prototype._checkVisibility=function(){if(this.content){var t=this.visible()?"":"none";this.content.style.display=t}},n.prototype.setContainer=function(t){if(typeof t===d){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var n;n="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(n)}if(!t)throw"Can not find container in document with id "+n}return this._setAttr($,t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this},n.prototype.shouldDrawHit=function(){return!0},n.prototype.clear=function(){var t,e=this.children,n=e.length;for(t=0;t<n;t++)e[t].clear();return this},n.prototype.clone=function(t){return t||(t={}),t.container=document.createElement("div"),s.Container.prototype.clone.call(this,t)},n.prototype.destroy=function(){t.prototype.destroy.call(this);var n=this.content;n&&i.Util._isInDocument(n)&&this.container().removeChild(n);var r=e.stages.indexOf(this);return r>-1&&e.stages.splice(r,1),this},n.prototype.getPointerPosition=function(){var t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(i.Util.warn(ot),null)},n.prototype._getPointerById=function(t){return this._pointerPositions.find((function(e){return e.id===t}))},n.prototype.getPointersPositions=function(){return this._pointerPositions},n.prototype.getStage=function(){return this},n.prototype.getContent=function(){return this.content},n.prototype._toKonvaCanvas=function(t){t=t||{};var e=t.x||0,n=t.y||0,r=new u.SceneCanvas({width:t.width||this.width(),height:t.height||this.height(),pixelRatio:t.pixelRatio||1}),i=r.getContext()._context,o=this.children;return(e||n)&&i.translate(-1*e,-1*n),o.each((function(r){if(r.isVisible()){var o=r._toKonvaCanvas(t);i.drawImage(o._canvas,e,n,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}})),r},n.prototype.getIntersection=function(t,e){if(!t)return null;var n,r,i=this.children,o=i.length,s=o-1;for(n=s;n>=0;n--)if(r=i[n].getIntersection(t,e),r)return r;return null},n.prototype._resizeDOM=function(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+f,this.content.style.height=e+f),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.each((function(n){n.setSize({width:t,height:e}),n.draw()}))},n.prototype.add=function(e){if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}t.prototype.add.call(this,e);var r=this.children.length;return r>tt&&i.Util.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e._setCanvasSize(this.width(),this.height()),e.draw(),a.Konva.isBrowser&&this.content.appendChild(e.canvas._canvas),this},n.prototype.getParent=function(){return null},n.prototype.getLayer=function(){return null},n.prototype.hasPointerCapture=function(t){return h.hasPointerCapture(t,this)},n.prototype.setPointerCapture=function(t){h.setPointerCapture(t,this)},n.prototype.releaseCapture=function(t){h.releaseCapture(t,this)},n.prototype.getLayers=function(){return this.getChildren()},n.prototype._bindContentEvents=function(){if(a.Konva.isBrowser)for(var t=0;t<rt;t++)it(this,nt[t])},n.prototype._mouseenter=function(t){this.setPointersPositions(t),this._fire(v,{evt:t,target:this,currentTarget:this})},n.prototype._mouseover=function(t){this.setPointersPositions(t),this._fire(k,{evt:t}),this._fire(y,{evt:t,target:this,currentTarget:this})},n.prototype._mouseout=function(t){this.setPointersPositions(t);var e=this.targetShape,n=!l.DD.isDragging||a.Konva.hitOnDragEnabled;e&&n?(e._fireAndBubble(g,{evt:t}),e._fireAndBubble(m,{evt:t}),this._fire(m,{evt:t,target:this,currentTarget:this}),this.targetShape=null):n&&(this._fire(m,{evt:t,target:this,currentTarget:this}),this._fire(g,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[],this._fire(F,{evt:t})},n.prototype._mousemove=function(t){if(a.Konva.UA.ieMobile)return this._touchmove(t);this.setPointersPositions(t);var e,n=i.Util._getFirstPointerId(t),r=!l.DD.isDragging||a.Konva.hitOnDragEnabled;if(r){if(e=this.getIntersection(this.getPointerPosition()),e&&e.isListening()){var o=!this.targetShape||this.targetShape!==e;r&&o?(this.targetShape&&(this.targetShape._fireAndBubble(g,{evt:t,pointerId:n},e),this.targetShape._fireAndBubble(m,{evt:t,pointerId:n},e)),e._fireAndBubble(y,{evt:t,pointerId:n},this.targetShape),e._fireAndBubble(v,{evt:t,pointerId:n},this.targetShape),e._fireAndBubble(x,{evt:t,pointerId:n}),this.targetShape=e):e._fireAndBubble(x,{evt:t,pointerId:n})}else this.targetShape&&r&&(this.targetShape._fireAndBubble(g,{evt:t,pointerId:n}),this.targetShape._fireAndBubble(m,{evt:t,pointerId:n}),this._fire(y,{evt:t,target:this,currentTarget:this,pointerId:n}),this.targetShape=null),this._fire(x,{evt:t,target:this,currentTarget:this,pointerId:n});this._fire(B,{evt:t})}t.cancelable&&t.preventDefault()},n.prototype._mousedown=function(t){if(a.Konva.UA.ieMobile)return this._touchstart(t);this.setPointersPositions(t);var e=i.Util._getFirstPointerId(t),n=this.getIntersection(this.getPointerPosition());l.DD.justDragged=!1,a.Konva.listenClickTap=!0,n&&n.isListening()?(this.clickStartShape=n,n._fireAndBubble(_,{evt:t,pointerId:e})):this._fire(_,{evt:t,target:this,currentTarget:this,pointerId:e}),this._fire(z,{evt:t})},n.prototype._mouseup=function(t){if(a.Konva.UA.ieMobile)return this._touchend(t);this.setPointersPositions(t);var e=i.Util._getFirstPointerId(t),n=this.getIntersection(this.getPointerPosition()),r=this.clickStartShape,o=this.clickEndShape,s=!1;a.Konva.inDblClickWindow?(s=!0,clearTimeout(this.dblTimeout)):l.DD.justDragged||(a.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout((function(){a.Konva.inDblClickWindow=!1}),a.Konva.dblClickWindow),n&&n.isListening()?(this.clickEndShape=n,n._fireAndBubble(b,{evt:t,pointerId:e}),a.Konva.listenClickTap&&r&&r._id===n._id&&(n._fireAndBubble(A,{evt:t,pointerId:e}),s&&o&&o===n&&n._fireAndBubble(P,{evt:t,pointerId:e}))):(this._fire(b,{evt:t,target:this,currentTarget:this,pointerId:e}),a.Konva.listenClickTap&&this._fire(A,{evt:t,target:this,currentTarget:this,pointerId:e}),s&&this._fire(P,{evt:t,target:this,currentTarget:this,pointerId:e})),this._fire(G,{evt:t}),a.Konva.listenClickTap&&(this._fire(V,{evt:t}),s&&this._fire(H,{evt:t})),a.Konva.listenClickTap=!1,t.cancelable&&t.preventDefault()},n.prototype._contextmenu=function(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(C,{evt:t}):this._fire(C,{evt:t,target:this,currentTarget:this}),this._fire(U,{evt:t})},n.prototype._touchstart=function(t){var e=this;this.setPointersPositions(t);var n=!1;this._changedPointerPositions.forEach((function(r){var i=e.getIntersection(r);a.Konva.listenClickTap=!0,l.DD.justDragged=!1;var o=i&&i.isListening();o&&(a.Konva.captureTouchEventsEnabled&&i.setPointerCapture(r.id),e.tapStartShape=i,i._fireAndBubble(L,{evt:t,pointerId:r.id},e),n=!0,i.isListening()&&i.preventDefault()&&t.cancelable&&t.preventDefault())})),n||this._fire(L,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(j,{evt:t})},n.prototype._touchmove=function(t){var e=this;this.setPointersPositions(t);var n=!l.DD.isDragging||a.Konva.hitOnDragEnabled;if(n){var r=!1,i={};this._changedPointerPositions.forEach((function(n){var o=h.getCapturedShape(n.id)||e.getIntersection(n),s=o&&o.isListening();s&&(i[o._id]||(i[o._id]=!0,o._fireAndBubble(O,{evt:t,pointerId:n.id}),r=!0,o.isListening()&&o.preventDefault()&&t.cancelable&&t.preventDefault()))})),r||this._fire(O,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(X,{evt:t})}l.DD.isDragging&&l.DD.node.preventDefault()&&t.cancelable&&t.preventDefault()},n.prototype._touchend=function(t){var e=this;this.setPointersPositions(t);var n=this.clickEndShape,r=!1;a.Konva.inDblClickWindow?(r=!0,clearTimeout(this.dblTimeout)):l.DD.justDragged||(a.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout((function(){a.Konva.inDblClickWindow=!1}),a.Konva.dblClickWindow);var i=!1,o={},s=!1,u=!1;this._changedPointerPositions.forEach((function(l){var c=h.getCapturedShape(l.id)||e.getIntersection(l);c&&c.releaseCapture(l.id);var p=c&&c.isListening();p&&(o[c._id]||(o[c._id]=!0,e.clickEndShape=c,c._fireAndBubble(I,{evt:t,pointerId:l.id}),i=!0,a.Konva.listenClickTap&&c===e.tapStartShape&&(s=!0,c._fireAndBubble(R,{evt:t,pointerId:l.id}),r&&n&&n===c&&(u=!0,c._fireAndBubble(N,{evt:t,pointerId:l.id}))),c.isListening()&&c.preventDefault()&&t.cancelable&&t.preventDefault()))})),i||this._fire(I,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),a.Konva.listenClickTap&&!s&&this._fire(R,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r&&!u&&this._fire(N,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(W,{evt:t}),a.Konva.listenClickTap&&(this._fire(Y,{evt:t}),r&&this._fire(q,{evt:t})),a.Konva.listenClickTap=!1},n.prototype._wheel=function(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(D,{evt:t}):this._fire(D,{evt:t,target:this,currentTarget:this}),this._fire(Z,{evt:t})},n.prototype._pointerdown=function(t){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=h.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(M,h.createEvent(t))}},n.prototype._pointermove=function(t){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=h.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(w,h.createEvent(t))}},n.prototype._pointerup=function(t){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=h.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(E,h.createEvent(t)),h.releaseCapture(t.pointerId)}},n.prototype._pointercancel=function(t){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(t);var e=h.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(E,h.createEvent(t)),h.releaseCapture(t.pointerId)}},n.prototype._lostpointercapture=function(t){h.releaseCapture(t.pointerId)},n.prototype.setPointersPositions=function(t){var e=this,n=this._getContentPosition(),r=null,o=null;t=t||window.event,void 0!==t.touches?(this._pointerPositions=[],this._changedPointerPositions=[],i.Collection.prototype.each.call(t.touches,(function(t){e._pointerPositions.push({id:t.identifier,x:(t.clientX-n.left)/n.scaleX,y:(t.clientY-n.top)/n.scaleY})})),i.Collection.prototype.each.call(t.changedTouches||t.touches,(function(t){e._changedPointerPositions.push({id:t.identifier,x:(t.clientX-n.left)/n.scaleX,y:(t.clientY-n.top)/n.scaleY})}))):(r=(t.clientX-n.left)/n.scaleX,o=(t.clientY-n.top)/n.scaleY,this.pointerPos={x:r,y:o},this._pointerPositions=[{x:r,y:o,id:i.Util._getFirstPointerId(t)}],this._changedPointerPositions=[{x:r,y:o,id:i.Util._getFirstPointerId(t)}])},n.prototype._setPointerPosition=function(t){i.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)},n.prototype._getContentPosition=function(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}},n.prototype._buildDOM=function(){if(this.bufferCanvas=new u.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new u.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),a.Konva.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML=et,this.content=document.createElement("div"),this.content.style.position=K,this.content.style.userSelect="none",this.content.className=J,this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}},n.prototype.cache=function(){return i.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this},n.prototype.clearCache=function(){return this},n.prototype.batchDraw=function(){return this.children.each((function(t){t.batchDraw()})),this},n}(s.Container);e.Stage=at,at.prototype.nodeType=p,c._registerNode(at),o.Factory.addGetterSetter(at,"container")},ed3d:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("d777"),i=function(){return r.glob.performance&&r.glob.performance.now?function(){return r.glob.performance.now()}:function(){return(new Date).getTime()}}(),o=function(){function t(e,n){this.id=t.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:i(),frameRate:0},this.func=e,this.setLayers(n)}return t.prototype.setLayers=function(t){var e=[];return e=t?t.length>0?t:[t]:[],this.layers=e,this},t.prototype.getLayers=function(){return this.layers},t.prototype.addLayer=function(t){var e,n=this.layers,r=n.length;for(e=0;e<r;e++)if(n[e]._id===t._id)return!1;return this.layers.push(t),!0},t.prototype.isRunning=function(){var e,n=t,r=n.animations,i=r.length;for(e=0;e<i;e++)if(r[e].id===this.id)return!0;return!1},t.prototype.start=function(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=i(),t._addAnimation(this),this},t.prototype.stop=function(){return t._removeAnimation(this),this},t.prototype._updateFrameObject=function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff},t._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},t._removeAnimation=function(t){var e,n=t.id,r=this.animations,i=r.length;for(e=0;e<i;e++)if(r[e].id===n){this.animations.splice(e,1);break}},t._runFrames=function(){var t,e,n,r,o,s,a,u,l,c={},h=this.animations;for(r=0;r<h.length;r++)if(t=h[r],e=t.layers,n=t.func,t._updateFrameObject(i()),s=e.length,l=!n||!1!==n.call(t,t.frame),l)for(o=0;o<s;o++)a=e[o],void 0!==a._id&&(c[a._id]=a);for(u in c)c.hasOwnProperty(u)&&c[u].draw()},t._animationLoop=function(){var e=t;e.animations.length?(e._runFrames(),requestAnimationFrame(e._animationLoop)):e.animRunning=!1},t._handleAnimation=function(){this.animRunning||(this.animRunning=!0,requestAnimationFrame(this._animationLoop))},t.animations=[],t.animIdCounter=0,t.animRunning=!1,t}();e.Animation=o},f0b4:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("9cb8"),i=n("4546"),o="get",s="set";e.Factory={addGetterSetter:function(t,e,n,r,i){this.addGetter(t,e,n),this.addSetter(t,e,r,i),this.addOverloadedGetterSetter(t,e)},addGetter:function(t,e,n){var i=o+r.Util._capitalize(e);t.prototype[i]=t.prototype[i]||function(){var t=this.attrs[e];return void 0===t?n:t}},addSetter:function(t,n,i,o){var a=s+r.Util._capitalize(n);t.prototype[a]||e.Factory.overWriteSetter(t,n,i,o)},overWriteSetter:function(t,e,n,i){var o=s+r.Util._capitalize(e);t.prototype[o]=function(t){return n&&void 0!==t&&null!==t&&(t=n.call(this,t,e)),this._setAttr(e,t),i&&i.call(this),this}},addComponentsGetterSetter:function(t,e,n,a,u){var l,c,h=n.length,p=r.Util._capitalize,d=o+p(e),f=s+p(e);t.prototype[d]=function(){var t={};for(l=0;l<h;l++)c=n[l],t[c]=this.getAttr(e+p(c));return t};var g=i.getComponentValidator(n);t.prototype[f]=function(t){var n,r=this.attrs[e];for(n in a&&(t=a.call(this,t)),g&&g.call(this,t,e),t)t.hasOwnProperty(n)&&this._setAttr(e+p(n),t[n]);return this._fireChangeEvent(e,r,t),u&&u.call(this),this},this.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter:function(t,e){var n=r.Util._capitalize(e),i=s+n,a=o+n;t.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[a]()}},addDeprecatedGetterSetter:function(t,e,n,i){r.Util.error("Adding deprecated "+e);var s=o+r.Util._capitalize(e),a=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[s]=function(){r.Util.error(a);var t=this.attrs[e];return void 0===t?n:t},this.addSetter(t,e,i,(function(){r.Util.error(a)})),this.addOverloadedGetterSetter(t,e)},backCompat:function(t,e){r.Util.each(e,(function(e,n){var i=t.prototype[n],a=o+r.Util._capitalize(e),u=s+r.Util._capitalize(e);function l(){i.apply(this,arguments),r.Util.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=l,t.prototype[a]=l,t.prototype[u]=l}))},afterSetFilter:function(){this._filterUpToDate=!1}}},f35c:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n("9cb8"),o=n("ea61"),s=n("d777"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._validateAdd=function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&i.Util.throw("You may only add groups and shapes to groups.")},e}(o.Container);e.Group=a,a.prototype.nodeType="Group",s._registerNode(a),i.Collection.mapMethods(a)},f632:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+57u05L+u5aSH5Lu9PC90aXRsZT4KICAgIDxnIGlkPSJ2Mi4xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0i5a+G5o6l5Y+N5p+lL+ehruiviuWPjeafpeWkh+S7vSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTExMjQuMDAwMDAwLCAtNDI1LjAwMDAwMCkiIGZpbGwtcnVsZT0ibm9uemVybyI+CiAgICAgICAgICAgIDxnIGlkPSLnu7Tkv67lpIfku70iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMjQuMDAwMDAwLCA0MjUuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiBmaWxsPSIjMTc4QjdEIiBvcGFjaXR5PSIwIiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSLot6/lvoQiIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iNCA0IDEzIDQgMTMgMTEgNCAxMSI+PC9wb2x5Z29uPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTExLjMzMzMzMzMsMS43MjY2NjY2NyBDMTEuNTExOTYxNiwxLjcyNjY2NjY3IDExLjY3NzAxOTIsMS44MjE5NzAwNiAxMS43NjYzMzMzLDEuOTc2NjY2NjcgTDE1LjA5OTY2NjcsNy43NSBDMTUuMTg4OTgzMSw3LjkwNDcwMDU0IDE1LjE4ODk4MzEsOC4wOTUyOTk0NiAxNS4wOTk2NjY3LDguMjUgTDExLjc2NjMzMzMsMTQuMDIzMzMzMyBDMTEuNjc3MDE5MiwxNC4xNzgwMjk5IDExLjUxMTk2MTYsMTQuMjczMzMzMyAxMS4zMzMzMzMzLDE0LjI3MzMzMzMgTDQuNjY2NjY2NjcsMTQuMjczMzMzMyBDNC40ODgwMzg0MSwxNC4yNzMzMzMzIDQuMzIyOTgwOCwxNC4xNzgwMjk5IDQuMjMzNjY2NjcsMTQuMDIzMzMzMyBMMC45MDAzMzMzMjgsOC4yNSBDMC44MTEwMTY5MzEsOC4wOTUyOTk0NiAwLjgxMTAxNjkzMSw3LjkwNDcwMDU0IDAuOTAwMzMzMzI4LDcuNzUgTDQuMjMzNjY2NjcsMS45NzY2NjY2NyBDNC4zMjI5ODA4LDEuODIxOTcwMDYgNC40ODgwMzg0MSwxLjcyNjY2NjY3IDQuNjY2NjY2NjcsMS43MjY2NjY2NyBMMTEuMzMzMzMzMywxLjcyNjY2NjY3IFogTTYuMDI2MzMzMzMsNC43ODgzMzMzMyBMNy40MzAzMzMzMyw2LjE5MyBMNi4xOTMsNy40MzAzMzMzMyBMNC43ODg2NjY2Nyw2LjAyNiBDNC40Mjc2NjY2Nyw2Ljg3NDMzMzMzIDQuNTkxNjY2NjcsNy44OTEzMzMzMyA1LjI4MTMzMzMzLDguNTgxIEM1Ljk3MSw5LjI3MSA2Ljk4OCw5LjQzNDY2NjY3IDcuODM2MzMzMzMsOS4wNzQgTDkuMzU1MzMzMzMsMTAuNTkyNjY2NyBDOS41NzUzODQ5LDEwLjgxODQ4NiA5Ljg5OTkxMzM5LDEwLjkwODQ0OTcgMTAuMjA0ODIzNCwxMC44MjgxNTY4IEMxMC41MDk3MzM0LDEwLjc0Nzg2MzkgMTAuNzQ3ODYzOSwxMC41MDk3MzM0IDEwLjgyODE1NjgsMTAuMjA0ODIzNCBDMTAuOTA4NDQ5Nyw5Ljg5OTkxMzM5IDEwLjgxODQ4Niw5LjU3NTM4NDkgMTAuNTkyNjY2Nyw5LjM1NTMzMzMzIEw5LjA3NCw3LjgzNiBDOS40MzQ2NjY2Nyw2Ljk4NzY2NjY3IDkuMjcwNjY2NjcsNS45NzEgOC41ODEsNS4yODEzMzMzMyBDNy44OTE2NjY2Nyw0LjU5MTY2NjY2IDYuODc0NjY2NjcsNC40MjggNi4wMjYzMzMzMyw0Ljc4ODMzMzMzIEw2LjAyNjMzMzMzLDQuNzg4MzMzMzMgWiIgaWQ9IuW9oueKtiIgZmlsbD0iIzE3OEI3RCI+PC9wYXRoPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="},f655:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i,o=n("9cb8"),s=n("c527"),a=n("d777"),u=n("f0b4"),l=n("4546");function c(){if(i)return i;var t=o.Util.createCanvasElement(),e=t.getContext("2d");return i=function(){var t=a.Konva._global.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/n}(),i}var h=function(){function t(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=t||{},n=e.pixelRatio||a.Konva.pixelRatio||c();this.pixelRatio=n,this._canvas=o.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return t.prototype.getContext=function(){return this.context},t.prototype.getPixelRatio=function(){return this.pixelRatio},t.prototype.setPixelRatio=function(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)},t.prototype.setWidth=function(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio,n=this.getContext()._context;n.scale(e,e)},t.prototype.setHeight=function(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio,n=this.getContext()._context;n.scale(e,e)},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setSize=function(t,e){this.setWidth(t||0),this.setHeight(e||0)},t.prototype.toDataURL=function(t,e){try{return this._canvas.toDataURL(t,e)}catch(n){try{return this._canvas.toDataURL()}catch(r){return o.Util.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}},t}();e.Canvas=h,u.Factory.addGetterSetter(h,"pixelRatio",void 0,l.getNumberValidator());var p=function(t){function e(e){void 0===e&&(e={width:0,height:0});var n=t.call(this,e)||this;return n.context=new s.SceneContext(n),n.setSize(e.width,e.height),n}return r(e,t),e}(h);e.SceneCanvas=p;var d=function(t){function e(e){void 0===e&&(e={width:0,height:0});var n=t.call(this,e)||this;return n.hitCanvas=!0,n.context=new s.HitContext(n),n.setSize(e.width,e.height),n}return r(e,t),e}(h);e.HitCanvas=d},f709:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(e,"__esModule",{value:!0});var o=n("9cb8"),s=n("f0b4"),a=n("fce6"),u=n("4546"),l=n("d777"),c=function(t){function e(e){var n=t.call(this,e)||this;return n.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")})),n}return r(e,t),e.prototype._sceneFunc=function(t){var e,n,r,i=this.points(),o=i.length,s=this.tension(),a=this.closed(),u=this.bezier();if(o){if(t.beginPath(),t.moveTo(i[0],i[1]),0!==s&&o>4){e=this.getTensionPoints(),n=e.length,r=a?0:4,a||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);while(r<n-2)t.bezierCurveTo(e[r++],e[r++],e[r++],e[r++],e[r++],e[r++]);a||t.quadraticCurveTo(e[n-2],e[n-1],i[o-2],i[o-1])}else if(u){r=2;while(r<o)t.bezierCurveTo(i[r++],i[r++],i[r++],i[r++],i[r++],i[r++])}else for(r=2;r<o;r+=2)t.lineTo(i[r],i[r+1]);a?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}},e.prototype.getTensionPoints=function(){return this._getCache("tensionPoints",this._getTensionPoints)},e.prototype._getTensionPoints=function(){return this.closed()?this._getTensionPointsClosed():o.Util._expandPoints(this.points(),this.tension())},e.prototype._getTensionPointsClosed=function(){var t=this.points(),e=t.length,n=this.tension(),r=o.Util._getControlPoints(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),i=o.Util._getControlPoints(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),s=o.Util._expandPoints(t,n),a=[r[2],r[3]].concat(s).concat([i[0],i[1],t[e-2],t[e-1],i[2],i[3],r[0],r[1],t[0],t[1]]);return a},e.prototype.getWidth=function(){return this.getSelfRect().width},e.prototype.getHeight=function(){return this.getSelfRect().height},e.prototype.getSelfRect=function(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?i([t[0],t[1]],this._getTensionPoints(),[t[t.length-2],t[t.length-1]]):this.points();for(var e,n,r=t[0],o=t[0],s=t[1],a=t[1],u=0;u<t.length/2;u++)e=t[2*u],n=t[2*u+1],r=Math.min(r,e),o=Math.max(o,e),s=Math.min(s,n),a=Math.max(a,n);return{x:r,y:s,width:o-r,height:a-s}},e}(a.Shape);e.Line=c,c.prototype.className="Line",c.prototype._attrsAffectingSize=["points","bezier","tension"],l._registerNode(c),s.Factory.addGetterSetter(c,"closed",!1),s.Factory.addGetterSetter(c,"bezier",!1),s.Factory.addGetterSetter(c,"tension",0,u.getNumberValidator()),s.Factory.addGetterSetter(c,"points",[],u.getNumberArrayValidator()),o.Collection.mapMethods(c)},fce6:function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i,o=n("9cb8"),s=n("f0b4"),a=n("4971"),u=n("4546"),l=n("d777"),c=n("7d2a"),h="hasShadow",p="shadowRGBA",d="patternImage",f="linearGradient",g="radialGradient";function m(){return i||(i=o.Util.createCanvasElement().getContext("2d"),i)}function y(t){t.fill()}function v(t){t.stroke()}function x(t){t.fill()}function _(t){t.stroke()}function b(){this._clearCache(h)}function w(){this._clearCache(p)}function M(){this._clearCache(d)}function E(){this._clearCache(f)}function S(){this._clearCache(g)}e.shapes={};var T=function(t){function n(n){var r,i=t.call(this,n)||this;while(1)if(r=o.Util.getRandomColor(),r&&!(r in e.shapes))break;return i.colorKey=r,e.shapes[r]=i,i.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",b),i.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",w),i.on("fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",M),i.on("fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",E),i.on("fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",S),i}return r(n,t),n.prototype.getContext=function(){return this.getLayer().getContext()},n.prototype.getCanvas=function(){return this.getLayer().getCanvas()},n.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this["_sceneFunc"]},n.prototype.getHitFunc=function(){return this.attrs.hitFunc||this["_hitFunc"]},n.prototype.hasShadow=function(){return this._getCache(h,this._hasShadow)},n.prototype._hasShadow=function(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())},n.prototype._getFillPattern=function(){return this._getCache(d,this.__getFillPattern)},n.prototype.__getFillPattern=function(){if(this.fillPatternImage()){var t=m(),e=t.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");return e}},n.prototype._getLinearGradient=function(){return this._getCache(f,this.__getLinearGradient)},n.prototype.__getLinearGradient=function(){var t=this.fillLinearGradientColorStops();if(t){for(var e=m(),n=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),i=e.createLinearGradient(n.x,n.y,r.x,r.y),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}},n.prototype._getRadialGradient=function(){return this._getCache(g,this.__getRadialGradient)},n.prototype.__getRadialGradient=function(){var t=this.fillRadialGradientColorStops();if(t){for(var e=m(),n=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),i=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius()),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}},n.prototype.getShadowRGBA=function(){return this._getCache(p,this._getShadowRGBA)},n.prototype._getShadowRGBA=function(){if(this.hasShadow()){var t=o.Util.colorToRGBA(this.shadowColor());return"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")"}},n.prototype.hasFill=function(){return this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())},n.prototype.hasStroke=function(){return this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())},n.prototype.hasHitStroke=function(){var t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t},n.prototype.intersects=function(t){var e,n=this.getStage(),r=n.bufferHitCanvas;return r.getContext().clear(),this.drawHit(r),e=r.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data,e[3]>0},n.prototype.destroy=function(){return a.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this},n.prototype._useBufferCanvas=function(t){return!(t&&!this.hasShadow()||!this.perfectDrawEnabled()||1===this.getAbsoluteOpacity()||!this.hasFill()||!this.hasStroke()||!this.getStage())},n.prototype.setStrokeHitEnabled=function(t){o.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)},n.prototype.getStrokeHitEnabled=function(){return 0!==this.hitStrokeWidth()},n.prototype.getSelfRect=function(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}},n.prototype.getClientRect=function(t){t=t||{};var e=t.skipTransform,n=t.relativeTo,r=this.getSelfRect(),i=!t.skipStroke&&this.hasStroke(),o=i&&this.strokeWidth()||0,s=r.width+o,a=r.height+o,u=!t.skipShadow&&this.hasShadow(),l=u?this.shadowOffsetX():0,c=u?this.shadowOffsetY():0,h=s+Math.abs(l),p=a+Math.abs(c),d=u&&this.shadowBlur()||0,f=h+2*d,g=p+2*d,m=0;Math.round(o/2)!==o/2&&(m=1);var y={width:f+m,height:g+m,x:-Math.round(o/2+d)+Math.min(l,0)+r.x,y:-Math.round(o/2+d)+Math.min(c,0)+r.y};return e?y:this._transformedRect(y,n)},n.prototype.drawScene=function(t,e,n,r){var i,o,s,a=this.getLayer(),u=t||a.getCanvas(),l=u.getContext(),c=this._getCanvasCache(),h=this.sceneFunc(),p=this.hasShadow(),d=this.hasStroke();if(!this.isVisible()&&!n)return this;if(c)return l.save(),a._applyTransform(this,l,e),this._drawCachedSceneCanvas(l),l.restore(),this;if(!h)return this;if(l.save(),this._useBufferCanvas(n)&&!r){if(i=this.getStage(),o=i.bufferCanvas,s=o.getContext(),s.clear(),s.save(),s._applyLineJoin(this),!n)if(a)a._applyTransform(this,s,e);else{var f=this.getAbsoluteTransform(e).getMatrix();l.transform(f[0],f[1],f[2],f[3],f[4],f[5])}h.call(this,s,this),s.restore();var g=o.pixelRatio;p&&!u.hitCanvas?(l.save(),l._applyShadow(this),l._applyOpacity(this),l._applyGlobalCompositeOperation(this),l.drawImage(o._canvas,0,0,o.width/g,o.height/g),l.restore()):(l._applyOpacity(this),l._applyGlobalCompositeOperation(this),l.drawImage(o._canvas,0,0,o.width/g,o.height/g))}else{if(l._applyLineJoin(this),!n)if(a)a._applyTransform(this,l,e);else{var m=this.getAbsoluteTransform(e).getMatrix();l.transform(m[0],m[1],m[2],m[3],m[4],m[5])}p&&d&&!u.hitCanvas?(l.save(),n||(l._applyOpacity(this),l._applyGlobalCompositeOperation(this)),l._applyShadow(this),h.call(this,l,this),l.restore(),this.hasFill()&&this.shadowForStrokeEnabled()&&h.call(this,l,this)):p&&!u.hitCanvas?(l.save(),n||(l._applyOpacity(this),l._applyGlobalCompositeOperation(this)),l._applyShadow(this),h.call(this,l,this),l.restore()):(n||(l._applyOpacity(this),l._applyGlobalCompositeOperation(this)),h.call(this,l,this))}return l.restore(),this},n.prototype.drawHit=function(t,e,n){var r=this.getLayer(),i=t||r.hitCanvas,s=i&&i.getContext(),a=this.hitFunc()||this.sceneFunc(),u=this._getCanvasCache(),l=u&&u.hit;if(this.colorKey||(console.log(this),o.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()")),!this.shouldDrawHit()&&!n)return this;if(l)return s.save(),r._applyTransform(this,s,e),this._drawCachedHitCanvas(s),s.restore(),this;if(!a)return this;if(s.save(),s._applyLineJoin(this),!n)if(r)r._applyTransform(this,s,e);else{var c=this.getAbsoluteTransform(e).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return a.call(this,s,this),s.restore(),this},n.prototype.drawHitFromCache=function(t){void 0===t&&(t=0);var e,n,r,i,s,a,u=this._getCanvasCache(),l=this._getCachedSceneCanvas(),c=u.hit,h=c.getContext(),p=c.getWidth(),d=c.getHeight();h.clear(),h.drawImage(l._canvas,0,0,p,d);try{for(e=h.getImageData(0,0,p,d),n=e.data,r=n.length,i=o.Util._hexToRgb(this.colorKey),s=0;s<r;s+=4)a=n[s+3],a>t?(n[s]=i.r,n[s+1]=i.g,n[s+2]=i.b,n[s+3]=255):n[s+3]=0;h.putImageData(e,0,0)}catch(f){o.Util.error("Unable to draw hit graph from cached scene canvas. "+f.message)}return this},n.prototype.hasPointerCapture=function(t){return c.hasPointerCapture(t,this)},n.prototype.setPointerCapture=function(t){c.setPointerCapture(t,this)},n.prototype.releaseCapture=function(t){c.releaseCapture(t,this)},n}(a.Node);e.Shape=T,T.prototype._fillFunc=y,T.prototype._strokeFunc=v,T.prototype._fillFuncHit=x,T.prototype._strokeFuncHit=_,T.prototype._centroid=!1,T.prototype.nodeType="Shape",l._registerNode(T),s.Factory.addGetterSetter(T,"stroke",void 0,u.getStringValidator()),s.Factory.addGetterSetter(T,"strokeWidth",2,u.getNumberValidator()),s.Factory.addGetterSetter(T,"hitStrokeWidth","auto",u.getNumberOrAutoValidator()),s.Factory.addGetterSetter(T,"strokeHitEnabled",!0,u.getBooleanValidator()),s.Factory.addGetterSetter(T,"perfectDrawEnabled",!0,u.getBooleanValidator()),s.Factory.addGetterSetter(T,"shadowForStrokeEnabled",!0,u.getBooleanValidator()),s.Factory.addGetterSetter(T,"lineJoin"),s.Factory.addGetterSetter(T,"lineCap"),s.Factory.addGetterSetter(T,"sceneFunc"),s.Factory.addGetterSetter(T,"hitFunc"),s.Factory.addGetterSetter(T,"dash"),s.Factory.addGetterSetter(T,"dashOffset",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"shadowColor",void 0,u.getStringValidator()),s.Factory.addGetterSetter(T,"shadowBlur",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"shadowOpacity",1,u.getNumberValidator()),s.Factory.addComponentsGetterSetter(T,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(T,"shadowOffsetX",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"shadowOffsetY",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"fillPatternImage"),s.Factory.addGetterSetter(T,"fill",void 0,u.getStringValidator()),s.Factory.addGetterSetter(T,"fillPatternX",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"fillPatternY",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(T,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(T,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(T,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(T,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(T,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(T,"fillEnabled",!0),s.Factory.addGetterSetter(T,"strokeEnabled",!0),s.Factory.addGetterSetter(T,"shadowEnabled",!0),s.Factory.addGetterSetter(T,"dashEnabled",!0),s.Factory.addGetterSetter(T,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(T,"fillPriority","color"),s.Factory.addComponentsGetterSetter(T,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(T,"fillPatternOffsetX",0,u.getNumberValidator()),s.Factory.addGetterSetter(T,"fillPatternOffsetY",0,u.getNumberValidator()),s.Factory.addComponentsGetterSetter(T,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(T,"fillPatternScaleX",1,u.getNumberValidator()),s.Factory.addGetterSetter(T,"fillPatternScaleY",1,u.getNumberValidator()),s.Factory.addComponentsGetterSetter(T,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(T,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(T,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(T,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(T,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(T,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(T,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(T,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(T,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(T,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(T,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(T,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(T,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(T,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(T,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(T,"fillPatternRotation",0),s.Factory.backCompat(T,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),o.Collection.mapMethods(T)},fd15:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("36da"),i=n("8603"),o=n("1bd8"),s=n("1f21"),a=n("383f"),u=n("229a"),l=n("da04"),c=n("f709"),h=n("8c18"),p=n("5d5a"),d=n("26c8"),f=n("bf11"),g=n("a34e"),m=n("e3af"),y=n("5414"),v=n("2a01"),x=n("d488"),_=n("96ee"),b=n("bdee"),w=n("6b7e"),M=n("c742"),E=n("e4b0"),S=n("bcb1"),T=n("cf29"),C=n("926b"),A=n("461e"),P=n("89c1"),L=n("1c49"),I=n("9470"),R=n("bbce"),N=n("405a"),O=n("2013"),D=n("8e84"),F=n("b33b"),k=n("769d"),B=n("7cc1"),z=n("122f");e.Konva=r.Konva.Util._assign(r.Konva,{Arc:i.Arc,Arrow:o.Arrow,Circle:s.Circle,Ellipse:a.Ellipse,Image:u.Image,Label:l.Label,Tag:l.Tag,Line:c.Line,Path:h.Path,Rect:p.Rect,RegularPolygon:d.RegularPolygon,Ring:f.Ring,Sprite:g.Sprite,Star:m.Star,Text:y.Text,TextPath:v.TextPath,Transformer:x.Transformer,Wedge:_.Wedge,Filters:{Blur:b.Blur,Brighten:w.Brighten,Contrast:M.Contrast,Emboss:E.Emboss,Enhance:S.Enhance,Grayscale:T.Grayscale,HSL:C.HSL,HSV:A.HSV,Invert:P.Invert,Kaleidoscope:L.Kaleidoscope,Mask:I.Mask,Noise:R.Noise,Pixelate:N.Pixelate,Posterize:O.Posterize,RGB:D.RGB,RGBA:F.RGBA,Sepia:k.Sepia,Solarize:B.Solarize,Threshold:z.Threshold}})}}]);