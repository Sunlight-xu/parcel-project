(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3500f468"],{"074d":function(e,i,t){"use strict";t("c40f")},"284b":function(e,i,t){"use strict";t("fc4f")},"6b2a":function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("section",{staticClass:"main_container"},[t("searchModule",{attrs:{"search-module":!0,type:"controlMission","filters-item":[["controlName","controlType","alarmLevel","controlType","planTime","status"]]}}),t("div",{staticClass:"search_content"},[t("div",{staticClass:"table_button"},[t("div",{staticClass:"button_left"},[t("ul",[t("li",{class:2==e.activeTab?"active":"",on:{click:function(i){return e.changeTab(2)}}},[e._v("出入口入侵")]),t("li",{class:3==e.activeTab?"active":"",on:{click:function(i){return e.changeTab(3)}}},[e._v("工作区未穿防护服")]),t("li",{class:4==e.activeTab?"active":"",on:{click:function(i){return e.changeTab(4)}}},[e._v("混流区未穿防护服")])])]),t("div",{staticClass:"button_right"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addMission}},[e._v(" 新增 ")]),t("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.delMission()}}},[e._v(" 删除 ")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.exportData}},[e._v(" 导出 ")]),t("el-dialog",{attrs:{width:"300px",visible:e.delMissionVisible},on:{"update:visible":function(i){e.delMissionVisible=i}}},[t("span",{staticClass:"button_left_dialog"},[e._v("确定要删除吗？")]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(i){e.delMissionVisible=!1}}},[e._v(" 取 消 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.delMissionConfirm}},[e._v(" 确 定 ")])],1)]),t("Dialog",{attrs:{width:"500px",title:"提示",isVisible:e.delMissionVisible},scopedSlots:e._u([{key:"content",fn:function(){return[t("span",{staticClass:"button_left_dialog"},[e._v("确定要删除吗？")])]},proxy:!0},{key:"footer",fn:function(){return[t("div",[t("el-button",{on:{click:function(i){e.delMissionVisible=!1}}},[e._v(" 取 消 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.delMissionConfirm}},[e._v(" 确 定 ")])],1)]},proxy:!0}])})],1)]),t("div",{staticClass:"table_container"},[t("el-table",{ref:"dataTable",attrs:{data:e.dataList,"row-key":e.getKey,"header-cell-style":e.headerCellStyle,"cell-style":e.cellStyle},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"50"}}),t("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号"}}),t("el-table-column",{attrs:{label:"名称",prop:"name"}}),3!==e.activeTab?t("el-table-column",{attrs:{label:"布控库",prop:"group_id"},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(e.valueFilter(i.row.group_id,e.missionLibraryOptions))+" ")]}}],null,!1,708901397)}):e._e(),t("el-table-column",{attrs:{label:"等级",prop:"alarm_level"},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(e.valueFilter(i.row.alarm_level,e.missionLevelOptions))+" ")]}}])}),t("el-table-column",{attrs:{label:"启用状态",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(e.valueFilter(i.row.status,e.missionStatusType))+" ")]}}])}),t("el-table-column",{attrs:{label:"布控人"},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(i.row.applicant.name)+" ")]}}])}),t("el-table-column",{attrs:{label:"发布时间",prop:"publish_time",width:"180"},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(e.timeFilter(i.row.publish_time))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.modMission(i.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delMission(i.row)}}},[e._v("删除")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDetail(i.row)}}},[e._v("详情")])]}}])})],1),t("div",{staticClass:"pagintion_content"},[t("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[1,10,20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.hanleCurrentPChange,"size-change":e.handleSizeChange}})],1)],1)]),t("Dialog",{attrs:{isVisible:e.missionVisible,title:e.dialogTitle,width:"660px"},on:{close:function(i){return e.closeDialog()}},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticClass:"mission_form"},[e.isEdit||e.isDetail?e._e():t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 布控类型: ")]),t("div",{staticClass:"mission_item_content"},[t("el-radio-group",{model:{value:e.missionType,callback:function(i){e.missionType=i},expression:"missionType"}},[t("el-radio",{attrs:{label:2}},[e._v("出入口入侵")]),t("el-radio",{attrs:{label:3}},[e._v("工作区未穿防护服")]),t("el-radio",{attrs:{label:4}},[e._v("混流区未穿防护服")])],1)],1)]),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 任务名称: ")]),t("div",{staticClass:"mission_item_content"},[t("el-input",{attrs:{disabled:e.inputDisable},model:{value:e.missionName,callback:function(i){e.missionName=i},expression:"missionName"}})],1)]),""!==e.missionType||e.inputDisable||e.isEdit?t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 布控地点: ")]),2!==e.missionType&&!e.isEdit&&!e.inputDisable||e.inputDisable&&2!==e.activeTab||2!==e.activeTab&&e.isEdit?t("div",{staticClass:"mission_item_content"},[t("el-tree",{ref:"tree",attrs:{"node-key":"id","show-checkbox":!e.inputDisable,"default-checked-keys":e.checkedNodes,"default-expand-all":!1,data:e.inputDisable?e.filterTree:e.missionAreaLevel},on:{check:e.handlePollNode}})],1):e._e(),2==e.missionType&&!e.isEdit&&!e.inputDisable||e.inputDisable&&2==e.activeTab||2==e.activeTab&&e.isEdit?t("div",{staticClass:"mission_item_content"},[t("el-select",{attrs:{disabled:e.inputDisable,multiple:"","collapse-tags":""},model:{value:e.checkedNodes,callback:function(i){e.checkedNodes=i},expression:"checkedNodes"}},e._l(e.missionAreaOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.airport_name,value:e.id}})})),1)],1):e._e()]):e._e(),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 布控原因: ")]),t("div",{staticClass:"mission_item_content"},[t("el-input",{attrs:{disabled:e.inputDisable},model:{value:e.missionReason,callback:function(i){e.missionReason=i},expression:"missionReason"}})],1)]),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 日期: ")]),t("div",{staticClass:"mission_item_content"},[t("el-date-picker",{attrs:{type:"date",disabled:e.inputDisable,placeholder:"选择日期"},model:{value:e.planStartDate,callback:function(i){e.planStartDate=i},expression:"planStartDate"}}),t("span",{staticClass:"mission_item_tag"},[e._v("-")]),t("el-date-picker",{attrs:{type:"date",disabled:e.inputDisable,placeholder:"选择日期"},model:{value:e.planEndDate,callback:function(i){e.planEndDate=i},expression:"planEndDate"}})],1)]),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 时间段: ")]),t("div",{staticClass:"mission_item_timeContent"},e._l(e.planTime,(function(i,s){return t("div",{key:s,staticClass:"mission_item_picker"},[t("el-time-picker",{attrs:{"is-range":"",disabled:e.inputDisable,"range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:e.planTime[s],callback:function(i){e.$set(e.planTime,s,i)},expression:"planTime[index]"}}),t("span",{staticClass:"mission_item_picker_button"},[s<=e.planTime.length-1&&0!==s&&!e.inputDisable?t("i",{staticClass:"el-icon-remove-outline",on:{click:function(i){return e.rmTimePicker(s)}}}):e._e(),s!==e.planTime.length-1||e.inputDisable?e._e():t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.addTimePicker}})])],1)})),0)]),3!==e.missionType?t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 人脸库: ")]),t("div",{staticClass:"mission_item_content"},[t("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionLibrary,callback:function(i){e.missionLibrary=i},expression:"missionLibrary"}},e._l(e.missionLibraryOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e(),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 报警等级: ")]),t("div",{staticClass:"mission_item_content"},[t("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionLevel,callback:function(i){e.missionLevel=i},expression:"missionLevel"}},e._l(e.missionLevelOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("div",{staticClass:"mission_form_item"},[t("div",{staticClass:"mission_item_header"},[e._v(" 启用状态: ")]),t("div",{staticClass:"mission_item_content"},[t("el-select",{attrs:{disabled:e.inputDisable},model:{value:e.missionStatus,callback:function(i){e.missionStatus=i},expression:"missionStatus"}},e._l(e.inputDisable?e.missionStatusType:e.missionStatusOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])])]},proxy:!0},{key:"footer",fn:function(){return[t("div",[t("el-button",{on:{click:e.addConcel}},[e._v(" 取 消 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addTrue}},[e._v(" 确定 ")])],1)]},proxy:!0}])})],1)},a=[],n=t("5530"),o=(t("4160"),t("d3b7"),t("159b"),t("b0c0"),t("99af"),t("0d03"),t("a434"),t("c975"),t("2f62")),l=t("5c96"),r=t("be46"),c=t("510e"),u=t("8dce"),m=t("d1cc"),d=t("365c"),h=t("f306"),p=t("8e6c"),b={data:function(){return{activeTab:2,dataList:[],cellStyle:{textAlign:"center"},headerCellStyle:{textAlign:"center"},rowStyle:{background:"#22253B"},selection:[],currentPage:1,total:0,pageSize:10,missionVisible:!1,delMissionVisible:!1,missionType:"",missionId:"",missionName:"",missionArea:"",checkedNodes:[],filterTree:[],missionAreaOptions:[],missionLibrary:"",missionLibraryOptions:[],missionLevel:"",missionLevelOptions:[{label:"一级",value:1},{label:"二级",value:2},{label:"三级",value:3}],missionStatus:"",missionStatusType:[{label:"启用",value:1},{label:"停用",value:2},{label:"未开始",value:3},{label:"已过期",value:4}],missionStatusOptions:[{label:"启用",value:1},{label:"停用",value:2}],missionReason:"",planStartDate:"",planEndDate:"",planTime:[""],inputDisable:!1,dialogTitle:"新增任务",currentRow:null,isEdit:!1,isDetail:!1,missionAreaLevel:[],typeControl:""}},mixins:[h["a"]],computed:Object(n["a"])({},Object(o["b"])(["controlData","controlDataQuery","library","areaData","camerasData","areaLevel"])),watch:{areaLevel:function(){this.areaLevel.forEach((function(e){e.label=e.name,e.children=e.child,e.children.forEach((function(e){e.label=e.name}))})),this.missionAreaLevel=this.areaLevel},controlData:function(){this.controlData&&this.controlData.controls?(this.dataList=this.controlData.controls,this.total=this.controlData.count):(this.dataList=[],this.total=0)},controlDataQuery:function(e){this.activeTab=e.control_type,e.reset&&this.$refs.dataTable.clearSelection(),this.currentPage=e.page,this.pageSize=e.page_size},missionVisible:function(e){e||(this.resetDialog(),this.missionType="")},areaData:function(){this.missionAreaOptions=this.areaData},library:function(){var e=[];this.library.forEach((function(i){2===i.type&&e.push({label:i.name,value:i.id})})),this.missionLibraryOptions=e},missionType:function(){this.resetDialog()}},components:{searchModule:r["a"],Dialog:p["a"]},mounted:function(){this.areaLevel.forEach((function(e){e.label=e.name,e.children=e.child,e.children.forEach((function(e){e.label=e.name}))})),this.missionAreaLevel=this.areaLevel,this.missionAreaOptions=this.areaData;var e=[];this.library.forEach((function(i){e.push({label:i.name,value:i.id})})),this.missionLibraryOptions=e},methods:{resetDialog:function(){this.missionName="",this.checkedNodes=[],this.missionLibrary="",this.missionStatus="",this.missionLevel="",this.missionReason="",this.planStartDate="",this.planEndDate="",this.planTime=[""],this.typeControl=""},closeDialog:function(){this.isEdit=!1,this.isDetail=!1,this.missionVisible=!1},changeTab:function(e){this.activeTab=e,this.checkedNodes=[],this.refreshData({page:this.currentPage,control_type:this.activeTab})},getKey:function(e){return e.id},valueFilter:function(e,i){var t="";return i.forEach((function(i){e===i.value&&(t=i.label)})),t},timeFilter:function(e){var i=c["a"].getTime(e);return"".concat(i.nowYear,"/").concat(i.nowMonth,"/").concat(i.nowDate," ").concat(i.nowHour,":").concat(i.nowMin,":").concat(i.nowSec)},refreshData:function(e){this.controlDataQuery.type&&!this.controlDataQuery.check_status&&0!==this.controlDataQuery.check_status&&this.$store.dispatch("SEARCHCONTROL",Object(n["a"])(Object(n["a"])({},this.controlDataQuery),e))},addMission:function(){this.inputDisable=!1,this.dialogTitle="新增任务",this.missionVisible=!0},modMission:function(e){this.inputDisable=!1,this.isEdit=!0,this.missionId=e.id,this.missionName=e.name,this.missionReason=e.reason,this.missionLevel=e.alarm_level,this.checkedNodes=e.cameras,this.missionLibrary=e.group_id,this.missionStatus=e.status>2?1:e.status,this.typeControl=e.control_type;var i=[];e.periods.forEach((function(e){i.push([new Date(1e3*e[0]+new Date((new Date).setHours(0,0,0,0)).getTime()),new Date(1e3*e[1]+new Date((new Date).setHours(0,0,0,0)).getTime())])})),this.planTime=i,this.planStartDate=new Date(1e3*e.start_time),this.planEndDate=new Date(1e3*e.end_time),this.dialogTitle="修改任务",this.missionVisible=!0},showDetail:function(e){this.isDetail=!0,this.missionName=e.name,this.missionReason=e.reason,this.missionLevel=e.alarm_level,this.checkedNodes=e.cameras,this.missionLibrary=e.group_id,this.missionStatus=e.status;var i=[];e.periods.forEach((function(e){i.push([new Date(1e3*e[0]+new Date((new Date).setHours(0,0,0,0)).getTime()),new Date(1e3*e[1]+new Date((new Date).setHours(0,0,0,0)).getTime())])})),this.planTime=i,this.planStartDate=new Date(1e3*e.start_time),this.planEndDate=new Date(1e3*e.end_time),this.dialogTitle="任务详情",this.inputDisable=!0,this.missionVisible=!0,this.filterTreeNode()},delMission:function(e){!e&&this.selection.length<1?l["Message"].error({message:"请选择任务再进行操作"}):(this.currentRow=e||null,this.delMissionVisible=!0)},delMissionConfirm:function(){var e=this,i=[];this.currentRow?i.push(this.currentRow.id):this.selection.forEach((function(e){i.push(e.id)})),Object(m["c"])(i).then((function(t){var s=1;1===i.length&&(s=c["a"].formatPage({current:e.currentPage,size:e.pageSize,total:e.total},"del")),0===t.error_no?(l["Message"].success({message:"删除成功"}),e.refreshData({page:s,control_type:e.activeTab})):504===t.error_no&&e.refreshData({page:s,control_type:e.activeTab})})),this.delMissionVisible=!1},addTimePicker:function(){this.planTime.push("")},rmTimePicker:function(e){this.planTime.splice(e,1)},addConcel:function(){this.missionVisible=!1,this.isDetail=!1,this.isEdit=!1},addTrue:function(){var e=this;if("任务详情"===this.dialogTitle)return this.missionVisible=!1,this.isDetail=!1,void(this.isEdit=!1);if(this.isEdit||this.missionType)if(this.missionName&&this.planStartDate&&this.planEndDate&&0!==this.checkedNodes.length&&this.planTime[0]&&this.missionLevel&&this.missionStatus&&this.missionReason)if(3===this.missionType||this.missionLibrary){var i=[];if(this.planTime[0]){var t=!1;if(this.planTime.forEach((function(e){var s=(e[0].getTime()-new Date((new Date).setHours(0,0,0,0)).getTime())/1e3,a=(e[1].getTime()-new Date((new Date).setHours(0,0,0,0)).getTime())/1e3;a-s<=0&&(t=!0);var n=[s,a];i.push(n)})),t)return void l["Message"].error({message:"结束时间应大于开始时间"})}if(this.planEndDate.getTime()-this.planStartDate.getTime()<0)l["Message"].error({message:"结束日期不能小于开始日期"});else{var s={name:this.missionName,reason:this.missionReason,start_time:new Date(this.planStartDate).getTime()/1e3,end_time:new Date(this.planEndDate).getTime()/1e3,camera_ids:this.checkedNodes,periods:i,alarm_level:this.missionLevel,status:this.missionStatus,type:1};this.isEdit?s.control_type=this.typeControl:s.control_type=this.missionType,3!==this.missionType&&(s.group_id=this.missionLibrary),this.activeTab=2,"新增任务"===this.dialogTitle?Object(m["a"])(s).then((function(i){0===i.error_no?(e.isEdit=!1,e.isDetail=!0,l["Message"].success({message:"添加成功"}),e.missionVisible=!1,e.refreshData({page:1,control_type:e.activeTab})):l["Message"].error({message:"请正确填写信息"})})):"修改任务"===this.dialogTitle&&Object(m["e"])(this.missionId,s).then((function(i){0===i.error_no?(e.isEdit=!1,e.isDetail=!0,l["Message"].success({message:"修改成功"}),e.missionVisible=!1,e.refreshData({page:1,control_type:e.activeTab})):l["Message"].error({message:"请正确填写信息"})}))}}else l["Message"].error({message:"请填写完整"});else l["Message"].error({message:"请填写完整"});else l["Message"].error({message:"请填写完整"})},handleSelectionChange:function(e){var i=this;this.selection=[],e&&e.forEach((function(e){e&&i.selection.push(e)}))},handlePollNode:function(e,i){var t=this;this.checkedNodes=[],i.checkedNodes.forEach((function(e){e.id&&t.checkedNodes.push(e.id)}))},hanleCurrentPChange:function(e){this.refreshData({page:e,reset:0,control_type:this.activeTab})},handleSizeChange:function(e){this.refreshData({page_size:e,page:1,reset:0,control_type:this.activeTab})},exportData:function(){var e=this;if(this.selection.length<1)l["Message"].error({message:"请选择导出数据"});else{var i=[[]];this.selection.forEach((function(t){i[0].push({"名称":t.name,"布控库":e.valueFilter(t.group_id,e.missionLibraryOptions),"报警等级":e.valueFilter(t.alarm_level,e.missionLevelOptions),"启用状态":e.valueFilter(t.status,e.missionStatusType),"布控人":t.applicant.name,"发布时间":e.timeFilter(t.publish_time)})})),Object(u["a"])(i,["任务配置"],"任务配置");var t={action:"导出",extra:"任务配置"};Object(d["b"])(t).then((function(){}))}},filterTreeNode:function(){var e=this,i=[];this.missionAreaLevel.forEach((function(t){-1!==e.checkedNodes.indexOf(t.id)&&i.push(t)})),this.filterTree=i}}},v=b,f=(t("284b"),t("074d"),t("2877")),_=Object(f["a"])(v,s,a,!1,null,"681f5b91",null);i["default"]=_.exports},c40f:function(e,i,t){},fc4f:function(e,i,t){}}]);