(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8b92bfc2"],{1816:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADx0lEQVRYCe1WXWwMURS+d0aq1W6qCfXiJ2i0u9KIpATRspXQdit+whNN8FJPvHgRiYjwIEJIJF4EiSBBGz/dUdLutFU/4UFEuqM/CEKEhqr42e7OPc6Z9o6xdmtntU/cZPd898w53zlzzrl3l7F/ffF0C3Djdk9+LDJwHBiby1W+KrDE+zgdLiUdp8ZQ55zo98gDAFjLAKYzE7amw0M+rhPQ9PBqE2K30XeqI2iBA7uCrhIIhoydAKwey54dFyUzbp/ydkwqllp391h4GT0BIDamYu+0aW9/4lm8uOizU+fEf6wADZt4GdWBgevgDc0dF/oi4qOmGwdxXhIO/LAJBFuNYpz0+4zBQmfWqWAKyBlfgb6qEGJHMBS+QJWM902agNZirART3EGiafFOqew558AUvgFtvw7Zr4NX0UPxvnZZMJDa2NK1UDDI4SDmCWB7MPukCTqJMFhboNy3xKmTuLGtc74ZNW9iC3NJpyh8TZXfd1k+t4cQS3QelevpAU75Xy1df5fzjb8vzc/xNZWU8PsNIWML3hd1RCoEHMKXvYpJC9rbb4gNW0OKkVhfoPeYMJn2tt84SnzV5d56FBeHuGdcbw3jbAwuKwEaGDzfdjXkw3Qldr/P8gVWq7V2zCWMpT8s+UDwGontCkjFSEg1y7MXT8AnmiEwlU3EiX2/hwP3weIHVmRJ/BqVBCoWTfnAONMGg4liGQwP5vMhPFPqRiWBIfKYJTlXZTDsszV42HA7rg2k0UhIOgXIU0FcnMEjyYl3YYGlA/5M6kYlga/QuxsHe6IVTFHoeLOg/qQEz3eeFZhDtyXxy04Az+V3qRwBOZk4kPNM5VLvXYtPiO0/eQeTor2VABoC43AEXcyfRumjcVzdhsw1eZmeWmLRmo3l2Au6lnHx1+N40ZVBTC1yLF3vnBBh6vgYDBTiETpjl8xhkwjiCyS9ihtau7w8Fm3B2zWffLmibA74vaclzy+Xj99f2IsP6NMTvGUsYANwDe/wWdLYrQw2h8vAjF7B4OPJF2/bc87gpLNngDbOFSj1dkFG9gL0anLq3WBM/hRW0QqOPC25Gepv/x2TJkCBqkunfczm3kp0PukmsLTF2/ApYRrG6ZO8KxL9M/plBqRjItmgh3cxAfsSPUs2A/Qbo4WMqYFlvheJ/Eg3bAWcTtV+335FUTdiH6NO/XCYTtdwwck35QTIuMpfdBYdKrG0/bS3F7CIjV0CVwkQd2X57GaVq2XY2Td2LM4e2tglcJ0A8VeUFz7KylLnI7yELalTMz0HXMb9b25X4AeJCkaDy4jNtgAAAABJRU5ErkJggg=="},"406e":function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return p}));let a=null;function r(e){return a||(a=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){return setTimeout(e,16)}).bind(window)),a(e)}let n=null;function s(e){n||(n=(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}).bind(window)),n(e)}function o(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),(document.querySelector("head")||document.body).appendChild(t),t}function c(e,t={}){let i=document.createElement(e);return Object.keys(t).forEach(e=>{i[e]=t[e]}),i}function d(e,t,i){let a=window.getComputedStyle(e,i||null)||{display:"none"};return a[t]}function l(e){if(!document.documentElement.contains(e))return{detached:!0,rendered:!1};let t=e;while(t!==document){if("none"===d(t,"display"))return{detached:!1,rendered:!1};t=t.parentNode}return{detached:!1,rendered:!0}}var h='.resize-triggers{visibility:hidden;opacity:0;pointer-events:none}.resize-contract-trigger,.resize-contract-trigger:before,.resize-expand-trigger,.resize-triggers{content:"";position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden}.resize-contract-trigger,.resize-expand-trigger{background:#eee;overflow:auto}.resize-contract-trigger:before{width:200%;height:200%}';let u=0,_=null;function f(e,t){e.__resize_mutation_handler__||(e.__resize_mutation_handler__=m.bind(e));let i=e.__resize_listeners__;if(!i)if(e.__resize_listeners__=[],window.ResizeObserver){let{offsetWidth:t,offsetHeight:i}=e,a=new ResizeObserver(()=>{(e.__resize_observer_triggered__||(e.__resize_observer_triggered__=!0,e.offsetWidth!==t||e.offsetHeight!==i))&&A(e)}),{detached:r,rendered:n}=l(e);e.__resize_observer_triggered__=!1===r&&!1===n,e.__resize_observer__=a,a.observe(e)}else if(e.attachEvent&&e.addEventListener)e.__resize_legacy_resize_handler__=function(){A(e)},e.attachEvent("onresize",e.__resize_legacy_resize_handler__),document.addEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);else if(u||(_=o(h)),D(e),e.__resize_rendered__=l(e).rendered,window.MutationObserver){let t=new MutationObserver(e.__resize_mutation_handler__);t.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e.__resize_mutation_observer__=t}e.__resize_listeners__.push(t),u++}function p(e,t){let i=e.__resize_listeners__;if(i){if(t&&i.splice(i.indexOf(t),1),!i.length||!t){if(e.detachEvent&&e.removeEventListener)return e.detachEvent("onresize",e.__resize_legacy_resize_handler__),void document.removeEventListener("DOMSubtreeModified",e.__resize_mutation_handler__);e.__resize_observer__?(e.__resize_observer__.unobserve(e),e.__resize_observer__.disconnect(),e.__resize_observer__=null):(e.__resize_mutation_observer__&&(e.__resize_mutation_observer__.disconnect(),e.__resize_mutation_observer__=null),e.removeEventListener("scroll",v),e.removeChild(e.__resize_triggers__.triggers),e.__resize_triggers__=null),e.__resize_listeners__=null}!--u&&_&&_.parentNode.removeChild(_)}}function g(e){let{width:t,height:i}=e.__resize_last__,{offsetWidth:a,offsetHeight:r}=e;return a!==t||r!==i?{width:a,height:r}:null}function m(){let{rendered:e,detached:t}=l(this);e!==this.__resize_rendered__&&(!t&&this.__resize_triggers__&&(w(this),this.addEventListener("scroll",v,!0)),this.__resize_rendered__=e,A(this))}function v(){w(this),this.__resize_raf__&&s(this.__resize_raf__),this.__resize_raf__=r(()=>{let e=g(this);e&&(this.__resize_last__=e,A(this))})}function A(e){e&&e.__resize_listeners__&&e.__resize_listeners__.forEach(t=>{t.call(e,e)})}function D(e){let t=d(e,"position");t&&"static"!==t||(e.style.position="relative"),e.__resize_old_position__=t,e.__resize_last__={};let i=c("div",{className:"resize-triggers"}),a=c("div",{className:"resize-expand-trigger"}),r=c("div"),n=c("div",{className:"resize-contract-trigger"});a.appendChild(r),i.appendChild(a),i.appendChild(n),e.appendChild(i),e.__resize_triggers__={triggers:i,expand:a,expandChild:r,contract:n},w(e),e.addEventListener("scroll",v,!0),e.__resize_last__={width:e.offsetWidth,height:e.offsetHeight}}function w(e){let{expand:t,expandChild:i,contract:a}=e.__resize_triggers__,{scrollWidth:r,scrollHeight:n}=a,{offsetWidth:s,offsetHeight:o,scrollWidth:c,scrollHeight:d}=t;a.scrollLeft=r,a.scrollTop=n,i.style.width=s+1+"px",i.style.height=o+1+"px",t.scrollLeft=c,t.scrollTop=d}},"428b":function(e,t,i){},"6ebd":function(e,t,i){},a905:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"resource_manage"},[i("div",{staticClass:"resource_manage_select"},[i("div",{staticClass:"add_enter"},[i("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.handleOperateLocation}},[e._v("新建")])],1),e.isShowTree?i("el-tree",{ref:"tree",staticClass:"resource_tree",attrs:{"node-key":"id",accordion:"","filter-node-method":e.filterNode,"default-checked-keys":e.checkedNodes,"default-expanded-keys":e.checkedNodes,data:e.resourceAreaOptions},on:{check:e.handlePollNode,"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return[i("div",{staticClass:"content",on:{mouseenter:function(t){return e.mouseEnterTree(r)},mouseleave:function(t){return e.mouseLeaveTree(r)}}},[i("p",[e._v(e._s(a.label))]),r.showTip?i("span",{staticClass:"tip",on:{mouseenter:function(t){return e.clickNodeFun(r)}}},[e._v(" ··· ")]):e._e(),r.showFun&&1==r.level?i("ul",{on:{mouseleave:function(e){r.showFun=!1}}},[i("li",{on:{click:function(t){return e.editLocation(r)}}},[e._v("编辑地点")]),i("li",{on:{click:function(t){return e.delLocation(r)}}},[e._v("删除地点")])]):e._e()])]}}],null,!1,1678691447)}):e._e(),i("span",{directives:[{name:"show",rawName:"v-show",value:e.isAddLocation,expression:"isAddLocation"}],staticClass:"add_location",on:{click:e.handleOperateLocation}},[e._v("新增地点")])],1),i("div",{staticClass:"resource_manage_result"},[i("div",{staticClass:"content"},[e.showItem?i("div",{staticClass:"resource_manage_result_top"},[i("div",{staticClass:"left"},[i("h3",[e._v(e._s(e.isAddArea?"新增区域":"编辑区域"))]),i("div",{staticClass:"left_item"},[i("span",[e._v("区域名称：")]),i("el-input",{model:{value:e.areaContent,callback:function(t){e.areaContent=t},expression:"areaContent"}})],1)]),i("div",{staticClass:"right"},[i("el-button",{attrs:{type:"primary",disabled:e.isClear},on:{click:e.clearArea}},[e._v("清空重画")]),i("el-button",{attrs:{type:"primary"},on:{click:e.addArea}},[e._v("保存")]),e.isAddArea?e._e():i("el-button",{on:{click:e.delArea}},[e._v("删除区域")])],1)]):e._e(),e.showItem?i("div",{staticClass:"resource_manage_result_tip"},[i("img",{attrs:{src:e.bellImg,alt:""}}),e._v(" 请在下方地图上绘制多边形确定区域范围，点击右键自动闭合多边形，完成图形绘制。 ")]):e._e()]),i("div",{staticClass:"resource_manage_result_bottom"},[i("Map",{ref:"map",attrs:{oldmap:!1,setPointList:e.pointData,floors:e.floors},on:{getPointList:e.getPoint,getCurrentFloor:e.getFloor}})],1)]),i("Dialog",{staticClass:"resource_dialog",attrs:{isVisible:e.isShowDialog,width:"500px",title:e.typeList[e.operateType]+e.currentType},on:{close:function(t){return e.handleCloseDialog()}},scopedSlots:e._u([{key:"content",fn:function(){return["地点"==e.currentType&&"del"!==e.operateType?i("div",{staticClass:"item"},[i("h4",[e._v("地点名称")]),i("el-input",{model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1):e._e(),"del"==e.operateType?i("div",[e._v(" 确认删除"+e._s(e.currentType+e.currentData.name)+"吗？ ")]):e._e()]},proxy:!0},{key:"footer",fn:function(){return[i("div",{staticClass:"operate_btn"},[i("el-button",{on:{click:e.handleCancel}},[e._v(" 取消 ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v(" 确定 ")])],1)]},proxy:!0}])})],1)},r=[],n=i("b85c"),s=i("5530"),o=(i("4160"),i("d3b7"),i("159b"),i("d401"),i("0d03"),i("25f0"),i("4795"),i("d81d"),i("e9c4"),i("b0c0"),i("498a"),i("c975"),i("fb6a"),i("4af1")),c=i("5c96"),d=i("2f62"),l=i("8dce"),h=i("0fea"),u=i("365c"),_=i("f306"),f=i("8e6c"),p=i("1816"),g=i.n(p),m={mixins:[_["a"]],data:function(){return{bellImg:g.a,areaContent:"",isAddArea:!1,showItem:!1,isAddLocation:!1,resourceAreaOptions:[],checkedNodes:[],currentTab:0,headerCellStyle:{textAlign:"center"},multipleSelection:[],isShowTree:!0,tableData:[],resourceData:[],currentPage:1,pageSize:10,total:0,type:"",currentType:"",operateType:"",isShowOperate:!1,areaList:[],locationList:[],deviceList:[],typeList:{add:"新增",edit:"修改",del:"删除"},isShowDialog:!1,location:"",area:{name:"",location:""},device:{name:[],area:"",location:"",parents_id:""},currentData:"",areaData:[],levelList:{1:"地点",2:"区域",3:"设备"},isDisabled:!1,floors:[],pointData:{},drawData:[],floorId:"",isClear:!0}},components:{Dialog:f["a"],Map:o["a"]},created:function(){this.floors=this.floorInfo},mounted:function(){this.getResourceData()},computed:Object(s["a"])({},Object(d["b"])(["camerasData","floorInfo"])),watch:{isAddLocation:function(){this.isAddLocation&&(this.isShowOperate=!1)},isShowOperate:function(){this.isShowOperate&&(this.isAddLocation=!1)},floorInfo:{handler:function(){this.floors=this.floorInfo},immediate:!0},drawData:function(){0!==this.drawData.length?this.isClear=!1:this.isClear=!0}},methods:{clearArea:function(){this.clearMap(),this.startMap(),this.drawData=[]},getAreaData:function(e){var t=this;h["b"].getRecource({id:e.id}).then((function(e){if(0===e.error_no){var i={};if(0!==e.data.items.length){t.floors.forEach((function(t){t.id===e.data.items[0].floor_id&&(i=t)})),t.isClear=!1,t.endMap();var a=e.data.items[0].floor_id.toString(),r=JSON.parse(e.data.items[0].points),n={};n[a]=r,t.pointData=n,t.drawData=r,t.floorId=a,setTimeout((function(){t.$refs.map.currentTerminal=i.terminal,t.$refs.map.currentFloor=i,t.$refs.map.mapChange(i.floor_id,i.type,i.source)}))}}}))},startMap:function(){this.$refs.map.$refs.svgmap.startDrawPoint()},clearMap:function(){this.$refs.map.$refs.svgmap.clearPath()},endMap:function(){this.$refs.map.$refs.svgmap.endDrawPoint()},getPoint:function(e){this.drawData=e},getFloor:function(e){this.floorId=e.id},addArea:function(){var e=this;if(""!==this.areaContent)if(0!==this.drawData.length){var t={name:this.areaContent,parents_id:this.isAddArea?this.currentData.id:this.currentData.parents_id,points:JSON.stringify(this.drawData),floor_id:this.floorId};this.isAddArea?h["b"].createResource(t).then((function(t){0===t.error_no&&(c["Message"].success({message:"创建成功"}),e.getResourceData(),e.clearMap())})):h["b"].updateResource(this.currentData.id,t).then((function(t){0===t.error_no&&(c["Message"].success({message:"修改成功"}),e.getResourceData(),e.clearMap())})),this.drawData=[],this.showItem=!1}else c["Message"].warning({message:"绘制区域后才可以保存"});else c["Message"].warning({message:"填写名称后才可以保存"})},delArea:function(){this.operateType="del",this.currentType="区域",this.isShowDialog=!0,this.showItem=!1,this.areaContent="",this.isAddArea=!0,this.drawData=[],this.clearMap()},editLocation:function(e){this.operateType="edit",this.currentType="地点",this.location=e.label,this.isShowDialog=!0},delLocation:function(){this.isShowDialog=!0,this.operateType="del",this.currentType="地点"},clickNodeFun:function(e){this.resourceAreaOptions.forEach((function(e){e.showFun=!1})),e.showFun=!0},mouseEnterTree:function(e){e.showTip=!0},mouseLeaveTree:function(e){e.showTip=!1},handleAddLocation:function(){this.isAddLocation=!this.isAddLocation},handleOperateLocation:function(){this.isShowDialog=!0,this.currentType="地点",this.operateType="add"},getReturnData:function(){var e=this;if(this.isDisabled=!0,"地点"!==this.currentType||"edit"!==this.operateType){if("区域"===this.currentType){if("add"===this.operateType)return void(this.area.location=this.currentData.name);"edit"===this.operateType&&(this.area.name=this.currentData.name,this.areaData.forEach((function(t,i){if(t.children){var a,r=Object(n["a"])(t.children);try{for(r.s();!(a=r.n()).done;){var s=a.value;s.name===e.currentData.name&&(e.area.location=e.areaData[i].name)}}catch(o){r.e(o)}finally{r.f()}}})))}if("设备"===this.currentType){if("add"===this.operateType)return this.device.area=this.currentData.name,void this.areaData.forEach((function(t,i){if(t.children){var a,r=Object(n["a"])(t.children);try{for(r.s();!(a=r.n()).done;){var s=a.value;s.name===e.currentData.name&&(e.device.location=e.areaData[i].name)}}catch(o){r.e(o)}finally{r.f()}}}));this.device.name="edit"===this.operateType?[this.currentData.id]:[],this.areaData.forEach((function(t,i){t.children&&t.children.forEach((function(a,r){if(a.children){var s,o=Object(n["a"])(a.children);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.name===e.currentData.name&&(e.device.area=t.children[r].name,e.device.location=e.areaData[i].name,e.device.parents_id=e.areaData[i].id)}}catch(d){o.e(d)}finally{o.f()}}}))}))}}else this.location=this.currentData.name},resetDialog:function(){for(var e in this.device)this.device[e]="";for(var t in this.area)this.area[t]="";this.location="",this.isDisabled=!1},handleCancel:function(){this.isShowDialog=!1,this.resetDialog()},handleConfirm:function(){var e=this;if(this.isShowDialog=!1,this.isShowOperate=!1,this.location.length>16)c["Message"].error({message:"地点名称过长"});else if(this.area.name.length>16)c["Message"].error({message:"区域名称过长"});else{if("add"===this.operateType){if("地点"===this.currentType){var t={parents_id:0,name:this.location.trim()};return""===this.location.trim()?void c["Message"].error({message:"地点不能为空"}):void h["b"].createResource(t).then((function(){e.getResourceData(),e.resetDialog()}))}if("区域"===this.currentType){if(""===this.area.name.trim())return void c["Message"].error({message:"区域不能为空"});var i={parents_id:this.currentData.id,name:this.area.name};return void h["b"].createResource(i).then((function(){e.getResourceData(),e.resetDialog()}))}if("设备"===this.currentType){if(0===this.device.name.length)return void c["Message"].error({message:"设备不能为空"});var a=this.device.name.length;return void this.device.name.forEach((function(t,i){h["b"].changeDevice(t,{property_id:e.currentData.id}).then((function(){i===a-1&&(e.getResourceData(),e.resetDialog())}))}))}}if("edit"===this.operateType){if("地点"===this.currentType){if(""===this.location.trim())return void c["Message"].error({message:"地点不能为空"});var r=this.currentData.id,n={parents_id:this.currentData.parents_id,name:this.location};return void h["b"].updateResource(r,n).then((function(){e.getResourceData(),e.resetDialog()}))}if("区域"===this.currentType){if(""===this.area.name.trim())return void c["Message"].error({message:"区域不能为空"});var s=this.currentData.id,o={parents_id:this.currentData.parents_id,name:this.area.name};return void h["b"].updateResource(s,o).then((function(){e.getResourceData(),e.resetDialog()}))}if("设备"===this.currentType){if(0===this.device.name.length)return void c["Message"].error({message:"设备不能为空"});var d=this.device.name.length;return void this.device.name.forEach((function(t,i){h["b"].changeDevice(t,{property_id:e.currentData.parents_id}).then((function(){i===d-1&&(e.getResourceData(),e.resetDialog())}))}))}}if("del"===this.operateType){var l=this.currentData.id;if("设备"===this.currentType)return void h["b"].changeDevice(l,{property_id:1}).then((function(t){0===t.error_no&&(e.getResourceData(),e.resetDialog())}));h["b"].deleteResource(l).then((function(t){0===t.error_no&&e.getResourceData()}))}}},getInitData:function(){var e=[],t=[];this.areaData.forEach((function(i){e.push(i.name),i.children&&i.children.forEach((function(e){t.push(e.name)}))})),this.areaList=t,this.locationList=e},handleCloseDialog:function(){this.isShowDialog=!1,this.isAddLocation=!1,this.resetDialog()},getOperate:function(e,t){this.operateType=e,this.isShowDialog=!0,this.currentType=t,this.getReturnData()},handleNodeClick:function(e){this.currentData=e,this.isShowOperate=!0,this.type=this.levelList[this.currentData.level],this.showItem=!0,1===e.level?(this.isAddArea=!0,this.areaContent="",this.drawData=[],this.clearMap(),this.startMap()):2===e.level&&(this.isAddArea=!1,this.areaContent=e.label,this.getAreaData(e))},getResourceData:function(){var e=this;h["b"].getCameraTree().then((function(t){if(!t.data)return e.areaData=[],void(e.resourceAreaOptions=[]);t.data.forEach((function(e){e.label=e.name,e.level=1,e.showTip=!1,e.showFun=!1,0!==e.child.length&&(e.children=e.child,e.child.forEach((function(e){e.level=2,e.label=e.name})))})),e.areaData=t.data,e.resourceAreaOptions=t.data,e.getInitData()}))},filterNode:function(e,t){return!(!e||!t.id||-1===this.checkedNodes.indexOf(t.id))},handlePollNode:function(e,t){var i=this;this.checkedNodes=[],t.checkedNodes.forEach((function(e){e.id&&i.checkedNodes.push(e.id)}))},handleSelectionChange:function(e){this.multipleSelection=e},hanleCurrentChange:function(e){0!==this.total&&(this.tableData=this.resourceData.slice(this.pageSize*(e-1),this.pageSize*e)),this.currentPage=e},handleSizeChange:function(e){0!==this.total&&(this.tableData=this.resourceData.slice(e*(this.currentPage-1),e*this.currentPage)),this.pageSize=e},handleExport:function(){if(this.multipleSelection.length<1)c["Message"].error({message:"请选择导出数据"});else{var e=[[]];this.multipleSelection.forEach((function(t){e[0].push({"设备名称":t.name,IP:t.ip,"地点":t.terminal,"区域":t.area,"维护人":t.admin,"更新时间":t.updated_at,"备注":t.comment})})),Object(l["a"])(e,["资产导出"],"资产导出");var t={action:"导出",extra:"资源管理"};Object(u["b"])(t).then((function(){}))}}}},v=m,A=(i("cb6b"),i("f663"),i("2877")),D=Object(A["a"])(v,a,r,!1,null,null,null);t["default"]=D.exports},cb6b:function(e,t,i){"use strict";i("428b")},f663:function(e,t,i){"use strict";i("6ebd")}}]);