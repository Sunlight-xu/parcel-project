{"version":3,"sources":["main.js"],"names":["background","chapter","canvas","formData","Object","create","loadImage","bg","Image","src","require","crossOrigin","onload","e","onerror","console","error","ct","draw","context","document","getElementById","getContext","width","height","drawImage","font","fillStyle","x","name","length","fillText","starttime","endtime","time","number","createdate","imgURL","toDataURL","alert","window","clearForm","tagElements","form","getElementsByTagName","j","value","log","makePic","now","Date","date","setDate","getDate","year","getFullYear","month","getMonth","day","id","random","parseInt","Math","replace","event","preventDefault","donloadPic","dlLink","createElement","download","href","dataset","downloadurl","join","body","appendChild","click","removeChild","sessionStorage","getItem","ret","prompt","style","display","setItem","location","reload"],"mappings":";;;;;AACA,IAAIA,EAAa,KACbC,EAAU,KACVC,EAAS,KACTC,EAAWC,OAAOC,OAAO,MAE7B,SAASC,IACP,IAAIC,EAAK,IAAIC,MACbD,EAAGE,IAAMC,QAAQ,6BACjBH,EAAGI,YAAc,YACjBJ,EAAGK,OAAS,SAAUC,GACpBb,EAAaO,GAEfA,EAAGO,QAAU,SAAUD,GACrBE,QAAQC,MAAMH,IAGhB,IAAII,EAAK,IAAIT,MACbS,EAAGR,IAAMC,QAAQ,wBACjBO,EAAGN,YAAc,YACjBM,EAAGL,OAAS,SAAUC,GACpBZ,EAAUgB,GAEZA,EAAGH,QAAU,SAAUD,GACrBE,QAAQC,MAAMH,IA6DlB,SAASK,IAEP,IAAMC,GADNjB,EAASkB,SAASC,eAAe,WACVC,WAAW,MAElCpB,EAAOqB,MAAQ,KACfrB,EAAOsB,OAAS,KAEhBL,EAAQM,UAAUzB,EAAY,EAAG,EAAG,KAAM,MAG1CmB,EAAQO,KAAO,+BACfP,EAAQQ,UAAY,UACpB,IAAMC,EAAI,IAA6B,GAAvBzB,EAAS0B,KAAKC,OAC9BX,EAAQY,SAAS5B,EAAS0B,KAAMD,EAAG,MAEnCT,EAAQY,SAAS5B,EAAS6B,UAAW,KAAM,MAE3Cb,EAAQY,SAAS5B,EAAS8B,QAAS,KAAM,MAEzCd,EAAQY,SAAS5B,EAAS+B,KAAM,KAAM,MAEtCf,EAAQO,KAAO,8BAEfP,EAAQY,SAAS5B,EAASgC,OAAQ,IAAK,MACvChB,EAAQY,SAAS5B,EAASiC,WAAY,IAAK,MAC3C,IAAIC,EAASnC,EAAOoC,UAAU,cAC9BlB,SAASC,eAAe,OAAOZ,IAAM4B,EACrCE,MAAM,OApFRjC,IAGAkC,OAAOC,UAAY,WAEjB,IADA,IAAIC,EAAcC,KAAKC,qBAAqB,SACnCC,EAAI,EAAGA,EAAIH,EAAYZ,OAAQe,IACtCH,EAAYG,GAAGC,MAAQ,GAEzB1B,SAASC,eAAe,OAAOZ,IAAM,GACrCM,QAAQgC,IAAI,SAIdP,OAAOQ,QAAU,SAAUnC,GACzB,IAAMoC,EAAM,IAAIC,KAGZC,GAFOF,EAAIG,QAAQH,EAAII,UAAY,GAE5B,IAAIH,MACXI,EAAOH,EAAKI,cACZC,EAAQL,EAAKM,WAAa,EAC1BC,EAAMP,EAAKE,UAAY,EACvBG,EAAQ,KAAIA,EAAQ,IAAMA,GAC1BE,EAAM,KAAIA,EAAM,IAAMA,GAC1B,IAAIxB,EAAOoB,EAAO,IAAME,EAAQ,IAAME,EAEtCtC,SAASC,eAAe,cAAcyB,MAAQZ,EAG9C,IAFA,IACIQ,EADOtB,SAASC,eAAe,QACZuB,qBAAqB,SACnCC,EAAI,EAAGA,EAAIH,EAAYZ,OAAQe,IACtC1C,EAASuC,EAAYG,GAAGc,IAAMjB,EAAYG,GAAGC,MAE/C,IAAIc,EAASC,SAAyB,IAAhBC,KAAKF,UAC3BxC,SAASC,eAAe,UAAUyB,MAAQ3C,EAAS8B,QAAQ8B,QAAQ,MAAO,IAASH,GAAAA,OAAAA,EAAS,GAAKA,EAAaA,IAAAA,OAAAA,IAC9GzD,EAASgC,OAASf,SAASC,eAAe,UAAUyB,MACpD5B,IACA8C,MAAMC,kBAIRzB,OAAO0B,WAAa,WAClB,GAAIhE,EAAQ,CACV,IAAImC,EAASnC,EAAOoC,UAAU,cAC1B6B,EAAS/C,SAASgD,cAAc,KACpCD,EAAOE,SAAWjD,SAASC,eAAe,QAAQyB,MAAQ,IAAM1B,SAASC,eAAe,UAAUyB,MAClGqB,EAAOG,KAAOjC,EACd8B,EAAOI,QAAQC,YAAc,CAAC,aAAcL,EAAOE,SAAUF,EAAOG,MAAMG,KAAK,KAC/ErD,SAASsD,KAAKC,YAAYR,GAC1BA,EAAOS,QACPxD,SAASsD,KAAKG,YAAYV,GAC1B5B,MAAM,cAENA,MAAM,UAoCVC,OAAO5B,OAAS,WACd,GAA8C,cAA1C4B,OAAOsC,eAAeC,QAAQ,SAAlC,CAIA,IAAIC,EAAMC,OAAO,SACbD,EACS,cAAPA,GACF5D,SAASC,eAAe,QAAQ6D,MAAMC,QAAU,OAChD3C,OAAOsC,eAAeM,QAAQ,QAASJ,KAEvCzC,MAAM,QACNC,OAAO6C,SAASC,UAGlB9C,OAAO6C,SAASC,cAbhBlE,SAASC,eAAe,QAAQ6D,MAAMC,QAAU","file":"main.a5c001ed.js","sourceRoot":"../demo/图片下载工具","sourcesContent":["\nlet background = null\nlet chapter = null\nlet canvas = null\nvar formData = Object.create(null);\n\nfunction loadImage() {\n  var bg = new Image();\n  bg.src = require('./assets/certificate.jpeg');\n  bg.crossOrigin = 'Anonymous';\n  bg.onload = function (e) {\n    background = bg\n  };\n  bg.onerror = function (e) {\n    console.error(e)\n  };\n\n  var ct = new Image();\n  ct.src = require('./assets/chapter.png');\n  ct.crossOrigin = 'Anonymous';\n  ct.onload = function (e) {\n    chapter = ct\n  };\n  ct.onerror = function (e) {\n    console.error(e)\n  };\n\n}\nloadImage()\n\n// 清空表单\nwindow.clearForm = function () {\n  var tagElements = form.getElementsByTagName('input');\n  for (var j = 0; j < tagElements.length; j++) {\n    tagElements[j].value = ''\n  }\n  document.getElementById('pic').src = ''\n  console.log('清空数据')\n\n}\n// 生成\nwindow.makePic = function (e) {\n  const now = new Date()\n  const tr = now.setDate(now.getDate() + 1);\n\n  var date = new Date();\n  var year = date.getFullYear();    //  返回的是年份\n  var month = date.getMonth() + 1;  //  返回的月份上个月的月份，记得+1才是当月\n  var day = date.getDate() + 1;\n  if (month < 10) month = \"0\" + month;\n  if (day < 10) day = \"0\" + day;\n  var time = year + \"-\" + month + \"-\" + day\n\n  document.getElementById('createdate').value = time\n  let form = document.getElementById('form')\n  var tagElements = form.getElementsByTagName('input');\n  for (var j = 0; j < tagElements.length; j++) {\n    formData[tagElements[j].id] = tagElements[j].value\n  }\n  let random = parseInt(Math.random() * 1000)\n  document.getElementById('number').value = formData.endtime.replace(/\\-/g, '') + `${random > 99 ? random : `0${random}`}`\n  formData.number = document.getElementById('number').value\n  draw()\n  event.preventDefault();\n}\n\n// 下载\nwindow.donloadPic = function () {\n  if (canvas) {\n    var imgURL = canvas.toDataURL('image/jpeg');\n    var dlLink = document.createElement('a');\n    dlLink.download = document.getElementById('name').value + '-' + document.getElementById('number').value;\n    dlLink.href = imgURL;\n    dlLink.dataset.downloadurl = ['image/jpeg', dlLink.download, dlLink.href].join(':');\n    document.body.appendChild(dlLink);\n    dlLink.click();\n    document.body.removeChild(dlLink);\n    alert('下载完成!')\n  } else {\n    alert('请先生成!')\n  }\n}\n\n// 渲染canvas\n\nfunction draw() {\n  canvas = document.getElementById('canvas')\n  const context = canvas.getContext('2d')\n  // var dpr = window.devicePixelRatio || 1\n  canvas.width = 3508\n  canvas.height = 2480 \n  // context.scale(dpr, dpr)\n  context.drawImage(background, 0, 0, 3508, 2480);\n  // context.drawImage(chapter, 2665, 1684, 500, 500);\n\n  context.font = \"normal normal 600 104px Song\"\n  context.fillStyle = \"#2E3441\"\n  const x = 895 - formData.name.length * 90\n  context.fillText(formData.name, x, 1420);\n\n  context.fillText(formData.starttime, 1130, 1420);\n\n  context.fillText(formData.endtime, 1900, 1420);\n\n  context.fillText(formData.time, 1060, 1590);\n\n  context.font = \"normal normal 600 66px Song\"\n\n  context.fillText(formData.number, 629, 2056);\n  context.fillText(formData.createdate, 629, 2162);\n  var imgURL = canvas.toDataURL('image/jpeg');\n  document.getElementById('pic').src = imgURL\n  alert('完成!')\n}\n\nwindow.onload = () => {\n  if (window.sessionStorage.getItem('token') == 'xl20200702') {\n    document.getElementById('form').style.display = 'flex'\n    return\n  }\n  var ret = prompt('请输入密码');\n  if (ret) {\n    if (ret == 'xl20200702') {\n      document.getElementById('form').style.display = 'flex'\n      window.sessionStorage.setItem('token', ret)\n    } else {\n      alert('密码错误')\n      window.location.reload()\n    }\n  } else {\n    window.location.reload()\n  }\n}"]}